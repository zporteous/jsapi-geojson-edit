"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[5349],{41978:function(e,t,r){r.d(t,{AM:function(){return g}});var n=r(93433),i=r(15671),a=r(43144),l=r(60136),s=r(54062),o=r(27366),u=r(85015),c=r(93169),d=r(84652),f=r(32718),y=r(49861),h=(r(25243),r(69912)),p=r(85411),v=r(32551),m=-1,g=function(e){(0,l.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e))._from=null,n._to=null,n._final=null,n._current=[],n._time=0,n.duration=(0,c.Z)("mapview-transitions-duration"),n.effects=[],n}return(0,a.Z)(r,[{key:"effect",set:function(e){if(this._get("effect")!==(e=e||"")){this._set("effect",e);try{this._transitionTo(b(e))}catch(t){this._transitionTo([]),f.Z.getLogger(this.declaredClass).warn("Invalid Effect",{effect:e,error:t})}}}},{key:"hasEffects",get:function(){return this.transitioning||!!this.effects.length}},{key:"scale",set:function(e){this._updateForScale(e)}},{key:"transitioning",get:function(){return null!==this._to}},{key:"canTransitionTo",value:function(e){try{return this.scale>0&&_(this._current,b(e),this.scale)}catch(t){return!1}}},{key:"transitionStep",value:function(e,t){this._applyTimeTransition(e),this._updateForScale(t)}},{key:"end",value:function(){this._applyTimeTransition(this.duration)}},{key:"_transitionTo",value:function(e){this.scale>0&&_(this._current,e,this.scale)?(this._final=e,this._to=(0,d.d9)(e),function(e,t,r){for(var i,a,l=e.length>t.length?e:t,s=e.length>t.length?t:e,o=s[s.length-1],u=null!==(i=null===o||void 0===o?void 0:o.scale)&&void 0!==i?i:r,c=null!==(a=null===o||void 0===o?void 0:o.effects)&&void 0!==a?a:[],d=s.length;d<l.length;d++)s.push({scale:u,effects:(0,n.Z)(c)});for(var f=0;f<l.length;f++)s[f].scale=s[f].scale===m?r:s[f].scale,l[f].scale=l[f].scale===m?r:l[f].scale,(0,v.uF)(s[f].effects,l[f].effects)}(this._current,this._to,this.scale),this._from=(0,d.d9)(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=e),this._set("effects",this._current[0]?(0,d.d9)(this._current[0].effects):[])}},{key:"_applyTimeTransition",value:function(e){if(this._to&&this._from&&this._current&&this._final){this._time+=e;for(var t=Math.min(1,this._time/this.duration),r=0;r<this._current.length;r++){var n=this._current[r],i=this._from[r],a=this._to[r];n.scale=L(i.scale,a.scale,t);for(var l=0;l<n.effects.length;l++){var s=n.effects[l],o=i.effects[l],u=a.effects[l];s.interpolate(o,u,t)}}1===t&&(this._current=this._final,this._set("effects",this._current[0]?(0,d.d9)(this._current[0].effects):[]),this._from=this._to=this._final=null)}}},{key:"_updateForScale",value:function(e){if(this._set("scale",e),0!==this._current.length){var t,r,n=this._current,i=this._current.length-1,a=1;if(1===n.length||e>=n[0].scale)r=t=n[0].effects;else if(e<=n[i].scale)r=t=n[i].effects;else for(var l=0;l<i;l++){var s=n[l],o=n[l+1];if(s.scale>=e&&o.scale<=e){a=(e-s.scale)/(o.scale-s.scale),t=s.effects,r=o.effects;break}}for(var u=0;u<this.effects.length;u++)this.effects[u].interpolate(t[u],r[u],a)}}}]),r}(u.Z);function b(e){var t=(0,p.Q)(e)||[];return function(e){var t=e[0];return!!t&&"type"in t}(t)?[{scale:m,effects:t}]:t}function _(e,t,r){var n,i,a,l;return null===(n=e[0])||void 0===n||!n.effects||null===(i=t[0])||void 0===i||!i.effects||!(((null===(a=e[0])||void 0===a?void 0:a.scale)===m||(null===(l=t[0])||void 0===l?void 0:l.scale)===m)&&(e.length>1||t.length>1)&&r<=0)&&(0,v.AS)(e[0].effects,t[0].effects)}function L(e,t,r){return e+(t-e)*r}(0,o._)([(0,y.Cb)()],g.prototype,"_to",void 0),(0,o._)([(0,y.Cb)()],g.prototype,"duration",void 0),(0,o._)([(0,y.Cb)({value:""})],g.prototype,"effect",null),(0,o._)([(0,y.Cb)({readOnly:!0})],g.prototype,"effects",void 0),(0,o._)([(0,y.Cb)({readOnly:!0})],g.prototype,"hasEffects",null),(0,o._)([(0,y.Cb)({value:0})],g.prototype,"scale",null),(0,o._)([(0,y.Cb)({readOnly:!0})],g.prototype,"transitioning",null),g=(0,o._)([(0,h.j)("esri.layers.effects.EffectView")],g)},44041:function(e,t,r){r.d(t,{R:function(){return b}});var n=r(1413),i=r(15671),a=r(43144),l=r(60136),s=r(54062),o=r(27366),u=r(85015),c=r(41691),d=r(92026),f=r(76672),y=r(49861),h=(r(63780),r(93169),r(25243),r(69912)),p=r(45948),v=r(87072),m=r(58132),g={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"},b=function(e){(0,l.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).floors=null,n.scale=0,n}return(0,a.Z)(r,[{key:"destroy",value:function(){this.layer=null}},{key:"dynamicLayers",get:function(){var e=this;if(!this.hasDynamicLayers)return null;var t=this.visibleSublayers.map((function(t){var r=(0,v.f)(e.floors,t);return t.toExportImageJSON(r)}));return t.length?JSON.stringify(t):null}},{key:"hasDynamicLayers",get:function(){return this.layer&&(0,m.FN)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}},{key:"layer",set:function(e){var t=this;this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(function(){return t.notifyChange("visibleSublayers")})),e.on("sublayer-update",(function(e){return t.notifyChange(g[e.propertyName])}))],"layer"))}},{key:"layers",get:function(){var e=this.visibleSublayers;return e?e.length?"show:"+e.map((function(e){return e.id})).join(","):"show:-1":null}},{key:"layerDefs",get:function(){var e,t=this,r=!(null===(e=this.floors)||void 0===e||!e.length),n=this.visibleSublayers.filter((function(e){return null!=e.definitionExpression||r&&null!=e.floorInfo}));return n.length?JSON.stringify(n.reduce((function(e,r){var n=(0,v.f)(t.floors,r),i=(0,f._)(n,r.definitionExpression);return(0,d.pC)(i)&&(e[r.id]=i),e}),{})):null}},{key:"version",get:function(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");var e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}},{key:"visibleSublayers",get:function(){var e=this,t=[];if(!this.layer)return t;var r=this.layer.sublayers;r&&r.forEach((function r(n){var i=e.scale,a=0===i,l=0===n.minScale||i<=n.minScale,s=0===n.maxScale||i>=n.maxScale;n.visible&&(a||l&&s)&&(n.sublayers?n.sublayers.forEach(r):t.unshift(n))}));var n=this._get("visibleSublayers");return!n||n.length!==t.length||n.some((function(e,r){return t[r]!==e}))?t:n}},{key:"toJSON",value:function(){var e=this.layer,t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t=(0,n.Z)((0,n.Z)({},t),{},{layers:this.layers,layerDefs:this.layerDefs}),t}}]),r}((0,c.p)(u.Z));(0,o._)([(0,y.Cb)({readOnly:!0})],b.prototype,"dynamicLayers",null),(0,o._)([(0,y.Cb)()],b.prototype,"floors",void 0),(0,o._)([(0,y.Cb)({readOnly:!0})],b.prototype,"hasDynamicLayers",null),(0,o._)([(0,y.Cb)()],b.prototype,"layer",null),(0,o._)([(0,y.Cb)({readOnly:!0})],b.prototype,"layers",null),(0,o._)([(0,y.Cb)({readOnly:!0})],b.prototype,"layerDefs",null),(0,o._)([(0,y.Cb)({type:Number})],b.prototype,"scale",void 0),(0,o._)([(0,y.Cb)(p.qG)],b.prototype,"timeExtent",void 0),(0,o._)([(0,y.Cb)({readOnly:!0})],b.prototype,"version",null),(0,o._)([(0,y.Cb)({readOnly:!0})],b.prototype,"visibleSublayers",null),b=(0,o._)([(0,h.j)("esri.layers.mixins.ExportImageParameters")],b)},87072:function(e,t,r){function n(e){var t,r=e.layer;return"floorInfo"in r&&null!==(t=r.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?a(e.view.floors,r.floorInfo.floorField):null}function i(e,t){var r;return"floorInfo"in t&&null!==(r=t.floorInfo)&&void 0!==r&&r.floorField?a(e,t.floorInfo.floorField):null}function a(e,t){if(null===e||void 0===e||!e.length)return null;var r=e.filter((function(e){return""!==e})).map((function(e){return"'".concat(e,"'")}));return r.push("''"),"".concat(t," IN (").concat(r.join(","),") OR ").concat(t," IS NULL")}r.d(t,{c:function(){return n},f:function(){return i}})},58132:function(e,t,r){r.d(t,{FN:function(){return s},QV:function(){return l},ac:function(){return u}});var n=r(37762),i=r(92026),a=r(25265);function l(e,t,r){return t.flatten((function(e){return e.sublayers})).length!==e.length||(!!e.some((function(e){return e.originIdOf("minScale")>r||e.originIdOf("maxScale")>r||e.originIdOf("renderer")>r||e.originIdOf("labelingInfo")>r||e.originIdOf("opacity")>r||e.originIdOf("labelsVisible")>r||e.originIdOf("source")>r}))||!o(e,t))}function s(e,t,r){return!!e.some((function(e){var t=e.source;return!(!t||"map-layer"===t.type&&t.mapLayerId===e.id&&((0,i.Wi)(t.gdbVersion)||t.gdbVersion===r))||e.originIdOf("renderer")>a.s3.SERVICE||e.originIdOf("labelingInfo")>a.s3.SERVICE||e.originIdOf("opacity")>a.s3.SERVICE||e.originIdOf("labelsVisible")>a.s3.SERVICE}))||!o(e,t)}function o(e,t){if(!e||!e.length||(0,i.Wi)(t))return!0;var r=t.slice().reverse().flatten((function(e){var t=e.sublayers;return t&&t.toArray().reverse()})).map((function(e){return e.id})).toArray();if(e.length>r.length)return!1;var a,l=0,s=r.length,o=(0,n.Z)(e);try{for(o.s();!(a=o.n()).done;){for(var u=a.value.id;l<s&&r[l]!==u;)l++;if(l>=s)return!1}}catch(c){o.e(c)}finally{o.f()}return!0}function u(e){return!!e&&e.some((function(e){return null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale}))}},61029:function(e,t,r){r.d(t,{e:function(){return l},s:function(){return s}});r(93169);var n=r(10064),i=r(92026),a=r(23707);function l(e){return(0,i.Wi)(e)||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type||"heatmap"===e.type}function s(e){if((0,i.Wi)(e))return null;if(!l(e))return new n.Z("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '".concat(e.type||e.declaredClass,"'"),{renderer:e});switch(e.type){case"simple":return function(e){return o(e,(0,a.q)(e.symbol).error)}(e);case"unique-value":return function(e){var t=e.uniqueValueInfos.map((function(e){return(0,a.q)(e.symbol).error})).filter((function(e){return!!e})),r=(0,a.q)(e.defaultSymbol);return r.error&&t.unshift(r.error),o(e,t)}(e);case"class-breaks":return function(e){var t=e.classBreakInfos.map((function(e){return(0,a.q)(e.symbol).error})).filter((function(e){return!!e})),r=(0,a.q)(e.defaultSymbol);return r.error&&t.unshift(r.error),o(e,t)}(e);case"dictionary":case"heatmap":return null}return null}function o(e,t){if(!t)return null;var r;if((r=Array.isArray(t)?t:[t]).length>0){var i=r.map((function(e){return e.details.symbol.type||e.details.symbol.declaredClass})).filter((function(e){return!!e}));i.sort();var a=[];return i.forEach((function(e,t){0!==t&&e===i[t-1]||a.push(e)})),new n.Z("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols (".concat(a.join(", "),") which are not supported in 3D"),{renderer:e,symbolErrors:r})}return null}},65349:function(e,t,r){r.r(t),r.d(t,{default:function(){return Un}});var n=r(1413),i=r(15671),a=r(43144),l=r(60136),s=r(54062),o=r(27366),u=r(100),c=r(92026),d=r(94172),f=r(8025),y=(r(63780),r(93169),r(89125)),h=r(49861),p=r(69912),v=r(69407),m=(r(59166),r(85015)),g=r(40281),b=(r(25243),r(37762)),_=r(74165),L=r(93433),w=r(15861),k=r(51995),S=r(19545),x=r(76200),I=r(51508),C=r(43404),E=r(32718),Z=r(66978),V=r(17842),R=r(35995),F=r(25265),z=r(41978),A=r(60676),T=r(44041),M=r(37270),P=r(9014),D=r(61029),N=r(12726),O=r(49729),B=r(37817),H=r(69157),q=r(86828),W=r(74579),U=r(245);function Y(e,t){if(!e||!("visualVariables"in e)||!e.visualVariables)return null;var r=e.visualVariables.find((function(e){return"size"===e.type})),n=function(e,t){var r=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return null!==t&&void 0!==t&&t.levels?t.levels[r]:null}(t,r);return n?new U.Z({field:r.field,minSize:n[2].size,minDataValue:n[2].value,maxSize:n[3].size,maxDataValue:n[3].value}):null}var j=r(226),J=r(40778),G=(r(84652),r(79563)),Q=r(36009),X={HH:315,HL:45,LL:135,LH:225},$={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function K(e){if(e){var t=e.type;if(t.includes("3d"))return(0,Q.getSymbolLayerFill)(e.symbolLayers.getItemAt(0));if("simple-line"===t){var r=(0,G.mx)(e);return r&&r.color}if("simple-marker"===e.type&&("x"===e.style||"cross"===e.style)){var n=(0,G.mx)(e);return n&&n.color}return(0,G._M)(e)}}function ee(e,t){var r=t.HH.label,n=t.LL.label,i=t.HL.label,a=t.LH.label;switch(e){case"HH":default:return{top:r,bottom:n,left:i,right:a};case"HL":return{top:i,bottom:a,left:n,right:r};case"LL":return{top:n,bottom:r,left:a,right:i};case"LH":return{top:a,bottom:i,left:r,right:n}}}function te(e){var t=e.focus,r=e.infos,n=e.numClasses,i=$[n],a={};r.forEach((function(e){a[e.value]={label:e.label,fill:K(e.symbol)}}));for(var l=[],s=0;s<n;s++){for(var o=[],u=0;u<n;u++){var c=a[i[s][u]];o.push(c.fill)}l.push(o)}return{type:"relationship-ramp",numClasses:n,focus:t,colors:l,labels:ee(t,a),rotation:re(t)}}function re(e){var t=X[e];return e&&null==t&&(t=X.HH),t||0}var ne=r(29439),ie=r(4075),ae=r(75434),le=r(80975),se=r(37384),oe=r(16072),ue=r(16851),ce=[255,255,255],de=[200,200,200],fe=[128,128,128];function ye(e,t){var r=e.length-1;return e.map((function(e,n){return(0,ae.MN)(e,n,r,t)}))}function he(e,t,r,n,i,a){return pe.apply(this,arguments)}function pe(){return pe=(0,w.Z)((0,_.Z)().mark((function e(t,r,n,i,a,l){var s,o,u,c,d,f,y,h,p,v,m,g,b,L,k,S,x,I,C,E;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=r.legendOptions,c=u&&u.customValues,e.next=4,ge(t,n);case 4:if(d=e.sent,f=!!d,y=!!c,h=null!=r.minSize&&null!=r.maxSize,p=r.stops&&r.stops.length>1,v=!!r.target,f&&(y||h||p&&!v)){e.next=12;break}return e.abrupt("return");case 12:if(m=(0,W.YW)(d),g=null,b=null,L=null,!m||p){e.next=18;break}e.t0=(0,ie.NM)([r.minDataValue,r.maxDataValue]),e.next=24;break;case 18:if(e.t1=c,e.t1){e.next=23;break}return e.next=22,ke(r,d,i,a);case 22:e.t1=e.sent;case 23:e.t0=e.t1;case 24:if(b=e.t0,k=null===t||void 0===t?void 0:t.authoringInfo,S="univariate-color-size"===(null===k||void 0===k?void 0:k.type),x=S&&"above-and-below"===(null===k||void 0===k?void 0:k.univariateTheme),!b&&p&&(b=r.stops.map((function(e){return e.value})),g=r.stops.some((function(e){return!!e.label})),"flow"===t.type&&(b=(0,ie.NM)(b)),g&&(L=r.stops.map((function(e){return e.label})))),m&&(null===(s=b)||void 0===s?void 0:s.length)>2&&!x&&(b=[b[0],b[b.length-1]]),b){e.next=28;break}return e.abrupt("return",null);case 28:return S&&5!==(null===(o=b)||void 0===o?void 0:o.length)&&(b=xe({minSize:b[0],maxSize:b[b.length-1]})),I=m?ve(t,b):null,C=(0,W.Y6)(d),E=g?null:ye(b,l),e.next=32,Promise.all(b.map(function(){var e=(0,w.Z)((0,_.Z)().mark((function e(n,l){var s;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!m){e.next=4;break}e.t0=I[l],e.next=7;break;case 4:return e.next=6,Ze(r,d,n,i,a);case 6:e.t0=e.sent;case 7:return s=e.t0,e.abrupt("return",{value:n,symbol:Re(x&&"class-breaks"===t.type?me(t,l):d,s),label:g?L[l]:E[l],size:s,outlineSize:C});case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()));case 32:return e.abrupt("return",e.sent.reverse());case 33:case"end":return e.stop()}}),e)}))),pe.apply(this,arguments)}function ve(e,t){var r=null===e||void 0===e?void 0:e.authoringInfo,n="univariate-color-size"===(null===r||void 0===r?void 0:r.type),i=[12,30];if(n){var a=t[0],l=t[t.length-1];i=t.map((function(e){return 12+(e-a)/(l-a)*18}))}return n&&"below"===(null===r||void 0===r?void 0:r.univariateTheme)&&i.reverse(),i}function me(e,t){var r=e.classBreakInfos,n=r.length,i=n<2||!(t>=2)?r[0].symbol.clone():r[n-1].symbol.clone();return e.visualVariables.some((function(e){return"color"===e.type}))&&(i.type.includes("3d")?Le(i):we(i)),i}function ge(e,t){return be.apply(this,arguments)}function be(){return be=(0,w.Z)((0,_.Z)().mark((function e(t,r){var n,i,a,l,s;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("flow"!==t.type){e.next=2;break}return e.abrupt("return",(0,ae.y$)(t,r));case 2:if("pie-chart"!==t.type){e.next=4;break}return e.abrupt("return",new oe.default({color:null,outline:null!==(n=t.outline)&&void 0!==n&&n.width?t.outline:new ue.default}));case 4:return i=null,a=null,"simple"===t.type?i=t.symbol:"class-breaks"===t.type?(l=t.classBreakInfos,i=l&&l[0]&&l[0].symbol,a=l.length>1):"unique-value"===t.type&&(s=t.uniqueValueInfos,i=s&&s[0]&&s[0].symbol,a=s.length>1),e.abrupt("return",!i||_e(i)?null:(i=i.clone(),(r||a)&&(i.type.includes("3d")?Le(i):we(i)),i));case 7:case"end":return e.stop()}}),e)}))),be.apply(this,arguments)}function _e(e){return!!e&&((0,I.dU)(e)?!!e.symbolLayers&&e.symbolLayers.some((function(e){return e&&"fill"===e.type})):e.type.includes("fill"))}function Le(e){"line-3d"===e.type?e.symbolLayers.forEach((function(e){e.material={color:fe}})):e.symbolLayers.forEach((function(e){"icon"!==e.type||e.resource&&e.resource.href?e.material={color:de}:(e.material={color:ce},e.outline={color:fe,size:1.5})}))}function we(e){var t=(0,se.$o)();if("cim"===e.type)(0,O.ZB)(e,new k.Z(de));else if(e.type.includes("line"))e.color=fe;else if(e.color=t?fe:ce,"simple-marker"===e.type)if(e.outline){var r,n;"#ffffff"===(null===(r=e.outline)||void 0===r||null===(n=r.color)||void 0===n?void 0:n.toHex())&&(e.outline.color=fe)}else e.outline={color:fe,width:1.5}}function ke(e,t,r,n){return Se.apply(this,arguments)}function Se(){return Se=(0,w.Z)((0,_.Z)().mark((function e(t,n,i,a){var l,s,o,u,c;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(r.bind(r,56011));case 2:if(l=e.sent.getSizeRangeAtScale(t,i,a),s=l&&xe(l),l||s){e.next=6;break}return e.abrupt("return");case 6:o=s.map((function(e){return Ie(e,t,l)})),o=(0,ie.NM)(o),u=1;case 9:if(!(u<o.length-1)){e.next=17;break}return e.next=12,Ce(t,n,o[u],o[u-1],i,a);case 12:(c=e.sent)&&(o[u]=c[0],s[u]=c[1]);case 14:u++,e.next=9;break;case 17:return e.abrupt("return",o);case 18:case"end":return e.stop()}}),e)}))),Se.apply(this,arguments)}function xe(e){for(var t=e.minSize,r=(e.maxSize-t)/4,n=[],i=0;i<5;i++)n.push(t+r*i);return n}function Ie(e,t,r){var n=r.minSize,i=r.maxSize,a=t.minDataValue,l=t.maxDataValue;return e<=n?a:e>=i?l:(e-n)/(i-n)*(l-a)+a}function Ce(e,t,r,n,i,a){return Ee.apply(this,arguments)}function Ee(){return Ee=(0,w.Z)((0,_.Z)().mark((function e(t,r,n,i,a,l){var s,o,u,c,d,f,y,h,p,v,m,g,b,L,w,k,S,x,I,C,E,Z,V;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ze(t,r,n,a,l);case 2:return s=e.sent,e.next=5,Ze(t,r,i,a,l);case 5:o=e.sent,u=(0,ie.D2)(n),c=u.fractional,d=20,f=u.integer,y=null,h=null,n>0&&n<1&&(y=Math.pow(10,c),f=(0,ie.D2)(n*=y).integer),p=f-1;case 12:if(!(p>=0)){e.next=38;break}return v=Math.pow(10,p),m=Math.floor(n/v)*v,g=Math.ceil(n/v)*v,null!=y&&(m/=y,g/=y),b=(m+g)/2,L=(0,ie.NM)([m,b,g],{indexes:[1]}),w=(0,ne.Z)(L,2),b=w[1],e.next=22,Ze(t,r,m,a,l);case 22:return k=e.sent,e.next=25,Ze(t,r,g,a,l);case 25:return S=e.sent,e.next=28,Ze(t,r,b,a,l);case 28:if(x=e.sent,I=(0,ie.f1)(s,k,o,null),C=(0,ie.f1)(s,S,o,null),E=(0,ie.f1)(s,x,o,null),Z=I.previous<=d,V=C.previous<=d,Z&&V&&(I.previous<=C.previous?(Z=!0,V=!1):(V=!0,Z=!1)),Z?h=[m,k]:V?h=[g,S]:E.previous<=d&&(h=[b,x]),!h){e.next=35;break}return e.abrupt("break",38);case 35:p--,e.next=12;break;case 38:return e.abrupt("return",h);case 39:case"end":return e.stop()}}),e)}))),Ee.apply(this,arguments)}function Ze(e,t,r,n,i){return Ve.apply(this,arguments)}function Ve(){return Ve=(0,w.Z)((0,_.Z)().mark((function e(t,n,i,a,l){var s,o;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(r.bind(r,56011));case 2:return s=e.sent,o=s.getSize,e.abrupt("return",o(t,i,{scale:a,view:l,shape:"simple-marker"===n.type?n.style:null}));case 5:case"end":return e.stop()}}),e)}))),Ve.apply(this,arguments)}function Re(e,t){var r=e.clone();if((0,I.dU)(r))(0,W.YW)(r)||r.symbolLayers.forEach((function(e){"fill"!==e.type&&(e.size=t)}));else if(function(e){return"esri.symbols.SimpleMarkerSymbol"===e.declaredClass}(r))r.size=t;else if(function(e){return"esri.symbols.PictureMarkerSymbol"===e.declaredClass}(r)){var n=r.width,i=r.height;r.height=t,r.width=t*(n/i)}else!function(e){return"esri.symbols.SimpleLineSymbol"===e.declaredClass}(r)?function(e){return"esri.symbols.TextSymbol"===e.declaredClass}(r)&&r.font&&(r.font.size=t):r.width=t;return r}r(76969);var Fe=r(6291);r(99388);function ze(e){var t=Math.floor(Math.log10(Math.abs(e)))+1,r=t<4||t>6?4:t,n=Math.abs(e)>=1e6?"compact":"standard";return(0,Fe.uf)(e,{notation:n,minimumSignificantDigits:2,maximumSignificantDigits:r})}var Ae=r(61459),Te=E.Z.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),Me=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,Pe=new C.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),De={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},Ne=new oe.default({size:6,outline:{color:[128,128,128,.5],width:.5}}),Oe=new Ae.default({style:"solid"});function Be(e){return"flow"===e.type}function He(e){return"vector-field"===e.type}function qe(e){return"raster-colormap"===e.type}function We(e){return"raster-stretch"===e.type}function Ue(e){return"raster-shaded-relief"===e.type}function Ye(e){return"esri.renderers.SimpleRenderer"===e.declaredClass}function je(e){return"esri.renderers.ClassBreaksRenderer"===e.declaredClass}function Je(e){return"esri.renderers.UniqueValueRenderer"===e.declaredClass}function Ge(e){return"esri.renderers.HeatmapRenderer"===e.declaredClass}function Qe(e){return Xe(e)||$e(e)||Ke(e)||function(e){return"esri.renderers.PointCloudRGBRenderer"===e.declaredClass}(e)}function Xe(e){return"esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function $e(e){return"esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function Ke(e){return"esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function et(e){return"esri.renderers.DotDensityRenderer"===e.declaredClass}function tt(e){return"esri.renderers.PieChartRenderer"===e.declaredClass}function rt(e,t){return Ye(e)||je(e)||Je(e)||Ge(e)||et(e)||tt(e)?"2d"===t.type||(0,D.e)(e):We(e)||qe(e)||Ue(e)||Xe(e)||$e(e)||Ke(e)||He(e)||Be(e)}function nt(e){return"esri.layers.BuildingSceneLayer"===e.declaredClass}function it(e){return"esri.layers.VoxelLayer"===e.declaredClass}function at(e){return"esri.layers.WMSLayer"===e.declaredClass}function lt(e){return"esri.layers.WMTSLayer"===e.declaredClass}function st(e){return"esri.layers.MapImageLayer"===e.declaredClass}function ot(e){return"esri.layers.TileLayer"===e.declaredClass}function ut(e){return"esri.layers.FeatureLayer"===e.declaredClass}function ct(e){return"esri.layers.ImageryLayer"===e.declaredClass}function dt(e){return"esri.layers.ImageryTileLayer"===e.declaredClass}function ft(e){return"esri.layers.WCSLayer"===e.declaredClass}function yt(e){return"stretch-ramp"===e.type}function ht(e){var t;return"univariate-color-size"===(null===(t="authoringInfo"in e&&(null===e||void 0===e?void 0:e.authoringInfo))||void 0===t?void 0:t.type)}function pt(e){var t="authoringInfo"in e&&(null===e||void 0===e?void 0:e.authoringInfo);return"univariate-color-size"===(null===t||void 0===t?void 0:t.type)&&"above-and-below"===(null===t||void 0===t?void 0:t.univariateTheme)}var vt=new oe.default({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}}),mt={},gt=function(e){(0,l.Z)(o,e);var t=(0,s.Z)(o);function o(e){var r;return(0,i.Z)(this,o),(r=t.call(this,e))._handles=new u.Z,r._hasColorRamp=!1,r._hasOpacityRamp=!1,r._hasSizeRamp=!1,r._webStyleSymbolCache=new Map,r._dotDensityUrlCache=new Map,r._scaleDrivenSizeVariable=null,r._hasClusterSizeVariable=!1,r.children=new g.Z,r.layerView=null,r.layer=null,r.legendElements=[],r.parent=null,r.hideLayersNotInCurrentView=!1,r.keepCacheOnDestroy=!1,r.respectLayerVisibility=!0,r.sublayerIds=[],r.title=null,r.view=null,r}return(0,a.Z)(o,[{key:"initialize",value:function(){var e=this,t=function(){return e.notifyChange("ready")};this._handles.add([(0,d.on)((function(){return e.children}),"change",(function(r){var n=r.added,i=r.removed,a=e._handles;n.forEach((function(e){var r="activeLayerInfo-ready-watcher-".concat(e.layer.uid);a.add((0,d.YP)((function(){return e.ready}),t,d.nn),r)})),i.forEach((function(e){return a.remove(e.layer.uid)})),t()}))]),this.keepCacheOnDestroy||(mt={})}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(mt=null)}},{key:"effectList",get:function(){var e=this.layer,t=null;return"effect"in e&&e.effect&&((t=new z.AM).effect=e.effect,t.end(),t.scale=this.scale),t}},{key:"opacity",get:function(){var e,t=this.layer.opacity,r=null===(e=this.parent)||void 0===e?void 0:e.opacity,n=this.layer.parent,i=n&&"uid"in n?this._getParentLayerOpacity(n):null;return null!=r?r*t:null!=i?i*t:t}},{key:"ready",get:function(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}},{key:"scale",get:function(){return this.view&&this.view.scale}},{key:"isScaleDriven",get:function(){var e=this.layer;if(null===e)return!1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return!0;if("featureReduction"in e&&e.featureReduction){if("cluster"===e.featureReduction.type)return!0;if("binning"===e.featureReduction.type&&"renderer"in e.featureReduction&&e.featureReduction.renderer)return this._isRendererScaleDriven(e.featureReduction.renderer)}return"renderer"in e&&e.renderer?this._isRendererScaleDriven(e.renderer):this._isLayerScaleDriven(this.layer)}},{key:"version",get:function(){return this._get("version")+1}},{key:"buildLegendElementsForFeatureCollections",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(t){var r,n,i=this;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=!this.hideLayersNotInCurrentView,e.t0){e.next=5;break}return e.next=4,this._isLayerInCurrentView();case 4:e.t0=e.sent;case 5:if(e.t0){e.next=7;break}return e.abrupt("return",(this.legendElements=[],void this.notifyChange("ready")));case 7:return r=Array.from(t,(function(e){if(ut(e))return i._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet&&e.featureSet.features.length){var t=e.layerDefinition,r=t&&t.drawingInfo,n=r&&(0,P.i)(r.renderer),a=Pe.read(t.geometryType);return n?i._getRendererLegendElements(n,{title:e.name,geometryType:a}):(Te.warn("drawingInfo not available!"),null)}return null})),e.prev=8,n=[],e.next=12,(0,Z.as)(r).then((function(e){e.forEach((function(e){var t=e.value;return t&&n.push.apply(n,(0,L.Z)(t))}))}));case 12:this.legendElements=n,this.notifyChange("ready"),e.next=19;break;case 16:e.prev=16,e.t1=e.catch(8),Te.warn("error while building legend for layer!",e.t1);case 19:case"end":return e.stop()}}),e,this,[[8,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"buildLegendElementsForRenderer",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(t){return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,e.t0=!this.hideLayersNotInCurrentView,e.t0){e.next=6;break}return e.next=5,this._isLayerInCurrentView();case 5:e.t0=e.sent;case 6:if(!e.t0){e.next=13;break}return e.next=10,this._getRendererLegendElements(t);case 10:e.t1=e.sent,e.next=14;break;case 13:e.t1=[];case 14:this.legendElements=e.t1,this.notifyChange("ready"),e.next=21;break;case 18:e.prev=18,e.t2=e.catch(0),Te.warn("error while building legend for layer!",e.t2);case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"buildLegendElementsForTools",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(){var t,r,n,i,a=this;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!it(t=this.layer)){e.next=5;break}this._constructLegendElementsForVoxellayer(),e.next=29;break;case 5:if(!lt(t)){e.next=9;break}this._constructLegendElementsForWMTSlayer(),e.next=29;break;case 9:if(!at(t)){e.next=14;break}return e.next=12,this._constructLegendElementsForWMSSublayers();case 12:case 17:case 22:e.next=29;break;case 14:if(!nt(t)){e.next=19;break}return e.next=17,this._constructLegendElementsForBuildingSceneLayer();case 19:if(!(st(t)||ot(t)||nt(t))){e.next=24;break}return e.next=22,this._constructLegendElementsForSublayers();case 24:return this._handles.remove("imageryLayers-watcher"),r="default",ct(t)&&(r=((null===t||void 0===t||null===(n=t.renderingRule)||void 0===n?void 0:n.functionName)||"default")+"_"+(null!==(i=t.bandIds)&&void 0!==i&&i.length?t.bandIds.join(""):"###")),e.next=29,this._getLegendLayers("".concat(t.uid,"-").concat(r)).then(function(){var e=(0,w.Z)((0,_.Z)().mark((function e(r){var n;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.legendElements=[],a.notifyChange("ready"),n=r.map(function(){var e=(0,w.Z)((0,_.Z)().mark((function e(r){var n,i;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(ct(t)||dt(t))&&(n=(0,d.YP)((function(){return["renderingRule"in t&&t.renderingRule,t.bandIds]}),(function(){return(0,Z.Ds)((0,w.Z)((0,_.Z)().mark((function e(){return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(mt.default=null,!t.renderer){e.next=6;break}return e.next=4,a.buildLegendElementsForRenderer(t.renderer);case 4:e.next=8;break;case 6:return e.next=8,a.buildLegendElementsForTools();case 8:case"end":return e.stop()}}),e)}))))()})),a._handles.add(n,"imageryLayers-watcher")),(i=a._generateSymbolTableElementForLegendLayer(r))&&i.infos.length&&(ct(t)&&(i.title=t.title),a.legendElements.push(i)),a.notifyChange("ready");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,(0,Z.as)(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){Te.warn("Request to server for legend has failed!",e)}));case 29:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_isLayerInCurrentView",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(){var t,r,n,i;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.layer,r=this.layerView,(n=r&&"createQuery"in r&&"queryFeatureCount"in r)||r&&"createQuery"in t&&"queryFeatureCount"in t){e.next=3;break}return e.abrupt("return",!0);case 3:return e.next=5,(0,d.N1)((function(){return!r.updating}));case 5:if((i=n?"createQuery"in r&&r.createQuery():"createQuery"in t&&t.createQuery()).geometry=this.view.extent,!n){e.next=16;break}if(e.t1="queryFeatureCount"in r,!e.t1){e.next=13;break}return e.next=12,r.queryFeatureCount(i);case 12:e.t1=e.sent;case 13:e.t0=e.t1,e.next=22;break;case 16:if(e.t2="queryFeatureCount"in t,!e.t2){e.next=21;break}return e.next=20,t.queryFeatureCount(i);case 20:e.t2=e.sent;case 21:e.t0=e.t2;case 22:return e.t3=e.t0,e.abrupt("return",0!==e.t3);case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getParentLayerOpacity",value:function(e){var t=1,r=e.parent;return r&&"uid"in r&&(t=this._getParentLayerOpacity(r)),e.opacity*t}},{key:"_isGroupActive",value:function(){var e=this.children;return!!e.length&&e.some((function(e){return e.ready}))}},{key:"_isRendererScaleDriven",value:function(e){var t=this;if("dot-density"===e.type)return!0;var r="valueExpression"in e&&e.valueExpression;if(Me.test(r))return!0;var n="visualVariables"in e&&e.visualVariables;return!!n&&n.some((function(e){return t._isScaleDrivenSizeVariable(e)}))}},{key:"_isScaleDrivenSizeVariable",value:function(e){if(e&&"size"!==e.type)return!1;var t=e,r=t.minSize,n=t.maxSize;return"object"==typeof r&&r?this._isScaleDrivenSizeVariable(r):"object"==typeof n&&n?this._isScaleDrivenSizeVariable(n):!!t.expression||Me.test(t.valueExpression)}},{key:"_isLayerScaleDriven",value:function(e){var t=this;if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some((function(e){return t._isLayerScaleDriven(e)}));var r=e.parent;if(!1===e.loaded&&r&&st(r)&&"source"in e&&e.source&&"map-layer"===e.source.type){var n,i=(0,b.Z)(r.sourceJSON.layers);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a.id===e.source.mapLayerId&&(a.minScale>0||a.maxScale>0))return!0}}catch(l){i.e(l)}finally{i.f()}}return!1}},{key:"_constructLegendElementsForVoxellayer",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(){var t,r,n,i,a,l,s,o,u,f,y,h,p,v=this;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("voxel-style-watcher"),r=this.layer,this._handles.add((0,d.YP)((function(){return r.currentVariableId}),(function(){return v._constructLegendElementsForVoxellayer()})),"voxel-style-watcher"),n=(0,c.Wg)(r.getVariableStyle(null)),i=[],n&&(null!==(t=n.uniqueValues)&&void 0!==t&&t.length?(a=[],n.uniqueValues.forEach((function(e){e.enabled&&a.push({label:e.label||"".concat(e.value),value:e.value,symbol:new Ae.default({color:e.color,outline:null})})})),a.length&&i.push({type:"symbol-table",title:n.label,infos:a})):n.transferFunction&&(l=n.transferFunction,s=l.colorStops,o=l.stretchRange,u=s.toArray().reverse(),f=o.map((function(e,t){return"".concat(0===t?ae.zZ:ae.Eh," ").concat(ze(e))})).reverse(),y=u.map((function(e){return{color:e.color,value:null,label:null}})),y[0].label=f[0],y[y.length-1].label=f[1],i.push({type:"color-ramp",title:n.label,infos:y,preview:(0,q.jT)(u.map((function(e){return e.color})))}))),h=r.opacity,p=i.reduce((function(e,t){return e.concat(v._getAllInfos(t))}),[]).filter((function(e){return!(null===e||void 0===e||!e.symbol)})).map((function(e){return v._getSymbolPreview(e,h)})),e.next=8,(0,Z.as)(p);case 8:this.legendElements=i,this.notifyChange("ready");case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_constructLegendElementsForWMTSlayer",value:function(){var e=this;this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");var t=this.layer.activeLayer;if(this._handles.add((0,d.YP)((function(){var t=e.layer;return t&&"activeLayer"in t&&t.activeLayer}),(function(){return e._constructLegendElementsForWMTSlayer()})),"wmts-activeLayer-watcher"),t.styleId&&t.styles){var r=null;t.styles.some((function(e){return t.styleId===e.id&&(r=e.legendUrl,!0)})),r&&(this.legendElements=[{type:"symbol-table",title:t.title,infos:[{src:r,opacity:this.opacity}]}])}this.notifyChange("ready")}},{key:"_constructLegendElementsForWMSSublayers",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(){var t,r,i=this;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("wms-sublayers-watcher"),t=this.layer,r=null,(t.customParameters||t.customLayerParameters)&&(r=(0,n.Z)((0,n.Z)({},t.customParameters),t.customLayerParameters)),this._handles.add((0,d.YP)((function(){var e=i.layer;return e&&"sublayers"in e&&e.sublayers}),(function(){return i._constructLegendElementsForWMSSublayers()})),"wms-sublayers-watcher"),e.next=7,this._generateLegendElementsForWMSSublayers(t.sublayers,r);case 7:this.legendElements=e.sent,this.notifyChange("ready");case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForWMSSublayers",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(t,r){var n,i,a,l,s,o=this;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],this._handles.add(t.on("change",(function(){return o._constructLegendElementsForWMSSublayers()})),"wms-sublayers-watcher"),i=t.toArray(),a=(0,b.Z)(i),e.prev=4,s=(0,_.Z)().mark((function e(){var t,i,a;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.value,i=(0,d.YP)((function(){return[t.title,t.visible,t.legendEnabled]}),(function(){return o._constructLegendElementsForWMSSublayers()})),o._handles.add(i,"wms-sublayers-watcher"),!(!o.respectLayerVisibility||t.visible&&t.legendEnabled)){e.next=7;break}return e.next=5,o._generateSymbolTableElementForWMSSublayer(t,r);case 5:(a=e.sent)&&a.infos.length&&n.unshift(a);case 7:case"end":return e.stop()}}),e)})),a.s();case 7:if((l=a.n()).done){e.next=11;break}return e.delegateYield(s(),"t0",9);case 9:e.next=7;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(4),a.e(e.t1);case 16:return e.prev=16,a.f(),e.finish(16);case 19:return e.abrupt("return",n);case 20:case"end":return e.stop()}}),e,this,[[4,13,16,19]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForWMSSublayer",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(t,r){var n;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.legendUrl||!t.sublayers){e.next=5;break}return e.next=3,this._generateLegendElementsForWMSSublayers(t.sublayers,r);case 3:return n=e.sent.filter((function(e){return e})),e.abrupt("return",{type:"symbol-table",title:t.title,infos:n});case 5:return e.abrupt("return",this._generateSymbolTableElementForLegendUrl(t,r));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForLegendUrl",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(t,r){var n,i,a,l,s;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.legendUrl){e.next=3;break}return e.abrupt("return");case 3:return a={type:"symbol-table",title:t.title||t.name||t.id&&t.id+"",infos:[]},r&&(i=(0,R.fl)(i,r)),l=null,s=null===(n=t.layer)||void 0===n?void 0:n.opacity,e.prev=7,e.next=10,(0,x.default)(i,{responseType:"image"});case 10:(l=e.sent.data)&&(l.style.opacity=s),e.next=16;break;case 14:e.prev=14,e.t0=e.catch(7);case 16:return e.abrupt("return",(a.infos.push({src:i,preview:l,opacity:s}),a));case 17:case"end":return e.stop()}}),e,null,[[7,14]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getLegendLayers",value:function(e,t){var r=mt&&mt[e];return r?Promise.resolve(r):this._legendRequest(t).then((function(t){var r=t.layers;return mt[e]=r,r}))}},{key:"_legendRequest",value:function(e){var t=this.layer,r={f:"json",dynamicLayers:e};if(ct(t)){var i=t.exportImageServiceParameters.renderingRule;if(i&&(r.renderingRule=JSON.stringify(i.rasterFunctionDefinition||i.toJSON())),t.bandIds&&(r.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){var a=t.raster,l=t.viewId,s=t.customParameters;r=(0,n.Z)((0,n.Z)({raster:a,viewId:l},r),s)}}var o=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){var u=o.indexOf("?");u>-1?o=o.substring(0,u)+"/legend"+o.substring(u):o+="/legend"}else{var c=o.toLowerCase().indexOf("/rest/"),d=o.substring(0,c)+o.substring(c+5,o.length);o="https://utility.arcgis.com/sharing/tools/legend?soapUrl="+encodeURI(d)+"&returnbytes=true"}return(0,x.default)(o,{query:r}).then((function(e){return e.data}))}},{key:"_constructLegendElementsForBuildingSceneLayer",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(){var t,r=this;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("sublayers-watcher"),t=this.layer,this._handles.add((0,d.YP)((function(){return t.sublayers}),(function(){return r._constructLegendElementsForBuildingSceneLayer()})),"sublayers-watcher"),e.prev=3,e.next=6,this._generateLegendElementsForBuildingSublayers(t.sublayers,this.opacity);case 6:this.legendElements=e.sent,this.notifyChange("ready"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),Te.warn("Request to server for legend has failed!",e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForBuildingSublayers",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(t,r){var n,i,a,l,s,o=this;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],this._handles.add(t.on("change",(function(){return o._constructLegendElementsForBuildingSceneLayer()})),"sublayers-watcher"),i=t.toArray(),a=(0,b.Z)(i),e.prev=4,s=(0,_.Z)().mark((function e(){var t,i,a,s,u,c,f;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.value,i=(0,d.YP)((function(){return["renderer"in t&&t.renderer,t.opacity,t.title,t.visible]}),(function(){return o._constructLegendElementsForBuildingSceneLayer()})),o._handles.add(i,"sublayers-watcher"),o.respectLayerVisibility&&!t.visible){e.next=21;break}if(a=t&&null!=t.opacity?t.opacity:null,s=null!=a?a*r:r,"building-group"!==t.type){e.next=12;break}return c={type:"symbol-table",title:t.title,infos:[]},e.next=8,o._generateLegendElementsForBuildingSublayers(t.sublayers,s);case 8:f=e.sent,(u=c.infos).push.apply(u,(0,L.Z)(f)),n=[c].concat((0,L.Z)(n)),e.next=21;break;case 12:if(!t.renderer){e.next=21;break}return e.t0=[],e.t1=L.Z,e.next=17,o._getRendererLegendElements(t.renderer,{title:t.title,opacity:s,sublayer:t});case 17:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=(0,L.Z)(n),n=e.t0.concat.call(e.t0,e.t3,e.t4);case 21:case"end":return e.stop()}}),e)})),a.s();case 7:if((l=a.n()).done){e.next=11;break}return e.delegateYield(s(),"t0",9);case 9:e.next=7;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(4),a.e(e.t1);case 16:return e.prev=16,a.f(),e.finish(16);case 19:return e.abrupt("return",n.filter((function(e){return!!e&&(!("infos"in e)||e.infos.length>0)})));case 20:case"end":return e.stop()}}),e,this,[[4,13,16,19]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_constructLegendElementsForSublayers",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(){var t,r=this;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("sublayers-watcher"),t=this.layer,this._handles.add((0,d.YP)((function(){return t.sublayers}),(function(){return r._constructLegendElementsForSublayers})),"sublayers-watcher"),e.prev=3,e.next=6,this._generateLegendElementsForSublayers(t.sublayers,this.opacity);case 6:this.legendElements=e.sent,this.notifyChange("ready"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),Te.warn("Request to server for legend has failed!",e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForSublayers",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(t,r,n){var i,a,l,s,o,u,c=this;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=this.layer,a=[],this._handles.add(t.on("change",(function(){return c._constructLegendElementsForSublayers()})),"sublayers-watcher"),l=t.toArray(),!n&&this.sublayerIds&&this.sublayerIds.length&&(l=this.sublayerIds.map((function(e){return i.findSublayerById(e)})).filter(Boolean)),s=(0,b.Z)(l),e.prev=6,u=(0,_.Z)().mark((function e(){var t,i,l,s,u;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.value,i=(0,d.YP)((function(){return[t.renderer,t.opacity,t.title,t.visible,t.legendEnabled]}),(function(){return c._constructLegendElementsForSublayers()})),c._handles.add(i,"sublayers-watcher"),c.respectLayerVisibility&&!(t.visible&&t.legendEnabled&&c._isSublayerInScale(t))){e.next=21;break}if(l=t&&null!=t.opacity?t.opacity:null,s=null!=l?l*r:r,!(t.renderer&&!t.sublayers&&t.originIdOf("renderer")>F.s3.SERVICE)){e.next=17;break}return e.next=7,t.load();case 7:return e.t0=[],e.t1=L.Z,e.next=11,c._getRendererLegendElements(t.renderer,{title:t.title,opacity:s,sublayer:t});case 11:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=(0,L.Z)(a),a=e.t0.concat.call(e.t0,e.t3,e.t4),e.next=21;break;case 17:return e.next=19,c._generateSymbolTableElementForSublayer(t,s,n);case 19:(u=e.sent)&&a.unshift(u);case 21:case"end":return e.stop()}}),e)})),s.s();case 9:if((o=s.n()).done){e.next=13;break}return e.delegateYield(u(),"t0",11);case 11:e.next=9;break;case 13:e.next=18;break;case 15:e.prev=15,e.t1=e.catch(6),s.e(e.t1);case 18:return e.prev=18,s.f(),e.finish(18);case 21:return e.abrupt("return",a.filter((function(e){return!!e&&(!("infos"in e)||e.infos.length>0)})));case 22:case"end":return e.stop()}}),e,this,[[6,15,18,21]])})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForSublayer",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(t,r,n){var i,a,l,s,o,u,c;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=9;break}return n=new Map,i=this.layer,a=t.source,l=null,(a&&("map-layer"!==a.type||a.mapLayerId!==t.id||a.gdbVersion&&a.gdbVersion!==("gdbVersion"in i&&i.gdbVersion))||t.originIdOf("renderer")>F.s3.SERVICE||t.originIdOf("labelingInfo")>F.s3.SERVICE||t.originIdOf("labelsVisible")>F.s3.SERVICE)&&(s=new T.R({layer:this.layer}),l=s.hasDynamicLayers?s.dynamicLayers:null,s.destroy()),o=l||"".concat(i.uid,"-default"),e.next=8,this._getLegendLayers(o,l);case 8:e.sent.forEach((function(e){return n.set(e.layerId,e)}));case 9:if(!(!(u=n.get(t.id))||null!==u&&void 0!==u&&u.subLayerIds&&u.defaultVisibility)||!t.sublayers){e.next=15;break}return e.next=13,this._generateLegendElementsForSublayers(t.sublayers,r,n);case 13:return c=e.sent,e.abrupt("return",{type:"symbol-table",title:t.title,infos:c});case 15:return e.abrupt("return",this._generateSymbolTableElementForLegendLayer(u,t,r));case 16:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForLegendLayer",value:function(e,t,r){var n,i=this;if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;var a=null===t||void 0===t?void 0:t.renderer,l=(null===t||void 0===t?void 0:t.title)||e.layerName;if(a&&(!t||(null===t||void 0===t?void 0:t.originIdOf("renderer"))>F.s3.SERVICE)){var s=(null===t||void 0===t?void 0:t.title)||this._getRendererTitle(a,t);s&&(l&&"string"!=typeof s&&"title"in s&&(s.title=l),l=s)}var o={type:"symbol-table",title:l,legendType:e.legendType?e.legendType:null,infos:[]},u=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return(null===(n=e.legendGroups)||void 0===n?void 0:n.length)>0?e.legendGroups.forEach((function(t){var n,a={type:"symbol-table",title:t.heading,legendType:e.legendType?e.legendType:null,infos:i._generateSymbolTableElementInfosForLegendLayer(u.filter((function(e){return e.groupId===t.id})),e.layerId,r)};(null===(n=a.infos)||void 0===n?void 0:n.length)>0&&o.infos.push(a)})):o.infos=this._generateSymbolTableElementInfosForLegendLayer(u,e.layerId,r),o.infos.length>0?o:null}},{key:"_generateSymbolTableElementInfosForLegendLayer",value:function(e,t,r){var n=this;return e.map((function(e){var i=e.url;if(e.imageData&&e.imageData.length>0)i="data:image/png;base64,".concat(e.imageData);else{if(0===i.indexOf("http"))return null;i=(0,S.Dp)("".concat(n.layer.url,"/").concat(t,"/images/").concat(i))}return{label:e.label,src:i,opacity:null==r?n.opacity:r,width:e.width,height:e.height}})).filter((function(e){return!!e}))}},{key:"_isSublayerInScale",value:function(e){var t=e.minScale||0,r=e.maxScale||0;return!(t>0&&t<this.scale||r>this.scale)}},{key:"_isLegendLayerInScale",value:function(e,t){var r=t||this.layer,n=null,i=null,a=!0;return!r.minScale&&0!==r.minScale||!r.maxScale&&0!==r.maxScale?(0===e.minScale&&r.tileInfo&&(n=r.tileInfo.lods[0].scale),0===e.maxScale&&r.tileInfo&&(i=r.tileInfo.lods[r.tileInfo.lods.length-1].scale)):(n=Math.min(r.minScale,e.minScale)||r.minScale||e.minScale,i=Math.max(r.maxScale,e.maxScale)),(n>0&&n<this.scale||i>this.scale)&&(a=!1),a}},{key:"_sanitizeLegendForSublayer",value:function(e,t){if("version"in this.layer&&this.layer.version<10.1||0===e.length)return e;var r=t.renderer,n=e.some((function(e){return e.values})),i=null,a=null;return n&&e.some((function(e,t){return e.values||(i=t,(a=e).label||(a.label="others")),null!=a})),r?"unique-value"===r.type?a&&(e.splice(i,1),e.push(a)):"class-breaks"===r.type&&(a&&e.splice(i,1),e.reverse(),a&&e.push(a)):a&&(e.splice(i,1),e.push(a)),e}},{key:"_getRendererLegendElements",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(t){var r,n=arguments;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.length>1&&void 0!==n[1]?n[1]:{},e.abrupt("return",rt(t,this.view)?Qe(t)?this._constructPointCloudRendererLegendElements(t,r):et(t)?this._constructDotDensityRendererLegendElements(t):tt(t)?this._constructPieChartRendererLegendElements(t):this._constructRendererLegendElements(t,r):(Te.warn("Renderer of type '".concat(t.type,"' not supported!")),[]));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getPointCloudRendererTitle",value:function(e){return e.legendOptions&&e.legendOptions.title||e.field}},{key:"_constructPointCloudRendererLegendElements",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.title,i=[],a=null,l=null;if(Xe(e))a={type:"symbol-table",title:n||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach((function(e){a.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:t._getAppliedCloneSymbol(Ne,e.color)})}));else if($e(e)){var s=e.stops,o=null;if(s.length&&(1===s.length&&(o=s[0].color),!o)){var u=s[0].value,c=s[s.length-1].value;null!=u&&null!=c&&(o=(0,j.QQ)(u+(c-u)/2,s))}a={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(Ne,o||Ne.color)}]};var d=(0,j.NA)(e.stops);l={type:"color-ramp",title:n||this._getPointCloudRendererTitle(e),infos:d,preview:(0,q.jT)(d.map((function(e){return e.color})))}}else Ke(e)&&(a={type:"symbol-table",title:n||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach((function(e){a.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:t._getAppliedCloneSymbol(Ne,e.color)})})));a&&a.infos.length&&i.push(a),l&&l.infos.length&&i.push(l);var f=i.reduce((function(e,t){return e.concat(t.infos)}),[]).filter((function(e){return!!e.symbol})).map((function(r){return t._getSymbolPreview(r,t.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}})}));return(0,Z.as)(f).then((function(){return i}))}},{key:"_getElementInfoForDotDensity",value:function(e,t){var r,n=e.backgroundColor,i=e.outline,a=e.dotSize,l=null===(r=this.effectList)||void 0===r?void 0:r.effects.map((function(e){return e.toJSON()})),s=(0,A.rM)(l),o=a+"-"+t+"-"+n+"-"+(i&&JSON.stringify(i.toJSON()))+"-"+s,u=this._dotDensityUrlCache,c=u.has(o)?u.get(o):(0,q.k)(e,t);u.set(o,c);var d={shape:{type:"image",x:0,y:0,width:c.width,height:c.height,src:c.src},fill:null,stroke:null,offset:[0,0]},f=(0,H.w)([[d]],[c.width,c.height],{effectView:this.effectList});return{opacity:1,src:c.src,preview:f,width:c.width,height:c.height}}},{key:"_constructDotDensityRendererLegendElements",value:function(e){var t=this,r=e.calculateDotValue(this.view.scale),n=e.legendOptions&&e.legendOptions.unit,i={type:"symbol-table",title:{value:r&&Math.round(r),unit:n||""},infos:[]};return e.attributes.forEach((function(r){var n=t._getElementInfoForDotDensity(e,r.color);n.label=r.label||r.valueExpressionTitle||r.field,i.infos.push(n)})),Promise.resolve([i])}},{key:"_constructPieChartRendererLegendElements",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(t){var r,n,i,a,l,s,o,u,c,d,f,y,h,p,v,m=this;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.layer.opacity,l=[],s="Others",o=t.outline,t.attributes.forEach((function(e){var t=new oe.default({color:e.color,outline:o}),r=e.label||e.valueExpressionTitle||e.field;l.push({label:r,symbol:t})})),u=l.length?[].concat(l):[],null!==(r=t.othersCategory)&&void 0!==r&&r.color&&0!==(null===(n=t.othersCategory)||void 0===n?void 0:n.threshold)&&(c=new oe.default({color:t.othersCategory.color,outline:o}),l.push({label:t.othersCategory.label||s,symbol:c})),null!==(i=t.defaultColor)&&void 0!==i&&i.a&&(d=new oe.default({color:t.defaultColor,outline:o}),l.push({label:t.defaultLabel,symbol:d})),e.next=7,this._getVisualVariableLegendElements(t,this.layer);case 7:if(e.t0=e.sent,e.t0){e.next=10;break}e.t0=[];case 10:return f=e.t0,l.length&&(f.unshift({type:"symbol-table",title:null,infos:l}),h=u.filter((function(e){return e.label!==s})).map((function(e){return e.symbol.color})).filter(Boolean),p=(0,q.LC)(h,{holePercentage:t.holePercentage,backgroundColor:null===(y=t.backgroundFillSymbol)||void 0===y?void 0:y.color,effectList:this.effectList,outline:o}),f.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(t,this.layer),infos:l,preview:p})),v=f.reduce((function(e,t){return e.concat(m._getAllInfos(t))}),[]).filter((function(e){return!(null===e||void 0===e||!e.symbol)&&!(null!==e&&void 0!==e&&e.preview)})).map((function(e){return m._getSymbolPreview(e,a,{effectList:m.effectList})})),e.next=15,(0,Z.as)(v);case 15:return e.abrupt("return",f);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_constructRendererLegendElements",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(t){var r,n,i,a,l,s,o,u,d,f,y,h,p,v,m,g,b,L,w,k,S,x,I,C,E,V,R,F,z,A,T,M,P,D,N,O,B,H,W,U,Y,j,G,Q,X,$,K,ee,ne,ie,le,se,oe=this,ue=arguments;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ue.length>1&&void 0!==ue[1]?ue[1]:{},n=r.title,i=r.sublayer,a=i||this.layer,e.next=4,this._loadRenderer(t);case 4:return l=e.sent,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null,e.next=8,this._getVisualVariableLegendElements(l,a);case 8:if(e.t0=e.sent,e.t0){e.next=11;break}e.t0=[];case 11:if(s=e.t0,o={type:"symbol-table",title:n||this._getRendererTitle(l,a),infos:[]},u=null,d=!1,f=new Set,!Be(l)||this._hasSizeRamp){e.next=22;break}return e.next=18,(0,ae.y$)(l);case 18:y=e.sent,o.infos.push({label:null,symbol:y}),e.next=86;break;case 22:if(!ht(l)){e.next=28;break}h=n,p=pt(l)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",v=s.findIndex((function(e){return"color-ramp"===e.type})),m=-1!==v?s.splice(v,1)[0]:null,g=s.findIndex((function(e){return"size-ramp"===e.type})),b=-1!==g?s.splice(g,1)[0]:null,L=[],m&&(h=m.title,L.push(m)),b&&(h=b.title,L.push(b)),L.length>0&&s.push({type:p,title:h,infos:L}),e.next=86;break;case 28:if(!Ge(l)){e.next=33;break}k=(0,J.h)(l),s.push({type:"heatmap-ramp",title:n||(null===(w=l.legendOptions)||void 0===w?void 0:w.title),infos:k,preview:(0,q.jT)(k.map((function(e){return e.color})),{effectList:this.effectList})}),e.next=86;break;case 33:if(!Je(l)){e.next=39;break}if((S=l&&l.authoringInfo)&&"relationship"===S.type){if(x=S.focus,I=S.numClasses,C=S.field1,E=S.field2,I&&C&&E){for(V=[C,E],R=re(x)||0,F=0,z=V;F<z.length;F++)A=z[F],T=A.field,M=A.normalizationField,P=A.label,D=P||{field:this._getFieldAlias(T,a),normField:M&&this._getFieldAlias(M,a)},(N=vt.clone()).angle=R,o.infos.push({label:D,symbol:N}),f.add(N),R+=90;O=te({focus:x,numClasses:I,infos:l.uniqueValueInfos}),s.unshift(O)}}else B=l.field,l.uniqueValueInfos.forEach((function(e){e.symbol&&o.infos.push({label:e.label||oe._getDomainName(B,e.value,a)||e.value,value:e.value,symbol:e.symbol})}));l.defaultSymbol&&(o.infos.push({label:l.defaultLabel||"others",symbol:l.defaultSymbol}),d=!0),e.next=86;break;case 39:if(!je(l)){e.next=44;break}(!(u=this._isUnclassedRenderer(l))||!this._hasSizeRamp)&&(l.classBreakInfos.forEach((function(e){e.symbol&&o.infos.unshift({label:e.label||(u?null:e.minValue+" - "+e.maxValue),value:[e.minValue,e.maxValue],symbol:e.symbol})})),u&&(o.title=null),this._updateInfosforClassedSizeRenderer(l,o.infos)),l.defaultSymbol&&!u&&(o.infos.push({label:l.defaultLabel||"others",symbol:l.defaultSymbol}),d=!0),e.next=86;break;case 44:if(!We(l)){e.next=68;break}if(!dt(this.layer)&&!ft(this.layer)){e.next=50;break}yt(H=this._constructTileImageryStretchRendererElements(l))?s.push(H):o.infos=H,e.next=66;break;case 50:if(W=this.layer,l.statistics&&l.statistics.length&&(U=null!=l.statistics[0].min?l.statistics[0].min:l.statistics[0][0],Y=null!=l.statistics[0].max?l.statistics[0].max:l.statistics[0][1]),j=[],e.t1=c.Wg,!W.renderingRule){e.next=60;break}return e.next=57,W.generateRasterInfo(W.renderingRule);case 57:e.t2=e.sent,e.next=61;break;case 60:e.t2=W.serviceRasterInfo;case 61:e.t3=e.t2,G=(0,e.t1)(e.t3),Q=G.keyProperties.BandProperties,X=De[W.rasterInfo.pixelType.toLowerCase()],1===G.bandCount||W.bandIds&&1===W.bandIds.length?(U=null!=U?U:G.statistics?G.statistics[W.bandIds[0]].min:X[0],Y=null!=Y?Y:G.statistics?G.statistics[W.bandIds[0]].max:X[1],U||Y?s.push(this._getStretchLegendElements(l,{min:U,max:Y})):this._getServerSideLegend()):G.bandCount>=3?Q&&Q.length>=G.bandCount?W.bandIds&&3===W.bandIds.length?(j=W.bandIds.map((function(e){return Q[e].BandName})),o.infos=this._createSymbolTableElementMultiBand(j)):"lerc"===W.format?(j=[0,1,2].map((function(e){return Q[e].BandName})),o.infos=this._createSymbolTableElementMultiBand(j)):this._getServerSideLegend():"lerc"===W.format?(j=["band1","band2","band3"],o.infos=this._createSymbolTableElementMultiBand(j)):this._getServerSideLegend():this._getServerSideLegend();case 66:e.next=86;break;case 68:if(!qe(l)){e.next=72;break}l.colormapInfos.forEach((function(e){o.infos.push({label:e.label,value:e.value,symbol:oe._getAppliedCloneSymbol(Oe,e.color)})})),e.next=86;break;case 72:if(!Ye(l)){e.next=85;break}$=l.symbol,e.t4=r.geometryType,e.next="point"===e.t4?77:"polyline"===e.t4?79:"polygon"===e.t4?81:82;break;case 77:return $="pointSymbol"in a&&a.pointSymbol,e.abrupt("break",82);case 79:return $="lineSymbol"in a&&a.lineSymbol,e.abrupt("break",82);case 81:$="polygonSymbol"in a&&a.polygonSymbol;case 82:l.symbol&&!this._hasSizeRamp&&o.infos.push({label:l.label,symbol:$}),e.next=86;break;case 85:He(l)?(l.outputUnit&&(this.title="("+l.toJSON().outputUnit+")"),o.title=l.attributeField,null!==(K=l.getClassBreakInfos())&&void 0!==K&&K.length?K.forEach((function(e){o.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol})})):o.infos.push({label:l.attributeField,symbol:l.getDefaultSymbol()})):Ue(l)&&s.push(this._getStretchLegendElements(l,{min:0,max:255}));case 86:return!(ee=l.defaultSymbol)||d||Ye(l)||u&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||s.push({type:"symbol-table",infos:[{label:l.defaultLabel||"others",symbol:ee}]}),o.infos.length&&s.unshift(o),ne=null==r.opacity?this.opacity:r.opacity,ie=this._isTallSymbol("visualVariables"in l&&l.visualVariables),le=ct(this.layer)||dt(this.layer),se=s.reduce((function(e,t){return e.concat(oe._getAllInfos(t))}),[]).filter((function(e){return!(null===e||void 0===e||!e.symbol)})).map((function(e){return oe._getSymbolPreview(e,ne,{isDefault:e.symbol===ee,applyScaleDrivenSize:!f.has(e.symbol),symbolConfig:{isTall:ie,isSquareFill:le},effectList:f.has(e.symbol)?null:oe.effectList})})),l=null,e.next=92,(0,Z.as)(se);case 92:return e.abrupt("return",s);case 93:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getServerSideLegend",value:function(){var e=this;setTimeout((function(){return e.buildLegendElementsForTools()}),0)}},{key:"_getAllInfos",value:function(e){var t=this,r=null===e||void 0===e?void 0:e.infos;return r?r.reduce((function(e,r){return e.concat(t._getAllInfos(r))}),[]):[e]}},{key:"_constructTileImageryStretchRendererElements",value:function(e){var t,r,n,i,a,l=this.layer,s=l.rasterInfo,o=s.bandCount||e.statistics.length,u=s.keyProperties&&s.keyProperties.BandProperties,c=null!==e&&void 0!==e&&null!==(t=e.statistics)&&void 0!==t&&t.length?e.statistics:null===s||void 0===s?void 0:s.statistics;if(c)n=void 0!==c[0].min?c[0].min:c[0][0],i=c[0].max||c[0][1];else{var d=De[l.rasterInfo.pixelType.toLowerCase()];n=d[0],i=d[1]}if(l.hasStandardTime()&&(n=l.getStandardTimeValue(n),i=l.getStandardTimeValue(i)),1===s.bandCount||1===(null===(r=l.bandIds)||void 0===r?void 0:r.length))return this._getStretchLegendElements(e,{min:n,max:i});function f(e){var t,r=(null!==l&&void 0!==l&&null!==(t=l.bandIds)&&void 0!==t&&t.length?l.bandIds:Array.from(Array(Math.min(s.bandCount,3)).keys())).map((function(t){return e&&e[t]&&e[t].BandName||"band"+(t+1)}));return r.length<3?r.push(r[1]):r.length>3&&r.splice(3),r}return a=u&&u.length>=o?f(u):f(),this._createSymbolTableElementMultiBand(a)}},{key:"_getStretchLegendElements",value:function(e,t){var r=e.colorRamp,n=(0,j.fD)(r,t);return{type:"stretch-ramp",title:"",infos:n,preview:(0,q.jT)(n.map((function(e){return e.color})))}}},{key:"_getSizeLegendElement",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(t,r,n,i){return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this._hasClusterSizeVariable?this._getClusterTitle(r):t,e.t1=he,e.t2=n,e.t3=r,e.next=6,(0,ae.jb)(n);case 6:return e.t4=e.sent,e.t5=this.scale,e.t6=this.view.type,e.t7=i,e.next=12,(0,e.t1)(e.t2,e.t3,e.t4,e.t5,e.t6,e.t7);case 12:return e.t8=e.sent,e.abrupt("return",{type:"size-ramp",title:e.t0,infos:e.t8});case 14:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"_createSymbolTableElementMultiBand",value:function(e){var t=this,r=[],n=["red","green","blue"];return e.forEach((function(e,i){var a;r.push({label:{colorName:n[i],bandName:e},src:ae.uY[i],opacity:null!==(a=t.opacity)&&void 0!==a?a:1})})),r}},{key:"_updateInfosforClassedSizeRenderer",value:function(e,t){var r=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,n=e.classBreakInfos.some((function(e){return(0,W.YW)(e.symbol)}));if(r&&n){var i=e.classBreakInfos.length,a=18/(i>1?i-1:i);t.forEach((function(e,t){e.size=30-a*t}))}}},{key:"_isTallSymbol",value:function(e){var t=!1,r=!1;if(e)for(var n=0;n<e.length&&(!t||!r);n++){var i=e[n];"size"===i.type&&("height"===i.axis&&(t=!0),"width-and-depth"===i.axis&&(r=!0))}return t&&r}},{key:"_getSymbolPreview",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(t,n,i){var a,l,s;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!==i&&void 0!==i&&i.isDefault||null!=t.size||!this._hasSizeRamp?t.size:(0,V.Wz)(B.b_.size),!this._scaleDrivenSizeVariable||null===i||void 0===i||!i.applyScaleDrivenSize){e.next=7;break}return e.next=4,Promise.resolve().then(r.bind(r,56011));case 4:l=e.sent,s=l.getSize,a=s(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===t.symbol.type?t.symbol.style:null});case 7:return e.abrupt("return",(0,q.l3)(t.symbol,{size:a,opacity:n,scale:!1,symbolConfig:null===i||void 0===i?void 0:i.symbolConfig,effectView:null===i||void 0===i?void 0:i.effectList}).then((function(e){return t.preview=e,t})).catch((function(){return t.preview=null,t})));case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_loadRenderer",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(t){var r,n,i,a,l,s,o,u,d,f,y,h,p,v=this;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=[],a=this.layer,t=t.clone(),this._hasClusterSizeVariable=!1,l="visualVariables"in t&&(null===(r=t.visualVariables)||void 0===r?void 0:r.some((function(e){return"size"===e.type&&"outline"!==e.target&&!Me.test(e.valueExpression)}))),t&&"visualVariables"in t&&!l&&"featureReduction"in a&&"cluster"===(null===(n=a.featureReduction)||void 0===n?void 0:n.type)&&(s=this.layerView._effectiveRenderer,(o=(0,c.Wg)(Y(s,this.view)))&&("clusterMinSize"in(u=a.featureReduction)&&"clusterMaxSize"in u&&(d=u.clusterMinSize,f=u.clusterMaxSize,o.legendOptions=new N.Z({showLegend:d!==f})),y=t.visualVariables||[],t.visualVariables=y.concat([o]),this._hasClusterSizeVariable=!0)),e.next=6,(0,ae.jb)(t);case 6:return h=e.sent,(je(t)||Je(t))&&(p=(t.classBreakInfos||t.uniqueValueInfos).map((function(e){return v._fetchSymbol(e.symbol,h).then((function(t){e.symbol=t})).catch((function(){e.symbol=null}))})),Array.prototype.push.apply(i,p)),e.abrupt("return",(i.push(this._fetchSymbol(t.symbol||t.defaultSymbol,t.defaultSymbol?null:h).then((function(e){v._applySymbolToRenderer(t,e,Ye(t))})).catch((function(){v._applySymbolToRenderer(t,null,Ye(t))}))),(0,Z.as)(i).then((function(){return t}))));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_applySymbolToRenderer",value:function(e,t,r){r?e.symbol=t:e.defaultSymbol=t}},{key:"_fetchSymbol",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(t,r){var n,i;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error;case 2:if("web-style"!==t.type){e.next=14;break}return n=this._webStyleSymbolCache,e.prev=4,e.next=7,"2d"===this.view.type?t.fetchCIMSymbol({cache:n}):t.fetchSymbol({cache:n});case 7:return i=e.sent,e.abrupt("return",this._getAppliedCloneSymbol(i,r));case 11:throw e.prev=11,e.t0=e.catch(4),Te.warn("Fetching web-style failed!"),new Error;case 14:return e.abrupt("return",this._getAppliedCloneSymbol(t,r));case 15:case"end":return e.stop()}}),e,this,[[4,11]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getAppliedCloneSymbol",value:function(e,t){if(!e||!t)return e;var r=e.clone(),n=t&&t.toRgba();return r.type.includes("3d")?this._applyColorTo3dSymbol(r,n):"cim"===r.type?(0,O.ZB)(r,t):r.color&&(r.color=new k.Z(n||r.color)),r}},{key:"_applyColorTo3dSymbol",value:function(e,t){t&&e.symbolLayers.forEach((function(e){e&&(e.material||(e.material={}),e.material.color=new k.Z(t))}))}},{key:"_getVisualVariableLegendElements",value:function(){var e=(0,w.Z)((0,_.Z)().mark((function e(t,r){var n,i,a,l,s,o,u,d,f,y,h,p,v,m=this;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("visualVariables"in t&&t.visualVariables&&"vector-field"!==t.type){e.next=2;break}return e.abrupt("return",null);case 2:n=t.visualVariables,i=[],a=[],l=[],s=(0,b.Z)(n);try{for(s.s();!(o=s.n()).done;)"color"===(u=o.value).type?i.push(u):"size"===u.type?a.push(u):"opacity"===u.type&&l.push(u)}catch(g){s.e(g)}finally{s.f()}return d=[].concat(i,a,l),0===i.length&&je(t)&&t.classBreakInfos&&1===t.classBreakInfos.length&&(h=t.classBreakInfos[0],f=h&&h.symbol),0===i.length&&Ye(t)&&(f=t.symbol),f&&(f.type.includes("3d")?"water"===(p=f.symbolLayers.getItemAt(0)).type?(0,c.pC)(p.color)&&(y=p.color):(0,c.pC)(p.material)&&(0,c.pC)(p.material.color)&&(y=p.material.color):f.url||(y=f.color)),v=this.effectList,e.next=11,Promise.all(d.map(function(){var e=(0,w.Z)((0,_.Z)().mark((function e(n){var i,a,l,s,o,u;return(0,_.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.legendOptions&&!1===n.legendOptions.showLegend){e.next=28;break}if(i=Be(t)?n.field:m._getRampTitle(n,r),a=null,l="getField"in r&&r.getField&&r.getField(n.field),s=l&&(0,M.y2)(l),"color"!==n.type){e.next=11;break}return e.next=7,(0,j.pO)(n,null,s);case 7:o=e.sent,a={type:"color-ramp",title:i,infos:o,preview:(0,q.jT)(o.map((function(e){return e.color})),{effectList:v})},m._hasColorRamp||(m._hasColorRamp=!(null==a.infos||!a.infos.length)),e.next=27;break;case 11:if("size"!==n.type||"outline"===n.target){e.next=22;break}if(!Me.test(n.valueExpression)){e.next=16;break}m._hasClusterSizeVariable||(m._scaleDrivenSizeVariable=n),e.next=20;break;case 16:return e.next=18,m._getSizeLegendElement(i,n,t,s);case 18:a=e.sent,m._hasSizeRamp||(m._hasSizeRamp=!(null==a.infos||!a.infos.length));case 20:e.next=27;break;case 22:if("opacity"!==n.type){e.next=27;break}return e.next=25,(0,j.pO)(n,y,s);case 25:u=e.sent,a={type:"opacity-ramp",title:i,infos:u,preview:(0,q.jT)(u.map((function(e){return e.color})),{effectList:v})},m._hasOpacityRamp||(m._hasOpacityRamp=!(null==a.infos||!a.infos.length));case 27:return e.abrupt("return",a&&a.infos?a:null);case 28:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return e.abrupt("return",e.sent.filter((function(e){return!!e})));case 12:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getDomainName",value:function(e,t,r){if(e&&"function"!=typeof e){var n="getField"in r&&r.getField&&r.getField(e),i=n&&"getFieldDomain"in r&&r.getFieldDomain?r.getFieldDomain(n.name):null;return i&&"coded-value"===i.type?i.getName(t):null}return null}},{key:"_getClusterTitle",value:function(e){var t=this.layer,r=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){var n=t.featureReduction,i="popupTemplate"in n&&n.popupTemplate,a=i&&i.fieldInfos;if(a){var l,s=(0,b.Z)(a);try{for(s.s();!(l=s.n()).done;){var o=l.value;if(o.fieldName===r)return"cluster_count"===r?o.label||{showCount:!0}:o.label}}catch(u){s.e(u)}finally{s.f()}}}return{showCount:!0}}},{key:"_getRampTitle",value:function(e,t){var r=e.field,n=e.normalizationField,i=!1,a=!1,l=!1,s=null;r="function"==typeof r?null:r,n="function"==typeof n?null:n;var o=e.legendOptions&&e.legendOptions.title;if(null!=o)s=o;else if(e.valueExpressionTitle)s=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables)for(var u=t.renderer.authoringInfo.visualVariables,c=0;c<u.length;c++){var d=u[c];if("color"===d.type){if("ratio"===d.style){i=!0;break}if("percent"===d.style){a=!0;break}if("percent-of-total"===d.style){l=!0;break}}}s={field:r&&this._getFieldAlias(r,t),normField:n&&this._getFieldAlias(n,t),ratio:i,ratioPercent:a,ratioPercentTotal:l}}return s}},{key:"_getRendererTitle",value:function(e,t){var r=e;if(r.legendOptions&&r.legendOptions.title)return r.legendOptions.title;if(r.valueExpressionTitle)return r.valueExpressionTitle;var n=r.field,i=null,a=null;je(r)&&(i=r.normalizationField,a="percent-of-total"===r.normalizationType),i="function"==typeof i?null:i;var l=null;return((n="function"==typeof n?null:n)||i)&&(l={field:n&&this._getFieldAlias(n,t),normField:i&&this._getFieldAlias(i,t),normByPct:a}),l}},{key:"_getFieldAlias",value:function(e,t){var r="popupTemplate"in t&&t.popupTemplate,n=r&&r.fieldInfos,i=null;n&&n.some((function(t){return e===t.fieldName&&(i=t,!0)}));var a=null;"getField"in t&&t.getField?a=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(a=t.fieldsIndex.get(e));var l=i||a,s=null;return l&&(s=i&&i.label||a&&a.alias||"name"in l&&l.name||"fieldName"in l&&l.fieldName),s}},{key:"_isUnclassedRenderer",value:function(e){var t=e.visualVariables,r=!1;return je(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(r=e.field?t.some((function(t){return!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField)})):!!t.length),r}}]),o}(m.Z);(0,o._)([(0,h.Cb)()],gt.prototype,"children",void 0),(0,o._)([(0,h.Cb)({readOnly:!0})],gt.prototype,"effectList",null),(0,o._)([(0,h.Cb)()],gt.prototype,"layerView",void 0),(0,o._)([(0,h.Cb)()],gt.prototype,"layer",void 0),(0,o._)([(0,h.Cb)()],gt.prototype,"legendElements",void 0),(0,o._)([(0,h.Cb)({readOnly:!0})],gt.prototype,"opacity",null),(0,o._)([(0,h.Cb)()],gt.prototype,"parent",void 0),(0,o._)([(0,h.Cb)({readOnly:!0,dependsOn:[]})],gt.prototype,"ready",null),(0,o._)([(0,h.Cb)()],gt.prototype,"hideLayersNotInCurrentView",void 0),(0,o._)([(0,h.Cb)()],gt.prototype,"keepCacheOnDestroy",void 0),(0,o._)([(0,h.Cb)()],gt.prototype,"respectLayerVisibility",void 0),(0,o._)([(0,h.Cb)({readOnly:!0})],gt.prototype,"scale",null),(0,o._)([(0,h.Cb)()],gt.prototype,"sublayerIds",void 0),(0,o._)([(0,h.Cb)({readOnly:!0})],gt.prototype,"isScaleDriven",null),(0,o._)([(0,h.Cb)()],gt.prototype,"title",void 0),(0,o._)([(0,h.Cb)({readOnly:!0,dependsOn:["ready"],value:0})],gt.prototype,"version",null),(0,o._)([(0,h.Cb)()],gt.prototype,"view",void 0);var bt=gt=(0,o._)([(0,p.j)("esri.widgets.Legend.support.ActiveLayerInfo")],gt),_t=r(36257),Lt="state",wt="view",kt="all-layer-views",St="legend-properties",xt=g.Z.ofType(bt),It=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],Ct="view.basemapView.baseLayerViews",Et="view.groundView.layerViews",Zt="view.basemapView.referenceLayerViews",Vt=[Ct,Et,"view.layerViews",Zt],Rt=function(e){(0,l.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e))._handles=new u.Z,n._layerViewByLayerId={},n._layerInfosByLayerViewId={},n._activeLayerInfosByLayerViewId={},n._activeLayerInfosWithNoParent=new g.Z,n.activeLayerInfos=new xt,n.basemapLegendVisible=!1,n.groundLegendVisible=!1,n.hideLayersNotInCurrentView=!1,n.keepCacheOnDestroy=!1,n.respectLayerVisibility=!0,n.layerInfos=[],n.view=null,n}return(0,a.Z)(r,[{key:"initialize",value:function(){var e=this;this._handles.add((0,d.YP)((function(){return e.view}),(function(){return e._viewHandles()}),d.nn),wt),this._handles.add((0,_t.qe)((function(){return e._refresh()})))}},{key:"destroy",value:function(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null}},{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}},{key:"_viewHandles",value:function(){var e=this;this._handles.remove(Lt),this.view&&this._handles.add((0,d.YP)((function(){return e.state}),(function(){return e._stateHandles()}),d.nn),Lt)}},{key:"_stateHandles",value:function(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()}},{key:"_resetAll",value:function(){this._handles.remove([kt,St]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}},{key:"_destroyViewActiveLayerInfos",value:function(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}},{key:"_destroyViewActiveLayerInfo",value:function(e){this._handles.remove(e);var t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t&&t.parent&&t.parent.children.remove(t)}},{key:"_watchPropertiesAndAllLayerViews",value:function(){var e=this,t=this.view.allLayerViews;t.length&&this._refresh(),this._handles.add(t.on("change",(function(t){return e._allLayerViewsChangeHandle(t)})),kt),this._handles.add((0,d.YP)((function(){return[e.layerInfos,e.basemapLegendVisible,e.groundLegendVisible]}),(function(){return e._propertiesChangeHandle()})),St)}},{key:"_allLayerViewsChangeHandle",value:function(e){var t=this;e.removed.forEach((function(e){return t._destroyViewActiveLayerInfo(e.uid)})),this._refresh()}},{key:"_propertiesChangeHandle",value:function(){this._destroyViewActiveLayerInfos(),this._refresh()}},{key:"_refresh",value:function(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}},{key:"_sortActiveLayerInfos",value:function(e){var t=this;if(!(e.length<2)){var r=[];e.forEach((function(n){if(!n.parent){var i=n.layer.parent,a=i&&"uid"in i&&t._layerViewByLayerId[i.uid],l=a&&t._activeLayerInfosByLayerViewId[a.uid];l&&e.includes(l)&&(r.push(n),n.parent=l,l.children.add(n),t._sortActiveLayerInfos(l.children))}})),e.removeMany(r);var n={};this.view.allLayerViews.forEach((function(e,t){return n[e.layer.uid]=t})),e.sort((function(e,t){var r=n[e.layer.uid]||0;return(n[t.layer.uid]||0)-r}))}}},{key:"_generateLayerViews",value:function(){var e=[];return Vt.filter(this._filterLayerViews,this).map(this.get,this).filter((function(e){return null!=e})).forEach(this._collectLayerViews("layerViews",e)),e}},{key:"_filterLayerViews",value:function(e){var t=!this.basemapLegendVisible&&(e===Ct||e===Zt),r=!this.groundLegendVisible&&e===Et;return!t&&!r}},{key:"_collectLayerViews",value:function(e,t){return function r(n){return n&&n.forEach((function(n){t.push(n),r(n[e])})),t}}},{key:"_filterLayerViewsByLayerInfos",value:function(e){var t=this,r=this.layerInfos;return!r||!r.length||r.some((function(r){return t._hasLayerInfo(r,e)}))}},{key:"_hasLayerInfo",value:function(e,t){var r=this._isLayerUIDMatching(e.layer,t.layer.uid);return r&&(this._layerInfosByLayerViewId[t.uid]=e),r}},{key:"_isLayerUIDMatching",value:function(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}},{key:"_hasLayerUID",value:function(e,t){var r=this;return e&&e.some((function(e){return r._isLayerUIDMatching(e,t)}))}},{key:"_isLayerViewSupported",value:function(e){return!!It.includes(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}},{key:"_generateActiveLayerInfo",value:function(e){var t=this;this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add((0,d.YP)((function(){var t;return[e.legendEnabled,null===(t=e.layer)||void 0===t?void 0:t.legendEnabled]}),(function(){return t._layerActiveHandle(e)})),e.uid))}},{key:"_layerActiveHandle",value:function(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e))}},{key:"_isLayerActive",value:function(e){return!this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}},{key:"_buildActiveLayerInfo",value:function(e){var t,r=this,n=e.layer,i=e.uid,a=this._layerInfosByLayerViewId[i],l=this._activeLayerInfosByLayerViewId[i];if(!l){var s=a&&void 0!==a.title&&a.layer.uid===n.uid;l=new bt({layer:n,layerView:e,title:s?a.title:n.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:a&&a.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[i]=l}var o=n.parent&&"uid"in n.parent&&this._layerViewByLayerId[null===(t=n.parent)||void 0===t?void 0:t.uid];if(l.parent=this._activeLayerInfosByLayerViewId[null===o||void 0===o?void 0:o.uid],!this._handles.has(i)){var u=[(0,d.YP)((function(){return n.title}),(function(e){return r._titleHandle(e,l)})),(0,d.YP)((function(){return[n.opacity,"renderer"in n&&n.renderer,"pointSymbol"in n&&n.pointSymbol,"lineSymbol"in n&&n.lineSymbol,"polygonSymbol"in n&&n.polygonSymbol]}),(function(){return r._constructLegendElements(l)})),(0,d.gx)((function(){var e;return!0===(null===(e=r.view)||void 0===e?void 0:e.stationary)}),(function(){return r._scaleHandle(l)}),d.nn),(0,d.YP)((function(){return e._effectiveRenderer}),(function(){return r._constructLegendElements(l)})),(0,d.YP)((function(){return"effect"in n&&n.effect}),(function(){return r._constructLegendElements(l)}))];if(this.respectLayerVisibility){var c=(0,d.YP)((function(){return e.legendEnabled}),(function(e){return r._legendEnabledHandle(e,l)})),f=(0,d.YP)((function(){return n.legendEnabled}),(function(e){return r._legendEnabledHandle(e,l)}));u.push(c,f)}this._handles.add(u,i)}l.isScaleDriven||this._constructLegendElements(l),this._addActiveLayerInfo(l)}},{key:"_titleHandle",value:function(e,t){t.title=e,this._constructLegendElements(t)}},{key:"_legendEnabledHandle",value:function(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}},{key:"_scaleHandle",value:function(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}},{key:"_addActiveLayerInfo",value:function(e){var t=this,r=e.layerView,n=e.layer;if(this._isLayerActive(r)&&!this.activeLayerInfos.includes(e)){var i=e.parent;if(i)i.children.includes(e)||i.children.push(e),this._sortActiveLayerInfos(i.children);else{var a,l=null===(a=this.layerInfos)||void 0===a?void 0:a.some((function(e){return e.layer.uid===n.uid}));n.parent&&"uid"in n.parent&&!l?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){var s=[];this._activeLayerInfosWithNoParent.forEach((function(e){var r=e.layer.parent,n=r&&"uid"in r&&t._layerViewByLayerId[null===r||void 0===r?void 0:r.uid],i=t._activeLayerInfosByLayerViewId[null===n||void 0===n?void 0:n.uid];i&&(s.push(e),e.parent=i)})),s.length&&(this._activeLayerInfosWithNoParent.removeMany(s),s.forEach((function(e){return t._addActiveLayerInfo(e)})))}}}},{key:"_removeActiveLayerInfo",value:function(e){var t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}},{key:"_constructLegendElements",value:function(e){var t,r=this,n=e.layer;"featureCollections"in n&&n.featureCollections?e.buildLegendElementsForFeatureCollections(n.featureCollections):"featureReduction"in n&&"binning"===(null===(t=n.featureReduction)||void 0===t?void 0:t.type)&&"renderer"in n.featureReduction?e.buildLegendElementsForRenderer(n.featureReduction.renderer):"renderer"in n&&n.renderer?e.buildLegendElementsForRenderer(n.renderer):"url"in n&&n.url?e.buildLegendElementsForTools():e.children.forEach((function(e){return r._constructLegendElements(e)}))}}]),r}(m.Z);(0,o._)([(0,h.Cb)({type:xt})],Rt.prototype,"activeLayerInfos",void 0),(0,o._)([(0,h.Cb)()],Rt.prototype,"basemapLegendVisible",void 0),(0,o._)([(0,h.Cb)()],Rt.prototype,"groundLegendVisible",void 0),(0,o._)([(0,h.Cb)()],Rt.prototype,"hideLayersNotInCurrentView",void 0),(0,o._)([(0,h.Cb)()],Rt.prototype,"keepCacheOnDestroy",void 0),(0,o._)([(0,h.Cb)()],Rt.prototype,"respectLayerVisibility",void 0),(0,o._)([(0,h.Cb)()],Rt.prototype,"layerInfos",void 0),(0,o._)([(0,h.Cb)({readOnly:!0})],Rt.prototype,"state",null),(0,o._)([(0,h.Cb)()],Rt.prototype,"view",void 0);var Ft=Rt=(0,o._)([(0,p.j)("esri.widgets.Legend.LegendViewModel")],Rt),zt=r(4942),At=r(99653),Tt=r(67005),Mt="http://www.w3.org/2000/svg",Pt="esri-relationship-ramp--diamond__container",Dt="esri-relationship-ramp--diamond__left-column",Nt="esri-relationship-ramp--diamond__right-column",Ot="esri-relationship-ramp--diamond__middle-column",Bt="esri-relationship-ramp--diamond__middle-column--label",Ht="esri-relationship-ramp--diamond__middle-column--ramp",qt="esri-relationship-ramp--square__table",Wt="esri-relationship-ramp--square__table-row",Ut="esri-relationship-ramp--square__table-cell",Yt="esri-relationship-ramp--square__table-label",jt="esri-relationship-ramp--square__table-label--left-bottom",Jt="esri-relationship-ramp--square__table-label--right-bottom",Gt="esri-relationship-ramp--square__table-label--left-top",Qt="esri-relationship-ramp--square__table-label--right-top";function Xt(e,t,r,n){var i=e.focus,a=e.labels,l=!!i,s=function(e,t,r,n){for(var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:60,a=e.focus,l=e.numClasses,s=e.colors,o=e.rotation,u=!!a,c=Math.sqrt(Math.pow(i,2)+Math.pow(i,2))+(u?0:5),d=[],f=[],y=[],h=(i||75)/l,p=0;p<l;p++)for(var v=p*h,m=0;m<l;m++){var g=m*h,b=(0,At.jA)(s[p][m]),_=(0,At.kQ)(null),L={type:"rect",x:g,y:v,width:h,height:h};d.push((0,At.ch)(b)),f.push((0,At.vq)(L,b.fill,_,null)),y.push((0,At.A5)(L))}var w=10,k=15,S=15,x=10,I=null;u||(I="margin: -15px -15px -18px -15px");var C=$t("left",a,t),E=$t("right",a,t),Z=(0,At.al)(y),V=(0,At.iL)(Z,c,c,0,!1,o,!1),R=(0,At.iL)(Z,c,c,0,!1,u?-45:null,!1),F={filter:(0,W.wJ)(n),opacity:null==r?null:"".concat(r)};return(0,Tt.u)("div",{styles:F,class:u?Ht:Ut},(0,Tt.u)("svg",{xmlns:Mt,width:c,height:c,style:I},(0,Tt.u)("defs",null,(0,Tt.u)("marker",{id:"".concat(t,"_arrowStart"),markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},(0,Tt.u)("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),(0,Tt.u)("marker",{id:"".concat(t,"_arrowEnd"),markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},(0,Tt.u)("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),d),(0,Tt.u)("g",{transform:V},f),(0,Tt.u)("g",{transform:R},(0,Tt.u)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":C.markerStart,"marker-end":C.markerEnd,x1:-w,y1:i-k,x2:-w,y2:k}),(0,Tt.u)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":E.markerStart,"marker-end":E.markerEnd,x1:S,y1:i+x,x2:i-S,y2:i+x}))))}(e,t,r,n),o=(0,le.dZ)();return l?(0,Tt.u)("div",{class:Pt,styles:{justifyContent:"center"}},(0,Tt.u)("div",{class:Dt},o?a.right:a.left),(0,Tt.u)("div",{class:Ot},(0,Tt.u)("div",{class:Bt},a.top),s,(0,Tt.u)("div",{class:Bt},a.bottom)),(0,Tt.u)("div",{class:Nt},o?a.left:a.right)):(0,Tt.u)("div",{class:qt},(0,Tt.u)("div",{class:Wt},(0,Tt.u)("div",{class:(0,le.Sh)(Ut,Yt,Jt)},o?a.top:a.left),(0,Tt.u)("div",{class:Ut}),(0,Tt.u)("div",{class:(0,le.Sh)(Ut,Yt,jt)},o?a.left:a.top)),(0,Tt.u)("div",{class:Wt},(0,Tt.u)("div",{class:Ut}),s,(0,Tt.u)("div",{class:Ut})),(0,Tt.u)("div",{class:Wt},(0,Tt.u)("div",{class:(0,le.Sh)(Ut,Yt,Qt)},o?a.right:a.bottom),(0,Tt.u)("div",{class:Ut}),(0,Tt.u)("div",{class:(0,le.Sh)(Ut,Yt,Gt)},o?a.bottom:a.right)))}function $t(e,t,r){var n="".concat(r,"_arrowStart"),i="".concat(r,"_arrowEnd"),a="left"===e,l={markerStart:null,markerEnd:null};switch(t){case"HL":a?l.markerStart="url(#".concat(i,")"):l.markerEnd="url(#".concat(n,")");break;case"LL":l.markerStart="url(#".concat(i,")");break;case"LH":a?l.markerEnd="url(#".concat(n,")"):l.markerStart="url(#".concat(i,")");break;default:l.markerEnd="url(#".concat(n,")")}return l}r(42877);var Kt=(0,r(88367).E)(),er=20,tr=10,rr=20,nr="esri-univariate-above-and-below-ramp__symbol",ir="esri-legend__color-ramp";function ar(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vertical",t="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?(0,Tt.u)("svg",{height:"4",width:"10"},(0,Tt.u)("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):(0,Tt.u)("svg",{height:"10",width:"10"},(0,Tt.u)("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function lr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vertical",r=document.createElement("div");return r.style.height="".concat(er,"px"),r.className=nr,null!=e&&(r.style.opacity=e.toString()),Kt.append(r,ar.bind(null,t)),r}function sr(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vertical",n=arguments.length>3?arguments[3]:void 0;e.infos.forEach((function(e,i){if(n&&2===i)e.preview=lr(t,r);else{var a=(0,V.F2)(e.size)+("horizontal"===r?rr:tr),l="div"===e.preview.tagName.toLowerCase(),s=l?e.preview:document.createElement("div");s.className=nr,"horizontal"===r?s.style.width="".concat(a,"px"):s.style.height="".concat(a,"px"),l||s.appendChild(e.preview),e.preview=s}}))}function or(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"classic",r=e.infos;return"classic"===t?((0,V.F2)(r[0].size)+tr)/2:((0,V.F2)(r[0].size)-(0,V.F2)(r[r.length-1].size))/2}function ur(e,t){if(!e)return null;var r=e.infos.map((function(e){return e.color})),n=(0,q.jT)("full"===t.type?r:"above"===t.type?r.slice(0,3):r.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList});return n.className=ir,null!=t.opacity&&(n.style.opacity=t.opacity.toString()),n}function cr(e,t,r){for(var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vertical",i=0,a=e.infos,l=Math.floor(a.length/2),s="full"===t||"above"===t?0:l,o="full"===t||"below"===t?a.length-1:l,u=s;u<=o;u++)i+=r&&u===l?"horizontal"===n?10:er:(0,V.F2)(a[u].size)+("horizontal"===n?rr:tr);return Math.round(i)}function dr(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vertical",i=cr(e,t,r,n),a=e.infos,l=Math.floor(a.length/2),s="full"===t||"above"===t?0:l,o="full"===t||"below"===t?a.length-1:l,u="full"===t?a[s].size+a[o].size:"above"===t?a[s].size:a[o].size,c=r?"vertical"===n?er:10:0,d="vertical"===n?tr*("full"===t?2:1):rr*("full"===t?2:1);return Math.round(i-((0,V.F2)(u)/2+c/2+d/2))}function fr(e,t){var r,i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vertical",l=e.infos,s=l.find((function(e){return"size-ramp"===e.type})),o=l.find((function(e){return"color-ramp"===e.type}));return s&&((s=(0,n.Z)({},s)).infos=(0,L.Z)(s.infos),sr(s,t,a,!0)),o&&((o=(0,n.Z)({},o)).infos=(0,L.Z)(o.infos)),"horizontal"===a&&(null!==(r=s)&&void 0!==r&&r.infos.reverse(),null!==(i=o)&&void 0!==i&&i.infos.reverse()),{sizeRampElement:s,colorRampElement:o}}function yr(e){var t,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vertical",a=e.infos,l=a.find((function(e){return"size-ramp"===e.type})),s=a.find((function(e){return"color-ramp"===e.type}));return l&&((l=(0,n.Z)({},l)).infos=(0,L.Z)(l.infos),sr(l,null,i,!1)),s&&((s=(0,n.Z)({},s)).infos=(0,L.Z)(s.infos)),"horizontal"===i&&(null!==(t=l)&&void 0!==t&&t.infos.reverse(),null!==(r=s)&&void 0!==r&&r.infos.reverse()),{sizeRampElement:l,colorRampElement:s}}var hr=r(8704);function pr(e){e.appendChild(this)}function vr(e,t,r){if(t){if("string"==typeof t||"number"==typeof t)return t;if("value"in t||"unit"in t)return(0,hr.n)(e.dotValue,t);if("colorName"in t||"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:null;var n=null;return function(e,t){return t}(0,r)?n=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:mr(t,r)&&(n=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),n?(0,hr.n)("showField"===n?"{field}":e[n],{field:t.field,normField:t.normField}):null}}function mr(e,t){return!t}function gr(e,t){return!!(t&&"Stretched"===t&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}var br,_r=r(96919),Lr=r(78088),wr=r(80532),kr="esri-legend--card__carousel-indicator--activated",Sr="esri-legend--card",xr="esri-legend--stacked",Ir="esri-legend--card__carousel-title",Cr="esri-legend--card__carousel-indicator",Er="esri-legend--card__interval-separator",Zr="esri-legend--card__imagery-layer-image--stretched",Vr="esri-legend--card__image-label",Rr="esri-legend--card__layer-caption",Fr="esri-legend--card__label-element",zr="esri-legend--card__layer-row",Ar="esri-legend--card__label-cell",Tr="esri-legend--card__message",Mr="esri-legend--card__ramp-label",Pr="esri-legend--card__section",Dr="esri-legend--card__service-caption-text",Nr="esri-legend--card__service-content",Or="esri-legend--card__service",Br="esri-legend--card__group-layer",Hr="esri-legend--card__group-layer-child",qr="esri-legend--card__symbol",Wr="esri-legend--card__size-ramp-row",Ur="esri-legend--card__symbol-row",Yr="esri-legend--card__symbol-cell",jr="esri-legend--card__carousel-indicator-container",Jr="esri-legend--card__interval-separators-container",Gr="esri-legend--card__relationship-label-container",Qr="esri-legend--card__label-container",Xr="esri-legend--card__service-caption-container",$r="esri-legend--card__symbol-container",Kr="esri-legend--card__size-ramp-container",en="esri-legend--card__size-ramp-preview",tn="esri-legend--card__pie-chart-ramp-preview",rn="esri-legend__size-ramp--horizontal",nn="esri-legend__ramp-labels",an="esri-legend__layer-cell esri-legend__layer-cell--info",ln="esri-univariate-above-and-below-ramp__color--card";!function(e){e.Auto="auto",e.Stack="stack",e.SideBySide="side-by-side"}(br||(br={}));var sn=window.devicePixelRatio;var on=function(e){(0,l.Z)(r,e);var t=(0,s.Z)(r);function r(e,n){var a;return(0,i.Z)(this,r),(a=t.call(this,e,n))._handles=new u.Z,a._hasIndicators=!1,a._selectedSectionName=null,a._sectionNames=[],a._sectionMap=new Map,a.activeLayerInfos=null,a.headingLevel=3,a.layout=br.Stack,a.messages=null,a.messagesCommon=null,a.type="card",a.view=null,a}return(0,a.Z)(r,[{key:"initialize",value:function(){var e=this;this.own((0,d.YP)((function(){return e.activeLayerInfos}),(function(t){e._handles.removeAll(),e._watchForSectionChanges(t)})))}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null}},{key:"render",value:function(){var e=this;this._hasIndicators=this.layout===br.Auto&&this.view.container.clientWidth<=768||this.layout===br.Stack;var t=this.activeLayerInfos,r=t&&t.toArray().map((function(t){return e._renderLegendForLayer(t)})).filter((function(e){return!!e}));this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;var n=this._sectionNames.length,i=this._sectionNames.map((function(t,r){var i=(0,hr.n)(e.messagesCommon.pagination.pageText,{index:r+1,total:n});return(0,Tt.u)("div",{key:t,role:"tab",id:t,"aria-label":i,"aria-controls":"".concat(t,"-panel"),"aria-selected":(e._selectedSectionName===t).toString(),tabIndex:e._selectedSectionName===t?0:-1,title:i,onclick:e._selectSection,onkeydown:e._focusSection,bind:e,class:e.classes(Cr,(0,zt.Z)({},kr,e._selectedSectionName===t)),"data-section-name":t})})),a=this._hasIndicators&&n>1?(0,Tt.u)("div",{class:jr,key:"carousel-navigation",role:"tablist"},i):null,l=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):r&&r.length?r:null,s=(0,zt.Z)({},xr,this._hasIndicators);return(0,Tt.u)("div",{class:this.classes(Sr,s)},l||(0,Tt.u)("div",{class:Tr},this.messages.noLegend),a)}},{key:"_selectSection",value:function(e){var t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}},{key:"_focusSection",value:function(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}},{key:"_switchSectionOnArrowPress",value:function(e){var t=e.key,r="ArrowLeft"===t?-1:1,n=e.target.getAttribute("data-section-name"),i=this._sectionNames.indexOf(n),a=this._sectionNames,l=null;-1!==i&&(a[i+r]?l=document.getElementById(a[i+r]):"ArrowLeft"===t?l=document.getElementById(a[a.length-1]):"ArrowRight"===t&&(l=document.getElementById(a[0])),l&&l.focus())}},{key:"_watchForSectionChanges",value:function(e){var t=this;if(this._generateSectionNames(),e){e.forEach((function(e){var r="activeLayerInfo-".concat(e.layer.uid,"-version-change");t._handles.remove(r),t._watchForSectionChanges(e.children),t._handles.add((0,d.YP)((function(){return e.version}),(function(){return t._generateSectionNames()})),r)}));var r="activeLayerInfos-collection-change";this._handles.remove(r),this._handles.add(e.on("change",(function(){return t._watchForSectionChanges(e)})),r)}}},{key:"_generateSectionNames",value:function(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}},{key:"_getSectionName",value:function(e,t,r){return"".concat(this.id).concat(e.uid,"-type-").concat(t.type,"-").concat(r)}},{key:"_generateSectionNamesForActiveLayerInfo",value:function(e){var t=this;e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach((function(r,n){t._sectionNames.push(t._getSectionName(e.layer,r,n))}))}},{key:"_renderLegendForLayer",value:function(e){var t=this;if(!e.ready)return null;if(e.children.length){var r=e.children.map((function(e){return t._renderLegendForLayer(e)})).toArray();return(0,Tt.u)("div",{key:e.layer.uid,class:this.classes(Or,Br)},(0,Tt.u)("div",{class:Xr},e.title),r)}var n=e.legendElements;if(n&&!n.length)return null;var i=n.some((function(e){return"relationship-ramp"===e.type})),a=n.map((function(r,n){return t._renderLegendForElement(r,e,n,i)})).filter((function(e){return!!e}));if(!a.length)return null;var l=(0,zt.Z)({},Hr,!!e.parent);return(0,Tt.u)("div",{key:e.layer.uid,class:this.classes(Or,l)},(0,Tt.u)("div",{class:Xr},(0,Tt.u)("div",{class:Dr},e.title)),(0,Tt.u)("div",{class:Nr},a))}},{key:"_renderLegendForElement",value:function(e,t,r){var n=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a="color-ramp"===e.type,l="opacity-ramp"===e.type,s="size-ramp"===e.type,o=t.layer,u=null;if("string"==typeof e.title)u=e.title;else if(e.title){var c=e.title,d=vr(this.messages,c,a||l);u=c.title?"".concat(c.title," (").concat(d,")"):d}var f=this._getSectionName(o,e,r),y=this._hasIndicators?(0,Tt.u)("div",null,(0,Tt.u)(_r.X6,{level:this.headingLevel,class:Ir},t.title),(0,Tt.u)(_r.X6,{level:(0,_r.MJ)(this.headingLevel),class:Rr},u)):u?(0,Tt.u)(_r.X6,{level:this.headingLevel,class:Rr},u):null,h=t.effectList,p=null;if("symbol-table"===e.type){var v=e.infos.map((function(r,i){return n._renderLegendForElementInfo(r,t,e.legendType,i)})).filter((function(e){return!!e}));if(v.length){var m,g=v[0].properties.classes&&v[0].properties.classes[Ur],b=(m={},(0,zt.Z)(m,Qr,!g&&!i),(0,zt.Z)(m,Gr,i),m);p=(0,Tt.u)("div",{class:this.classes(b)},v)}}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?p=this._renderLegendForRamp(e,o.opacity,h):s?p=this._renderSizeRamp(e,o.opacity):"pie-chart-ramp"===e.type?p=this._renderPieChartRamp(e):"relationship-ramp"===e.type?p=Xt(e,this.id,o.opacity,h):"univariate-above-and-below-ramp"===e.type?p=this._renderUnivariateAboveAndBelowRamp(e,o.opacity,h):"univariate-color-size-ramp"===e.type&&(p=this._renderUnivariateColorSizeRamp(e,o.opacity,h));if(!p)return null;var _=(0,Tt.u)("div",{key:f,class:Pr,id:"".concat(f,"-panel"),role:"tabpanel","aria-labelledby":f,tabIndex:0},[y,p]);return this._sectionMap.set(f,_),_}},{key:"_renderPieChartRamp",value:function(e){return(0,Tt.u)("div",{class:tn,bind:e.preview,afterCreate:pr})}},{key:"_renderUnivariateAboveAndBelowRamp",value:function(e,t,r){var n=fr(e,t,"horizontal"),i=n.sizeRampElement,a=n.colorRampElement;if(!i)return null;var l=cr(i,"full",!0,"horizontal"),s=dr(i,"above",!0,"horizontal"),o=dr(i,"below",!0,"horizontal"),u=ur(a,{width:s,height:12,rampAlignment:"horizontal",opacity:t,type:"above",effectList:r}),c=ur(a,{width:o,height:12,rampAlignment:"horizontal",opacity:t,type:"below",effectList:r}),d=or(i,"card"),f=i.infos.map((function(e){return e.label})),y=f.length-1,h=f.map((function(e,t){return 0===t||t===y?(0,Tt.u)("div",{key:t},e):null})),p={marginTop:"3px",display:"flex"};(0,le.dZ)(this.container)?p.marginRight="".concat(d,"px"):p.marginLeft="".concat(d,"px");var v={width:"".concat(l,"px"),display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,Tt.u)("div",{class:zr,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,Tt.u)("div",{class:this.classes($r,rn),styles:{display:"flex",flexDirection:"row"}},i.infos.map((function(e,t){return(0,Tt.u)("div",{key:t,class:qr,bind:e.preview,afterCreate:pr})}))),u?(0,Tt.u)("div",{class:ln,styles:p,key:"color-ramp-preview"},(0,Tt.u)("div",{bind:u,afterCreate:pr}),(0,Tt.u)("div",{bind:c,afterCreate:pr})):null,(0,Tt.u)("div",{class:an},(0,Tt.u)("div",{class:nn,styles:v},h)))}},{key:"_renderUnivariateColorSizeRamp",value:function(e,t,r){var n=yr(e,"horizontal"),i=n.sizeRampElement,a=n.colorRampElement;if(!i)return null;var l=cr(i,"full",!1,"horizontal"),s=ur(a,{width:dr(i,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:r}),o=or(i,"card"),u=i.infos.length-1,c=i.infos.map((function(e,t){return 0===t||t===u?(0,Tt.u)("div",{key:t},e.label):null})),d={marginTop:"3px",display:"flex"};(0,le.dZ)(this.container)?d.marginRight="".concat(o,"px"):d.marginLeft="".concat(o,"px");var f={width:"".concat(l,"px"),display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,Tt.u)("div",{class:zr,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,Tt.u)("div",{class:this.classes($r,rn),styles:{display:"flex",flexDirection:"row"}},i.infos.map((function(e,t){return(0,Tt.u)("div",{key:t,class:qr,bind:e.preview,afterCreate:pr})}))),(0,Tt.u)("div",{class:ln,styles:d,key:"color-ramp-preview"},(0,Tt.u)("div",{bind:s,afterCreate:pr})),(0,Tt.u)("div",{class:an},(0,Tt.u)("div",{class:nn,styles:f},c)))}},{key:"_renderLegendForElementInfo",value:function(e,t,r,n){var i=t.layer;if(e.type)return this._renderLegendForElement(e,t,n);var a=gr(i,r);if(e.preview){var l,s;if(!e.symbol||!e.symbol.type.includes("simple-fill")){if(!e.label)return(0,Tt.u)("div",{key:n,bind:e.preview,afterCreate:pr});var o=(0,zt.Z)({},Yr,this._hasIndicators);return(0,Tt.u)("div",{key:n,class:this.classes(zr,(0,zt.Z)({},Ur,this._hasIndicators))},(0,Tt.u)("div",{class:this.classes(o),bind:e.preview,afterCreate:pr}),(0,Tt.u)("div",{class:this.classes(Vr,(0,zt.Z)({},Ar,this._hasIndicators))},vr(this.messages,e.label,!1)||""))}var u=255,c=255,d=255,f=0,y=255,h=255,p=255,v=0,m=e.symbol.color&&e.symbol.color.a,g=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;m&&(u=e.symbol.color.r,c=e.symbol.color.g,d=e.symbol.color.b,f=e.symbol.color.a*i.opacity),g&&(y=e.symbol.outline.color.r,h=e.symbol.outline.color.g,p=e.symbol.outline.color.b,v=e.symbol.outline.color.a*i.opacity);var b=null===(l=null===(s=e.symbol.color)||void 0===s?void 0:s.isBright)||void 0===l||l,_=b?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",L={background:m?"rgba(".concat(u,", ").concat(c,", ").concat(d,", ").concat(f,")"):"none",color:b?"black":"white",textShadow:"-1px -1px 0 ".concat(_,",\n                                              1px -1px 0 ").concat(_,",\n                                              -1px 1px 0 ").concat(_,",\n                                              1px 1px 0 ").concat(_),border:g?"1px solid rgba(".concat(y,", ").concat(h,", ").concat(p,", ").concat(v,")"):"none",filter:(0,W.wJ)(t.effectList)};return(0,Tt.u)("div",{key:n,class:zr},(0,Tt.u)("div",{class:Fr,styles:L}," ",e.label," "))}if(e.src){var w=this._renderImage(e,i,a);return(0,Tt.u)("div",{key:n,class:zr},w,(0,Tt.u)("div",{class:Vr},e.label||""))}}},{key:"_renderImage",value:function(e,t,r){var n,i=e.label,a=e.src,l=e.opacity,s=(n={},(0,zt.Z)(n,Zr,r),(0,zt.Z)(n,qr,!r),n),o={opacity:"".concat(null!=l?l:t.opacity)};return(0,Tt.u)("img",{alt:vr(this.messages,i,!1),src:a,border:0,width:e.width,height:e.height,class:this.classes(s),styles:o})}},{key:"_renderSizeRampLines",value:function(e){var t=e.infos,r=t[0],n=t[t.length-1],i=r.symbol,a=this._hasIndicators,l=(0,V.F2)(r.size+r.outlineSize)*sn,s=(0,V.F2)(n.size+n.outlineSize)*sn,o=a?l:l+50*sn,u=a?l/2+50*sn:l,c=function(e){if(e){if(e.type.includes("3d")){var t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;var r=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return"triangle"===r||"cone"===r||"tetrahedron"===r}return"triangle"===e.style}}(i),d=function(e){if(e){if(e.type.includes("3d")){var t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;var r=e.symbolLayers.getItemAt(t-1),n=r.resource&&r.resource.primitive;return"circle"===n||"cross"===n||"kite"===n||"sphere"===n||"cube"===n||"diamond"===n}var i=e.style;return"circle"===i||"diamond"===i||"cross"===i}}(i),f=document.createElement("canvas");f.width=o,f.height=u,f.style.width=f.width/sn+"px",f.style.height=f.height/sn+"px";var y=f.getContext("2d");if(a){y.beginPath();var h=o/2-s/2,p=u;y.moveTo(0,0),y.lineTo(h,p);var v=o,m=o/2+s/2,g=u;y.moveTo(v,0),y.lineTo(m,g)}else{y.beginPath();var b=u/2-s/2,_=o;y.moveTo(0,b),y.lineTo(_,0);var L=u/2+s/2,w=o,k=u;y.moveTo(0,L),y.lineTo(w,k)}return y.strokeStyle="#ddd",y.stroke(),(0,Tt.u)("div",{bind:f,afterCreate:pr,styles:a?{display:"flex",marginTop:"-".concat(c?0:d?l/2:0,"px"),marginBottom:"-".concat(c?s:d?s/2:0,"px")}:{display:"flex",marginRight:"-".concat(c?0:d?l/2:0,"px"),marginLeft:"-".concat(c?0:d?s/2:0,"px")}})}},{key:"_renderSizeRamp",value:function(e,t){var r=e.infos,n=r[0].label,i=r[r.length-1].label,a=r[0].preview,l=r[r.length-1].preview,s=this._hasIndicators,o={"flex-direction":s?"column":"row-reverse"};a&&((a=a.cloneNode(!0)).style.display="flex"),l&&((l=l.cloneNode(!0)).style.display="flex");var u={opacity:null!=t?"".concat(t):""};return(0,Tt.u)("div",{class:this.classes(zr,(0,zt.Z)({},Wr,s))},(0,Tt.u)("div",{class:Mr},s?n:i),(0,Tt.u)("div",{class:Kr,styles:o},(0,Tt.u)("div",{bind:a,afterCreate:pr,class:en,styles:u}),this._renderSizeRampLines(e),(0,Tt.u)("div",{bind:l,afterCreate:pr,class:Kr,styles:u})),(0,Tt.u)("div",{class:Mr},s?i:n))}},{key:"_renderLegendForRamp",value:function(e,t,r){var n=e.infos,i="heatmap-ramp"===e.type,a=n.length-1,l=25,s=a>2&&!i?25*a:100,o=s+20,u=10,c=n.slice(0).reverse();c.forEach((function(e,t){e.offset=i?e.ratio:t/a}));var d=c.length-1,f=c.length%2!=0&&c[c.length/2|0],y=f&&(0,Tt.u)("div",{class:Jr},(0,Tt.u)("div",{class:Er},"|"),(0,Tt.u)("div",{class:Mr},f.label)),h=n[n.length-1].label,p=n[0].label,v=[[{shape:{type:"path",path:"M0 ".concat(l/2," L").concat(u," 0 L").concat(u," ").concat(l," Z")},fill:c[0].color,stroke:{width:0}},{shape:{type:"rect",x:u,y:0,width:s,height:l},fill:{type:"linear",x1:u,y1:0,x2:s+u,y2:0,colors:c},stroke:{width:0}},{shape:{type:"path",path:"M".concat(s+u," 0 L").concat(o," ").concat(l/2," L").concat(s+u," ").concat(l," Z")},fill:c[d].color,stroke:{width:0}}]],m=(0,At.KB)(v,o,l),g=this.messages,b={filter:(0,W.wJ)(r),opacity:null==t?null:"".concat(t)};return(0,Tt.u)("div",{class:zr,styles:{justifyContent:"center"}},(0,Tt.u)("div",{class:Mr},i?g[h]:h),(0,Tt.u)("div",{class:$r},(0,Tt.u)("div",{styles:b},m),y),(0,Tt.u)("div",{class:Mr},i?g[p]:p))}}]),r}(v.Z);(0,o._)([(0,h.Cb)()],on.prototype,"activeLayerInfos",void 0),(0,o._)([(0,h.Cb)()],on.prototype,"headingLevel",void 0),(0,o._)([(0,h.Cb)()],on.prototype,"layout",void 0),(0,o._)([(0,h.Cb)(),(0,wr.H)("esri/widgets/Legend/t9n/Legend")],on.prototype,"messages",void 0),(0,o._)([(0,h.Cb)(),(0,wr.H)("esri/t9n/common")],on.prototype,"messagesCommon",void 0),(0,o._)([(0,h.Cb)({readOnly:!0})],on.prototype,"type",void 0),(0,o._)([(0,h.Cb)()],on.prototype,"view",void 0),(0,o._)([(0,Lr.h)()],on.prototype,"_selectSection",null);var un=on=(0,o._)([(0,p.j)("esri.widgets.Legend.styles.Card")],on),cn="esri-legend__service",dn="esri-legend__service-label",fn="esri-legend__layer",yn="esri-legend__group-layer",hn="esri-legend__group-layer-child",pn="esri-legend__layer-table",vn="esri-legend__layer-table--size-ramp",mn="esri-legend__layer-child-table",gn="esri-legend__layer-caption",bn="esri-legend__layer-body",_n="esri-legend__layer-row",Ln="esri-legend__layer-cell esri-legend__layer-cell--info",wn="esri-legend__imagery-layer-image--stretched",kn="esri-legend__imagery-layer-info--stretched",Sn="esri-legend__layer-cell esri-legend__layer-cell--symbols",xn="esri-legend__symbol",In="esri-legend__ramps",Cn="esri-legend__size-ramp",En="esri-legend__color-ramp",Zn="esri-legend__opacity-ramp",Vn="esri-legend__ramp-labels",Rn="esri-legend__ramp-label",Fn="esri-univariate-above-and-below-ramp__label",zn="esri-legend__message",An="esri-widget__heading",Tn={display:"flex",alignItems:"flex-start"},Mn={marginLeft:"3px"},Pn={display:"table-cell",verticalAlign:"middle"},Dn=function(e){(0,l.Z)(r,e);var t=(0,s.Z)(r);function r(e,n){var a;return(0,i.Z)(this,r),(a=t.call(this,e,n)).activeLayerInfos=null,a.headingLevel=3,a.messages=null,a.type="classic",a}return(0,a.Z)(r,[{key:"render",value:function(){var e=this,t=this.activeLayerInfos,r=t&&t.toArray().map((function(t){return e._renderLegendForLayer(t)})).filter((function(e){return!!e}));return(0,Tt.u)("div",null,r&&r.length?r:(0,Tt.u)("div",{class:zn},this.messages.noLegend))}},{key:"_renderLegendForLayer",value:function(e){var t=this;if(!e.ready)return null;var r=!!e.children.length,n="".concat("esri-legend__").concat(e.layer.uid,"-version-").concat(e.version),i=e.title?(0,_r.X6)({level:this.headingLevel,class:this.classes(An,dn)},e.title):null;if(r){var a=e.children.map((function(e){return t._renderLegendForLayer(e)})).toArray();return(0,Tt.u)("div",{key:n,class:this.classes(cn,yn)},i,a)}var l=e.legendElements;if(l&&!l.length)return null;var s=l.map((function(r){return t._renderLegendForElement(r,e.layer,e.effectList)})).filter((function(e){return!!e}));if(!s.length)return null;var o=(0,zt.Z)({},hn,!!e.parent);return(0,Tt.u)("div",{key:n,class:this.classes(cn,o),tabIndex:0},i,(0,Tt.u)("div",{class:fn},s))}},{key:"_renderLegendForElement",value:function(e,t,r,n){var i=this,a="color-ramp"===e.type,l="opacity-ramp"===e.type,s="size-ramp"===e.type,o=null;if("symbol-table"===e.type||s){var u=e.infos.map((function(n){return i._renderLegendForElementInfo(n,t,r,s,e.legendType)})).filter((function(e){return!!e}));u.length&&(o=(0,Tt.u)("div",{class:bn},u))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?o=this._renderLegendForRamp(e,t.opacity):"relationship-ramp"===e.type?o=Xt(e,this.id,t.opacity,r):"pie-chart-ramp"===e.type?o=this._renderPieChartRamp(e):"univariate-above-and-below-ramp"===e.type?o=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,r):"univariate-color-size-ramp"===e.type&&(o=this._renderUnivariateColorSizeRamp(e,t.opacity,r));if(!o)return null;var c=e.title,d=null;if("string"==typeof c)d=c;else if(c){var f=vr(this.messages,c,a||l);d=mr(0,a||l)&&c.title?"".concat(c.title," (").concat(f,")"):f}var y=n?mn:pn,h=d?(0,Tt.u)("div",{class:gn},d):null,p=(0,zt.Z)({},vn,s||!n);return(0,Tt.u)("div",{class:this.classes(y,p)},h,o)}},{key:"_renderPieChartRamp",value:function(e){return(0,Tt.u)("div",{bind:e.preview,afterCreate:pr})}},{key:"_renderUnivariateAboveAndBelowRamp",value:function(e,t,r){var n=this,i=fr(e,t),a=i.sizeRampElement,l=i.colorRampElement;if(!a)return null;var s=dr(a,"above",!0),o=dr(a,"below",!0),u=ur(l,{width:12,height:s,rampAlignment:"vertical",opacity:t,type:"above",effectList:r}),c=ur(l,{width:12,height:o,rampAlignment:"vertical",opacity:t,type:"below",effectList:r}),d=or(a),f=a.infos.map((function(e){return e.label})),y=f.map((function(e,t){var r=2===t;return 0===t?(0,Tt.u)("div",{key:t,class:e?u?Fn:Rn:null},e):r?(0,Tt.u)("div",null):null})),h=f.length-1,p=Math.floor(f.length/2),v=f.map((function(e,t){return t===p||t===h?(0,Tt.u)("div",{key:t,class:e?u?Fn:Rn:null},e):null})),m={display:"table-cell",verticalAlign:"middle"},g={marginTop:"".concat(d,"px")},b={height:"".concat(s,"px")},_={height:"".concat(o,"px")};return(0,Tt.u)("div",{key:"univariate-above-and-below-ramp-preview",styles:Tn},(0,Tt.u)("div",{class:bn},a.infos.map((function(e,t){return(0,Tt.u)("div",{class:n.classes(_n,Cn)},(0,Tt.u)("div",{class:xn,styles:m,bind:e.preview,afterCreate:pr}),u||t%2!=0?null:(0,Tt.u)("div",{class:Ln},f[t]))}))),u?(0,Tt.u)("div",{styles:g,key:"color-ramp-preview"},(0,Tt.u)("div",{styles:Mn},(0,Tt.u)("div",{styles:Pn},(0,Tt.u)("div",{class:In,bind:u,afterCreate:pr})),(0,Tt.u)("div",{styles:Pn},(0,Tt.u)("div",{class:Vn,styles:b},y))),(0,Tt.u)("div",{styles:Mn},(0,Tt.u)("div",{styles:Pn},(0,Tt.u)("div",{class:In,bind:c,afterCreate:pr})),(0,Tt.u)("div",{styles:Pn},(0,Tt.u)("div",{class:Vn,styles:_},v)))):null)}},{key:"_renderUnivariateColorSizeRamp",value:function(e,t,r){var n=this,i=yr(e),a=i.sizeRampElement,l=i.colorRampElement;if(!a)return null;var s=or(a),o=dr(a,"full",!1),u=ur(l,{width:12,height:o,rampAlignment:"vertical",opacity:t,type:"full",effectList:r}),c=a.infos.length-1,d=a.infos.map((function(e,t){return 0===t||t===c?(0,Tt.u)("div",{key:t,class:e.label?l?Fn:Rn:null},e.label):null})),f={display:"table-cell",verticalAlign:"middle"},y={marginTop:"".concat(s,"px")},h={height:"".concat(o,"px")};return(0,Tt.u)("div",{key:"univariate-above-and-below-ramp-preview",styles:Tn},(0,Tt.u)("div",{class:bn},a.infos.map((function(e){return(0,Tt.u)("div",{class:n.classes(_n,Cn)},(0,Tt.u)("div",{class:xn,styles:f,bind:e.preview,afterCreate:pr}))}))),(0,Tt.u)("div",{styles:y,key:"color-ramp-preview"},(0,Tt.u)("div",{styles:Mn},(0,Tt.u)("div",{styles:Pn},(0,Tt.u)("div",{class:In,bind:u,afterCreate:pr})),(0,Tt.u)("div",{styles:Pn},(0,Tt.u)("div",{class:Vn,styles:h},d)))))}},{key:"_renderLegendForRamp",value:function(e,t){var r=this,n=e.infos,i="opacity-ramp"===e.type,a="heatmap-ramp"===e.type,l="stretch-ramp"===e.type,s=e.preview,o=i?Zn:"";s.className="".concat(En," ").concat(o),null!=t&&(s.style.opacity=t.toString());var u=n.map((function(e){return(0,Tt.u)("div",{class:e.label?Rn:null},a?r.messages[e.label]||e.label:l?r._getStretchStopLabel(e):e.label)})),c={width:"".concat(24,"px")},d={height:s.style.height};return(0,Tt.u)("div",{class:_n},(0,Tt.u)("div",{class:Sn,styles:c},(0,Tt.u)("div",{class:In,bind:s,afterCreate:pr})),(0,Tt.u)("div",{class:Ln},(0,Tt.u)("div",{class:Vn,styles:d},u)))}},{key:"_getStretchStopLabel",value:function(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:(0,Fe.uf)(e.value,{style:"decimal",notation:e.value.toString().includes("e")?"scientific":"standard"})):""}},{key:"_renderLegendForElementInfo",value:function(e,t,r,n,i){var a;if(e.type)return this._renderLegendForElement(e,t,r,!0);var l=null,s=gr(t,i);if(e.preview?l=(0,Tt.u)("div",{class:xn,bind:e.preview,afterCreate:pr}):e.src&&(l=this._renderImage(e,t,s)),!l)return null;var o=(0,zt.Z)({},kn,s),u=(a={},(0,zt.Z)(a,kn,s),(0,zt.Z)(a,Cn,!s&&n),a);return(0,Tt.u)("div",{class:_n},(0,Tt.u)("div",{class:this.classes(Sn,u)},l),(0,Tt.u)("div",{class:this.classes(Ln,o)},vr(this.messages,e.label,!1)||""))}},{key:"_renderImage",value:function(e,t,r){var n,i=e.label,a=e.src,l=e.opacity,s=(n={},(0,zt.Z)(n,wn,r),(0,zt.Z)(n,xn,!r),n),o={opacity:"".concat(null!=l?l:t.opacity)};return(0,Tt.u)("img",{alt:vr(this.messages,i,!1),src:a,border:0,width:e.width,height:e.height,class:this.classes(s),styles:o})}}]),r}(v.Z);(0,o._)([(0,h.Cb)()],Dn.prototype,"activeLayerInfos",void 0),(0,o._)([(0,h.Cb)()],Dn.prototype,"headingLevel",void 0),(0,o._)([(0,h.Cb)(),(0,wr.H)("esri/widgets/Legend/t9n/Legend")],Dn.prototype,"messages",void 0),(0,o._)([(0,h.Cb)({readOnly:!0})],Dn.prototype,"type",void 0);var Nn=Dn=(0,o._)([(0,p.j)("esri.widgets.Legend.styles.Classic")],Dn),On="esri-legend",Bn="esri-widget",Hn="esri-widget--panel",qn="esri-icon-layer-list",Wn=function(e){(0,l.Z)(r,e);var t=(0,s.Z)(r);function r(e,n){var a;return(0,i.Z)(this,r),(a=t.call(this,e,n))._handles=new u.Z,a.activeLayerInfos=null,a.basemapLegendVisible=!1,a.groundLegendVisible=!1,a.headingLevel=3,a.hideLayersNotInCurrentView=!1,a.keepCacheOnDestroy=!1,a.respectLayerVisibility=!0,a.iconClass=qn,a.label=void 0,a.layerInfos=null,a.messages=null,a.style=new Nn,a.view=null,a.viewModel=new Ft,a}return(0,a.Z)(r,[{key:"initialize",value:function(){var e=this;this.own([(0,d.on)((function(){return e.view}),"resize",(function(){return e.scheduleRender()})),(0,d.on)((function(){return e.activeLayerInfos}),"change",(function(){return e._refreshActiveLayerInfos(e.activeLayerInfos)})),(0,d.YP)((function(){return e.headingLevel}),(function(t){var r=e.style;r&&(r.headingLevel=t)})),(0,d.YP)((function(){return e.style}),(function(t,r){r&&t!==r&&r.destroy(),t&&(t.activeLayerInfos=e.activeLayerInfos,"card"===t.type&&(t.view=e.view),t.headingLevel=e.headingLevel)}),d.nn)])}},{key:"destroy",value:function(){this._handles=(0,c.SC)(this._handles)}},{key:"castStyle",value:function(e){if(e instanceof un||e instanceof Nn)return e;if("string"==typeof e)return"card"===e?new un:new Nn;if(e&&"string"==typeof e.type){var t=(0,n.Z)({},e);return delete t.type,new("card"===e.type?un:Nn)(t)}return new Nn}},{key:"render",value:function(){return(0,Tt.u)("div",{class:this.classes(On,Bn,this.style instanceof Nn?Hn:null)},this.style.render())}},{key:"_refreshActiveLayerInfos",value:function(e){var t=this;this._handles.removeAll(),e.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)})),this.scheduleRender()}},{key:"_renderOnActiveLayerInfoChange",value:function(e){var t=this,r=(0,d.YP)((function(){return e.version}),(function(){return t.scheduleRender()}));this._handles.add(r,"version_".concat(e.layer.uid));var n=(0,d.on)((function(){return e.children}),"change",(function(){return e.children.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)}))}),d.nn);this._handles.add(n,"children_".concat(e.layer.uid)),e.children.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)}))}}]),r}(v.Z);(0,o._)([(0,f.B)("viewModel.activeLayerInfos")],Wn.prototype,"activeLayerInfos",void 0),(0,o._)([(0,f.B)("viewModel.basemapLegendVisible")],Wn.prototype,"basemapLegendVisible",void 0),(0,o._)([(0,f.B)("viewModel.groundLegendVisible")],Wn.prototype,"groundLegendVisible",void 0),(0,o._)([(0,h.Cb)()],Wn.prototype,"headingLevel",void 0),(0,o._)([(0,f.B)("viewModel.hideLayersNotInCurrentView")],Wn.prototype,"hideLayersNotInCurrentView",void 0),(0,o._)([(0,f.B)("viewModel.keepCacheOnDestroy")],Wn.prototype,"keepCacheOnDestroy",void 0),(0,o._)([(0,f.B)("viewModel.respectLayerVisibility")],Wn.prototype,"respectLayerVisibility",void 0),(0,o._)([(0,h.Cb)()],Wn.prototype,"iconClass",void 0),(0,o._)([(0,h.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Wn.prototype,"label",void 0),(0,o._)([(0,f.B)("viewModel.layerInfos")],Wn.prototype,"layerInfos",void 0),(0,o._)([(0,h.Cb)(),(0,wr.H)("esri/widgets/Legend/t9n/Legend")],Wn.prototype,"messages",void 0),(0,o._)([(0,h.Cb)()],Wn.prototype,"style",void 0),(0,o._)([(0,y.p)("style")],Wn.prototype,"castStyle",null),(0,o._)([(0,f.B)("viewModel.view")],Wn.prototype,"view",void 0),(0,o._)([(0,h.Cb)()],Wn.prototype,"viewModel",void 0);var Un=Wn=(0,o._)([(0,p.j)("esri.widgets.Legend")],Wn)}}]);
//# sourceMappingURL=5349.02404e92.chunk.js.map