"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[7044],{82582:function(e,t,r){r.d(t,{dp:function(){return a},yZ:function(){return i}});var n=r(68860);function i(e,t){var r=t||e.extent,i=e.width,a=(0,n.c9)(r&&r.spatialReference);return r&&i?r.width/i*a*n.hd*96:0}function a(e,t){return e/((0,n.c9)(t)*n.hd*96)}},44041:function(e,t,r){r.d(t,{R:function(){return g}});var n=r(1413),i=r(15671),a=r(43144),o=r(60136),s=r(54062),u=r(27366),l=r(85015),c=r(41691),p=r(92026),f=r(76672),y=r(49861),d=(r(63780),r(93169),r(25243),r(69912)),h=r(45948),v=r(87072),m=r(58132),b={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"},g=function(e){(0,o.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).floors=null,n.scale=0,n}return(0,a.Z)(r,[{key:"destroy",value:function(){this.layer=null}},{key:"dynamicLayers",get:function(){var e=this;if(!this.hasDynamicLayers)return null;var t=this.visibleSublayers.map((function(t){var r=(0,v.f)(e.floors,t);return t.toExportImageJSON(r)}));return t.length?JSON.stringify(t):null}},{key:"hasDynamicLayers",get:function(){return this.layer&&(0,m.FN)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}},{key:"layer",set:function(e){var t=this;this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(function(){return t.notifyChange("visibleSublayers")})),e.on("sublayer-update",(function(e){return t.notifyChange(b[e.propertyName])}))],"layer"))}},{key:"layers",get:function(){var e=this.visibleSublayers;return e?e.length?"show:"+e.map((function(e){return e.id})).join(","):"show:-1":null}},{key:"layerDefs",get:function(){var e,t=this,r=!(null===(e=this.floors)||void 0===e||!e.length),n=this.visibleSublayers.filter((function(e){return null!=e.definitionExpression||r&&null!=e.floorInfo}));return n.length?JSON.stringify(n.reduce((function(e,r){var n=(0,v.f)(t.floors,r),i=(0,f._)(n,r.definitionExpression);return(0,p.pC)(i)&&(e[r.id]=i),e}),{})):null}},{key:"version",get:function(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");var e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}},{key:"visibleSublayers",get:function(){var e=this,t=[];if(!this.layer)return t;var r=this.layer.sublayers;r&&r.forEach((function r(n){var i=e.scale,a=0===i,o=0===n.minScale||i<=n.minScale,s=0===n.maxScale||i>=n.maxScale;n.visible&&(a||o&&s)&&(n.sublayers?n.sublayers.forEach(r):t.unshift(n))}));var n=this._get("visibleSublayers");return!n||n.length!==t.length||n.some((function(e,r){return t[r]!==e}))?t:n}},{key:"toJSON",value:function(){var e=this.layer,t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t=(0,n.Z)((0,n.Z)({},t),{},{layers:this.layers,layerDefs:this.layerDefs}),t}}]),r}((0,c.p)(l.Z));(0,u._)([(0,y.Cb)({readOnly:!0})],g.prototype,"dynamicLayers",null),(0,u._)([(0,y.Cb)()],g.prototype,"floors",void 0),(0,u._)([(0,y.Cb)({readOnly:!0})],g.prototype,"hasDynamicLayers",null),(0,u._)([(0,y.Cb)()],g.prototype,"layer",null),(0,u._)([(0,y.Cb)({readOnly:!0})],g.prototype,"layers",null),(0,u._)([(0,y.Cb)({readOnly:!0})],g.prototype,"layerDefs",null),(0,u._)([(0,y.Cb)({type:Number})],g.prototype,"scale",void 0),(0,u._)([(0,y.Cb)(h.qG)],g.prototype,"timeExtent",void 0),(0,u._)([(0,y.Cb)({readOnly:!0})],g.prototype,"version",null),(0,u._)([(0,y.Cb)({readOnly:!0})],g.prototype,"visibleSublayers",null),g=(0,u._)([(0,d.j)("esri.layers.mixins.ExportImageParameters")],g)},87072:function(e,t,r){function n(e){var t,r=e.layer;return"floorInfo"in r&&null!==(t=r.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?a(e.view.floors,r.floorInfo.floorField):null}function i(e,t){var r;return"floorInfo"in t&&null!==(r=t.floorInfo)&&void 0!==r&&r.floorField?a(e,t.floorInfo.floorField):null}function a(e,t){if(null===e||void 0===e||!e.length)return null;var r=e.filter((function(e){return""!==e})).map((function(e){return"'".concat(e,"'")}));return r.push("''"),"".concat(t," IN (").concat(r.join(","),") OR ").concat(t," IS NULL")}r.d(t,{c:function(){return n},f:function(){return i}})},58132:function(e,t,r){r.d(t,{FN:function(){return s},QV:function(){return o},ac:function(){return l}});var n=r(37762),i=r(92026),a=r(25265);function o(e,t,r){return t.flatten((function(e){return e.sublayers})).length!==e.length||(!!e.some((function(e){return e.originIdOf("minScale")>r||e.originIdOf("maxScale")>r||e.originIdOf("renderer")>r||e.originIdOf("labelingInfo")>r||e.originIdOf("opacity")>r||e.originIdOf("labelsVisible")>r||e.originIdOf("source")>r}))||!u(e,t))}function s(e,t,r){return!!e.some((function(e){var t=e.source;return!(!t||"map-layer"===t.type&&t.mapLayerId===e.id&&((0,i.Wi)(t.gdbVersion)||t.gdbVersion===r))||e.originIdOf("renderer")>a.s3.SERVICE||e.originIdOf("labelingInfo")>a.s3.SERVICE||e.originIdOf("opacity")>a.s3.SERVICE||e.originIdOf("labelsVisible")>a.s3.SERVICE}))||!u(e,t)}function u(e,t){if(!e||!e.length||(0,i.Wi)(t))return!0;var r=t.slice().reverse().flatten((function(e){var t=e.sublayers;return t&&t.toArray().reverse()})).map((function(e){return e.id})).toArray();if(e.length>r.length)return!1;var a,o=0,s=r.length,u=(0,n.Z)(e);try{for(u.s();!(a=u.n()).done;){for(var l=a.value.id;o<s&&r[o]!==l;)o++;if(o>=s)return!1}}catch(c){u.e(c)}finally{u.f()}return!0}function l(e){return!!e&&e.some((function(e){return null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale}))}},87044:function(e,t,r){r.r(t),r.d(t,{default:function(){return ve}});var n=r(1413),i=r(74165),a=r(15861),o=r(15671),s=r(43144),u=r(60136),l=r(54062),c=r(27366),p=r(32718),f=r(66978),y=r(94172),d=r(49861),h=(r(63780),r(93169)),v=r(25243),m=r(69912),b=r(78983),g=r(90110),x=r(95986),w=r(34035),Z=r(83978),_=r(9229),I=r(67581),C=r(93433),k=r(11752),S=r(61120),E=r(10064),O=r(92026),P=r(53866),N=r(82582),F=r(45948),V=r(44041),j=r(87072),R=r(96669),L=r(37762),D=r(76200),U=r(50689),T=r(23084),q=r(76672),A=r(77981),G=r(58132),J=function(e){return e.spatialReference.wkid||JSON.stringify(e.spatialReference)};function M(e,t){var r=e.toJSON(),n=r.dpi,i=r.gdbVersion,a=r.geometry,o=r.geometryPrecision,s=r.height,u=r.layerOption,l=r.mapExtent,c=r.maxAllowableOffset,p=r.returnFieldName,f=r.returnGeometry,y=r.returnUnformattedValues,d=r.returnZ,h=r.spatialReference,v=r.timeExtent,m=r.tolerance,b=r.width,g=Q(e),x=g.dynamicLayers,w=g.layerDefs,Z=g.layerIds,_=t&&(0,O.pC)(t.geometry)?t.geometry:null,I={geometryPrecision:o,maxAllowableOffset:c,returnFieldName:p,returnGeometry:f,returnUnformattedValues:y,returnZ:d,tolerance:m},C=_&&_.toJSON()||a;if(I.imageDisplay="".concat(b,",").concat(s,",").concat(n),i&&(I.gdbVersion=i),C&&(delete C.spatialReference,I.geometry=JSON.stringify(C),I.geometryType=(0,A.Ji)(C)),h?I.sr=h.wkid||JSON.stringify(h):C&&C.spatialReference?I.sr=J(C):l&&l.spatialReference&&(I.sr=J(l)),I.time=v?[v.start,v.end].join(","):null,l){var k=l.xmin,S=l.ymin,E=l.xmax,P=l.ymax;I.mapExtent="".concat(k,",").concat(S,",").concat(E,",").concat(P)}return w&&(I.layerDefs=w),x&&!w&&(I.dynamicLayers=x),I.layers="popup"===u?"visible":u,Z&&!x&&(I.layers+=":".concat(Z.join(","))),I}function Q(e){var t,r,n=e.mapExtent,i=e.floors,a=e.width,o=e.sublayers,s=e.layerIds,u=e.layerOption,l=e.gdbVersion,c=null===o||void 0===o||null===(t=o.find((function(e){return null!=e.layer})))||void 0===t||null===(r=t.layer)||void 0===r?void 0:r.serviceSublayers,p="popup"===u,f={},y=(0,N.yZ)({extent:n,width:a,spatialReference:null===n||void 0===n?void 0:n.spatialReference}),d=[];if(null!==o&&void 0!==o&&o.forEach((function e(t){var r=0===y,n=0===t.minScale||y<=t.minScale,i=0===t.maxScale||y>=t.maxScale;if(t.visible&&(r||n&&i))if(t.sublayers)t.sublayers.forEach(e);else{if(!1===(null===s||void 0===s?void 0:s.includes(t.id))||p&&(!t.popupTemplate||!t.popupEnabled))return;d.unshift(t)}})),o&&!d.length)f.layerIds=[];else{var h=(0,G.FN)(d,c,l),v=d.map((function(e){var t=(0,j.f)(i,e);return e.toExportImageJSON(t)}));if(h)f.dynamicLayers=JSON.stringify(v);else{if(o){var m=d.map((function(e){return e.id}));s&&(m=m.filter((function(e){return s.includes(e)}))),f.layerIds=m}else(null===s||void 0===s?void 0:s.length)&&(f.layerIds=s);var b=function(e,t){var r=!(null===e||void 0===e||!e.length),n=t.filter((function(e){return null!=e.definitionExpression||r&&null!=e.floorInfo}));return n.length?n.map((function(t){var r=(0,j.f)(e,t),n=(0,q._)(r,t.definitionExpression);return{id:t.id,definitionExpression:n}})):null}(i,d);if((0,O.pC)(b)&&b.length){var g,x={},w=(0,L.Z)(b);try{for(w.s();!(g=w.n()).done;){var Z=g.value;Z.definitionExpression&&(x[Z.id]=Z.definitionExpression)}}catch(_){w.e(_)}finally{w.f()}Object.keys(x).length&&(f.layerDefs=JSON.stringify(x))}}}return f}var B,H=r(59486),W=r(62044),z=r(46784),Y=r(78952),K=B=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).dpi=96,n.floors=null,n.gdbVersion=null,n.geometry=null,n.geometryPrecision=null,n.height=400,n.layerIds=null,n.layerOption="top",n.mapExtent=null,n.maxAllowableOffset=null,n.returnFieldName=!0,n.returnGeometry=!1,n.returnM=!1,n.returnUnformattedValues=!0,n.returnZ=!1,n.spatialReference=null,n.sublayers=null,n.timeExtent=null,n.tolerance=null,n.width=400,n}return(0,s.Z)(r,null,[{key:"from",value:function(e){return(0,v.TJ)(B,e)}}]),r}(z.wq);(0,c._)([(0,d.Cb)({type:Number,json:{write:!0}})],K.prototype,"dpi",void 0),(0,c._)([(0,d.Cb)()],K.prototype,"floors",void 0),(0,c._)([(0,d.Cb)({type:String,json:{write:!0}})],K.prototype,"gdbVersion",void 0),(0,c._)([(0,d.Cb)({types:H.qM,json:{read:A.im,write:!0}})],K.prototype,"geometry",void 0),(0,c._)([(0,d.Cb)({type:Number,json:{write:!0}})],K.prototype,"geometryPrecision",void 0),(0,c._)([(0,d.Cb)({type:Number,json:{write:!0}})],K.prototype,"height",void 0),(0,c._)([(0,d.Cb)({type:[Number],json:{write:!0}})],K.prototype,"layerIds",void 0),(0,c._)([(0,d.Cb)({type:["top","visible","all","popup"],json:{write:!0}})],K.prototype,"layerOption",void 0),(0,c._)([(0,d.Cb)({type:P.Z,json:{write:!0}})],K.prototype,"mapExtent",void 0),(0,c._)([(0,d.Cb)({type:Number,json:{write:!0}})],K.prototype,"maxAllowableOffset",void 0),(0,c._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],K.prototype,"returnFieldName",void 0),(0,c._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],K.prototype,"returnGeometry",void 0),(0,c._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],K.prototype,"returnM",void 0),(0,c._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],K.prototype,"returnUnformattedValues",void 0),(0,c._)([(0,d.Cb)({type:Boolean,json:{write:!0}})],K.prototype,"returnZ",void 0),(0,c._)([(0,d.Cb)({type:Y.Z,json:{write:!0}})],K.prototype,"spatialReference",void 0),(0,c._)([(0,d.Cb)()],K.prototype,"sublayers",void 0),(0,c._)([(0,d.Cb)({type:W.Z,json:{write:!0}})],K.prototype,"timeExtent",void 0),(0,c._)([(0,d.Cb)({type:Number,json:{write:!0}})],K.prototype,"tolerance",void 0),(0,c._)([(0,d.Cb)({type:Number,json:{write:!0}})],K.prototype,"width",void 0);var X=K=B=(0,c._)([(0,m.j)("esri.rest.support.IdentifyParameters")],K),$=r(52639),ee=r(38511),te=r(31201),re=r(27823),ne=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).displayFieldName=null,n.feature=null,n.layerId=null,n.layerName=null,n}return(0,s.Z)(r,[{key:"readFeature",value:function(e,t){return $.Z.fromJSON({attributes:(0,n.Z)({},t.attributes),geometry:(0,n.Z)({},t.geometry)})}},{key:"writeFeature",value:function(e,t){if(e){var r=e.attributes,i=e.geometry;r&&(t.attributes=(0,n.Z)({},r)),(0,O.pC)(i)&&(t.geometry=i.toJSON(),t.geometryType=re.P$.toJSON(i.type))}}}]),r}(z.wq);(0,c._)([(0,d.Cb)({type:String,json:{write:!0}})],ne.prototype,"displayFieldName",void 0),(0,c._)([(0,d.Cb)({type:$.Z})],ne.prototype,"feature",void 0),(0,c._)([(0,ee.r)("feature",["attributes","geometry"])],ne.prototype,"readFeature",null),(0,c._)([(0,te.c)("feature")],ne.prototype,"writeFeature",null),(0,c._)([(0,d.Cb)({type:Number,json:{write:!0}})],ne.prototype,"layerId",void 0),(0,c._)([(0,d.Cb)({type:String,json:{write:!0}})],ne.prototype,"layerName",void 0);var ie=ne=(0,c._)([(0,m.j)("esri.rest.support.IdentifyResult")],ne);function ae(e,t,r){return oe.apply(this,arguments)}function oe(){return oe=(0,a.Z)((0,i.Z)().mark((function e(t,r,a){var o,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(r=ue(r)).geometry?[r.geometry]:[],s=(0,T.en)(t),e.abrupt("return",(s.path+="/identify",(0,U.aX)(o).then((function(e){var t=M(r,{geometry:e&&e[0]}),i=(0,T.cv)((0,n.Z)((0,n.Z)({},s.query),{},{f:"json"},t)),o=(0,T.lA)(i,a);return(0,D.default)(s.path,o).then(se).then((function(e){return le(e,r.sublayers)}))}))));case 2:case"end":return e.stop()}}),e)}))),oe.apply(this,arguments)}function se(e){var t=e.data;t.results=t.results||[];var r={results:[]};return r.results=t.results.map((function(e){return ie.fromJSON(e)})),r}function ue(e){return X.from(e)}function le(e,t){if(null===t||void 0===t||!t.length)return e;var r=new Map;t.forEach((function e(t){r.set(t.id,t),t.sublayers&&t.sublayers.forEach(e)}));var n,i=(0,L.Z)(e.results);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.feature.sourceLayer=r.get(a.layerId)}}catch(o){i.e(o)}finally{i.f()}return e}var ce=r(819),pe=r(24405),fe=r(13107),ye=r(45008),de=p.Z.getLogger("esri.views.2d.layers.MapImageLayerView2D"),he=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(){var e;return(0,o.Z)(this,r),(e=t.apply(this,arguments))._highlightGraphics=new b.J,e}return(0,s.Z)(r,[{key:"update",value:function(e){this.strategy.update(e).catch((function(e){(0,f.D_)(e)||de.error(e)}))}},{key:"attach",value:function(){var e=this,t=this.layer,r=t.imageMaxWidth,n=t.imageMaxHeight,i=t.version,a=i>=10.3,o=i>=10;this._bitmapContainer=new g.c,this.container.addChild(this._bitmapContainer);var s=new w.Z({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:function(){return e.requestUpdate()},container:new Z.Z(this.view.featuresTilingScheme)});this.container.addChild(s.container),this.strategy=new _.Z({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:r,imageMaxHeight:n,imageRotationSupported:a,imageNormalizationSupported:o,hidpi:!0}),this.handles.add((0,y.YP)((function(){return e.exportImageVersion}),(function(){return e.requestUpdate()})),"exportImageVersion"),this.handles.add((0,y.YP)((function(){var t;return null===(t=e.view)||void 0===t?void 0:t.floors}),(function(){return e.requestUpdate()})),"view.floors"),this.requestUpdate()}},{key:"detach",value:function(){this.handles.remove("exportImageVersion"),this.handles.remove("view.floors"),this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren()}},{key:"moveStart",value:function(){}},{key:"viewChange",value:function(){}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"highlight",value:function(e,t){var r=this;return this._highlightGraphics.add(e),{remove:function(){r._highlightGraphics.remove(e)}}}},{key:"supportsSpatialReference",value:function(e){return this.layer.serviceSupportsSpatialReference(e)}},{key:"createFetchPopupFeaturesQueryGeometry",value:function(e,t){return(0,ye.K)(e,t,this.view)}},{key:"doRefresh",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.requestUpdate();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isUpdating",value:function(){return this.strategy.updating||this.updateRequested}},{key:"fetchImage",value:function(e,t,r,i){return this.layer.fetchImage(e,t,r,(0,n.Z)({timeExtent:this.timeExtent,floors:this.view.floors},i))}}]),r}(function(e){var t=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(){return(0,o.Z)(this,r),t.apply(this,arguments)}return(0,s.Z)(r,[{key:"initialize",value:function(){this.exportImageParameters=new V.R({layer:this.layer})}},{key:"destroy",value:function(){this.exportImageParameters.destroy(),this.exportImageParameters=null}},{key:"exportImageVersion",get:function(){var e;return null!==(e=this.exportImageParameters)&&void 0!==e&&e.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}},{key:"fetchPopupFeatures",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a,o,s,u,l,c,p;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=this.layer,t){e.next=3;break}throw new E.Z("mapimagelayer:fetchPopupFeatures","Nothing to fetch without area",{layer:c});case 3:if(p=null===(n=null===(a=this.layer.capabilities)||void 0===a||null===(o=a.operations)||void 0===o?void 0:o.supportsQuery)||void 0===n||n,(null===(s=null===(u=this.layer.capabilities)||void 0===u||null===(l=u.operations)||void 0===l?void 0:l.supportsIdentify)||void 0===s||s)&&this.layer.version>=10.5||p){e.next=6;break}throw new E.Z("mapimagelayer:fetchPopupFeatures-not-supported","query operation is disabled for this service",{layer:c});case 6:return e.abrupt("return",p?this._fetchPopupFeaturesUsingQueries(t,r):this._fetchPopupFeaturesUsingIdentify(t,r));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){var e;return!!(0,k.Z)((0,S.Z)(r.prototype),"canResume",this).call(this)&&!(null!==(e=this.timeExtent)&&void 0!==e&&e.isEmpty)}},{key:"_fetchPopupFeaturesUsingIdentify",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,a,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._createIdentifyParameters(t,r);case 2:if(n=e.sent,!(0,O.Wi)(n)){e.next=5;break}return e.abrupt("return",[]);case 5:return e.next=7,ae(this.layer.parsedUrl,n);case 7:return a=e.sent,o=a.results,e.abrupt("return",o.map((function(e){return e.feature})));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createIdentifyParameters",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,o,s,u,l,c,p,f,y,d,v,m,b,g,x=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=this.view,u=s.floors,l=s.spatialReference,c=s.scale,p=(0,O.pC)(r)?r.event:null,e.next=7,this._collectPopupProviders(this.layer.sublayers,c,r);case 7:if((f=e.sent).length){e.next=10;break}return e.abrupt("return",null);case 10:return e.next=12,Promise.all(f.map((function(e){return e.sublayer.load().catch((function(){}))})));case 12:if(y=Math.min((0,h.Z)("mapimagelayer-popup-identify-max-tolerance"),this.layer.allSublayers.reduce((function(e,t){return t.renderer?(0,R.k)({renderer:t.renderer,event:p}):e}),2)),d=this.createFetchPopupFeaturesQueryGeometry(t,y),v=(0,N.dp)(c,l),m=Math.round(d.width/v),b=new P.Z({xmin:d.center.x-v*m,ymin:d.center.y-v*m,xmax:d.center.x+v*m,ymax:d.center.y+v*m,spatialReference:d.spatialReference}),e.t0=!1===(null===(n=this.layer.capabilities)||void 0===n||null===(o=n.operations)||void 0===o?void 0:o.supportsQuery),e.t0){e.next=22;break}return e.next=21,new Promise((function(e){var t=!1;Promise.all(f.map(function(){var r=(0,a.Z)((0,i.Z)().mark((function r(n){var a,o;return(0,i.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(a=n.popupTemplate)){r.next=9;break}return r.next=4,x._loadArcadeModules(a);case 4:if(o=r.sent,!t){r.next=7;break}return r.abrupt("return");case 7:(null===o||void 0===o?void 0:o.arcadeUtils.hasGeometryOperations(a))&&(t=!0,e(!0));case 9:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())).finally((function(){return e(!1)}))}));case 21:e.t0=e.sent;case 22:return g=e.t0,e.abrupt("return",new X({floors:u,gdbVersion:this.layer.gdbVersion,geometry:t,height:m,layerOption:"popup",mapExtent:b,maxAllowableOffset:g?0:v,returnGeometry:!0,spatialReference:l,sublayers:this.layer.sublayers,timeExtent:this.timeExtent,tolerance:y,width:m}));case 24:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_fetchPopupFeaturesUsingQueries",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n,o,s,u=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._collectPopupProviders(this.layer.sublayers,this.view.scale,r);case 2:return n=e.sent,o=(0,O.pC)(r)?r.event:null,s=n.map(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(r){var n,a,s,l,c,p,f,y,d,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.sublayer,a=r.popupTemplate,e.next=3,n.load().catch((function(){}));case 3:return s=n.createQuery(),l=(0,R.k)({renderer:n.renderer,event:o}),c=u.createFetchPopupFeaturesQueryGeometry(t,l),s.geometry=c,e.next=7,(0,pe.e)(n,a);case 7:if(s.outFields=e.sent,!("floors"in u.view)){e.next=11;break}y=null===(p=u.view)||void 0===p||null===(f=p.floors)||void 0===f?void 0:f.clone(),d=(0,j.f)(y,n),(0,O.pC)(d)&&(s.where=s.where?"(".concat(s.where,") AND (").concat(d,")"):d);case 11:return e.next=13,u._loadArcadeModules(a);case 13:return(h=e.sent)&&h.arcadeUtils.hasGeometryOperations(a)||(s.maxAllowableOffset=c.width/l),e.next=17,n.queryFeatures(s);case 17:return e.abrupt("return",e.sent.features);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=7,(0,f.as)(s);case 7:return e.abrupt("return",e.sent.reduce((function(e,t){return t.value?[].concat((0,C.Z)(e),(0,C.Z)(t.value)):e}),[]).filter((function(e){return null!=e})));case 8:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_collectPopupProviders",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,o){var s,u,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=[],u=function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var a,l,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=0===t.minScale||r<=t.minScale,l=0===t.maxScale||r>=t.maxScale,t.visible&&a&&l&&(t.sublayers?t.sublayers.forEach(u):t.popupEnabled&&(c=(0,pe.V)(t,(0,n.Z)((0,n.Z)({},o),{},{defaultPopupTemplateEnabled:!1})),(0,O.pC)(c)&&s.unshift({sublayer:t,popupTemplate:c})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=t.toArray().reverse().map(u),e.next=3,Promise.all(l);case 3:return e.abrupt("return",s);case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_loadArcadeModules",value:function(e){var t;if(null!==(t=e.expressionInfos)&&void 0!==t&&t.length||Array.isArray(e.content)&&e.content.some((function(e){return"expression"===e.type})))return(0,ce.LC)()}}]),r}(e);return(0,c._)([(0,d.Cb)()],t.prototype,"exportImageParameters",void 0),(0,c._)([(0,d.Cb)({readOnly:!0})],t.prototype,"exportImageVersion",null),(0,c._)([(0,d.Cb)()],t.prototype,"layer",void 0),(0,c._)([(0,d.Cb)()],t.prototype,"suspended",void 0),(0,c._)([(0,d.Cb)(F.qG)],t.prototype,"timeExtent",void 0),t=(0,c._)([(0,m.j)("esri.views.layers.MapImageLayerView")],t)}((0,fe.Z)((0,x.y)(I.Z))));(0,c._)([(0,d.Cb)()],he.prototype,"strategy",void 0),(0,c._)([(0,d.Cb)()],he.prototype,"updating",void 0);var ve=he=(0,c._)([(0,m.j)("esri.views.2d.layers.MapImageLayerView2D")],he)},83978:function(e,t,r){r.d(t,{Z:function(){return h}});var n=r(15671),i=r(43144),a=r(11752),o=r(61120),s=r(60136),u=r(54062),l=r(27366),c=(r(32718),r(25243),r(63780),r(93169),r(75366),r(69912)),p=r(80613),f=r(82022),y=r(8548),d=function(e){(0,s.Z)(r,e);var t=(0,u.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"doRender",value:function(e){e.drawPhase===p.jx.HIGHLIGHT&&(0,a.Z)((0,o.Z)(r.prototype),"doRender",this).call(this,e)}},{key:"renderChildren",value:function(e){if(this.attributeView.bindTextures(e.context),this.children.some((function(e){return e.hasData}))){(0,a.Z)((0,o.Z)(r.prototype),"renderChildren",this).call(this,e);var t=e.painter.effects.highlight;t.bind(e),e.context.setColorMask(!0,!0,!0,!0),e.context.clear(y.lk.COLOR_BUFFER_BIT),this._renderChildren(e,t.defines.concat(["highlightAll"])),t.draw(e),t.unbind()}}}]),r}(f.Z),h=d=(0,l._)([(0,c.j)("esri.views.2d.layers.support.HighlightGraphicContainer")],d)},24405:function(e,t,r){r.d(t,{V:function(){return c},e:function(){return u}});var n=r(74165),i=r(93433),a=r(15861),o=r(92026),s=r(37270);function u(e){return l.apply(this,arguments)}function l(){return l=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a,u,l,c,p,f,y,d,h=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=h.length>1&&void 0!==h[1]?h[1]:t.popupTemplate,!(0,o.Wi)(r)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,r.getRequiredFields(t.fieldsIndex);case 5:if(a=e.sent,u=r.lastEditInfoEnabled,l=t.objectIdField,c=t.typeIdField,p=t.globalIdField,f=t.relationships,!a.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!u){e.next=19;break}return e.next=16,(0,s.CH)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return y=e.t0,d=(0,s.Q0)(t.fieldsIndex,[].concat((0,i.Z)(a),(0,i.Z)(y))),e.abrupt("return",(c&&d.push(c),d&&l&&t.fieldsIndex.has(l)&&!d.includes(l)&&d.push(l),d&&p&&t.fieldsIndex.has(p)&&!d.includes(p)&&d.push(p),f&&f.forEach((function(e){var r=e.keyField;d&&r&&t.fieldsIndex.has(r)&&!d.includes(r)&&d.push(r)})),d));case 23:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}function c(e,t){return e.popupTemplate?e.popupTemplate:(0,o.pC)(t)&&t.defaultPopupTemplateEnabled&&(0,o.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=7044.9c5a64c1.chunk.js.map