"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[1573],{51573:function(e,t,n){n.r(t),n.d(t,{default:function(){return K}});var r=n(37762),i=n(1413),a=n(29439),u=n(74165),s=n(15861),l=n(43144),o=n(15671),c=(n(59486),n(76200)),f=n(10064),d=n(32718),p=n(66978),h=n(35995),v=n(79803),y=n(40237),m=n(92975),g=n(81753),x=n(3182),b=n(80457),Z=n(68928),w=n(19995),k=n(14e3),F=(0,u.Z)().mark(E),_=(0,u.Z)().mark(C),N=/^\s*"([\S\s]*)"\s*$/,I=/""/g,T=[","," ",";","|","\t"];function E(e,t,n){var r,i,a;return(0,u.Z)().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:r=0;case 1:if(!(r<=e.length)){u.next=10;break}if(i=e.indexOf(t,r),a=e.substring(r,i>-1?i:void 0),r+=a.length+t.length,u.t0=n&&!a.trim(),u.t0){u.next=8;break}return u.next=8,a;case 8:u.next=1;break;case 10:case"end":return u.stop()}}),F)}function S(e){var t=e.includes("\r\n")?"\r\n":"\n";return E(e,t,!0)}function q(e,t){return E(e,t,!1)}function C(e,t,n){var i,a,s,l,o,c,f,d,p,h,v,y,m,g,x=arguments;return(0,u.Z)().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:i=x.length>3&&void 0!==x[3]?x[3]:function(){return Object.create(null)},a="",s="",l=0,o=i(),c=0,f=(0,r.Z)(e),u.prev=3,f.s();case 5:if((d=f.n()).done){u.next=47;break}p=d.value,h=q(p,n),v=(0,r.Z)(h),u.prev=9,v.s();case 11:if((y=v.n()).done){u.next=29;break}if(m=y.value,a+=s+m,s="",(l+=D(m))%2!=0){u.next=26;break}if(!(l>0)){u.next=22;break}if(g=N.exec(a)){u.next=19;break}return o=i(),c=0,a="",l=0,u.abrupt("continue",45);case 19:o[t[c]]=g[1].replace(I,'"'),c++,u.next=23;break;case 22:o[t[c]]=a,c++;case 23:a="",l=0,u.next=27;break;case 26:s=n;case 27:u.next=11;break;case 29:u.next=34;break;case 31:u.prev=31,u.t0=u.catch(9),v.e(u.t0);case 34:return u.prev=34,v.f(),u.finish(34);case 37:if(0!==l){u.next=44;break}return u.next=40,o;case 40:o=i(),c=0,u.next=45;break;case 44:s="\n";case 45:u.next=5;break;case 47:u.next=52;break;case 49:u.prev=49,u.t1=u.catch(3),f.e(u.t1);case 52:return u.prev=52,f.f(),u.finish(52);case 55:case"end":return u.stop()}}),_,null,[[3,49,52,55],[9,31,34,37]])}function D(e){var t=0,n=0;for(n=e.indexOf('"',n);n>=0;)t++,n=e.indexOf('"',n+1);return t}var O=n(63543),j=n(29616);function P(e){var t=e.map((function(e){return e.toLowerCase()}));return{longitudeFieldName:e[t.indexOf(A.find((function(e){return t.includes(e)})))],latitudeFieldName:e[t.indexOf($.find((function(e){return t.includes(e)})))]}}function V(e,t,n,i){var a,u=[],s=C(e,n,t),l=[],o=(0,r.Z)(s);try{for(o.s();!(a=o.n()).done;){var c=a.value;if(10===l.length)break;l.push(c)}}catch(h){o.e(h)}finally{o.f()}var f,d=(0,r.Z)(n);try{var p=function(){var e=f.value;if(e===i.longitudeFieldName||e===i.latitudeFieldName)u.push({name:e,type:"esriFieldTypeDouble",alias:e});else{var t=G(l.map((function(t){return t[e]}))),n={name:e,type:null,alias:e};switch(t){case"integer":n.type="esriFieldTypeInteger";break;case"double":n.type="esriFieldTypeDouble";break;case"date":n.type="esriFieldTypeDate",n.length=36;break;default:n.type="esriFieldTypeString",n.length=255}u.push(n)}};for(d.s();!(f=d.n()).done;)p()}catch(h){d.e(h)}finally{d.f()}return u}function G(e){if(!e.length)return"string";var t=/[^+-.,0-9]/;return e.map((function(e){var n=!1;if(""!==e){if(t.test(e))n=!0;else{var r=R(e);if(!isNaN(r))return/[.,]/.test(e)||!Number.isInteger(r)||r>214783647||r<-214783648?"double":"integer";if(e.includes("E")){if(r=Number(e),!isNaN(r))return"double";if(e.includes(",")){if(e=e.replace(",","."),r=Number(e),!isNaN(r))return"double";n=!0}else n=!0}else n=!0}return n?/^[-]?\d*[.,]?\d*$/.test(e)?"string":Q(new Date(e),e)?"date":"string":"string"}})).reduce((function(e,t){return void 0===e||e===t?t:"string"===e||"string"===t?"string":"double"===e||"double"===t?"double":void 0}))}function Q(e,t){if(!e||"[object Date]"!==Object.prototype.toString.call(e)||isNaN(e.getTime()))return!1;var n=!0;if(!M&&/\d+\W*$/.test(t)){var r=t.match(/[a-zA-Z]{2,}/);if(r){for(var i=!1,a=0;!i&&a<=r.length;)i=!L.test(r[a]),a++;n=!i}}return n}var R=function(){var e=(0,j.lt)(),t=new RegExp("^"+e.regexp+"$"),n=new RegExp("["+e.group+"\\s\\xa0]","g"),r=e.factor;return function(i){var a=t.exec(i);if(e.factor=r,!a)return NaN;var u=a[1];if(!a[1]){if(!a[2])return NaN;u=a[2],e.factor*=-1}return+(u=u.replace(n,"").replace(e.decimal,"."))*e.factor}}(),L=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,M=Number.isNaN(new Date("technology 10").getTime()),$=["lat","latitude","latitude83","latdecdeg","lat_dd","y","ycenter","point-y"],A=["lon","lng","long","longitude","longitude83","longdecdeg","long_dd","x","xcenter","point-x"],Y=n(52410),U=n(37270),W=n(78952),B=(0,O.bU)("esriGeometryPoint"),J=["csv"],z=[0,0],H=(0,l.Z)((function e(t,n){(0,o.Z)(this,e),this.x=t,this.y=n})),K=function(){function e(){var t=this;(0,o.Z)(this,e),this._queryEngine=null,this._snapshotFeatures=function(){var e=(0,s.Z)((0,u.Z)().mark((function e(n){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._fetch(n);case 2:return r=e.sent,e.abrupt("return",t._createFeatures(r));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}return(0,l.Z)(e,[{key:"destroy",value:function(){var e;null!==(e=this._queryEngine)&&void 0!==e&&e.destroy(),this._queryEngine=null}},{key:"load",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t){var n,r,i,s,l,o,c,f,d,p,h=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=h.length>1&&void 0!==h[1]?h[1]:{},this.loadOptions=t,e.next=4,Promise.all([this._fetch(r.signal),this._checkProjection(null===t||void 0===t||null===(n=t.parsingOptions)||void 0===n?void 0:n.spatialReference)]);case 4:return i=e.sent,s=(0,a.Z)(i,1),l=s[0],o=X(l,t),this.locationInfo=o.locationInfo,this.delimiter=o.delimiter,this._queryEngine=this._createQueryEngine(o),e.next=11,this._createFeatures(l);case 11:return c=e.sent,this._queryEngine.featureStore.addMany(c),o.layerDefinition.extent=this._queryEngine.fullExtent,o.layerDefinition.timeInfo&&(f=this._queryEngine.timeExtent,d=f.start,p=f.end,o.layerDefinition.timeInfo.timeExtent=[d,p]),e.abrupt("return",o);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"applyEdits",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new f.Z("csv-layer:editing-not-supported","applyEdits() is not supported on CSVLayer");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"queryFeatures",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(){var t,n,r=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this._waitSnapshotComplete();case 4:return e.abrupt("return",this._queryEngine.executeQuery(t,n.signal));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"queryFeatureCount",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(){var t,n,r=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this._waitSnapshotComplete();case 4:return e.abrupt("return",this._queryEngine.executeQueryForCount(t,n.signal));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"queryObjectIds",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(){var t,n,r=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this._waitSnapshotComplete();case 4:return e.abrupt("return",this._queryEngine.executeQueryForIds(t,n.signal));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"queryExtent",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(){var t,n,r=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this._waitSnapshotComplete();case 4:return e.abrupt("return",this._queryEngine.executeQueryForExtent(t,n.signal));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"querySnapping",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t){var n,r=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this._waitSnapshotComplete();case 3:return e.abrupt("return",this._queryEngine.executeQueryForSnapping(t,n.signal));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refresh",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t){var n,r=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadOptions.customParameters=t,null!==(n=this._snapshotTask)&&void 0!==n&&n.abort(),this._snapshotTask=(0,p.vr)(this._snapshotFeatures),this._snapshotTask.promise.then((function(e){r._queryEngine.featureStore.clear(),e&&r._queryEngine.featureStore.addMany(e)}),(function(e){r._queryEngine.featureStore.clear(),(0,p.D_)(e)||d.Z.getLogger("esri.layers.CSVLayer").error(new f.Z("csv-layer:refresh","An error occurred during refresh",{error:e}))})),e.next=6,this._waitSnapshotComplete();case 6:return e.abrupt("return",{extent:this._queryEngine.fullExtent,timeExtent:this._queryEngine.timeExtent});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_waitSnapshotComplete",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._snapshotTask||this._snapshotTask.finished){e.next=9;break}return e.prev=1,e.next=4,this._snapshotTask.promise;case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:return e.abrupt("return",this._waitSnapshotComplete());case 9:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"_fetch",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t){var n,r,a,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.loadOptions,r=n.url,a=n.customParameters,r){e.next=3;break}throw new f.Z("csv-layer:invalid-source","url not defined");case 3:return s=(0,h.mN)(r),e.next=6,(0,c.default)(s.path,{query:(0,i.Z)((0,i.Z)({},s.query),a),responseType:"text",signal:t});case 6:return e.abrupt("return",e.sent.data);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createQueryEngine",value:function(e){var t=e.layerDefinition,n=t.objectIdField,r=t.fields,i=t.extent,a=t.timeInfo,u=new Z.Z({geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1});return new k.q({fields:r,geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1,timeInfo:a,objectIdField:n,spatialReference:i.spatialReference||{wkid:4326},cacheSpatialQueries:!0,featureStore:u})}},{key:"_createFeatures",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t){var n,i,s,l,o,c,f,d,p,h,Z,w,k,F,_,N,I,T,E,q,D,j,P,V,G,L,M,$,A,Y,B,J,K,X,ee,te,ne;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.locationInfo,i=n.latitudeFieldName,s=n.longitudeFieldName,l=this._queryEngine,o=l.objectIdField,c=l.fieldsIndex,f=l.spatialReference,d=[],p=[],h=c.fields.filter((function(e){return e.name!==o})).map((function(e){return e.name})),Z=0,(w=S(t)).next(),k={},F=(0,r.Z)(c.fields);try{for(F.s();!(_=F.n()).done;)"esriFieldTypeOID"!==(N=_.value).type&&"esriFieldTypeGlobalID"!==N.type&&void 0!==(I=(0,U.os)(N))&&(k[N.name]=I)}catch(u){F.e(u)}finally{F.f()}T=C(w,h,this.delimiter,(0,O.Dm)(k,o)),E=(0,r.Z)(T);try{for(E.s();!(q=E.n()).done;)if(D=q.value,j=this._parseCoordinateValue(D[i]),null!=(P=this._parseCoordinateValue(D[s]))&&null!=j&&!isNaN(j)&&!isNaN(P)){for(V in D[i]=j,D[s]=P,D)V!==i&&V!==s&&(c.isDateField(V)?(G=new Date(D[V]),D[V]=Q(G,D[V])?G.getTime():null):c.isNumericField(V)&&(L=R(D[V]),isNaN(L)?D[V]=null:D[V]=L));D[o]=Z,Z++,d.push(new H(P,j)),p.push(D)}}catch(u){E.e(u)}finally{E.f()}if(!(0,m.fS)({wkid:4326},f))if((0,m.sS)(f)){M=(0,r.Z)(d);try{for(M.s();!($=M.n()).done;)A=$.value,Y=(0,g.hG)(A.x,A.y,z),B=(0,a.Z)(Y,2),A.x=B[0],A.y=B[1]}catch(u){M.e(u)}finally{M.f()}}else d=(0,v.oj)(y.N,d,W.Z.WGS84,f,null,null);for(J=[],K=0;K<d.length;K++)X=d[K],ee=X.x,te=X.y,(ne=p[K])[o]=K+1,J.push(new x.u_(new b.Z([],[ee,te]),ne,null,ne[o]));return e.abrupt("return",J);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_parseCoordinateValue",value:function(e){if(null==e||""===e)return null;var t=R(e);return(isNaN(t)||Math.abs(t)>181)&&(t=parseFloat(e)),t}},{key:"_checkProjection",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,w._W)(m.Zn,t);case 3:e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(0),new f.Z("csv-layer:projection-not-supported","Projection not supported");case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();function X(e,t){var n=t.parsingOptions||{},i={delimiter:n.delimiter,layerDefinition:null,locationInfo:{latitudeFieldName:n.latitudeField,longitudeFieldName:n.longitudeField}},a=S(e),u=a.next().value;if(!u)throw new f.Z("csv-layer:empty-csv","CSV is empty",{csv:e});if(u=u.trim(),!n.delimiter){var s=function(e){var t,n=e.trim(),i=0,a="",u=(0,r.Z)(T);try{for(u.s();!(t=u.n()).done;){var s=t.value,l=n.split(s).length;l>i&&(i=l,a=s)}}catch(o){u.e(o)}finally{u.f()}return""===a?null:a}(u);if(!s)throw new f.Z("csv-layer:invalid-delimiter","Unable to detect the delimiter from CSV");i.delimiter=s}var l=u.split(i.delimiter).filter((function(e){return!!e})),o=i.layerDefinition={name:(0,h.vt)(t.url,J)||"csv",drawingInfo:B,geometryType:"esriGeometryPoint",objectIdField:null,fields:[],timeInfo:n.timeInfo,extent:{xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:n.spatialReference||{wkid:102100}}};if(!n.latitudeField||!n.longitudeField){var c=P(l);if(!n.longitudeField&&!c.longitudeFieldName||!n.latitudeField&&!c.latitudeFieldName)throw new f.Z("csv-layer:location-fields-not-found","Unable to identify latitude and longitude fields from the CSV file");i.locationInfo={longitudeFieldName:n.longitudeField||c.longitudeFieldName,latitudeFieldName:n.latitudeField||c.latitudeFieldName}}var d=V(a,i.delimiter,l,i.locationInfo);if(n.fields&&n.fields.length){var p,v=new Map,y=(0,r.Z)(n.fields);try{for(y.s();!(p=y.n()).done;){var m=p.value;v.set(m.name.toLowerCase(),m)}}catch(q){y.e(q)}finally{y.f()}var g,x=(0,r.Z)(d);try{for(x.s();!(g=x.n()).done;){var b=g.value,Z=v.get(b.name.toLowerCase());if(Z){var w=b.name;Object.assign(b,Z),b.name=w}}}catch(q){x.e(q)}finally{x.f()}}if(o.fields=d,!o.fields.some((function(e){return"esriFieldTypeOID"===e.type&&(o.objectIdField=e.name,!0)}))){var k={name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,nullable:!1};o.objectIdField=k.name,o.fields.unshift(k)}if(o.timeInfo){var F=new Y.Z(o.fields),_=o.timeInfo;if(_.startTimeField){var N=F.get(_.startTimeField);N?(_.startTimeField=N.name,N.type="esriFieldTypeDate"):_.startTimeField=null}if(_.endTimeField){var I=F.get(_.endTimeField);I?(_.endTimeField=I.name,I.type="esriFieldTypeDate"):_.endTimeField=null}if(_.trackIdField){var E=F.get(_.trackIdField);_.trackIdField=E?E.name:null}_.startTimeField||_.endTimeField||(o.timeInfo=null)}return i}}}]);
//# sourceMappingURL=1573.ccbc5145.chunk.js.map