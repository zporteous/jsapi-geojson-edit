"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[3518],{47991:function(e,t,n){n.d(t,{SR:function(){return v},Ui:function(){return f}});var i=n(43144),r=n(15671),a=n(37762),s=n(29439),u=n(92026),o=n(65156),h=n(376),l=n(69662),c=n(77981),p=n(76335),d=n(92975);function f(e){return y(e,!0)}function v(e){return y(e,!1)}function y(e,t){if((0,u.Wi)(e))return null;var n=e.spatialReference,i=(0,d.C5)(n),r="toJSON"in e?e.toJSON():e;if(!i)return r;var a=(0,d.sS)(n)?102100:4326,s=p.UZ[a].maxX,o=p.UZ[a].minX;if((0,c.wp)(r))return x(r,s,o);if((0,c.aW)(r))return r.points=r.points.map((function(e){return x(e,s,o)})),r;if((0,c.YX)(r))return m(r,i);if((0,c.oU)(r)||(0,c.l9)(r)){var l=(0,h.$P)(w,r),f={xmin:l[0],ymin:l[1],xmax:l[2],ymax:l[3]},v=(0,p.XZ)(f.xmin,o)*(2*s),y=0===v?r:(0,p.Sy)(r,v);return f.xmin+=v,f.xmax+=v,f.xmax>s?Z(y,s,t):f.xmin<o?Z(y,o,t):y}return r}function m(e,t){if(!t)return e;var n=function(e,t){var n=[],i=e.ymin,r=e.ymax,a=e.xmin,u=e.xmax,o=e.xmax-e.xmin,h=(0,s.Z)(t.valid,2),l=h[0],c=h[1],p=_(e.xmin,t),d=p.x,f=p.frameId,v=_(e.xmax,t),y=v.x,m=v.frameId,x=d===y&&o>0;if(o>2*c){var k={xmin:a<u?d:y,ymin:i,xmax:c,ymax:r},Z={xmin:l,ymin:i,xmax:a<u?y:d,ymax:r},w={xmin:0,ymin:i,xmax:c,ymax:r},C={xmin:l,ymin:i,xmax:0,ymax:r},I=[],O=[];g(k,w)&&I.push(f),g(k,C)&&O.push(f),g(Z,w)&&I.push(m),g(Z,C)&&O.push(m);for(var P=f+1;P<m;P++)I.push(P),O.push(P);n.push(new S(k,[f]),new S(Z,[m]),new S(w,I),new S(C,O))}else d>y||x?n.push(new S({xmin:d,ymin:i,xmax:c,ymax:r},[f]),new S({xmin:l,ymin:i,xmax:y,ymax:r},[m])):n.push(new S({xmin:d,ymin:i,xmax:y,ymax:r},[f]));return n}(e,t).map((function(e){return e.extent}));return n.length<2?n[0]||e:n.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:n.map((function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]}))}}function x(e,t,n){if(Array.isArray(e)){var i=e[0];if(i>t){var r=(0,p.XZ)(i,t);e[0]=i+r*(-2*t)}else if(i<n){var a=(0,p.XZ)(i,n);e[0]=i+a*(-2*n)}}else{var s=e.x;if(s>t){var u=(0,p.XZ)(s,t);e.x+=u*(-2*t)}else if(s<n){var o=(0,p.XZ)(s,n);e.x+=o*(-2*n)}}return e}function _(e,t){var n,i=(0,s.Z)(t.valid,2),r=i[0],a=i[1],u=2*a,o=0;return e>a?(e-=(n=Math.ceil(Math.abs(e-a)/u))*u,o=n):e<r&&(e+=(n=Math.ceil(Math.abs(e-r)/u))*u,o=-n),{x:e,frameId:o}}function g(e,t){var n=t.xmin,i=t.ymin,r=t.xmax,a=t.ymax;return k(e,n,i)&&k(e,n,a)&&k(e,r,a)&&k(e,r,i)}function k(e,t,n){return t>=e.xmin&&t<=e.xmax&&n>=e.ymin&&n<=e.ymax}function Z(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(0,c.l9)(e);if(i&&(0,l.Zy)(e),n)return(new C).cut(e,t);for(var r=i?e.rings:e.paths,s=i?4:2,u=r.length,o=-2*t,h=0;h<u;h++){var p=r[h];if(p&&p.length>=s){var d,f=[],v=(0,a.Z)(p);try{for(v.s();!(d=v.n()).done;){var y=d.value;f.push([y[0]+o,y[1]])}}catch(m){v.e(m)}finally{v.f()}r.push(f)}}return i?e.rings=r:e.paths=r,e}var S=(0,i.Z)((function e(t,n){(0,r.Z)(this,e),this.extent=t,this.frameIds=n})),w=(0,o.Ue)(),C=function(){function e(){(0,r.Z)(this,e),this.linesIn=[],this.linesOut=[]}return(0,i.Z)(e,[{key:"cut",value:function(e,t){var n;if(this.xCut=t,e.rings)this.closed=!0,n=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,n=e.paths,this.minPts=2}var i,r=(0,a.Z)(n);try{for(r.s();!(i=r.n()).done;){var s=i.value;if(s&&!(s.length<this.minPts)){var u,o=!0,h=(0,a.Z)(s);try{for(h.s();!(u=h.n()).done;){var l=u.value;o?(this.moveTo(l),o=!1):this.lineTo(l)}}catch(g){h.e(g)}finally{h.f()}this.closed&&this.close()}}}catch(g){r.e(g)}finally{r.f()}this._pushLineIn(),this._pushLineOut(),n=[];var c,p=(0,a.Z)(this.linesIn);try{for(p.s();!(c=p.n()).done;){var d=c.value;d&&d.length>=this.minPts&&n.push(d)}}catch(g){p.e(g)}finally{p.f()}var f,v=-2*this.xCut,y=(0,a.Z)(this.linesOut);try{for(y.s();!(f=y.n()).done;){var m=f.value;if(m&&m.length>=this.minPts){var x,_=(0,a.Z)(m);try{for(_.s();!(x=_.n()).done;){x.value[0]+=v}}catch(g){_.e(g)}finally{_.f()}n.push(m)}}}catch(g){y.e(g)}finally{y.f()}return this.closed?e.rings=n:e.paths=n,e}},{key:"moveTo",value:function(e){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(e[0]),this._moveTo(e[0],e[1],this._prevSide),this._prevPt=e,this._firstPt=e}},{key:"lineTo",value:function(e){var t=this._side(e[0]);if(t*this._prevSide==-1){var n=this._intersect(this._prevPt,e);this._lineTo(this.xCut,n,0),this._prevSide=0,this._lineTo(e[0],e[1],t)}else this._lineTo(e[0],e[1],t);this._prevSide=t,this._prevPt=e}},{key:"close",value:function(){var e=this._firstPt,t=this._prevPt;e[0]===t[0]&&e[1]===t[1]||this.lineTo(e),this._checkClosingPt(this.lineIn),this._checkClosingPt(this.lineOut)}},{key:"_moveTo",value:function(e,t,n){this.closed?(this.lineIn.push([n<=0?e:this.xCut,t]),this.lineOut.push([n>=0?e:this.xCut,t])):(n<=0&&this.lineIn.push([e,t]),n>=0&&this.lineOut.push([e,t]))}},{key:"_lineTo",value:function(e,t,n){this.closed?(this._addPolyVertex(this.lineIn,n<=0?e:this.xCut,t),this._addPolyVertex(this.lineOut,n>=0?e:this.xCut,t)):n<0?(0===this._prevSide&&this._pushLineOut(),this.lineIn.push([e,t])):n>0?(0===this._prevSide&&this._pushLineIn(),this.lineOut.push([e,t])):this._prevSide<0?(this.lineIn.push([e,t]),this.lineOut.push([e,t])):this._prevSide>0&&(this.lineOut.push([e,t]),this.lineIn.push([e,t]))}},{key:"_addPolyVertex",value:function(e,t,n){var i=e.length;i>1&&e[i-1][0]===t&&e[i-2][0]===t?e[i-1][1]=n:e.push([t,n])}},{key:"_checkClosingPt",value:function(e){var t=e.length;t>3&&e[0][0]===this.xCut&&e[t-2][0]===this.xCut&&e[1][0]===this.xCut&&(e[0][1]=e[t-2][1],e.pop())}},{key:"_side",value:function(e){return e<this.xCut?-1:e>this.xCut?1:0}},{key:"_intersect",value:function(e,t){var n=(this.xCut-e[0])/(t[0]-e[0]);return e[1]+n*(t[1]-e[1])}},{key:"_pushLineIn",value:function(){this.lineIn&&this.lineIn.length>=this.minPts&&this.linesIn.push(this.lineIn),this.lineIn=[]}},{key:"_pushLineOut",value:function(){this.lineOut&&this.lineOut.length>=this.minPts&&this.linesOut.push(this.lineOut),this.lineOut=[]}}]),e}()},33518:function(e,t,n){n.r(t),n.d(t,{GraphicsSnappingSource:function(){return T}});var i=n(4942),r=n(29439),a=n(74165),s=n(15861),u=n(37762),o=n(15671),h=n(43144),l=n(60136),c=n(54062),p=n(27366),d=n(85015),f=n(63780),v=n(41691),y=n(92026),m=n(66978),x=n(49861),_=(n(93169),n(25243),n(69912)),g=n(80885),k=n(79803),Z=n(47991),S=n(27823),w=n(83406),C=n(3182),I=n(68928),O=n(14e3),P=n(64674),b=n(69117),T=function(e){(0,l.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).availability=1,i.sources={multipoint:null,point:null,polygon:null,polyline:null},i.loadedWkids=new Set,i.loadedWkts=new Set,i.pendingAdds=[],i}return(0,h.Z)(n,[{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"layer",get:function(){return this.layerSource.layer}},{key:"destroy",value:function(){var e=this,t=this.pendingAdds;this.pendingAdds.length=0;var n,i=(0,u.Z)(t);try{for(i.s();!(n=i.n()).done;){n.value.task.abort()}}catch(r){i.e(r)}finally{i.f()}this._mapSources((function(t){return e._destroySource(t)}))}},{key:"initialize",value:function(){var e=this;this.handles.add([this.layer.on("graphic-update",(function(t){return e._onGraphicUpdate(t)})),this.updatingHandles.addOnCollectionChange((function(){return e.layer.graphics}),(function(t){return e._onGraphicsChanged(t)}))]),this._addMany(this.layer.graphics.toArray())}},{key:"fetchCandidates",value:function(){var e=(0,s.Z)((0,a.Z)().mark((function e(t,n){var i,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,m.WW)(this._mapSources((function(e){return e.queryEngine.executeQueryForSnapping({point:t.coordinateHelper.vectorToPoint(t.point).toJSON(),distance:t.distance,types:t.types,query:(0,y.pC)(t.filter)?t.filter.createQuery().toJSON():{where:"1=1"}},n).then((function(e){return e.candidates}))})));case 2:return i=e.sent,r=i.flat().map((function(e){return(0,b.X)(e,t.coordinateHelper,t.elevationInfo)})),e.abrupt("return",((0,P.lQ)(t.point,r),r));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"refresh",value:function(){}},{key:"_onGraphicUpdate",value:function(e){switch(e.property){case"geometry":case"visible":this._remove(e.graphic),this._addMany([e.graphic])}}},{key:"_onGraphicsChanged",value:function(e){var t,n=(0,u.Z)(e.removed);try{for(n.s();!(t=n.n()).done;){var i=t.value;this._remove(i)}}catch(r){n.e(r)}finally{n.f()}this._addMany(e.added)}},{key:"_addMany",value:function(e){var t,n=[],i=new Map,r=(0,u.Z)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;(0,y.Wi)(a.geometry)||(this._needsInitializeProjection(a.geometry.spatialReference)?(n.push(a.geometry.spatialReference),i.set(a.uid,a)):this._add(a))}}catch(s){r.e(s)}finally{r.f()}this._createPendingAdd(n,i)}},{key:"_createPendingAdd",value:function(e,t){var n=this;if(e.length){var i=(0,m.vr)(function(){var i=(0,s.Z)((0,a.Z)().mark((function i(s){var o,h,l,c;return(0,a.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,k.iQ)(e.map((function(e){return{source:e,dest:n.spatialReference}})),{signal:s});case 2:n._markLoadedSpatialReferences(e),o=(0,u.Z)(t);try{for(o.s();!(h=o.n()).done;)l=(0,r.Z)(h.value,2),c=l[1],n._add(c)}catch(a){o.e(a)}finally{o.f()}case 5:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}());this.updatingHandles.addPromise(i.promise);var o={task:i,graphics:t},h=function(){return(0,f.e$)(n.pendingAdds,o)};i.promise.then(h,h),this.pendingAdds.push(o)}}},{key:"_markLoadedSpatialReferences",value:function(e){var t,n=(0,u.Z)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;null!=i.wkid&&this.loadedWkids.add(i.wkid),null!=i.wkt&&this.loadedWkts.add(i.wkt)}}catch(r){n.e(r)}finally{n.f()}}},{key:"_add",value:function(e){if(!(0,y.Wi)(e.geometry)&&e.visible){var t=e.geometry;if("mesh"!==t.type){"extent"===t.type&&(t=g.Z.fromExtent(t));var n=this._ensureSource(t.type);if(!(0,y.Wi)(n)){var i=this._createOptimizedFeature(e.uid,t);(0,y.pC)(i)&&n.featureStore.add(i)}}}}},{key:"_needsInitializeProjection",value:function(e){return(null==e.wkid||!this.loadedWkids.has(e.wkid))&&(null==e.wkt||!this.loadedWkts.has(e.wkt))&&!(0,k.Up)(e,this.spatialReference)}},{key:"_createOptimizedFeature",value:function(e,t){var n=(0,k.iV)((0,Z.SR)(t),this.spatialReference);return n?new C.u_((0,w.GH)(n,!1,!1),(0,i.Z)({},R,e),null,e):null}},{key:"_ensureSource",value:function(e){var t=this.sources[e];if((0,y.pC)(t))return t;var n=this._createSource(e);return this.sources[e]=n,n}},{key:"_createSource",value:function(e){var t=S.Mk.toJSON(e),n=new I.Z({geometryType:t,hasZ:!1,hasM:!1});return{featureStore:n,queryEngine:new O.q({featureStore:n,fields:[{name:R,type:"esriFieldTypeOID",alias:R}],geometryType:t,hasM:!1,hasZ:!1,objectIdField:R,spatialReference:this.spatialReference,scheduler:(0,y.pC)(this.view)&&"3d"===this.view.type?this.view.resourceController.scheduler:null}),type:e}}},{key:"_remove",value:function(e){var t=this;this._mapSources((function(n){return t._removeFromSource(n,e)}));var n,i=(0,u.Z)(this.pendingAdds);try{for(i.s();!(n=i.n()).done;){var r=n.value;r.graphics.delete(e.uid),0===r.graphics.size&&r.task.abort()}}catch(a){i.e(a)}finally{i.f()}}},{key:"_removeFromSource",value:function(e,t){var n=t.uid;e.featureStore.has(n)&&e.featureStore.removeById(t.uid)}},{key:"_destroySource",value:function(e){e.queryEngine.destroy(),this.sources[e.type]=null}},{key:"_mapSources",value:function(e){var t=this.sources,n=t.point,i=t.polygon,r=t.polyline,a=t.multipoint,s=[];return(0,y.pC)(n)&&s.push(e(n)),(0,y.pC)(i)&&s.push(e(i)),(0,y.pC)(r)&&s.push(e(r)),(0,y.pC)(a)&&s.push(e(a)),s}}]),n}((0,v.p)(d.Z));(0,p._)([(0,x.Cb)({constructOnly:!0})],T.prototype,"spatialReference",void 0),(0,p._)([(0,x.Cb)({constructOnly:!0})],T.prototype,"layerSource",void 0),(0,p._)([(0,x.Cb)({constructOnly:!0})],T.prototype,"view",void 0),(0,p._)([(0,x.Cb)({readOnly:!0})],T.prototype,"updating",null),(0,p._)([(0,x.Cb)({readOnly:!0})],T.prototype,"availability",void 0),T=(0,p._)([(0,_.j)("esri.views.interactive.snapping.featureSources.GraphicsSnappingSource")],T);var R="OBJECTID"},69117:function(e,t,n){n.d(t,{X:function(){return d}});var i=n(95905),r=n(1413),a=n(15671),s=n(43144),u=n(60136),o=n(54062),h=n(95122),l=n(75691),c=n(61309),p=function(e){(0,u.Z)(n,e);var t=(0,o.Z)(n);function n(e){return(0,a.Z)(this,n),t.call(this,(0,r.Z)((0,r.Z)({},e),{},{constraint:new h.Hk(e.coordinateHelper,e.targetPoint)}))}return(0,s.Z)(n,[{key:"hints",get:function(){return[new c.n(this.targetPoint,this.elevationInfo)]}}]),n}(l.a);function d(e,t,n){switch(e.type){case"edge":return new i.L({coordinateHelper:t,edgeStart:t.pointToVector(e.start),edgeEnd:t.pointToVector(e.end),targetPoint:t.pointToVector(e.target),objectId:e.objectId,elevationInfo:n});case"vertex":return new p({coordinateHelper:t,targetPoint:t.pointToVector(e.target),objectId:e.objectId,elevationInfo:n})}}},61309:function(e,t,n){n.d(t,{n:function(){return o}});var i=n(15671),r=n(43144),a=n(60136),s=n(54062),u=n(64674),o=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e,r){var a;return(0,i.Z)(this,n),(a=t.call(this,r)).point=e,a}return(0,r.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&(0,u.Xv)(this.point,e.point)}}]),n}(n(55054).r)}}]);
//# sourceMappingURL=3518.c12b70d8.chunk.js.map