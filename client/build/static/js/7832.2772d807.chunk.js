"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[7832],{43244:function(e,t,i){i.d(t,{Z:function(){return o}});var n=i(37762),r=i(15671),a=i(43144),s=i(92026),o=function(){function e(t){(0,r.Z)(this,e),this.size=0,this._start=0,this.maxSize=t,this._buffer=new Array(t)}return(0,a.Z)(e,[{key:"entries",get:function(){return this._buffer}},{key:"enqueue",value:function(e){if(this.size===this.maxSize){var t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return this._buffer[(this._start+this.size++)%this.maxSize]=e,null}},{key:"dequeue",value:function(){if(0===this.size)return null;var e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}},{key:"peek",value:function(){return 0===this.size?null:this._buffer[this._start]}},{key:"find",value:function(e){if(0===this.size)return null;var t,i=(0,n.Z)(this._buffer);try{for(i.s();!(t=i.n()).done;){var r=t.value;if((0,s.pC)(r)&&e(r))return r}}catch(a){i.e(a)}finally{i.f()}return null}},{key:"clear",value:function(e){for(var t=this.dequeue();(0,s.pC)(t);)e&&e(t),t=this.dequeue()}}]),e}()},59447:function(e,t,i){i.d(t,{r:function(){return a}});var n=i(15671),r=i(43144),a=function(){function e(){(0,n.Z)(this,e),this._outer=new Map}return(0,r.Z)(e,[{key:"clear",value:function(){this._outer.clear()}},{key:"empty",get:function(){return 0===this._outer.size}},{key:"get",value:function(e,t){var i;return null===(i=this._outer.get(e))||void 0===i?void 0:i.get(t)}},{key:"set",value:function(e,t,i){var n=this._outer.get(e);n?n.set(t,i):this._outer.set(e,new Map([[t,i]]))}},{key:"delete",value:function(e,t){var i=this._outer.get(e);i&&(i.delete(t),0===i.size&&this._outer.delete(e))}},{key:"forEach",value:function(e){this._outer.forEach((function(t,i){return e(t,i)}))}}]),e}()},91958:function(e,t,i){i.d(t,{$7:function(){return p},$e:function(){return u},E0:function(){return d},N5:function(){return _},lW:function(){return l}});var n=i(74165),r=i(15861),a=(i(93169),i(10064)),s=i(92026),o=i(35995);function u(e){var t=d(e);return(0,s.pC)(t)?t.toDataURL():""}function l(e){return h.apply(this,arguments)}function h(){return h=(0,r.Z)((0,n.Z)().mark((function e(t){var i,r,o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=d(t),!(0,s.Wi)(i)){e.next=3;break}throw new a.Z("imageToArrayBuffer","Unsupported image type");case 3:return e.next=5,c(t);case 5:return r=e.sent,e.next=8,new Promise((function(e){return i.toBlob(e,r)}));case 8:if(o=e.sent){e.next=11;break}throw new a.Z("imageToArrayBuffer","Failed to encode image");case 11:return e.next=13,o.arrayBuffer();case 13:return e.t0=e.sent,e.t1=r,e.abrupt("return",{data:e.t0,type:e.t1});case 16:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function c(e){return f.apply(this,arguments)}function f(){return(f=(0,r.Z)((0,n.Z)().mark((function e(t){var i,r,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof HTMLImageElement){e.next=2;break}return e.abrupt("return","image/png");case 2:if(i=t.src,!(0,o.HK)(i)){e.next=6;break}return r=(0,o.sJ)(i),a=r.mediaType,e.abrupt("return","image/jpeg"===a?a:"image/png");case 6:return e.abrupt("return",/\.png$/i.test(i)?"image/png":/\.(jpg|jpeg)$/i.test(i)?"image/jpeg":"image/png");case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e){if(e instanceof HTMLCanvasElement)return e;if(e instanceof HTMLVideoElement)return null;var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var i=t.getContext("2d");return e instanceof HTMLImageElement?i.drawImage(e,0,0,e.width,e.height):e instanceof ImageData&&i.putImageData(e,0,0),t}function _(e){for(var t=[],i=new Uint8Array(e),n=0;n<i.length;n++)t.push(String.fromCharCode(i[n]));return"data:application/octet-stream;base64,"+btoa(t.join(""))}function p(e){if(e.byteLength<8)return!1;var t=new Uint8Array(e);return 137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7]}},38330:function(e,t,i){i.d(t,{t:function(){return o}});var n=i(74165),r=i(1413),a=i(15861),s=i(76200);function o(e,t){return u.apply(this,arguments)}function u(){return u=(0,a.Z)((0,n.Z)().mark((function e(t,i){var a,o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.default)(t,(0,r.Z)({responseType:"image"},i));case 2:return a=e.sent,o=a.data,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)}))),u.apply(this,arguments)}},16285:function(e,t,i){i.d(t,{Z:function(){return c}});var n=i(37762),r=i(29439),a=i(15671),s=i(43144),o=i(78915),u=i(691),l=i(6388),h=i(31027),c=function(){function e(t){(0,a.Z)(this,e),this._resourceManager=t}return(0,s.Z)(e,[{key:"dispose",value:function(){this._rasterizationCanvas=null}},{key:"rasterizeJSONResource",value:function(e,t,i){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),"simple-fill"===e.type||"esriSFS"===e.type){var n=o.fN.rasterizeSimpleFill(this._rasterizationCanvas,e.style,t),a=(0,r.Z)(n,3),s=a[0];return{size:[a[1],a[2]],image:new Uint32Array(s.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0}}if("simple-line"===e.type||"esriSLS"===e.type||"line"===e.type&&e.dashTemplate){var h,c;if("simple-line"===e.type||"esriSLS"===e.type)switch(h=(0,o.U1)(e.style,e.cap),e.cap){case"butt":c="Butt";break;case"square":c="Square";break;default:c="Round"}else h=e.dashTemplate,c=e.cim.capStyle;var f=o.fN.rasterizeSimpleLine(h,c),d=(0,r.Z)(f,3),_=d[0];return{size:[d[1],d[2]],image:new Uint32Array(_.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}var p,v,m;if("simple-marker"===e.type||"esriSMS"===e.type||"line-marker"===e.type?(p=o.B$.fromSimpleMarker(e),m=(0,l.Fp)(p)):e.cim&&"CIMHatchFill"===e.cim.type?(p=o.B$.fromCIMHatchFill(e.cim),v=new u.Z(p.frame.xmin,-p.frame.ymax,p.frame.xmax-p.frame.xmin,p.frame.ymax-p.frame.ymin)):e.cim.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===e.cim.markerPlacement.type?(p=o.B$.fromCIMInsidePolygon(e.cim),v=new u.Z(p.frame.xmin,-p.frame.ymax,p.frame.xmax-p.frame.xmin,p.frame.ymax-p.frame.ymin)):(p=e.cim,m=(0,l.Fp)(p)),m&&!i){var g=(0,l.RL)(m),y=(0,r.Z)(g,3),b=y[0],E=y[1],x=y[2];return b?{size:[E,x],image:new Uint32Array(b.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}var w=o.B$.rasterize(this._rasterizationCanvas,p,v,this._resourceManager,!i),T=(0,r.Z)(w,5),R=T[0],F=T[1],B=T[2],A=T[3],k=T[4];return R?{size:[F,B],image:new Uint32Array(R.buffer),sdf:!1,simplePattern:!1,anchorX:A,anchorY:k}:null}},{key:"rasterizeImageResource",value:function(e,t,i,a){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),this._rasterizationCanvas.width=e,this._rasterizationCanvas.height=t;var s=this._rasterizationCanvas.getContext("2d");i instanceof ImageData?s.putImageData(i,0,0):(i.setAttribute("width","".concat(e,"px")),i.setAttribute("height","".concat(t,"px")),s.drawImage(i,0,0,e,t));var o,u=s.getImageData(0,0,e,t),l=new Uint8Array(u.data);if(a){var c,f=(0,n.Z)(a);try{for(f.s();!(c=f.n()).done;){var d=c.value;if(d&&d.oldColor&&4===d.oldColor.length&&d.newColor&&4===d.newColor.length){var _=(0,r.Z)(d.oldColor,4),p=_[0],v=_[1],m=_[2],g=_[3],y=(0,r.Z)(d.newColor,4),b=y[0],E=y[1],x=y[2],w=y[3];if(p===b&&v===E&&m===x&&g===w)continue;for(var T=0;T<l.length;T+=4)p===l[T]&&v===l[T+1]&&m===l[T+2]&&g===l[T+3]&&(l[T]=b,l[T+1]=E,l[T+2]=x,l[T+3]=w)}}}catch(O){f.e(O)}finally{f.f()}}for(var R=0;R<l.length;R+=4)o=l[R+3]/255,l[R]=l[R]*o,l[R+1]=l[R+1]*o,l[R+2]=l[R+2]*o;var F=l,B=e,A=t,k=512;if(B>=k||A>=k){var C=B/A;C>1?(B=k,A=Math.round(k/C)):(A=k,B=Math.round(k*C)),F=new Uint8Array(4*B*A);var S=new Uint8ClampedArray(F.buffer);(0,h.TT)(l,e,t,S,B,A,!1)}return{size:[B,A],image:new Uint32Array(F.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}]),e}()},10106:function(e,t,i){var n,r,a,s,o;i.d(t,{Fr:function(){return o},_K:function(){return s},al:function(){return r}}),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.FILL_VERTEX=1]="FILL_VERTEX",e[e.FILL_DD_VERTEX=2]="FILL_DD_VERTEX",e[e.FILL_INDEX=3]="FILL_INDEX",e[e.OUTLINE_VERTEX=4]="OUTLINE_VERTEX",e[e.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX",e[e.OUTLINE_INDEX=6]="OUTLINE_INDEX",e[e.LINE_VERTEX=7]="LINE_VERTEX",e[e.LINE_DD_VERTEX=8]="LINE_DD_VERTEX",e[e.LINE_INDEX=9]="LINE_INDEX",e[e.ICON_VERTEX=10]="ICON_VERTEX",e[e.ICON_DD_VERTEX=11]="ICON_DD_VERTEX",e[e.ICON_INDEX=12]="ICON_INDEX",e[e.TEXT_VERTEX=13]="TEXT_VERTEX",e[e.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX",e[e.TEXT_INDEX=15]="TEXT_INDEX",e[e.CIRCLE_VERTEX=16]="CIRCLE_VERTEX",e[e.CIRCLE_INDEX=17]="CIRCLE_INDEX"}(n||(n={})),function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(r||(r={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.OPAQUE=1]="OPAQUE",e[e.TRANSLUCENT=2]="TRANSLUCENT",e[e.SYMBOLS=3]="SYMBOLS",e[e.HITTEST=4]="HITTEST"}(a||(a={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(s||(s={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(o||(o={}))},75391:function(e,t,i){i.d(t,{Z:function(){return h}});var n=i(15671),r=i(43144),a=i(11752),s=i(61120),o=i(60136),u=i(54062),l=i(80613),h=function(e){(0,o.Z)(i,e);var t=(0,u.Z)(i);function i(){return(0,n.Z)(this,i),t.apply(this,arguments)}return(0,r.Z)(i,[{key:"renderChildren",value:function(e){this.attributeView.bindTextures(e.context,!1),this.children.some((function(e){return e.hasData}))&&((0,a.Z)((0,s.Z)(i.prototype),"renderChildren",this).call(this,e),e.drawPhase===l.jx.MAP&&this._renderChildren(e),this.hasHighlight()&&e.drawPhase===l.jx.HIGHLIGHT&&this._renderHighlight(e),this._boundsRenderer&&this._boundsRenderer.doRender(e))}},{key:"_renderHighlight",value:function(e){var t=e.painter.effects.highlight;t.bind(e),this._renderChildren(e,t.defines),t.draw(e),t.unbind()}}]),i}(i(82022).Z)},87832:function(e,t,i){i.r(t),i.d(t,{GraphicContainer:function(){return Wn.Z},GraphicsView2D:function(){return Vn.Z},LabelManager:function(){return Gn},MagnifierView2D:function(){return Cr},MapViewNavigation:function(){return xr},Stage:function(){return bn}});var n=i(74165),r=i(1413),a=i(15861),s=i(37762),o=i(15671),u=i(43144),l=i(97326),h=i(11752),c=i(61120),f=i(60136),d=i(54062),_=i(10064),p=i(98928),v=i(93169),m=i(92026),g=i(94172),y=i(99346),b=i(23588),E=i(59001),x=i(33624),w=i(80613),T=i(53628),R=i(10106),F={background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = u_opacity * color;\n#else\ngl_FragColor = u_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position = vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             = u_tlbr / u_mosaicSize.xyxy;\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float dist = length(v_offset);\nmediump float alpha = smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio = v_stroke_width < 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor = alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_stroke_color = stroke_color * stroke_opacity;\nv_stroke_width = stroke_width;\nv_radius = radius;\nv_blur = max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset = offset;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = fract(v_tileTextureCoord);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = v_color[3] * color;\n#else\ngl_FragColor = v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include <util/util.glsl>\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n#ifdef PATTERN\nfloat patternWidth = nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight = nextPOT(tlbr.w - tlbr.y);\nfloat scaleX = 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY = 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat = mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord = (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             = tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include <util/encoding.glsl>\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor = v_color;\nfloat d = rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio = 0.248062016;\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * softEdgeRatio * size;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width > 0.25) {\nlowp vec4 outlinePixelColor = u_outlineColor;\nconst float outlineLimitRatio = (16.0 / 86.0);\nfloat clampedOutlineSize = softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *= clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor = v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor = v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor = texture2D(u_texture, v_tex);\ngl_FragColor = v_opacity * texColor;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION = 1.0 / 8.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float tileCoordRatio = 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color = color;\nv_opacity = opacity;\n#ifdef SDF\nv_halo_width = halo_width;\n#endif\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *= interpolatedOpacity;\nmediump float a_angle         = a_levelInfo[1];\nmediump float a_minLevel      = a_levelInfo[2];\nmediump float a_maxLevel      = a_levelInfo[3];\nmediump vec2 a_tex            = a_texAngleRange.xy;\nmediump float delta_z = 0.0;\nmediump float rotated = mod(a_angle + u_mapRotation, 256.0);\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_opacity, 0.0);\nvec2 offset = C_OFFSET_PRECISION * a_vertexOffset;\nv_size = abs(offset);\n#ifdef SDF\noffset = (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_tex = a_tex.xy / u_mosaicSize;\n}"},line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include <util/encoding.glsl>\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float fragDist = length(v_normal) * v_lineHalfWidth;\nlowp float alpha = clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX = fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY = 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\ngl_FragColor = alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX = fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY =  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor = alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor = alpha * v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale = 1.0 / 31.0;\nconst mediump float tileCoordRatio = 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth = 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_blur = blur + u_antialiasing;\nv_normal = a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          = tlbr / u_mosaicSize.xyxy;\nv_patternSize   = vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio = width / v_patternSize.y;\n#else\nv_widthRatio = width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth = (width + u_antialiasing) * 0.5;\nmediump vec2 dir = a_dir_normal.xy * scale;\nmediump vec2 offset_ = a_extrude_offset.zw * scale * offset;\nmediump vec2 dist = v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance = a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = abs(v_normal.y);\nlowp float alpha = smoothstep(1.0, 0.0, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale = 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_normal = a_xnormal;\nmediump vec2 dist = u_outline_width * scale * a_offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float alpha = smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision = 1.0 / 8.0;\nconst mediump float edgePos = 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale = 1.0 / 24.0;\nconst float sdfPixel = 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo > 0.5)\n{\nv_color = halo_color * opacity;\nhalo_width *= sdfPixel;\nhalo_blur *= sdfPixel;\n}\nelse\n{\nv_color = color * opacity;\nhalo_width = 0.0;\nhalo_blur = 0.0;\n}\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *= interpolatedOpacity;\nmediump float a_angle       = a_levelInfo[1];\nmediump float a_minLevel    = a_levelInfo[2];\nmediump float a_maxLevel    = a_levelInfo[3];\nmediump vec2 a_tex          = a_texAngleRange.xy;\nmediump float a_visMinAngle    = a_texAngleRange.z;\nmediump float a_visMaxAngle    = a_texAngleRange.w;\nmediump float delta_z = 0.0;\nmediump float angle = mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle < a_visMaxAngle)\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_color[3], 0.0);\nv_tex = a_tex.xy / u_mosaicSize;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_edgeDistance = edgePos - halo_width / size;\nv_edgeWidth = (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}};var B=new(i(56648).B)((function(e){var t=F;return e.split("/").forEach((function(e){t&&(t=t[e])})),t}));function A(e){return B.resolveIncludes(e)}var k=i(65706),C=function(e){return(0,k.K)({ID:e.id,PATTERN:e.pattern})},S={shaders:function(e){return{vertexShader:C(e)+A("background/background.vert"),fragmentShader:C(e)+A("background/background.frag")}}},O=function(e){return(0,k.K)({ID:e.id})},M={shaders:function(e){return{vertexShader:O(e)+A("circle/circle.vert"),fragmentShader:O(e)+A("circle/circle.frag")}}},I=function(e){return(0,k.K)({ID:e.id,PATTERN:e.pattern})},P={shaders:function(e){return{vertexShader:I(e)+A("fill/fill.vert"),fragmentShader:I(e)+A("fill/fill.frag")}}},D=function(e){return(0,k.K)({ID:e.id})},U={shaders:function(e){return{vertexShader:D(e)+A("outline/outline.vert"),fragmentShader:D(e)+A("outline/outline.frag")}}},N=function(e){return(0,k.K)({ID:e.id,SDF:e.sdf})},L={shaders:function(e){return{vertexShader:N(e)+A("icon/icon.vert"),fragmentShader:N(e)+A("icon/icon.frag")}}},Z=function(e){return(0,k.K)({ID:e.id,PATTERN:e.pattern,SDF:e.sdf})},z={shaders:function(e){return{vertexShader:Z(e)+A("line/line.vert"),fragmentShader:Z(e)+A("line/line.frag")}}},G=function(e){return(0,k.K)({ID:e.id})},V={shaders:function(e){return{vertexShader:G(e)+A("text/text.vert"),fragmentShader:G(e)+A("text/text.frag")}}},W=function(){function e(){(0,o.Z)(this,e),this._programByKey=new Map}return(0,u.Z)(e,[{key:"dispose",value:function(){this._programByKey.forEach((function(e){return e.dispose()})),this._programByKey.clear()}},{key:"getMaterialProgram",value:function(e,t,i){var n=t.key<<3|this._getMaterialOptionsValue(t.type,i);if(this._programByKey.has(n))return this._programByKey.get(n);var r=(0,this._getProgramTemplate(t.type).shaders)(i),a=r.vertexShader,s=r.fragmentShader,o=t.getShaderHeader(),u=t.getShaderMain(),l=a.replace("#pragma header",o).replace("#pragma main",u),h=e.programCache.acquire(l,s,t.getAttributeLocations());return this._programByKey.set(n,h),h}},{key:"_getMaterialOptionsValue",value:function(e,t){switch(e){case R._K.BACKGROUND:var i=t;return(i.pattern?1:0)<<1|(i.id?1:0);case R._K.FILL:var n=t;return(n.pattern?1:0)<<1|(n.id?1:0);case R._K.OUTLINE:return t.id?1:0;case R._K.LINE:var r=t;return(r.sdf?1:0)<<2|(r.pattern?1:0)<<1|(r.id?1:0);case R._K.ICON:var a=t;return(a.sdf?1:0)<<1|(a.id?1:0);case R._K.CIRCLE:case R._K.TEXT:return t.id?1:0;default:return 0}}},{key:"_getProgramTemplate",value:function(e){switch(e){case R._K.BACKGROUND:return S;case R._K.CIRCLE:return M;case R._K.FILL:return P;case R._K.ICON:return L;case R._K.LINE:return z;case R._K.OUTLINE:return U;case R._K.TEXT:return V;default:return null}}}]),e}(),X=i(61441),H=i(54711),q={shaders:{vertexShader:(0,H.w)("bitBlit/bitBlit.vert"),fragmentShader:(0,H.w)("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])},j=i(44070),Y=i(8548),K=i(96721),Q=i(45412),$=function(){function e(){(0,o.Z)(this,e),this._initialized=!1}return(0,u.Z)(e,[{key:"dispose",value:function(){this._program=(0,m.O3)(this._program),this._vertexArrayObject=(0,m.O3)(this._vertexArrayObject)}},{key:"render",value:function(e,t,i,n){e&&(this._initialized||this._initialize(e),e.setBlendFunctionSeparate(Y.zi.ONE,Y.zi.ONE_MINUS_SRC_ALPHA,Y.zi.ONE,Y.zi.ONE_MINUS_SRC_ALPHA),e.bindVAO(this._vertexArrayObject),e.useProgram(this._program),t.setSamplingMode(i),e.bindTexture(t,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",n),e.drawArrays(Y.MX.TRIANGLE_STRIP,0,4),e.bindTexture(null,0),e.bindVAO())}},{key:"_initialize",value:function(e){if(this._initialized)return!0;var t=(0,K.H)(e,q);if(!t)return!1;var i=new Int8Array(16);i[0]=-1,i[1]=-1,i[2]=0,i[3]=0,i[4]=1,i[5]=-1,i[6]=1,i[7]=0,i[8]=-1,i[9]=1,i[10]=0,i[11]=1,i[12]=1,i[13]=1,i[14]=1,i[15]=1;var n=q.attributes,r=new Q.U(e,n,X.As,{geometry:j.f.createVertex(e,Y.l1.STATIC_DRAW,i)});return this._program=t,this._vertexArrayObject=r,this._initialized=!0,!0}}]),e}(),J=i(4942),ee=function(e){var t="";t+=e[0].toUpperCase();for(var i=1;i<e.length;i++){var n=e[i];n===n.toUpperCase()?(t+="_",t+=n):t+=n.toUpperCase()}return t},te=function(e,t,i,n){var r=e+e.substring(e.lastIndexOf("/")),a=t+t.substring(t.lastIndexOf("/")),s=function(e){var t={};for(var i in e)t[ee(i)]=e[i];return(0,k.K)(t)}(n);return{attributes:i,shaders:{vertexShader:s+(0,H.w)("".concat(r,".vert")),fragmentShader:s+(0,H.w)("".concat(a,".frag"))}}},ie=function(e){return e===w.jx.HITTEST||e===w.jx.LABEL_ALPHA},ne=function(e,t,i,n){var r=e.rendererInfo,a=e.drawPhase;return"".concat(t.getVariationHash(),"-").concat(n.join("."),"-").concat(function(e){return(ie(e)?1:0)|(e===w.jx.HIGHLIGHT?2:0)}(a),"-").concat(r.getVariationHash(),"-").concat((0,m.pC)(i)&&i.join("."))},re=function(e,t,i,n){var a=n.reduce((function(t,i){return(0,r.Z)((0,r.Z)({},t),{},(0,J.Z)({},i,e.context.driverTest[i]))}),{}),o=(0,r.Z)((0,r.Z)((0,r.Z)({},t.getVariation()),e.rendererInfo.getVariation()),{},{highlight:e.drawPhase===w.jx.HIGHLIGHT,id:ie(e.drawPhase)},a);if((0,m.pC)(i)){var u,l=(0,s.Z)(i);try{for(l.s();!(u=l.n()).done;){o[u.value]=!0}}catch(h){l.e(h)}finally{l.f()}}return o},ae=function(){function e(t){(0,o.Z)(this,e),this._rctx=t,this._programByKey=new Map}return(0,u.Z)(e,[{key:"dispose",value:function(){this._programByKey.forEach((function(e){return e.dispose()})),this._programByKey.clear()}},{key:"getProgram",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=e.vsPath+"."+e.fsPath+JSON.stringify(i)+n.join(".");if(this._programByKey.has(a))return this._programByKey.get(a);var s=n.reduce((function(e,i){return(0,r.Z)((0,r.Z)({},e),{},(0,J.Z)({},i,t._rctx.driverTest[i]))}),{}),o=(0,r.Z)((0,r.Z)({},i.map((function(e){return"string"==typeof e?{name:e,value:!0}:e})).reduce((function(e,t){return(0,r.Z)((0,r.Z)({},e),{},(0,J.Z)({},t.name,t.value))}),{})),s),u=e.vsPath,l=e.fsPath,h=e.attributes,c=te(u,l,h,o),f=this._rctx.programCache.acquire(c.shaders.vertexShader,c.shaders.fragmentShader,c.attributes);if(!f)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(a,f),f}},{key:"getMaterialProgram",value:function(e,t,i,n,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:["ignoresSamplerPrecision"],s=ne(e,t,r,a);if(this._programByKey.has(s))return this._programByKey.get(s);var o=re(e,t,r,a),u=te(i,i,n,o),l=this._rctx.programCache.acquire(u.shaders.vertexShader,u.shaders.fragmentShader,u.attributes);if(!l)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(s,l),l}}]),e}(),se=i(42265),oe=i(76200),ue=i(75746),le=i(32718),he=i(66978),ce=i(17842),fe=i(88396),de=i(15245),_e=i(16285),pe=i(94109),ve=i(88750),me=i(12233),ge=function(){function e(t,i){(0,o.Z)(this,e),this._width=0,this._height=0,this._free=[],this._width=t,this._height=i,this._free.push(new me.Z(0,0,t,i))}return(0,u.Z)(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"allocate",value:function(e,t){if(e>this._width||t>this._height)return new me.Z;for(var i=null,n=-1,r=0;r<this._free.length;++r){var a=this._free[r];e<=a.width&&t<=a.height&&(null===i||a.y<=i.y&&a.x<=i.x)&&(i=a,n=r)}return null===i?new me.Z:(this._free.splice(n,1),i.width<i.height?(i.width>e&&this._free.push(new me.Z(i.x+e,i.y,i.width-e,t)),i.height>t&&this._free.push(new me.Z(i.x,i.y+t,i.width,i.height-t))):(i.width>e&&this._free.push(new me.Z(i.x+e,i.y,i.width-e,i.height)),i.height>t&&this._free.push(new me.Z(i.x,i.y+t,e,i.height-t))),new me.Z(i.x,i.y,e,t))}},{key:"release",value:function(e){for(var t=0;t<this._free.length;++t){var i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}]),e}(),ye=i(51378),be=function(e){return Math.floor(e/256)};function Ee(e){var t,i=new Set,n=(0,s.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;i.add(be(r))}}catch(a){n.e(a)}finally{n.f()}return i}function xe(e,t,i){return e.has(t)||e.set(t,i().then((function(){e.delete(t)})).catch((function(i){e.delete(t),(0,he.H9)(i)}))),e.get(t)}var we=function(){function e(t,i,n){(0,o.Z)(this,e),this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphCache={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=i,this._glyphSource=n,this._binPack=new ge(t-4,i-4),this._glyphData.push(new Uint8Array(t*i)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph()}return(0,u.Z)(e,[{key:"dispose",value:function(){this._binPack=null;var e,t=(0,s.Z)(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(n){t.e(n)}finally{t.f()}this._textures.length=0,this._glyphData.length=0}},{key:"_initDecorationGlyph",value:function(){for(var e=[117,149,181,207,207,181,149,117],t=[],i=0;i<e.length;i++)for(var n=e[i],r=0;r<11;r++)t.push(n);var a={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(t)};this._recordGlyph(a)}},{key:"getGlyphItems",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i,r){var a,s=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this._getGlyphCache(t),e.next=3,this._fetchRanges(t,i,r);case 3:return e.abrupt("return",i.map((function(e){return s._getMosaicItem(a,t,e)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,i,n){return e.apply(this,arguments)}}()},{key:"bind",value:function(e,t,i,n){var r=this._getTexture(e,i);r.setSamplingMode(t),this._dirties[i]&&(r.setData(this._glyphData[i]),this._dirties[i]=!1),e.bindTexture(r,n)}},{key:"_getGlyphCache",value:function(e){return this._glyphCache[e]||(this._glyphCache[e]={}),this._glyphCache[e]}},{key:"_getTexture",value:function(e,t){return this._textures[t]||(this._textures[t]=new ye.x(e,{pixelFormat:Y.VI.ALPHA,dataType:Y.Br.UNSIGNED_BYTE,width:this.width,height:this.height},new Uint8Array(this.width*this.height))),this._textures[t]}},{key:"_invalidate",value:function(){this._dirties[this._currentPage]=!0}},{key:"_fetchRanges",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i,r){var a,s,o=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Ee(i),s=[],a.forEach((function(e){s.push(o._fetchRange(t,e,r))})),e.next=4,Promise.all(s);case 4:case"end":return e.stop()}}),e)})));return function(t,i,n){return e.apply(this,arguments)}}()},{key:"_fetchRange",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i,r){var a,s=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i>256)){e.next=2;break}return e.abrupt("return",null);case 2:return a=t+i,e.abrupt("return",xe(this._rangePromises,a,(function(){return s._glyphSource.getRange(t,i,r)})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,i,n){return e.apply(this,arguments)}}()},{key:"_getMosaicItem",value:function(e,t,i){if(!e[i]){var n=this._glyphSource.getGlyph(t,i);if(!n||!n.metrics)return function(e){return{rect:new me.Z(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:e,sdf:!0}}(i);var r=this._recordGlyph(n),a=this._currentPage,s=n.metrics;e[i]={rect:r,page:a,metrics:s,code:i,sdf:!0},this._invalidate()}return e[i]}},{key:"_recordGlyph",value:function(e){var t,i=e.metrics;if(0===i.width)t=new me.Z(0,0,0,0);else{var n=i.width+6,r=i.height+6;(t=this._binPack.allocate(n,r)).isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph(),this._binPack=new ge(this.width-4,this.height-4),t=this._binPack.allocate(n,r));var a,s,o=this._glyphData[this._currentPage],u=e.bitmap;if(u)for(var l=0;l<r;l++){a=n*l,s=this.width*(t.y+l)+t.x;for(var h=0;h<n;h++)o[s+h]=u[a+h]}(0,v.Z)("esri-glyph-debug")&&this._showDebugPage(o)}return t}},{key:"_showDebugPage",value:function(e){var t=document.createElement("canvas"),i=t.getContext("2d"),n=new ImageData(this.width,this.height),r=n.data;t.width=this.width,t.height=this.height,t.style.border="1px solid black";for(var a=0;a<e.length;++a)r[4*a+0]=e[a],r[4*a+1]=0,r[4*a+2]=0,r[4*a+3]=255;i.putImageData(n,0,0),document.body.appendChild(t)}}]),e}(),Te=i(78084),Re=function(){function e(t){for((0,o.Z)(this,e),this._metrics=[],this._bitmaps=[];t.next();)if(1===t.tag()){for(var i=t.getMessage();i.next();)if(3===i.tag()){for(var n=i.getMessage(),r=void 0,a=void 0,s=void 0,u=void 0,l=void 0,h=void 0,c=void 0;n.next();)switch(n.tag()){case 1:r=n.getUInt32();break;case 2:a=n.getBytes();break;case 3:s=n.getUInt32();break;case 4:u=n.getUInt32();break;case 5:l=n.getSInt32();break;case 6:h=n.getSInt32();break;case 7:c=n.getUInt32();break;default:n.skip()}n.release(),r&&(this._metrics[r]={width:s,height:u,left:l,top:h,advance:c},this._bitmaps[r]=a)}else i.skip();i.release()}else t.skip()}return(0,u.Z)(e,[{key:"getMetrics",value:function(e){return this._metrics[e]}},{key:"getBitmap",value:function(e){return this._bitmaps[e]}}]),e}(),Fe=function(){function e(){(0,o.Z)(this,e),this._ranges=[]}return(0,u.Z)(e,[{key:"getRange",value:function(e){return this._ranges[e]}},{key:"addRange",value:function(e,t){this._ranges[e]=t}}]),e}(),Be=function(){function e(t){(0,o.Z)(this,e),this._glyphInfo={},this._baseURL=t}return(0,u.Z)(e,[{key:"getRange",value:function(e,t,i){var n=this._getFontStack(e);if(n.getRange(t))return Promise.resolve();var a=256*t,s=a+255,o=this._baseURL.replace("{fontstack}",e).replace("{range}",a+"-"+s);return(0,oe.default)(o,(0,r.Z)({responseType:"array-buffer"},i)).then((function(e){n.addRange(t,new Re(new Te.Z(new Uint8Array(e.data),new DataView(e.data))))}))}},{key:"getGlyph",value:function(e,t){var i=this._getFontStack(e);if(i){var n=Math.floor(t/256);if(!(n>256)){var r=i.getRange(n);return r?{metrics:r.getMetrics(t),bitmap:r.getBitmap(t)}:void 0}}}},{key:"_getFontStack",value:function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new Fe),t}}]),e}(),Ae=i(46228),ke=1e20,Ce=function(){function e(t){(0,o.Z)(this,e),this.size=t;var i=document.createElement("canvas");i.width=i.height=t,this._context=i.getContext("2d"),this._gridOuter=new Float64Array(t*t),this._gridInner=new Float64Array(t*t),this._f=new Float64Array(t),this._d=new Float64Array(t),this._z=new Float64Array(t+1),this._v=new Int16Array(t)}return(0,u.Z)(e,[{key:"dispose",value:function(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null,this._svg&&(document.body.removeChild(this._svg),this._svg=null)}},{key:"draw",value:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:31;this._initSVG();var r=this.createSVGString(e);return new Promise((function(e,a){var s=new Image;s.src="data:image/svg+xml; charset=utf8, "+encodeURIComponent(r),s.onload=function(){s.onload=null,i._context.clearRect(0,0,i.size,i.size),i._context.drawImage(s,0,0,i.size,i.size);for(var t=i._context.getImageData(0,0,i.size,i.size),r=new Uint8Array(i.size*i.size*4),a=0;a<i.size*i.size;a++){var o=t.data[4*a+3]/255;i._gridOuter[a]=1===o?0:0===o?ke:Math.pow(Math.max(0,.5-o),2),i._gridInner[a]=1===o?ke:0===o?0:Math.pow(Math.max(0,o-.5),2)}i._edt(i._gridOuter,i.size,i.size),i._edt(i._gridInner,i.size,i.size);for(var u=0;u<i.size*i.size;u++){var l=i._gridOuter[u]-i._gridInner[u];(0,Ae.I)(.5-l/(2*n),r,4*u)}e(r)};var o=t&&t.signal;o&&(0,he.fu)(o,(function(){return a((0,he.zE)())}))}))}},{key:"_initSVG",value:function(){if(!this._svg){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("style","position: absolute;"),e.setAttribute("width","0"),e.setAttribute("height","0"),e.setAttribute("aria-hidden","true"),e.setAttribute("role","presentation"),document.body.appendChild(e),this._svg=e}}},{key:"createSVGString",value:function(e){this._initSVG();var t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",e),this._svg.appendChild(t);var i,n,r,a,s=t.getBBox(),o=s.width/s.height,u=this.size/2;if(o>1){n=i=u/s.width;var l=u*(1/o);r=this.size/4,a=u-l/2}else i=n=u/s.height,r=u-u*o/2,a=this.size/4;var h=-s.x*i+r,c=-s.y*n+a;t.setAttribute("style","transform: matrix(".concat(i,", 0, 0, ").concat(n,", ").concat(h,", ").concat(c,")"));var f='<svg style="fill:red;" height="'.concat(this.size,'" width="').concat(this.size,'" xmlns="http://www.w3.org/2000/svg">').concat(this._svg.innerHTML,"</svg>");return this._svg.removeChild(t),f}},{key:"_edt",value:function(e,t,i){for(var n=this._f,r=this._d,a=this._v,s=this._z,o=0;o<t;o++){for(var u=0;u<i;u++)n[u]=e[u*t+o];this._edt1d(n,r,a,s,i);for(var l=0;l<i;l++)e[l*t+o]=r[l]}for(var h=0;h<i;h++){for(var c=0;c<t;c++)n[c]=e[h*t+c];this._edt1d(n,r,a,s,t);for(var f=0;f<t;f++)e[h*t+f]=Math.sqrt(r[f])}}},{key:"_edt1d",value:function(e,t,i,n,r){i[0]=0,n[0]=-ke,n[1]=+ke;for(var a=1,s=0;a<r;a++){for(var o=(e[a]+a*a-(e[i[s]]+i[s]*i[s]))/(2*a-2*i[s]);o<=n[s];)s--,o=(e[a]+a*a-(e[i[s]]+i[s]*i[s]))/(2*a-2*i[s]);i[++s]=a,n[s]=o,n[s+1]=+ke}for(var u=0,l=0;u<r;u++){for(;n[l+1]<u;)l++;t[u]=(u-i[l])*(u-i[l])+e[i[l]]}}}]),e}(),Se=i(29439),Oe=i(13200);function Me(e){return e&&"static"===e.type}var Ie=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,o.Z)(this,e),this._mosaicPages=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects=new Map,this._spriteCopyQueue=[],this.pixelRatio=1,(t<=0||i<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=i,n>0&&(this._maxItemSize=n),this.pixelRatio=window.devicePixelRatio||1,this._binPack=new ge(this._pageWidth,this._pageHeight);var r=Math.floor(this._pageWidth),a=Math.floor(this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(r*a)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}return(0,u.Z)(e,[{key:"getWidth",value:function(e){return e>=this._mosaicPages.length?-1:this._mosaicPages[e].size[0]}},{key:"getHeight",value:function(e){return e>=this._mosaicPages.length?-1:this._mosaicPages[e].size[1]}},{key:"getPageTexture",value:function(e){return e<this._mosaicPages.length?this._mosaicPages[e].texture:null}},{key:"has",value:function(e){return this._mosaicRects.has(e)}},{key:"itemCount",get:function(){return this._mosaicRects.size}},{key:"getSpriteItem",value:function(e){return this._mosaicRects.get(e)}},{key:"addSpriteItem",value:function(e,t,i,n,r,a){if(this._mosaicRects.has(e))return this._mosaicRects.get(e);var s,o,u;if(Me(i)){var l=this._allocateImage(t[0],t[1]),h=(0,Se.Z)(l,3);s=h[0],o=h[1],u=h[2]}else{s=new me.Z(0,0,t[0],t[1]),o=this._mosaicPages.length;this._mosaicPages.push({mosaicsData:i,size:[t[0]+2*pe.fL,t[1]+2*pe.fL],dirty:!0,texture:void 0})}if(s.width<=0||s.height<=0)return null;var c={rect:s,width:t[0],height:t[1],sdf:r,simplePattern:a,pixelRatio:1,page:o};return this._mosaicRects.set(e,c),Me(i)&&this._copy({rect:s,spriteSize:t,spriteData:i.data,page:o,pageSize:u,repeat:n,sdf:r}),c}},{key:"hasItemsToProcess",value:function(){return 0!==this._spriteCopyQueue.length}},{key:"processNextItem",value:function(){var e=this._spriteCopyQueue.pop();e&&this._copy(e)}},{key:"getSpriteItems",value:function(e){var t,i={},n=(0,s.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;i[r]=this.getSpriteItem(r)}}catch(a){n.e(a)}finally{n.f()}return i}},{key:"getMosaicItemPosition",value:function(e){var t=this.getSpriteItem(e),i=t&&t.rect;if(!i)return null;i.width=t.width,i.height=t.height;var n=t.width,r=t.height,a=pe.fL,s=this._mosaicPages[t.page];return{size:[t.width,t.height],tl:[(i.x+a)/s[0],(i.y+a)/s[1]],br:[(i.x+a+n)/s[0],(i.y+a+r)/s[1]],page:t.page}}},{key:"bind",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=this._mosaicPages[i],a=r.mosaicsData,s=r.texture;s||(s=Pe(e,a,r.size),r.texture=s),s.setSamplingMode(t),Me(a)?(e.bindTexture(s,n),r.dirty&&(s.setData(new Uint8Array(a.data.buffer)),s.generateMipmap())):a.data.bindFrame(e,s,n),r.dirty=!1}},{key:"_copy",value:function(t){if(!(t.page>=this._mosaicPages.length)){var i=this._mosaicPages[t.page],n=i.mosaicsData;if(!Me(i.mosaicsData))throw new _.Z("mapview-invalid-resource","unsuitable data type!");var r=t.spriteData,a=n.data;a&&r||console.error("Source or target images are uninitialized!"),e._copyBits(r,t.spriteSize[0],0,0,a,t.pageSize[0],t.rect.x+pe.fL,t.rect.y+pe.fL,t.spriteSize[0],t.spriteSize[1],t.repeat),i.dirty=!0}}},{key:"_allocateImage",value:function(e,t){e+=2*pe.fL,t+=2*pe.fL;var i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){var n=Math.pow(2,Math.ceil((0,Oe.k3)(e))),r=Math.pow(2,Math.ceil((0,Oe.k3)(t))),a=new me.Z(0,0,e,t);return this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(n*r)},size:[n,r],dirty:!0,texture:void 0}),[a,this._mosaicPages.length-1,[n,r]]}var s=this._binPack.allocate(e,t);if(s.width<=0){var o=this._mosaicPages[this._currentPage];return!o.dirty&&Me(o.mosaicsData)&&(o.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new ge(this._pageWidth,this._pageHeight),this._allocateImage(e,t)}return[s,this._currentPage,[this._pageWidth,this._pageHeight]]}},{key:"dispose",value:function(){this._binPack=null;var e,t=(0,s.Z)(this._mosaicPages);try{for(t.s();!(e=t.n()).done;){var i=e.value,n=i.texture;n&&n.dispose();var r=i.mosaicsData;Me(r)||r.data.destroy()}}catch(a){t.e(a)}finally{t.f()}this._mosaicPages=null,this._mosaicRects.clear()}}],[{key:"_copyBits",value:function(e,t,i,n,r,a,s,o,u,l,h){var c=n*t+i,f=o*a+s;if(h){f-=a;for(var d=-1;d<=l;c=((++d+l)%l+n)*t+i,f+=a)for(var _=-1;_<=u;_++)r[f+_]=e[c+(_+u)%u]}else for(var p=0;p<l;p++){for(var v=0;v<u;v++)r[f+v]=e[c+v];c+=t,f+=a}}}]),e}();function Pe(e,t,i){return Me(t)?new ye.x(e,{pixelFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,width:i[0],height:i[1]},new Uint8Array(t.data.buffer)):new ye.x(e,{pixelFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,samplingMode:Y.cw.LINEAR,wrapMode:Y.e8.CLAMP_TO_EDGE,width:i[0],height:i[1]},null)}var De=i(46640),Ue=i(84397),Ne=i(38499),Le=i(48202),Ze=i(93592);function ze(e){return(0,Ne.HA)(e.frameDurations.reduce((function(e,t){return e+t}),0))}function Ge(e,t){var i=e.width,n=e.height,r=e.selectFrame,a=e.frameDurations.slice(),s=a.pop();return a.push((0,Ne.HA)(s+t)),{frameDurations:a,selectFrame:r,width:i,height:n}}var Ve=function(){function e(t,i,n){(0,o.Z)(this,e),this._animation=t,this._repeatType=n,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];for(var r=0;i>r;)r+=this.timeToFrame,this.nextFrame();this._animation.selectFrame(this._currentFrame)}return(0,u.Z)(e,[{key:"nextFrame",value:function(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case Le.of.None:this._currentFrame-=this._direction;break;case Le.of.Loop:this._currentFrame=0;break;case Le.of.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case Le.of.None:this._currentFrame-=this._direction;break;case Le.of.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case Le.of.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame],this._animation.selectFrame(this._currentFrame)}}]),e}();function We(e,t,i){var n,r=t.repeatType;if(null==r&&(r=Le.of.Loop),!0===t.reverseAnimation&&(e=function(e){var t=e.width,i=e.height;return{frameDurations:e.frameDurations.reverse(),selectFrame:function(t){var i=e.frameDurations.length-1-t;e.selectFrame(i)},width:t,height:i}}(e)),null!=t.duration&&(e=function(e,t){var i=e.width,n=e.height,r=e.selectFrame,a=t/ze(e);return{frameDurations:e.frameDurations.map((function(e){return(0,Ne.HA)(e*a)})),selectFrame:r,width:i,height:n}}(e,(0,Ne.HA)(1e3*t.duration))),null!=t.repeatDelay){var a=1e3*t.repeatDelay;r===Le.of.Loop?e=Ge(e,(0,Ne.HA)(a)):r===Le.of.Oscillate&&(e=function(e,t){var i=e.width,n=e.height,r=e.selectFrame,a=e.frameDurations.slice(),s=a.shift();return a.unshift((0,Ne.HA)(s+t)),{frameDurations:a,selectFrame:r,width:i,height:n}}(Ge(e,(0,Ne.HA)(a/2)),(0,Ne.HA)(a/2)))}if(null!=t.startTimeOffset)n=(0,Ne.HA)(1e3*t.startTimeOffset);else if(null!=t.randomizeStartTime){var s=(0,Ze.$)(i),o=null!=t.randomizeStartSeed?t.randomizeStartSeed:82749913,u=(0,Ze.f)(s,o);n=(0,Ne.HA)(u*ze(e))}else n=(0,Ne.HA)(0);return new Ve(e,n,r)}function Xe(e,t,i){var n,r=null==t.playAnimation||t.playAnimation,a=We(e,t,i),s=a.timeToFrame;return function e(){n=r&&setTimeout((function(){a.nextFrame(),s=a.timeToFrame,e()}),s)}(),{remove:function(){r&&clearTimeout(n)}}}var He,qe=function(){function e(t){(0,o.Z)(this,e),this._requestRender=t,this._frameData=null}return(0,u.Z)(e,[{key:"destroy",value:function(){this._playHandle.remove()}},{key:"bindFrame",value:function(e,t,i){e.bindTexture(t,i),(0,m.Wi)(this._frameData)||(t.updateData(0,pe.fL,pe.fL,this._frameData.width,this._frameData.height,this._frameData),this._frameData=null)}},{key:"_load",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i,r,a){var s,o,u=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=function(e){u._frameData=e,u._requestRender.requestRender()},e.next=4,this._loadAnimation(t,s,a);case 4:o=e.sent,this.frameCount=o.frameDurations.length,this.width=o.width,this.height=o.height,this._playHandle=Xe(o,i,r),e.next=12;break;case 8:if(e.prev=8,e.t0=e.catch(0),(0,he.D_)(e.t0)){e.next=12;break}return e.abrupt("return",new _.Z("invalid-resource","Could not parse animated resource."));case 12:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t,i,n,r){return e.apply(this,arguments)}}()}]),e}(),je={exports:{}};He=function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}return i.m=e,i.c=t,i.p="",i(0)}([function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.isNotPNG=function(e){return e===a},t.isNotAPNG=function(e){return e===s},t.default=function(e){var t=new Uint8Array(e);if(Array.prototype.some.call(o,(function(e,i){return e!==t[i]})))return a;var i=!1;if(u(t,(function(e){return!(i="acTL"===e)})),!i)return s;var n=[],l=[],d=null,_=null,p=0,v=new r.APNG;if(u(t,(function(e,t,i,a){var s=new DataView(t.buffer);switch(e){case"IHDR":d=t.subarray(i+8,i+8+a),v.width=s.getUint32(i+8),v.height=s.getUint32(i+12);break;case"acTL":v.numPlays=s.getUint32(i+8+4);break;case"fcTL":_&&(v.frames.push(_),p++),(_=new r.Frame).width=s.getUint32(i+8+4),_.height=s.getUint32(i+8+8),_.left=s.getUint32(i+8+12),_.top=s.getUint32(i+8+16);var o=s.getUint16(i+8+20),u=s.getUint16(i+8+22);0===u&&(u=100),_.delay=1e3*o/u,_.delay<=10&&(_.delay=100),v.playTime+=_.delay,_.disposeOp=s.getUint8(i+8+24),_.blendOp=s.getUint8(i+8+25),_.dataParts=[],0===p&&2===_.disposeOp&&(_.disposeOp=1);break;case"fdAT":_&&_.dataParts.push(t.subarray(i+8+4,i+8+a));break;case"IDAT":_&&_.dataParts.push(t.subarray(i+8,i+8+a));break;case"IEND":l.push(h(t,i,12+a));break;default:n.push(h(t,i,12+a))}})),_&&v.frames.push(_),0==v.frames.length)return s;var m=new Blob(n),g=new Blob(l);return v.frames.forEach((function(e){var t=[];t.push(o),d.set(f(e.width),0),d.set(f(e.height),4),t.push(c("IHDR",d)),t.push(m),e.dataParts.forEach((function(e){return t.push(c("IDAT",e))})),t.push(g),e.imageData=new Blob(t,{type:"image/png"}),delete e.dataParts,t=null})),v};var n=function(e){return e&&e.__esModule?e:{default:e}}(i(1)),r=i(2);var a=new Error("Not a PNG"),s=new Error("Not an animated PNG");var o=new Uint8Array([137,80,78,71,13,10,26,10]);function u(e,t){var i=new DataView(e.buffer),n=8,r=void 0,a=void 0,s=void 0;do{a=i.getUint32(n),s=t(r=l(e,n+4,4),e,n,a),n+=12+a}while(!1!==s&&"IEND"!=r&&n<e.length)}function l(e,t,i){var n=Array.prototype.slice.call(e.subarray(t,t+i));return String.fromCharCode.apply(String,n)}function h(e,t,i){var n=new Uint8Array(i);return n.set(e.subarray(t,t+i)),n}var c=function(e,t){var i=e.length+t.length,r=new Uint8Array(i+8),a=new DataView(r.buffer);a.setUint32(0,t.length),r.set(function(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}(e),4),r.set(t,8);var s=(0,n.default)(r,4,i);return a.setUint32(i+4,s),r},f=function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=-1,r=t,a=t+(arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length-t);r<a;r++)n=n>>>8^i[255&(n^e[r])];return-1^n};for(var i=new Uint32Array(256),n=0;n<256;n++){for(var r=n,a=0;a<8;a++)r=0!=(1&r)?3988292384^r>>>1:r>>>1;i[n]=r}},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Frame=t.APNG=void 0;var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(e){return e&&e.__esModule?e:{default:e}}(i(3));function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.APNG=function(){function e(){a(this,e),this.width=0,this.height=0,this.numPlays=0,this.playTime=0,this.frames=[]}return n(e,[{key:"createImages",value:function(){return Promise.all(this.frames.map((function(e){return e.createImage()})))}},{key:"getPlayer",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.createImages().then((function(){return new r.default(t,e,i)}))}}]),e}(),t.Frame=function(){function e(){a(this,e),this.left=0,this.top=0,this.width=0,this.height=0,this.delay=0,this.disposeOp=0,this.blendOp=0,this.imageData=null,this.imageElement=null}return n(e,[{key:"createImage",value:function(){var e=this;return this.imageElement?Promise.resolve():new Promise((function(t,i){var n=URL.createObjectURL(e.imageData);e.imageElement=document.createElement("img"),e.imageElement.onload=function(){URL.revokeObjectURL(n),t()},e.imageElement.onerror=function(){URL.revokeObjectURL(n),e.imageElement=null,i(new Error("Image creation error"))},e.imageElement.src=n}))}}]),e}()},function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var r=function(e){function t(e,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.playbackRate=1,r._currentFrameNumber=0,r._ended=!1,r._paused=!0,r._numPlays=0,r._apng=e,r.context=i,r.stop(),n&&r.play(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"renderNextFrame",value:function(){this._currentFrameNumber=(this._currentFrameNumber+1)%this._apng.frames.length,this._currentFrameNumber===this._apng.frames.length-1&&(this._numPlays++,0!==this._apng.numPlays&&this._numPlays>=this._apng.numPlays&&(this._ended=!0,this._paused=!0)),this._prevFrame&&1==this._prevFrame.disposeOp?this.context.clearRect(this._prevFrame.left,this._prevFrame.top,this._prevFrame.width,this._prevFrame.height):this._prevFrame&&2==this._prevFrame.disposeOp&&this.context.putImageData(this._prevFrameData,this._prevFrame.left,this._prevFrame.top);var e=this.currentFrame;this._prevFrame=e,this._prevFrameData=null,2==e.disposeOp&&(this._prevFrameData=this.context.getImageData(e.left,e.top,e.width,e.height)),0==e.blendOp&&this.context.clearRect(e.left,e.top,e.width,e.height),this.context.drawImage(e.imageElement,e.left,e.top),this.emit("frame",this._currentFrameNumber),this._ended&&this.emit("end")}},{key:"play",value:function(){var e=this;this.emit("play"),this._ended&&this.stop(),this._paused=!1;var t=performance.now()+this.currentFrame.delay/this.playbackRate;requestAnimationFrame((function i(n){if(!e._ended&&!e._paused){if(n>=t){for(;n-t>=e._apng.playTime/e.playbackRate;)t+=e._apng.playTime/e.playbackRate,e._numPlays++;do{e.renderNextFrame(),t+=e.currentFrame.delay/e.playbackRate}while(!e._ended&&n>t)}requestAnimationFrame(i)}}))}},{key:"pause",value:function(){this._paused||(this.emit("pause"),this._paused=!0)}},{key:"stop",value:function(){this.emit("stop"),this._numPlays=0,this._ended=!1,this._paused=!0,this._currentFrameNumber=-1,this.context.clearRect(0,0,this._apng.width,this._apng.height),this.renderNextFrame()}},{key:"currentFrameNumber",get:function(){return this._currentFrameNumber}},{key:"currentFrame",get:function(){return this._apng.frames[this._currentFrameNumber]}},{key:"paused",get:function(){return this._paused}},{key:"ended",get:function(){return this._ended}}]),t}(function(e){return e&&e.__esModule?e:{default:e}}(i(4)).default);t.default=r},function(e,t){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function r(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}e.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!function(e){return"number"==typeof e}(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,i,s,o,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(a(i=this._events[e]))return!1;if(n(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),i.apply(this,o)}else if(r(i))for(o=Array.prototype.slice.call(arguments,1),s=(l=i.slice()).length,u=0;u<s;u++)l[u].apply(this,o);return!0},i.prototype.addListener=function(e,t){var s;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?r(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,r(this._events[e])&&!this._events[e].warned&&(s=a(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){if(!n(t))throw TypeError("listener must be a function");var i=!1;function r(){this.removeListener(e,r),i||(i=!0,t.apply(this,arguments))}return r.listener=t,this.on(e,r),this},i.prototype.removeListener=function(e,t){var i,a,s,o;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(i=this._events[e]).length,a=-1,i===t||n(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(r(i)){for(o=s;o-- >0;)if(i[o]===t||i[o].listener&&i[o].listener===t){a=o;break}if(a<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n(i=this._events[e]))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}}])},je.exports=He();var Ye=(0,Ue.g)(je.exports),Ke=function(e){(0,f.Z)(i,e);var t=(0,d.Z)(i);function i(){return(0,o.Z)(this,i),t.apply(this,arguments)}return(0,u.Z)(i,[{key:"_loadAnimation",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i,r){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Qe(t,i,r));case 1:case"end":return e.stop()}}),e)})));return function(t,i,n){return e.apply(this,arguments)}}()}],[{key:"create",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r,a,s,o){var u;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=new i(s),e.prev=1,e.next=4,u._load(t,r,a,o);case 4:e.next=10;break;case 6:if(e.prev=6,e.t0=e.catch(1),(0,he.D_)(e.t0)){e.next=10;break}return e.abrupt("return",new _.Z("invalid-resource","Could not load PNG: ".concat(e.t0.message)));case 10:return e.abrupt("return",u);case 11:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,i,n,r,a){return e.apply(this,arguments)}}()}]),i}(qe);function Qe(e,t,i){return $e.apply(this,arguments)}function $e(){return $e=(0,a.Z)((0,n.Z)().mark((function e(t,i,r){var a,o,u,l,h,c,f,d,_,p,v,m,g,y;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((a=Ye(t))instanceof Error)){e.next=3;break}throw a;case 3:return e.next=5,a.createImages();case 5:(0,he.k_)(r),o=a.frames,u=a.width,l=a.height,(h=document.createElement("canvas")).width=u,h.height=l,c=h.getContext("2d"),f=[],d=[],_=(0,s.Z)(o);try{for(_.s();!(p=_.n()).done;)v=p.value,d.push((0,Ne.HA)(v.delay)),m=v.imageElement,0===v.blendOp?c.globalCompositeOperation="copy":c.globalCompositeOperation="source-over",g=2===v.disposeOp&&c.getImageData(v.left,v.top,v.width,v.height),c.drawImage(m,v.left,v.top),y=c.getImageData(0,0,u,l),f.push(y),0===v.disposeOp||(1===v.disposeOp?c.clearRect(v.left,v.top,v.width,v.height):2===v.disposeOp&&c.putImageData(g,v.left,v.top))}catch(n){_.e(n)}finally{_.f()}return e.abrupt("return",{frameDurations:d,selectFrame:function(e){var t=f[e];i(t)},width:u,height:l});case 12:case"end":return e.stop()}}),e)}))),$e.apply(this,arguments)}var Je=[137,80,78,71,13,10,26,10];function et(e){var t=new Uint8Array(e);return!Je.some((function(e,i){return e!==t[i]}))}function tt(e){if(!et(e))return!1;var t,i=new DataView(e),n=new Uint8Array(e),r=8;do{var a=i.getUint32(r);if("acTL"===(t=String.fromCharCode.apply(String,Array.prototype.slice.call(n.subarray(r+4,r+8)))))return!0;r+=12+a}while("IEND"!==t&&r<n.length);return!1}var it=i(91958),nt={},rt={},at={};Object.defineProperty(at,"__esModule",{value:!0}),at.loop=at.conditional=at.parse=void 0;at.parse=function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;if(Array.isArray(i))i.forEach((function(i){return e(t,i,n,r)}));else if("function"==typeof i)i(t,n,r,e);else{var a=Object.keys(i)[0];Array.isArray(i[a])?(r[a]={},e(t,i[a],n,r[a])):r[a]=i[a](t,n,r,e)}return n};at.conditional=function(e,t){return function(i,n,r,a){t(i,n,r)&&a(i,e,n,r)}};at.loop=function(e,t){return function(i,n,r,a){for(var s=[],o=i.pos;t(i,n,r);){var u={};if(a(i,e,n,u),i.pos===o)break;o=i.pos,s.push(u)}return s}};var st={};Object.defineProperty(st,"__esModule",{value:!0}),st.readBits=st.readArray=st.readUnsigned=st.readString=st.peekBytes=st.readBytes=st.peekByte=st.readByte=st.buildStream=void 0;st.buildStream=function(e){return{data:e,pos:0}};var ot=function(){return function(e){return e.data[e.pos++]}};st.readByte=ot;st.peekByte=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(t){return t.data[t.pos+e]}};var ut=function(e){return function(t){return t.data.subarray(t.pos,t.pos+=e)}};st.readBytes=ut;st.peekBytes=function(e){return function(t){return t.data.subarray(t.pos,t.pos+e)}};st.readString=function(e){return function(t){return Array.from(ut(e)(t)).map((function(e){return String.fromCharCode(e)})).join("")}};st.readUnsigned=function(e){return function(t){var i=ut(2)(t);return e?(i[1]<<8)+i[0]:(i[0]<<8)+i[1]}};st.readArray=function(e,t){return function(i,n,r){for(var a="function"==typeof t?t(i,n,r):t,s=ut(e),o=new Array(a),u=0;u<a;u++)o[u]=s(i);return o}};st.readBits=function(e){return function(t){for(var i=function(e){return e.data[e.pos++]}(t),n=new Array(8),r=0;r<8;r++)n[7-r]=!!(i&1<<r);return Object.keys(e).reduce((function(t,i){var r=e[i];return r.length?t[i]=function(e,t,i){for(var n=0,r=0;r<i;r++)n+=e[t+r]&&Math.pow(2,i-r-1);return n}(n,r.index,r.length):t[i]=n[r.index],t}),{})}},function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=at,i=st,n={blocks:function(e){for(var t=[],n=e.data.length,r=0,a=(0,i.readByte)()(e);0!==a&&a;a=(0,i.readByte)()(e)){if(e.pos+a>=n){var s=n-e.pos;t.push((0,i.readBytes)(s)(e)),r+=s;break}t.push((0,i.readBytes)(a)(e)),r+=a}for(var o=new Uint8Array(r),u=0,l=0;l<t.length;l++)o.set(t[l],u),u+=t[l].length;return o}},r=(0,t.conditional)({gce:[{codes:(0,i.readBytes)(2)},{byteSize:(0,i.readByte)()},{extras:(0,i.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,i.readUnsigned)(!0)},{transparentColorIndex:(0,i.readByte)()},{terminator:(0,i.readByte)()}]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&249===t[1]})),a=(0,t.conditional)({image:[{code:(0,i.readByte)()},{descriptor:[{left:(0,i.readUnsigned)(!0)},{top:(0,i.readUnsigned)(!0)},{width:(0,i.readUnsigned)(!0)},{height:(0,i.readUnsigned)(!0)},{lct:(0,i.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,t.conditional)({lct:(0,i.readArray)(3,(function(e,t,i){return Math.pow(2,i.descriptor.lct.size+1)}))},(function(e,t,i){return i.descriptor.lct.exists})),{data:[{minCodeSize:(0,i.readByte)()},n]}]},(function(e){return 44===(0,i.peekByte)()(e)})),s=(0,t.conditional)({text:[{codes:(0,i.readBytes)(2)},{blockSize:(0,i.readByte)()},{preData:function(e,t,n){return(0,i.readBytes)(n.text.blockSize)(e)}},n]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&1===t[1]})),o=(0,t.conditional)({application:[{codes:(0,i.readBytes)(2)},{blockSize:(0,i.readByte)()},{id:function(e,t,n){return(0,i.readString)(n.blockSize)(e)}},n]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&255===t[1]})),u=(0,t.conditional)({comment:[{codes:(0,i.readBytes)(2)},n]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&254===t[1]})),l=[{header:[{signature:(0,i.readString)(3)},{version:(0,i.readString)(3)}]},{lsd:[{width:(0,i.readUnsigned)(!0)},{height:(0,i.readUnsigned)(!0)},{gct:(0,i.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,i.readByte)()},{pixelAspectRatio:(0,i.readByte)()}]},(0,t.conditional)({gct:(0,i.readArray)(3,(function(e,t){return Math.pow(2,t.lsd.gct.size+1)}))},(function(e,t){return t.lsd.gct.exists})),{frames:(0,t.loop)([r,o,u,a,s],(function(e){var t=(0,i.peekByte)()(e);return 33===t||44===t}))}];e.default=l}(rt);var lt={};Object.defineProperty(lt,"__esModule",{value:!0}),lt.deinterlace=void 0;lt.deinterlace=function(e,t){for(var i=new Array(e.length),n=e.length/t,r=function(n,r){var a=e.slice(r*t,(r+1)*t);i.splice.apply(i,[n*t,t].concat(a))},a=[0,4,2,1],s=[8,8,4,2],o=0,u=0;u<4;u++)for(var l=a[u];l<n;l+=s[u])r(l,o),o++;return i};var ht={};Object.defineProperty(ht,"__esModule",{value:!0}),ht.lzw=void 0;ht.lzw=function(e,t,i){var n,r,a,s,o,u,l,h,c,f,d,_,p,v,m,g,y=4096,b=i,E=new Array(i),x=new Array(y),w=new Array(y),T=new Array(y+1);for(o=1+(r=1<<(f=e)),n=r+2,l=-1,a=(1<<(s=f+1))-1,h=0;h<r;h++)x[h]=0,w[h]=h;for(d=_=p=v=m=g=0,c=0;c<b;){if(0===v){if(_<s){d+=t[g]<<_,_+=8,g++;continue}if(h=d&a,d>>=s,_-=s,h>n||h==o)break;if(h==r){a=(1<<(s=f+1))-1,n=r+2,l=-1;continue}if(-1==l){T[v++]=w[h],l=h,p=h;continue}for(u=h,h==n&&(T[v++]=p,h=l);h>r;)T[v++]=w[h],h=x[h];p=255&w[h],T[v++]=p,n<y&&(x[n]=l,w[n]=p,0==(++n&a)&&n<y&&(s++,a+=n)),l=u}v--,E[m++]=T[v],c++}for(c=m;c<b;c++)E[c]=0;return E},Object.defineProperty(nt,"__esModule",{value:!0});var ct=nt.decompressFrames=nt.decompressFrame=mt=nt.parseGIF=void 0,ft=function(e){return e&&e.__esModule?e:{default:e}}(rt),dt=at,_t=st,pt=lt,vt=ht;var mt=nt.parseGIF=function(e){var t=new Uint8Array(e);return(0,dt.parse)((0,_t.buildStream)(t),ft.default)},gt=function(e,t,i){if(e.image){var n=e.image,r=n.descriptor.width*n.descriptor.height,a=(0,vt.lzw)(n.data.minCodeSize,n.data.blocks,r);n.descriptor.lct.interlaced&&(a=(0,pt.deinterlace)(a,n.descriptor.width));var s={pixels:a,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return n.descriptor.lct&&n.descriptor.lct.exists?s.colorTable=n.lct:s.colorTable=t,e.gce&&(s.delay=10*(e.gce.delay||10),s.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(s.transparentIndex=e.gce.transparentColorIndex)),i&&(s.patch=function(e){for(var t=e.pixels.length,i=new Uint8ClampedArray(4*t),n=0;n<t;n++){var r=4*n,a=e.pixels[n],s=e.colorTable[a]||[0,0,0];i[r]=s[0],i[r+1]=s[1],i[r+2]=s[2],i[r+3]=a!==e.transparentIndex?255:0}return i}(s)),s}console.warn("gif frame does not have associated image.")};nt.decompressFrame=gt;ct=nt.decompressFrames=function(e,t){return e.frames.filter((function(e){return e.image})).map((function(i){return gt(i,e.gct,t)}))};var yt=function(e){(0,f.Z)(i,e);var t=(0,d.Z)(i);function i(){return(0,o.Z)(this,i),t.apply(this,arguments)}return(0,u.Z)(i,[{key:"_loadAnimation",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i,r){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",bt(t,i));case 1:case"end":return e.stop()}}),e)})));return function(t,i,n){return e.apply(this,arguments)}}()}],[{key:"create",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r,a,s,o){var u;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=new i(s),e.prev=1,e.next=4,u._load(t,r,a,o);case 4:e.next=10;break;case 6:if(e.prev=6,e.t0=e.catch(1),(0,he.D_)(e.t0)){e.next=10;break}return e.abrupt("return",new _.Z("invalid-resource","Could not load GIF: ".concat(e.t0.message)));case 10:return e.abrupt("return",u);case 11:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,i,n,r,a){return e.apply(this,arguments)}}()}]),i}(qe);function bt(e,t,i){return Et.apply(this,arguments)}function Et(){return Et=(0,a.Z)((0,n.Z)().mark((function e(t,i,r){var a,o,u,l,h,c,f,d,_,p,v,m,g,y,b,E;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=mt(t),o=ct(a,!0),u=a.lsd,l=u.width,h=u.height,(c=document.createElement("canvas")).width=l,c.height=h,f=c.getContext("2d"),d=[],_=[],p=(0,s.Z)(o);try{for(p.s();!(v=p.n()).done;)m=v.value,_.push((0,Ne.HA)(m.delay)),g=new ImageData(m.patch,m.dims.width,m.dims.height),y=(0,it.E0)(g),b=3===m.disposalType&&f.getImageData(m.dims.left,m.dims.top,m.dims.width,m.dims.height),f.drawImage(y,m.dims.left,m.dims.top),E=f.getImageData(0,0,l,h),d.push(E),1===m.disposalType||(2===m.disposalType?f.clearRect(m.dims.left,m.dims.top,m.dims.width,m.dims.height):3===m.disposalType&&f.putImageData(b,m.dims.left,m.dims.top))}catch(n){p.e(n)}finally{p.f()}return e.abrupt("return",{frameDurations:_,selectFrame:function(e){var t=d[e];i(t)},width:l,height:h});case 6:case"end":return e.stop()}}),e)}))),Et.apply(this,arguments)}var xt=[71,73,70];function wt(e){var t=new Uint8Array(e);return!xt.some((function(e,i){return e!==t[i]}))}function Tt(e){if(!wt(e))return!1;for(var t=new DataView(e),i=t.getUint8(10),n=13+(128&i?3*Math.pow(2,1+(7&i)):0),r=0,a=!1;!a;){switch(t.getUint8(n++)){case 33:if(!s())return!1;break;case 44:o();break;case 59:a=!0;break;default:return!1}if(r>1)return!0}function s(){switch(t.getUint8(n++)){case 249:n++,n+=4,u();break;case 1:r++,n++,n+=12,u();break;case 254:u();break;case 255:n++,n+=8,n+=3,u();break;default:return!1}return!0}function o(){r++,n+=8;var e=t.getUint8(n++);n+=128&e?3*Math.pow(2,1+(7&e)):0,n++,u()}function u(){for(var e;e=t.getUint8(n++);)n+=e}return!1}var Rt=i(55940);function Ft(e){switch(e.type){case"esriSMS":return"".concat(e.style,".").concat(e.path);case"esriSLS":return"".concat(e.style,".").concat(e.cap);case"esriSFS":return"".concat(e.style);case"esriPFS":case"esriPMS":return e.imageData?"".concat(e.imageData).concat(e.width).concat(e.height):"".concat(e.url).concat(e.width).concat(e.height);default:return"mosaicHash"in e?e.mosaicHash:JSON.stringify(e)}}var Bt=i(38164),At=(0,de.c)(),kt="arial-unicode-ms-regular",Ct=le.Z.getLogger("esri.views.2d.engine.webgl.TextureManager");function St(e,t){return Ot.apply(this,arguments)}function Ot(){return Ot=(0,a.Z)((0,n.Z)().mark((function e(t,i){var a,s,o,u,l,h,c,f,d,p;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(0,De.Gr)(t),o=";base64,",!a.includes(o)){e.next=8;break}for(u=a.indexOf(o)+o.length,l=a.substring(u),h=atob(l),c=new Uint8Array(h.length),f=0;f<h.length;f++)c[f]=h.charCodeAt(f);s=c.buffer,e.next=20;break;case 8:return e.prev=8,e.next=11,(0,oe.default)(a,(0,r.Z)({responseType:"array-buffer"},i));case 11:d=e.sent,p=d.data,s=p,e.next=20;break;case 16:if(e.prev=16,e.t0=e.catch(8),(0,he.D_)(e.t0)){e.next=20;break}return e.abrupt("return",new _.Z("mapview-invalid-resource","Could not fetch requested resource at ".concat(a)));case 20:return e.abrupt("return",s);case 21:case"end":return e.stop()}}),e,null,[[8,16]])}))),Ot.apply(this,arguments)}function Mt(e,t){var i=Math.round((0,ce.F2)(t)*window.devicePixelRatio),n=i>=128?2:4;return Math.min(e,i*n)}var It=function(e,t,i){return Ct.error(new _.Z(e,t,i))},Pt=function(){function e(t,i,n){(0,o.Z)(this,e),this.mosaicType=t,this.page=i,this.sdf=n}return(0,u.Z)(e,null,[{key:"fromMosaic",value:function(t,i){return new e(t,i.page,i.sdf)}}]),e}(),Dt=function(){function e(t,i){(0,o.Z)(this,e),this._requestRender=t,this.resourceManager=i,this._invalidFontsMap=new Map,this._sdfConverter=new Ce(126),this._bindingInfos=new Array,this._hashToBindingIndex=new Map,this._ongoingRasterizations=new Map,this._imageRequestQueue=new Bt.e({concurrency:10,process:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,he.k_)(i),e.prev=1,e.next=4,(0,oe.default)(t,{responseType:"image",signal:i});case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),(0,he.D_)(e.t0)){e.next=11;break}throw new _.Z("mapview-invalid-resource","Could not fetch requested resource at ".concat(t),e.t0);case 11:throw e.t0;case 12:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,i){return e.apply(this,arguments)}}()}),this._spriteMosaic=new Ie(2048,2048,500),this._glyphSource=new Be("".concat(se.Z.fontsUrl,"/{fontstack}/{range}.pbf")),this._glyphMosaic=new we(1024,1024,this._glyphSource),this._rasterizer=new _e.Z(i)}return(0,u.Z)(e,[{key:"dispose",value:function(){this._spriteMosaic.dispose(),this._glyphMosaic.dispose(),this._rasterizer.dispose(),this._sdfConverter.dispose(),this._spriteMosaic=null,this._glyphMosaic=null,this._sdfConverter=null,this._hashToBindingIndex.clear(),this._hashToBindingIndex=null,this._bindingInfos=null,this._ongoingRasterizations.clear(),this._ongoingRasterizations=null,this._imageRequestQueue.clear(),this._imageRequestQueue=null}},{key:"sprites",get:function(){return this._spriteMosaic}},{key:"glyphs",get:function(){return this._glyphMosaic}},{key:"rasterizeItem",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i,r,a){var s,o,u=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,m.Wi)(t)){e.next=2;break}return e.abrupt("return",(It("mapview-null-resource","Unable to rasterize null resource"),null));case 2:e.t0=t.type,e.next="text"===e.t0||"esriTS"===e.t0?5:9;break;case 5:return e.next=7,this._rasterizeText(t,r,a);case 7:return s=e.sent,e.abrupt("return",(s.forEach((function(e){return u._setTextureBinding(w.Un.GLYPH,e)})),{glyphMosaicItems:s}));case 9:if(!(0,De.Ll)(t)){e.next=11;break}return e.abrupt("return",(It("mapview-invalid-type","MapView does not support symbol type: ".concat(t.type),t),null));case 11:return e.next=13,this._rasterizeSpriteSymbol(t,i,a);case 13:return o=e.sent,e.abrupt("return",((0,Rt.ok)(o)&&o&&this._setTextureBinding(w.Un.SPRITE,o),{spriteMosaicItem:o}));case 15:case"end":return e.stop()}}),e,this)})));return function(t,i,n,r){return e.apply(this,arguments)}}()},{key:"bindTextures",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(0!==i.textureBinding){var r=this._bindingInfos[i.textureBinding-1],a=r.page,s=n?Y.cw.LINEAR_MIPMAP_LINEAR:Y.cw.LINEAR;switch(r.mosaicType){case w.Un.SPRITE:var o=this.sprites.getWidth(a),u=this.sprites.getHeight(a),l=(0,fe.a)(At,o,u);return this._spriteMosaic.bind(e,s,a,pe.D3),t.setUniform1i("u_texture",pe.D3),void t.setUniform2fv("u_mosaicSize",l);case w.Un.GLYPH:var h=this.glyphs.width,c=this.glyphs.height,f=(0,fe.a)(At,h,c);return this._glyphMosaic.bind(e,s,a,pe.Al),t.setUniform1i("u_texture",pe.Al),void t.setUniform2fv("u_mosaicSize",f);default:Ct.error("mapview-texture-manager","Cannot handle unknown type ".concat(r.mosaicType))}}}},{key:"_hashMosaic",value:function(e,t){return 1|e<<1|(t.sdf?1:0)<<2|t.page<<3}},{key:"_setTextureBinding",value:function(e,t){var i=this._hashMosaic(e,t);if(!this._hashToBindingIndex.has(i)){var n=Pt.fromMosaic(e,t),r=this._bindingInfos.length+1;this._hashToBindingIndex.set(i,r),this._bindingInfos.push(n)}t.textureBinding=this._hashToBindingIndex.get(i)}},{key:"_rasterizeText",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i,r){var a,s,o,u,l,h;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"cim"in t?(a=(o=t).fontName,s=o.text):(u=t,a=(0,ve.Yc)(u.font),s=u.text),l=this._invalidFontsMap.has(a),h=i||(0,De.Jq)((0,ue.E)(s)[0]),e.prev=2,e.next=5,this._glyphMosaic.getGlyphItems(l?kt:a,h,r);case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",(It("mapview-invalid-resource","Couldn't find font ".concat(a,". Falling back to Arial Unicode MS Regular")),this._invalidFontsMap.set(a,!0),this._glyphMosaic.getGlyphItems(kt,h,r)));case 11:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(t,i,n){return e.apply(this,arguments)}}()},{key:"_rasterizeSpriteSymbol",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i,r){var a,s,o,u,l,h;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,De.Gg)(t)){e.next=2;break}return e.abrupt("return",null);case 2:if(a=Ft(t),!this._spriteMosaic.has(a)){e.next=5;break}return e.abrupt("return",this._spriteMosaic.getSpriteItem(a));case 5:if(!((0,De.sG)(t)||(0,De.HX)(t)&&!(0,De.yP)(t))){e.next=7;break}return e.abrupt("return",this._handleAsyncResource(a,t,r));case 7:if(1,!(s=this._rasterizer.rasterizeJSONResource(t,1))){e.next=11;break}return o=s.size,u=s.image,l=s.sdf,h=s.simplePattern,e.abrupt("return",this._addItemToMosaic(a,o,{type:"static",data:u},(0,De.js)(t),l,h));case 11:return e.abrupt("return",new _.Z("TextureManager","unrecognized or null rasterized image"));case 12:case"end":return e.stop()}}),e,this)})));return function(t,i,n){return e.apply(this,arguments)}}()},{key:"_handleAsyncResource",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i,r){var a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._ongoingRasterizations.has(t)){e.next=2;break}return e.abrupt("return",this._ongoingRasterizations.get(t));case 2:return a=(0,De.sG)(i)?this._handleSVG(i,t,r):this._handleImage(i,t,r),this._ongoingRasterizations.set(t,a),e.prev=3,e.next=6,a;case 6:this._ongoingRasterizations.delete(t),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),this._ongoingRasterizations.delete(t);case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t,i,n){return e.apply(this,arguments)}}()},{key:"_handleSVG",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i,r){var a,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[126,126],e.next=3,this._sdfConverter.draw(t.path,r);case 3:return s=e.sent,e.abrupt("return",this._addItemToMosaic(i,a,{type:"static",data:new Uint32Array(s.buffer)},!1,!0,!0));case 5:case"end":return e.stop()}}),e,this)})));return function(t,i,n){return e.apply(this,arguments)}}()},{key:"_handleGIFOrPNG",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i,r){var a,s,o,u,l,h,c,f,d,p,v,m,g,y,b;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,St(t,r);case 2:if(a=e.sent,!(0,Rt.ok)(a)){e.next=37;break}if(s=wt(a),o=et(a),s||o){e.next=7;break}return e.abrupt("return",new _.Z("mapview-invalid-resource","Image data is neither GIF nor PNG!"));case 7:if(e.prev=7,l=t.animatedSymbolProperties||{},h=t.objectId,!s||!Tt(a)){e.next=15;break}return e.next=12,yt.create(a,l,h,this._requestRender,r);case 12:u=e.sent,e.next=20;break;case 15:if(e.t0=o&&tt(a),!e.t0){e.next=20;break}return e.next=19,Ke.create(a,l,h,this._requestRender,r);case 19:u=e.sent;case 20:e.next=26;break;case 22:if(e.prev=22,e.t1=e.catch(7),(0,he.D_)(e.t1)){e.next=26;break}return e.abrupt("return",new _.Z("mapview-invalid-resource","Could not fetch requested resource!"));case 26:if(!u||!(0,Rt.ok)(u)){e.next=28;break}return e.abrupt("return",this._addItemToMosaic(i,[u.width,u.height],{type:"animated",data:u},(0,De.js)(t),!1,!1));case 28:return c=new Blob([a],{type:s?"image/gif":"image/png"}),e.next=31,this._imageFromBlob(c);case 31:if(!((f=e.sent)&&f instanceof HTMLImageElement)){e.next=37;break}return d=f.width,p=f.height,"esriPMS"===t.type&&(d=Math.round(Mt(f.width,(0,De.Ub)(t))),p=Math.round(f.height*(d/f.width))),v="cim"in t?t.cim.colorSubstitutions:void 0,m=this._rasterizer.rasterizeImageResource(d,p,f,v),g=m.size,y=m.sdf,b=m.image,e.abrupt("return",this._addItemToMosaic(i,g,{type:"static",data:b},(0,De.js)(t),y,!1));case 37:return e.abrupt("return",new _.Z("mapview-invalid-resource","Could not handle resource!"));case 38:case"end":return e.stop()}}),e,this,[[7,22]])})));return function(t,i,n){return e.apply(this,arguments)}}()},{key:"_handleImage",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i,a){var s,o,u,l,h,c,f,d,p,v,g,y,b,E;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,De.DQ)(t)&&!(0,De.iw)(t)){e.next=2;break}return e.abrupt("return",this._handleGIFOrPNG(t,i,a));case 2:if(s=(0,De.Gr)(t),e.prev=3,u=this.resourceManager.getResource(s),!(0,m.pC)(u)){e.next=9;break}o=u,e.next=14;break;case 9:return e.next=11,this._imageRequestQueue.push(s,(0,r.Z)({},a));case 11:l=e.sent,h=l.data,o=h;case 14:if((0,De.TB)(s)&&("width"in t&&"height"in t?(o.width=(0,ce.F2)(t.width),o.height=(0,ce.F2)(t.height)):"cim"in t&&(f=t.cim,o.width=(0,ce.F2)(null!==(c=f.width)&&void 0!==c?c:f.scaleX*f.size),o.height=(0,ce.F2)(f.size))),o.width&&o.height){e.next=17;break}return e.abrupt("return",null);case 17:return d=o.width,p=o.height,"esriPMS"===t.type&&(d=Math.round(Mt(o.width,(0,De.Ub)(t))),p=Math.round(o.height*(d/o.width))),v="cim"in t?t.cim.colorSubstitutions:void 0,g=this._rasterizer.rasterizeImageResource(d,p,o,v),y=g.size,b=g.sdf,E=g.image,e.abrupt("return",this._addItemToMosaic(i,y,{type:"static",data:E},(0,De.js)(t),b,!1));case 23:if(e.prev=23,e.t0=e.catch(3),(0,he.D_)(e.t0)){e.next=27;break}return e.abrupt("return",new _.Z("mapview-invalid-resource","Could not fetch requested resource at ".concat(s,". ").concat(e.t0.message)));case 27:case"end":return e.stop()}}),e,this,[[3,23]])})));return function(t,i,n){return e.apply(this,arguments)}}()},{key:"_imageFromBlob",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var i,r,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=window.URL.createObjectURL(t),e.prev=1,e.next=4,this._imageRequestQueue.push(i);case 4:return r=e.sent,a=r.data,e.abrupt("return",(window.URL.revokeObjectURL(i),a));case 9:if(e.prev=9,e.t0=e.catch(1),window.URL.revokeObjectURL(i),(0,he.D_)(e.t0)){e.next=13;break}return e.abrupt("return",new _.Z("mapview-invalid-resource","Could not fetch requested resource at ".concat(i)));case 13:throw e.t0;case 14:case"end":return e.stop()}}),e,this,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_addItemToMosaic",value:function(e,t,i,n,r,a){return this._spriteMosaic.addSpriteItem(e,t,i,n,r,a)}}]),e}(),Ut=i(26277),Nt=i(22753),Lt=i(6394),Zt=i(11186),zt=i(71353),Gt=i(25866),Vt={shaders:{vertexShader:(0,H.w)("stencil/stencil.vert"),fragmentShader:(0,H.w)("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])},Wt=(0,Lt.f)(-.5,-.5),Xt=function(){function e(){(0,o.Z)(this,e),this._centerNdc=(0,zt.c)(),this._pxToNdc=(0,zt.c)(),this._worldDimensionsPx=(0,zt.c)(),this._mat3=(0,b.c)(),this._initialized=!1}return(0,u.Z)(e,[{key:"dispose",value:function(){this._program=(0,m.O3)(this._program),this._quad=(0,m.O3)(this._quad)}},{key:"render",value:function(e,t){var i=e.context;return!!this._updateGeometry(e,t)&&(this._initialized||this._initialize(i),i.setDepthWriteEnabled(!1),i.setDepthTestEnabled(!1),i.setColorMask(!1,!1,!1,!1),i.setBlendingEnabled(!1),i.setStencilOp(Y.xS.KEEP,Y.xS.KEEP,Y.xS.REPLACE),i.setStencilFunction(Y.wb.ALWAYS,1,255),i.setStencilTestEnabled(!0),i.useProgram(this._program),this._program.setUniformMatrix3fv("u_worldExtent",this._mat3),this._quad.draw(),this._quad.unbind(),!0)}},{key:"_initialize",value:function(e){if(!this._initialized){var t=(0,K.H)(e,Vt);t&&(this._program=t,this._quad=new Gt.Z(e,[0,0,1,0,0,1,1,1]),this._initialized=!0)}}},{key:"_updateGeometry",value:function(e,t){var i=e.state,n=e.pixelRatio,r=i.size,a=i.rotation,s=Math.round(r[0]*n),o=Math.round(r[1]*n);if(!i.spatialReference.isWrappable)return!1;var u=(0,Ut.t)(a),l=Math.abs(Math.cos(u)),h=Math.abs(Math.sin(u)),c=Math.round(s*l+o*h),f=Math.round(i.worldScreenWidth);if(c<=f)return!1;var d=s*h+o*l,_=f*n,p=(t.left-t.right)*n/s,v=(t.bottom-t.top)*n/o;(0,Zt.s)(this._worldDimensionsPx,_,d,1),(0,Zt.s)(this._pxToNdc,2/s,-2/o,1),(0,Zt.s)(this._centerNdc,p,v,1);var m=this._mat3;return(0,Nt.h)(m,this._centerNdc),(0,Nt.d)(m,m,this._pxToNdc),0!==a&&(0,Nt.r)(m,m,u),(0,Nt.d)(m,m,this._worldDimensionsPx),(0,Nt.c)(m,m,Wt),!0}}]),e}(),Ht=function(){function e(){(0,o.Z)(this,e),this.name=this.constructor.name}return(0,u.Z)(e,[{key:"createOptions",value:function(e,t){return null}}]),e}(),qt=function(e){(0,f.Z)(i,e);var t=(0,d.Z)(i);function i(){var e;return(0,o.Z)(this,i),(e=t.apply(this,arguments)).defines=[],e._desc={vsPath:"fx/integrate",fsPath:"fx/integrate",attributes:new Map([["a_position",0]])},e}return(0,u.Z)(i,[{key:"dispose",value:function(){this._quad&&this._quad.dispose()}},{key:"bind",value:function(){}},{key:"unbind",value:function(){}},{key:"draw",value:function(e,t){if(t.size){var i=e.context,n=e.renderingOptions;this._quad||(this._quad=new Gt.Z(i,[0,0,1,0,0,1,1,1]));var r=i.getBoundFramebufferObject(),a=i.getViewport(),s=a.x,o=a.y,u=a.width,l=a.height;t.bindTextures(i);var h=t.getBlock(pe.xl);if(!(0,m.Wi)(h)){var c=h.getFBO(i),f=h.getFBO(i,1);i.setViewport(0,0,t.size,t.size),this._computeDelta(e,f,n.labelsAnimationTime),this._updateAnimationState(e,f,c),i.bindFramebuffer(r),i.setViewport(s,o,u,l)}}}},{key:"_computeDelta",value:function(e,t,i){var n=e.context,r=e.painter,a=e.displayLevel,s=r.materialManager.getProgram(this._desc,["delta"]);n.bindFramebuffer(t),n.setClearColor(0,0,0,0),n.clear(n.gl.COLOR_BUFFER_BIT),n.useProgram(s),s.setUniform1i("u_maskTexture",pe.iJ),s.setUniform1i("u_sourceTexture",pe.nM),s.setUniform1f("u_timeDelta",e.deltaTime),s.setUniform1f("u_animationTime",i),s.setUniform1f("u_zoomLevel",Math.round(10*a)),this._quad.draw()}},{key:"_updateAnimationState",value:function(e,t,i){var n=e.context,r=e.painter.materialManager.getProgram(this._desc,["update"]);n.bindTexture(t.colorTexture,1),n.useProgram(r),r.setUniform1i("u_sourceTexture",1),n.bindFramebuffer(i),n.setClearColor(0,0,0,0),n.clear(n.gl.COLOR_BUFFER_BIT),this._quad.draw()}}]),i}(Ht),jt=function(e){return"#define ".concat(function(e){return e.replace("-","_").toUpperCase()}(e),"\n")};function Yt(e){return{attributes:new Map([["a_pos",0],["a_tex",1]]),shaders:{vertexShader:jt(e)+(0,H.w)("blend/blend.vert"),fragmentShader:jt(e)+(0,H.w)("blend/blend.frag")}}}var Kt=le.Z.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect"),Qt=function(){function e(){(0,o.Z)(this,e),this._size=[0,0]}return(0,u.Z)(e,[{key:"dispose",value:function(e){this._backBufferTexture=(0,m.O3)(this._backBufferTexture),this._quad=(0,m.O3)(this._quad)}},{key:"draw",value:function(e,t,i,n,r){var a=e.context,s=e.drawPhase;if(this._setupShader(a),n&&"normal"!==n&&s!==w.jx.LABEL)this._drawBlended(e,t,i,n,r);else{var o=Yt("normal"),u=a.programCache.acquire(o.shaders.vertexShader,o.shaders.fragmentShader,o.attributes);if(u){a.useProgram(u),t.setSamplingMode(i),a.bindTexture(t,0),u.setUniform1i("u_layerTexture",0),u.setUniform1f("u_opacity",r),a.setBlendingEnabled(!0),a.setBlendFunction(Y.zi.ONE,Y.zi.ONE_MINUS_SRC_ALPHA);var l=this._quad;l.draw(),l.unbind(),u.dispose()}else Kt.error(new _.Z("mapview-BlendEffect",'Error creating shader program for blend mode "normal"'))}}},{key:"_drawBlended",value:function(e,t,i,n,r){var a,s,o=e.context,u=e.state,l=e.pixelRatio,h=e.inFadeTransition,c=u.size,f=o.getBoundFramebufferObject();if((0,m.pC)(f)){var d=f.descriptor;a=d.width,s=d.height}else a=Math.round(l*c[0]),s=Math.round(l*c[1]);this._createOrResizeTexture(e,a,s);var p=this._backBufferTexture;f.copyToTexture(0,0,a,s,0,0,p),o.setStencilTestEnabled(!1),o.setStencilWriteMask(0),o.setBlendingEnabled(!0),o.setDepthTestEnabled(!1),o.setDepthWriteEnabled(!1);var v=Yt(n),g=o.programCache.acquire(v.shaders.vertexShader,v.shaders.fragmentShader,v.attributes);if(g){o.useProgram(g),p.setSamplingMode(i),o.bindTexture(p,0),g.setUniform1i("u_backbufferTexture",0),t.setSamplingMode(i),o.bindTexture(t,1),g.setUniform1i("u_layerTexture",1),g.setUniform1f("u_opacity",r),g.setUniform1f("u_inFadeOpacity",h?1:0),o.setBlendFunction(Y.zi.ONE,Y.zi.ZERO);var y=this._quad;y.draw(),y.unbind(),g.dispose(),o.setBlendFunction(Y.zi.ONE,Y.zi.ONE_MINUS_SRC_ALPHA)}else Kt.error(new _.Z("mapview-BlendEffect","Error creating shader program for blend mode ".concat(n)))}},{key:"_setupShader",value:function(e){this._quad||(this._quad=new Gt.Z(e,[-1,-1,1,-1,-1,1,1,1]))}},{key:"_createOrResizeTexture",value:function(e,t,i){var n=e.context;null!==this._backBufferTexture&&t===this._size[0]&&i===this._size[1]||(this._backBufferTexture?this._backBufferTexture.resize(t,i):this._backBufferTexture=new ye.x(n,{target:Y.No.TEXTURE_2D,pixelFormat:Y.VI.RGBA,internalFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,wrapMode:Y.e8.CLAMP_TO_EDGE,samplingMode:Y.cw.LINEAR,flipped:!1,width:t,height:i}),this._size[0]=t,this._size[1]=i)}}]),e}(),$t=function(e){(0,f.Z)(i,e);var t=(0,d.Z)(i);function i(e){var n;return(0,o.Z)(this,i),(n=t.call(this)).name=n.constructor.name,n.defines=[e],n}return(0,u.Z)(i,[{key:"dispose",value:function(){}},{key:"bind",value:function(e){var t=e.context,i=e.painter;this._prev=t.getBoundFramebufferObject();var n=t.getViewport(),r=n.width,a=n.height,s=i.getFbos(r,a).effect0;t.bindFramebuffer(s),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}},{key:"unbind",value:function(){}},{key:"draw",value:function(e,t){var i,n=e.context,r=e.painter,a=r.getPostProcessingEffects(t),o=n.getBoundFramebufferObject(),u=(0,s.Z)(a);try{for(u.s();!(i=u.n()).done;){var l=i.value,h=l.postProcessingEffect,c=l.effect;h.draw(e,o,c)}}catch(f){u.e(f)}finally{u.f()}n.bindFramebuffer(this._prev),n.setStencilTestEnabled(!1),r.blitTexture(n,o.colorTexture,Y.cw.NEAREST),n.setStencilTestEnabled(!0)}}]),i}(Ht),Jt=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],ei=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],ti=256,ii=1.3,ni=.4,ri=.4,ai=0,si=le.Z.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");var oi=[0,0,0,0],ui=function(){function e(){(0,o.Z)(this,e),this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:ai,outlineWidth:ii,innerHaloWidth:ri,outerHaloWidth:ni},this.shadeTexChanged=!0,this.texelData=new Uint8Array(1024),this.minMaxDistance=[0,0]}return(0,u.Z)(e,[{key:"setHighlightOptions",value:function(e){var t=this._convertedHighlightOptions;!function(e,t){t.fillColor[0]=e.color.r/255,t.fillColor[1]=e.color.g/255,t.fillColor[2]=e.color.b/255,t.fillColor[3]=e.color.a,e.haloColor?(t.outlineColor[0]=e.haloColor.r/255,t.outlineColor[1]=e.haloColor.g/255,t.outlineColor[2]=e.haloColor.b/255,t.outlineColor[3]=e.haloColor.a):(t.outlineColor[0]=t.fillColor[0],t.outlineColor[1]=t.fillColor[1],t.outlineColor[2]=t.fillColor[2],t.outlineColor[3]=t.fillColor[3]),t.fillColor[3]*=e.fillOpacity,t.outlineColor[3]*=e.haloOpacity,t.fillColor[0]*=t.fillColor[3],t.fillColor[1]*=t.fillColor[3],t.fillColor[2]*=t.fillColor[3],t.outlineColor[0]*=t.outlineColor[3],t.outlineColor[1]*=t.outlineColor[3],t.outlineColor[2]*=t.outlineColor[3],t.outlineWidth=ii,t.outerHaloWidth=ni,t.innerHaloWidth=ri,t.outlinePosition=ai}(e,t);var i,n=t.outlinePosition-t.outlineWidth/2-t.outerHaloWidth,r=t.outlinePosition-t.outlineWidth/2,a=t.outlinePosition+t.outlineWidth/2,s=t.outlinePosition+t.outlineWidth/2+t.innerHaloWidth,o=1*Math.sqrt(Math.PI/2),u=Math.abs(n)>o?Math.round(10*(Math.abs(n)-o))/10:0,l=Math.abs(s)>o?Math.round(10*(Math.abs(s)-o))/10:0;u&&!l?si.error("The outer rim of the highlight is "+u+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!u&&l?si.error("The inner rim of the highlight is "+l+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):u&&l&&si.error("The highlight is "+Math.max(u,l)+"px away from the edge of the feature; consider reducing some width values.");var h=[void 0,void 0,void 0,void 0];function c(e,t,i){h[0]=(1-i)*e[0]+i*t[0],h[1]=(1-i)*e[1]+i*t[1],h[2]=(1-i)*e[2]+i*t[2],h[3]=(1-i)*e[3]+i*t[3]}for(var f=this.texelData,d=0;d<ti;++d){var _,p,v,m;(i=n+d/255*(s-n))<n?(h[4*d+0]=0,h[4*d+1]=0,h[4*d+2]=0,h[4*d+3]=0):i<r?c(oi,t.outlineColor,(i-n)/(r-n)):i<a?(_=t.outlineColor,p=(0,Se.Z)(_,4),h[0]=p[0],h[1]=p[1],h[2]=p[2],h[3]=p[3]):i<s?c(t.outlineColor,t.fillColor,(i-a)/(s-a)):(v=t.fillColor,m=(0,Se.Z)(v,4),h[4*d+0]=m[0],h[4*d+1]=m[1],h[4*d+2]=m[2],h[4*d+3]=m[3]),f[4*d+0]=255*h[0],f[4*d+1]=255*h[1],f[4*d+2]=255*h[2],f[4*d+3]=255*h[3]}this.minMaxDistance[0]=n,this.minMaxDistance[1]=s,this.shadeTexChanged=!0}},{key:"applyHighlightOptions",value:function(e,t){this.shadeTex||(this.shadeTex=new ye.x(e,{target:Y.No.TEXTURE_2D,pixelFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,wrapMode:Y.e8.CLAMP_TO_EDGE,width:ti,height:1,samplingMode:Y.cw.LINEAR})),this.shadeTexChanged&&(this.shadeTex.updateData(0,0,0,ti,1,this.texelData),this.shadeTexChanged=!1),e.bindTexture(this.shadeTex,pe.Jw),t.setUniform2fv("u_minMaxDistance",this.minMaxDistance)}},{key:"destroy",value:function(){this.shadeTex&&(this.shadeTex.dispose(),this.shadeTex=null)}}]),e}(),li={shaders:{vertexShader:(0,H.w)("highlight/textured.vert"),fragmentShader:(0,H.w)("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},hi={shaders:{vertexShader:(0,H.w)("highlight/textured.vert"),fragmentShader:(0,H.w)("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},ci=i(61109),fi=function(){function e(){(0,o.Z)(this,e),this._width=void 0,this._height=void 0,this._resources=null}return(0,u.Z)(e,[{key:"dispose",value:function(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}},{key:"preBlur",value:function(e,t){e.bindTexture(t,pe.QU),e.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",Jt),e.bindVAO(this._resources.quadVAO),e.drawArrays(Y.MX.TRIANGLE_STRIP,0,4),e.bindVAO()}},{key:"finalBlur",value:function(e,t){e.bindTexture(t,pe.QU),e.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",ei),e.bindVAO(this._resources.quadVAO),e.drawArrays(Y.MX.TRIANGLE_STRIP,0,4),e.bindVAO()}},{key:"renderHighlight",value:function(e,t,i){e.bindTexture(t,pe.QU),e.useProgram(this._resources.highlightProgram),i.applyHighlightOptions(e,this._resources.highlightProgram),e.bindVAO(this._resources.quadVAO),e.setBlendingEnabled(!0),e.setBlendFunction(Y.zi.ONE,Y.zi.ONE_MINUS_SRC_ALPHA),e.drawArrays(Y.MX.TRIANGLE_STRIP,0,4),e.bindVAO()}},{key:"_initialize",value:function(e,t,i){this._width=t,this._height=i;var n=j.f.createVertex(e,Y.l1.STATIC_DRAW,new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]).buffer),r=new Q.U(e,new Map([["a_position",0],["a_texcoord",1]]),{geometry:[new ci.G("a_position",2,Y.g.BYTE,0,4),new ci.G("a_texcoord",2,Y.g.UNSIGNED_BYTE,2,4)]},{geometry:n}),a=(0,K.H)(e,li),s=(0,K.H)(e,hi);e.useProgram(a),a.setUniform1i("u_texture",pe.QU),a.setUniform1i("u_shade",pe.Jw),a.setUniform1f("u_sigma",1),e.useProgram(s),s.setUniform1i("u_texture",pe.QU),s.setUniform1f("u_sigma",1),this._resources={quadGeometry:n,quadVAO:r,highlightProgram:a,blurProgram:s}}},{key:"setup",value:function(e,t,i){this._resources?(this._width=t,this._height=i):this._initialize(e,t,i)}}]),e}(),di=i(53634);function _i(e,t,i){var n=new ye.x(e,{target:Y.No.TEXTURE_2D,pixelFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,wrapMode:Y.e8.CLAMP_TO_EDGE,width:t,height:i,samplingMode:Y.cw.LINEAR});return[n,new di.X(e,{colorTarget:Y.Lm.TEXTURE,depthStencilTarget:Y.OU.STENCIL_RENDER_BUFFER},n)]}var pi=function(){function e(){(0,o.Z)(this,e),this._width=void 0,this._height=void 0,this._resources=null}return(0,u.Z)(e,[{key:"dispose",value:function(){this._resources&&(this._resources.sharedBlur1Tex.dispose(),this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Tex.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)}},{key:"_initialize",value:function(e,t,i){this._width=t,this._height=i;var n=_i(e,t,i),r=(0,Se.Z)(n,2),a=r[0],s=r[1],o=_i(e,t,i),u=(0,Se.Z)(o,2),l=u[0],h=u[1];this._resources={sharedBlur1Tex:a,sharedBlur1Fbo:s,sharedBlur2Tex:l,sharedBlur2Fbo:h}}},{key:"setup",value:function(e,t,i){!this._resources||this._width===t&&this._height===i||this.dispose(),this._resources||this._initialize(e,t,i)}},{key:"sharedBlur1Tex",get:function(){return this._resources.sharedBlur1Tex}},{key:"sharedBlur1Fbo",get:function(){return this._resources.sharedBlur1Fbo}},{key:"sharedBlur2Tex",get:function(){return this._resources.sharedBlur2Tex}},{key:"sharedBlur2Fbo",get:function(){return this._resources.sharedBlur2Fbo}}]),e}(),vi=function(e){(0,f.Z)(i,e);var t=(0,d.Z)(i);function i(){var e;return(0,o.Z)(this,i),(e=t.apply(this,arguments)).defines=["highlight"],e._hlRenderer=new fi,e._hlGradient=new ui,e._width=void 0,e._height=void 0,e._hlSurfaces=new pi,e._adjustedWidth=void 0,e._adjustedHeight=void 0,e._blitRenderer=new $,e}return(0,u.Z)(i,[{key:"dispose",value:function(){this._hlSurfaces&&this._hlSurfaces.dispose(),this._hlRenderer&&this._hlRenderer.dispose(),this._hlGradient&&this._hlGradient.destroy(),this._boundFBO=null}},{key:"bind",value:function(e){var t=e.context,i=e.painter,n=t.getViewport(),r=n.width,a=n.height,s=i.getFbos(r,a).effect0;this.setup(e,r,a),t.bindFramebuffer(s),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}},{key:"unbind",value:function(){}},{key:"setup",value:function(e,t,i){var n=e.context;this._width=t,this._height=i;var r=t%4,a=i%4;t+=r<2?-r:4-r,i+=a<2?-a:4-a,this._adjustedWidth=t,this._adjustedHeight=i,this._boundFBO=n.getBoundFramebufferObject();var s=Math.round(1*t),o=Math.round(1*i);this._hlRenderer.setup(n,s,o),this._hlSurfaces.setup(n,s,o)}},{key:"draw",value:function(e){var t=e.context,i=t.getBoundFramebufferObject();t.setViewport(0,0,1*this._adjustedWidth,1*this._adjustedHeight),t.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),t.setStencilTestEnabled(!1),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._blitRenderer.render(t,i.colorTexture,Y.cw.NEAREST,1),t.setStencilTestEnabled(!1),t.setBlendingEnabled(!1),t.setColorMask(!1,!1,!1,!0),t.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._hlRenderer.preBlur(t,this._hlSurfaces.sharedBlur1Tex),t.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(t,this._hlSurfaces.sharedBlur2Tex),t.bindFramebuffer(this._boundFBO),t.setBlendingEnabled(!0),t.setColorMask(!0,!0,!0,!0),t.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(t,this._hlSurfaces.sharedBlur1Tex,this._hlGradient),this._boundFBO=null}},{key:"setHighlightOptions",value:function(e){this._hlGradient.setHighlightOptions(e)}}]),i}(Ht),mi=function(e){(0,f.Z)(i,e);var t=(0,d.Z)(i);function i(){var e;return(0,o.Z)(this,i),(e=t.apply(this,arguments)).name=e.constructor.name,e.defines=["hittest"],e}return(0,u.Z)(i,[{key:"dispose",value:function(){(0,m.pC)(this._fbo)&&this._fbo.dispose()}},{key:"createOptions",value:function(e,t){var i=e.pixelRatio,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:pe.dn;if(!t.length)return null;var r=t.shift(),a=r.point.x,s=r.point.y;return this._outstanding=r,{type:"hittest",distance:n*i,position:[a,s]}}},{key:"bind",value:function(e){var t=e.context,i=e.attributeView;if(i.size){var n=i.getBlock(pe.pU);if(!(0,m.Wi)(n)){var r=n.getFBO(t);t.setViewport(0,0,i.size,i.size),t.bindFramebuffer(r),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT)}}}},{key:"unbind",value:function(e){}},{key:"draw",value:function(e){var t=e.context,i=e.attributeView.getBlock(pe.pU);if(!(0,m.Wi)(this._outstanding)){var n=this._outstanding.resolver;if((0,m.Wi)(i))return n.resolve([]),void(this._outstanding=null);var r=i.getFBO(t),a=new Uint8Array(r.width*r.height*4);r.readPixels(0,0,r.width,r.height,Y.VI.RGBA,Y.Br.UNSIGNED_BYTE,a);for(var s=[],o=0;o<a.length;o+=4){var u=a[o],l=a[o+3];u&&s.push({id:o/4,directHits:l})}this._outstanding=null,s.sort((function(e,t){return t.directHits===e.directHits?t.id-e.id:t.directHits-e.directHits})),n.resolve(s.map((function(e){return e.id})))}}}]),i}(Ht),gi=function(e){(0,f.Z)(i,e);var t=(0,d.Z)(i);function i(){var e;return(0,o.Z)(this,i),(e=t.apply(this,arguments)).name=e.constructor.name,e.defines=["id"],e._lastSize=0,e}return(0,u.Z)(i,[{key:"dispose",value:function(){(0,m.pC)(this._fbo)&&this._fbo.dispose()}},{key:"bind",value:function(e){var t=e.context,i=e.painter,n=t.getViewport(),r=n.width,a=n.height;this._boundFBO=t.getBoundFramebufferObject();var s=i.getFbos(r,a).effect0;t.bindFramebuffer(s),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}},{key:"unbind",value:function(e){e.context.bindFramebuffer(this._boundFBO),this._boundFBO=null}},{key:"draw",value:function(e,t){var i=this,n=e.context,r=e.state,a=e.pixelRatio,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2*pe.dn,o=n.getBoundFramebufferObject(),u=r.size[1]*a,l=Math.round(s*a),h=l/2,c=l/2;this._ensureBuffer(l),t.forEach((function(e,n){var r=new Map,s=Math.floor(n.x*a-l/2),f=Math.floor(u-n.y*a-l/2);o.readPixels(s,f,l,l,Y.VI.RGBA,Y.Br.UNSIGNED_BYTE,i._buf);for(var d=0;d<i._buf32.length;d++){var _=i._buf32[d];if(4294967295!==_&&0!==_){var p=d%l,v=l-Math.floor(d/l),m=(h-p)*(h-p)+(c-v)*(c-v),g=r.has(_)?r.get(_):4294967295;r.set(_,Math.min(m,g))}}var y=Array.from(r).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}));e.resolve(y),t.delete(n)}))}},{key:"_ensureBuffer",value:function(e){this._lastSize!==e&&(this._lastSize=e,this._buf=new Uint8Array(4*e*e),this._buf32=new Uint32Array(this._buf.buffer))}}]),i}(Ht),yi=[1,0],bi=[0,1],Ei=[1,.8,.6,.4,.2],xi=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],wi=function(){function e(){(0,o.Z)(this,e),this._intensityFBO=null,this._compositeFBO=null,this._mipsFBOs=new Array(5),this._nMips=5,this._kernelSizeArray=[3,5,7,9,11],this._size=[0,0],this._programDesc={luminosityHighPass:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/luminosityHighPass",attributes:new Map([["a_position",0]])},gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}return(0,u.Z)(e,[{key:"dispose",value:function(){if(this._quad&&(this._quad.dispose(),this._quad=null),this._intensityFBO&&(this._intensityFBO.dispose(),this._intensityFBO=null),this._compositeFBO&&(this._compositeFBO.dispose(),this._compositeFBO=null),this._mipsFBOs){for(var e=0;e<this._nMips;e++)this._mipsFBOs[e]&&(this._mipsFBOs[e].horizontal.dispose(),this._mipsFBOs[e].vertical.dispose());this._mipsFBOs=null}}},{key:"draw",value:function(e,t,i){var n=t.width,r=t.height,a=e.context,s=e.painter.materialManager,o=a.gl,u=this._programDesc,l=i.strength,h=i.radius,c=i.threshold;this._quad||(this._quad=new Gt.Z(a,[-1,-1,1,-1,-1,1,1,1])),this._createOrResizeResources(e,n,r),a.setStencilTestEnabled(!1),a.setBlendingEnabled(!0),a.setBlendFunction(Y.zi.ONE,Y.zi.ONE_MINUS_SRC_ALPHA),a.setStencilWriteMask(0);var f=this._quad;f.bind(),a.bindFramebuffer(this._intensityFBO);var d=s.getProgram(u.luminosityHighPass);a.useProgram(d),a.bindTexture(t.colorTexture,0),d.setUniform1i("u_texture",0),d.setUniform3fv("u_defaultColor",[0,0,0]),d.setUniform1f("u_defaultOpacity",0),d.setUniform1f("u_luminosityThreshold",c),d.setUniform1f("u_smoothWidth",.01);var _=[Math.round(n/2),Math.round(r/2)];a.setViewport(0,0,_[0],_[1]),a.setClearColor(0,0,0,0),a.clear(o.COLOR_BUFFER_BIT),f.draw(),a.setBlendingEnabled(!1);for(var p=this._intensityFBO.colorTexture,v=0;v<this._nMips;v++){var m=s.getProgram(u.gaussianBlur,[{name:"radius",value:this._kernelSizeArray[v]}]);a.useProgram(m),a.bindTexture(p,v+1),m.setUniform1i("u_colorTexture",v+1),m.setUniform2fv("u_texSize",_),m.setUniform2fv("u_direction",yi),a.setViewport(0,0,_[0],_[1]);var g=this._mipsFBOs[v];a.bindFramebuffer(g.horizontal),f.draw(),p=g.horizontal.colorTexture,a.bindFramebuffer(g.vertical),a.bindTexture(p,v+1),m.setUniform2fv("u_direction",bi),f.draw(),p=g.vertical.colorTexture,_[0]=Math.round(_[0]/2),_[1]=Math.round(_[1]/2)}a.setViewport(0,0,n,r);var y=s.getProgram(u.composite,[{name:"nummips",value:5}]);a.bindFramebuffer(this._compositeFBO),a.useProgram(y),y.setUniform1f("u_bloomStrength",l),y.setUniform1f("u_bloomRadius",h),y.setUniform1fv("u_bloomFactors",Ei),y.setUniform3fv("u_bloomTintColors",xi),a.bindTexture(this._mipsFBOs[0].vertical.colorTexture,1),y.setUniform1i("u_blurTexture1",1),a.bindTexture(this._mipsFBOs[1].vertical.colorTexture,2),y.setUniform1i("u_blurTexture2",2),a.bindTexture(this._mipsFBOs[2].vertical.colorTexture,3),y.setUniform1i("u_blurTexture3",3),a.bindTexture(this._mipsFBOs[3].vertical.colorTexture,4),y.setUniform1i("u_blurTexture4",4),a.bindTexture(this._mipsFBOs[4].vertical.colorTexture,5),y.setUniform1i("u_blurTexture5",5),f.draw(),a.bindFramebuffer(t),a.setBlendingEnabled(!0);var b=s.getProgram(u.blit);a.useProgram(b),a.bindTexture(this._compositeFBO.colorTexture,6),b.setUniform1i("u_texture",6),a.setBlendFunction(Y.zi.ONE,Y.zi.ONE),f.draw(),f.unbind(),a.setBlendFunction(Y.zi.ONE,Y.zi.ONE_MINUS_SRC_ALPHA),a.setStencilTestEnabled(!0)}},{key:"_createOrResizeResources",value:function(e,t,i){var n=e.context;if(!this._compositeFBO||this._size[0]!==t||this._size[1]!==i){this._size[0]=t,this._size[1]=i;var r=[Math.round(t/2),Math.round(i/2)];this._compositeFBO?this._compositeFBO.resize(t,i):this._compositeFBO=new di.X(n,{colorTarget:Y.Lm.TEXTURE,depthStencilTarget:Y.OU.NONE,width:t,height:i}),this._intensityFBO?this._intensityFBO.resize(r[0],r[1]):this._intensityFBO=new di.X(n,{colorTarget:Y.Lm.TEXTURE,depthStencilTarget:Y.OU.NONE,width:r[0],height:r[1]},{target:Y.No.TEXTURE_2D,pixelFormat:Y.VI.RGBA,internalFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,wrapMode:Y.e8.CLAMP_TO_EDGE,samplingMode:Y.cw.LINEAR,flipped:!1,width:r[0],height:r[1]});for(var a=0;a<this._nMips;a++)this._mipsFBOs[a]?(this._mipsFBOs[a].horizontal.resize(r[0],r[1]),this._mipsFBOs[a].vertical.resize(r[0],r[1])):this._mipsFBOs[a]={horizontal:new di.X(n,{colorTarget:Y.Lm.TEXTURE,depthStencilTarget:Y.OU.NONE,width:r[0],height:r[1]},{target:Y.No.TEXTURE_2D,pixelFormat:Y.VI.RGBA,internalFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,wrapMode:Y.e8.CLAMP_TO_EDGE,samplingMode:Y.cw.LINEAR,flipped:!1,width:r[0],height:r[1]}),vertical:new di.X(n,{colorTarget:Y.Lm.TEXTURE,depthStencilTarget:Y.OU.NONE,width:r[0],height:r[1]},{target:Y.No.TEXTURE_2D,pixelFormat:Y.VI.RGBA,internalFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,wrapMode:Y.e8.CLAMP_TO_EDGE,samplingMode:Y.cw.LINEAR,flipped:!1,width:r[0],height:r[1]})},r[0]=Math.round(r[0]/2),r[1]=Math.round(r[1]/2)}}}]),e}(),Ti=[1,0],Ri=[0,1],Fi=function(){function e(){(0,o.Z)(this,e),this._blurFBO=null,this._size=[0,0],this._programDesc={gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},radialBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/radial-blur",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}return(0,u.Z)(e,[{key:"dispose",value:function(){this._blurFBO&&(this._blurFBO.dispose(),this._blurFBO=null)}},{key:"draw",value:function(e,t,i){var n=e.context,r=i.type,a=i.radius;if(0!==a){this._createOrResizeResources(e),this._quad||(this._quad=new Gt.Z(n,[-1,-1,1,-1,-1,1,1,1]));var s=this._quad;s.bind(),"blur"===r?this._gaussianBlur(e,t,a):this._radialBlur(e,t),s.unbind()}}},{key:"_gaussianBlur",value:function(e,t,i){var n=e.context,r=e.state,a=e.painter,s=e.pixelRatio,o=r.size,u=a.materialManager,l=this._programDesc,h=this._quad,c=[Math.round(s*o[0]),Math.round(s*o[1])],f=this._blurFBO,d=u.getProgram(l.gaussianBlur,[{name:"radius",value:Math.ceil(i)}]);n.useProgram(d),n.setBlendingEnabled(!1),n.bindFramebuffer(f),n.bindTexture(t.colorTexture,4),d.setUniform1i("u_colorTexture",4),d.setUniform2fv("u_texSize",c),d.setUniform2fv("u_direction",Ti),d.setUniform1f("u_sigma",i),h.draw(),n.bindFramebuffer(t),n.setStencilWriteMask(0),n.setStencilTestEnabled(!1),n.setDepthWriteEnabled(!1),n.setDepthTestEnabled(!1),n.bindTexture(f.colorTexture,5),d.setUniform1i("u_colorTexture",5),d.setUniform2fv("u_direction",Ri),h.draw(),n.setBlendingEnabled(!0),n.setBlendFunction(Y.zi.ONE,Y.zi.ONE_MINUS_SRC_ALPHA),n.setStencilTestEnabled(!0)}},{key:"_radialBlur",value:function(e,t){var i=e.context,n=e.painter.materialManager,r=this._programDesc,a=this._quad,s=this._blurFBO;i.bindFramebuffer(s);var o=n.getProgram(r.radialBlur);i.useProgram(o),i.setBlendingEnabled(!1),i.bindTexture(t.colorTexture,4),o.setUniform1i("u_colorTexture",4),a.draw(),i.bindFramebuffer(t),i.setStencilWriteMask(0),i.setStencilTestEnabled(!1),i.setDepthWriteEnabled(!1),i.setDepthTestEnabled(!1),i.setBlendingEnabled(!0);var u=n.getProgram(r.blit);i.useProgram(u),i.bindTexture(s.colorTexture,5),u.setUniform1i("u_texture",5),i.setBlendFunction(Y.zi.ONE,Y.zi.ONE_MINUS_SRC_ALPHA),a.draw()}},{key:"_createOrResizeResources",value:function(e){var t=e.context,i=e.state,n=e.pixelRatio,r=i.size,a=Math.round(n*r[0]),s=Math.round(n*r[1]);this._blurFBO&&this._size[0]===a&&this._size[1]===s||(this._size[0]=a,this._size[1]=s,this._blurFBO?this._blurFBO.resize(a,s):this._blurFBO=new di.X(t,{colorTarget:Y.Lm.TEXTURE,depthStencilTarget:Y.OU.NONE,width:a,height:s},{target:Y.No.TEXTURE_2D,pixelFormat:Y.VI.RGBA,internalFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,wrapMode:Y.e8.CLAMP_TO_EDGE,samplingMode:Y.cw.LINEAR,flipped:!1,width:a,height:s}))}}]),e}(),Bi=function(){function e(){(0,o.Z)(this,e),this._size=[0,0],this._programDesc={vsPath:"post-processing/pp",fsPath:"post-processing/filterEffect",attributes:new Map([["a_position",0]])}}return(0,u.Z)(e,[{key:"dispose",value:function(){this._layerFBOTexture&&(this._layerFBOTexture.dispose(),this._layerFBOTexture=null)}},{key:"draw",value:function(e,t,i){var n=t.width,r=t.height;this._createOrResizeResources(e,n,r);var a=e.context,s=e.painter.materialManager,o=this._programDesc,u=this._quad,l=i.colorMatrix;u.bind();var h=this._layerFBOTexture;a.bindFramebuffer(t),t.copyToTexture(0,0,n,r,0,0,h),a.setBlendingEnabled(!1),a.setStencilTestEnabled(!1);var c=s.getProgram(o);a.useProgram(c),a.bindTexture(h,2),c.setUniformMatrix4fv("u_coefficients",l),c.setUniform1i("u_colorTexture",2),u.draw(),a.setBlendingEnabled(!0),a.setBlendFunction(Y.zi.ONE,Y.zi.ONE_MINUS_SRC_ALPHA),a.setStencilTestEnabled(!0),u.unbind()}},{key:"_createOrResizeResources",value:function(e,t,i){var n=e.context;this._layerFBOTexture&&this._size[0]===t&&this._size[1]===i||(this._size[0]=t,this._size[1]=i,this._layerFBOTexture?this._layerFBOTexture.resize(t,i):this._layerFBOTexture=new ye.x(n,{target:Y.No.TEXTURE_2D,pixelFormat:Y.VI.RGBA,internalFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,wrapMode:Y.e8.CLAMP_TO_EDGE,samplingMode:Y.cw.LINEAR,flipped:!1,width:t,height:i}),this._quad||(this._quad=new Gt.Z(n,[-1,-1,1,-1,-1,1,1,1])))}}]),e}(),Ai=[1,0],ki=[0,1],Ci=function(){function e(){(0,o.Z)(this,e),this._horizontalBlurFBO=null,this._verticalBlurFBO=null,this._size=[0,0],this._programDesc={blur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/drop-shadow/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}return(0,u.Z)(e,[{key:"dispose",value:function(){this._layerFBOTexture&&(this._layerFBOTexture.dispose(),this._layerFBOTexture=null),this._horizontalBlurFBO&&(this._horizontalBlurFBO.dispose(),this._horizontalBlurFBO=null),this._verticalBlurFBO&&(this._verticalBlurFBO.dispose(),this._verticalBlurFBO=null)}},{key:"draw",value:function(e,t,i){var n=e.context,r=e.state,a=e.painter.materialManager,s=this._programDesc,o=t.width,u=t.height,l=[Math.round(o/2),Math.round(u/2)],h=i.blurRadius,c=i.offsetX,f=i.offsetY,d=i.color,_=[(0,ce.F2)(c/2),(0,ce.F2)(f/2)];this._createOrResizeResources(e,o,u,l);var p=this._horizontalBlurFBO,v=this._verticalBlurFBO;n.setStencilWriteMask(0),n.setStencilTestEnabled(!1),n.setDepthWriteEnabled(!1),n.setDepthTestEnabled(!1);var m=this._layerFBOTexture;t.copyToTexture(0,0,o,u,0,0,m),this._quad||(this._quad=new Gt.Z(n,[-1,-1,1,-1,-1,1,1,1])),n.setViewport(0,0,l[0],l[1]);var g=this._quad;g.bind(),n.setBlendingEnabled(!1);var y=a.getProgram(s.blur,[{name:"radius",value:Math.ceil(h)}]);n.useProgram(y),n.bindFramebuffer(p),n.bindTexture(t.colorTexture,4),y.setUniform1i("u_colorTexture",4),y.setUniform2fv("u_texSize",l),y.setUniform2fv("u_direction",Ai),y.setUniform1f("u_sigma",h),g.draw(),n.bindFramebuffer(v),n.bindTexture(p.colorTexture,5),y.setUniform1i("u_colorTexture",5),y.setUniform2fv("u_direction",ki),g.draw(),n.bindFramebuffer(t),n.setViewport(0,0,o,u);var b=a.getProgram(s.composite);n.useProgram(b),n.bindTexture(v.colorTexture,2),b.setUniform1i("u_blurTexture",2),n.bindTexture(m,3),b.setUniform1i("u_layerFBOTexture",3),b.setUniform4fv("u_shadowColor",[d[3]*(d[0]/255),d[3]*(d[1]/255),d[3]*(d[2]/255),d[3]]),b.setUniformMatrix3fv("u_displayViewMat3",r.displayMat3),b.setUniform2fv("u_shadowOffset",_),g.draw(),n.setBlendingEnabled(!0),n.setStencilTestEnabled(!0),n.setBlendFunction(Y.zi.ONE,Y.zi.ONE_MINUS_SRC_ALPHA),g.unbind()}},{key:"_createOrResizeResources",value:function(e,t,i,n){var r=e.context;this._horizontalBlurFBO&&this._size[0]===t&&this._size[1]===i||(this._size[0]=t,this._size[1]=i,this._horizontalBlurFBO?this._horizontalBlurFBO.resize(n[0],n[1]):this._horizontalBlurFBO=new di.X(r,{colorTarget:Y.Lm.TEXTURE,depthStencilTarget:Y.OU.NONE,width:n[0],height:n[1]},{target:Y.No.TEXTURE_2D,pixelFormat:Y.VI.RGBA,internalFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,wrapMode:Y.e8.CLAMP_TO_EDGE,samplingMode:Y.cw.LINEAR,flipped:!1,width:n[0],height:n[1]}),this._verticalBlurFBO?this._verticalBlurFBO.resize(n[0],n[1]):this._verticalBlurFBO=new di.X(r,{colorTarget:Y.Lm.TEXTURE,depthStencilTarget:Y.OU.NONE,width:n[0],height:n[1]},{target:Y.No.TEXTURE_2D,pixelFormat:Y.VI.RGBA,internalFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,wrapMode:Y.e8.CLAMP_TO_EDGE,samplingMode:Y.cw.LINEAR,flipped:!1,width:n[0],height:n[1]}),this._layerFBOTexture?this._layerFBOTexture.resize(t,i):this._layerFBOTexture=new ye.x(r,{target:Y.No.TEXTURE_2D,pixelFormat:Y.VI.RGBA,internalFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,wrapMode:Y.e8.CLAMP_TO_EDGE,samplingMode:Y.cw.LINEAR,flipped:!1,width:t,height:i}))}}]),e}(),Si=function(){function e(){(0,o.Z)(this,e),this._size=[0,0]}return(0,u.Z)(e,[{key:"dispose",value:function(){this._layerFBOTexture&&(this._layerFBOTexture.dispose(),this._layerFBOTexture=null)}},{key:"draw",value:function(e,t,i){var n=t.width,r=t.height;this._createOrResizeResources(e,n,r);var a=e.context,s=e.painter,o=i.amount,u=a.gl,l=this._layerFBOTexture;a.bindFramebuffer(t),t.copyToTexture(0,0,n,r,0,0,l),a.setBlendingEnabled(!0),a.setStencilTestEnabled(!1),a.setDepthTestEnabled(!1),a.setClearColor(0,0,0,0),a.clear(u.COLOR_BUFFER_BIT),s.blitTexture(a,l,Y.cw.NEAREST,o)}},{key:"_createOrResizeResources",value:function(e,t,i){var n=e.context;this._layerFBOTexture&&this._size[0]===t&&this._size[1]===i||(this._size[0]=t,this._size[1]=i,this._layerFBOTexture?this._layerFBOTexture.resize(t,i):this._layerFBOTexture=new ye.x(n,{target:Y.No.TEXTURE_2D,pixelFormat:Y.VI.RGBA,internalFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,wrapMode:Y.e8.CLAMP_TO_EDGE,samplingMode:Y.cw.NEAREST,flipped:!1,width:t,height:i}))}}]),e}();function Oi(e){switch(e){case"bloom":case"blur":case"opacity":case"drop-shadow":return e;default:return"colorize"}}var Mi={colorize:function(){return new Bi},blur:function(){return new Fi},bloom:function(){return new wi},opacity:function(){return new Si},"drop-shadow":function(){return new Ci}},Ii=function(){function e(){(0,o.Z)(this,e),this._effectMap=new Map}return(0,u.Z)(e,[{key:"dispose",value:function(){this._effectMap.forEach((function(e){return e.dispose()})),this._effectMap.clear()}},{key:"getPostProcessingEffects",value:function(e){if(!e||0===e.length)return[];var t,i=[],n=(0,s.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=Oi(r.type),o=this._effectMap.get(a);o||(o=Mi[a](),this._effectMap.set(a,o)),i.push({postProcessingEffect:o,effect:r})}}catch(u){n.e(u)}finally{n.f()}return i}}]),e}(),Pi=i(63780),Di=function(){function e(t,i){var n;(0,o.Z)(this,e),this.brushes=t,this.name=i.name,this.drawPhase=i.drawPhase||w.jx.MAP,this._targetFn=i.target,this.effects=i.effects||[],this.enableDefaultDraw=null!==(n=i.enableDefaultDraw)&&void 0!==n?n:function(){return!0}}return(0,u.Z)(e,[{key:"render",value:function(e){var t=e.context,i=e.profiler,n=this._targetFn(),r=this.drawPhase&e.drawPhase;if(i.recordPassStart(this.name),r){this.enableDefaultDraw()&&this._doRender(e,n),i.recordPassEnd();var a,o=(0,s.Z)(this.effects);try{for(o.s();!(a=o.n()).done;){var u=a.value;if(u.enable()){var l=u.apply;i.recordPassStart(this.name+"."+l.name),i.recordBrushStart(l.name);var h=u.args&&u.args(),c=t.getViewport(),f=c.x,d=c.y,_=c.width,p=c.height,v=t.getBoundFramebufferObject();l.bind(e,h);var m=l.createOptions(e,h),g=e.passOptions;e.passOptions=m,this._doRender(e,n,l.defines),e.passOptions=g,l.draw(e,h),l.unbind(e,h),t.bindFramebuffer(v),t.setViewport(f,d,_,p),i.recordBrushEnd(),i.recordPassEnd()}}}catch(y){o.e(y)}finally{o.f()}}}},{key:"_doRender",value:function(e,t,i){if(!(0,m.Wi)(t))if((0,Pi.zG)(t)){var n,r=(0,s.Z)(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.visible){var o,u=(0,s.Z)(this.brushes);try{for(u.s();!(o=u.n()).done;){var l=o.value;e.profiler.recordBrushStart(l.name),l.prepareState(e,a,i),l.draw(e,a,i),e.profiler.recordBrushEnd()}}catch(d){u.e(d)}finally{u.f()}}}}catch(d){r.e(d)}finally{r.f()}}else{var h,c=(0,s.Z)(this.brushes);try{for(c.s();!(h=c.n()).done;){var f=h.value;e.profiler.recordBrushStart(f.name),f.prepareState(e,t,i),f.draw(e,t,i),e.profiler.recordBrushEnd()}}catch(d){c.e(d)}finally{c.f()}}}}]),e}(),Ui=i(15880);var Ni=function(){function e(t,i,n){(0,o.Z)(this,e),this.context=t,this._blitRenderer=new $,this._worldExtentClipRenderer=new Xt,this._isClippedToWorldExtent=!1,this._brushCache=new Map,this._vtlMaterialManager=new W,this._blendEffect=new Qt,this._fboPool=[],this.effects={highlight:new vi,hittest:new mi,hittestVTL:new gi,integrate:new qt,insideEffect:new $t("inside"),outsideEffect:new $t("outside")},this.materialManager=new ae(t),this.textureManager=new Dt(i,n),this._effectsManager=new Ii}return(0,u.Z)(e,[{key:"vectorTilesMaterialManager",get:function(){return this._vtlMaterialManager}},{key:"getRenderTarget",value:function(){return this._renderTarget}},{key:"setRenderTarget",value:function(e){this._renderTarget=e}},{key:"getFbos",value:function(e,t){if(e!==this._lastWidth||t!==this._lastHeight){if(this._lastWidth=e,this._lastHeight=t,this._fbos){for(var i in this._fbos)this._fbos[i].resize(e,t);return this._fbos}var n={target:Y.No.TEXTURE_2D,pixelFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,samplingMode:Y.cw.NEAREST,wrapMode:Y.e8.CLAMP_TO_EDGE,width:e,height:t},r={colorTarget:Y.Lm.TEXTURE,depthStencilTarget:Y.OU.DEPTH_STENCIL_RENDER_BUFFER},a=new Ui.r(this.context,{width:e,height:t,internalFormat:Y.Tg.DEPTH_STENCIL});this._stencilBuf=a,this._fbos={output:new di.X(this.context,r,n,a),blend:new di.X(this.context,r,n,a),effect0:new di.X(this.context,r,n,a)}}return this._fbos}},{key:"acquireFbo",value:function(e,t){var i,n=(i=this._fboPool.length>0?this._fboPool.pop():new di.X(this.context,{colorTarget:Y.Lm.TEXTURE,depthStencilTarget:Y.OU.DEPTH_STENCIL_RENDER_BUFFER},{target:Y.No.TEXTURE_2D,pixelFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,samplingMode:Y.cw.NEAREST,wrapMode:Y.e8.CLAMP_TO_EDGE,width:e,height:t},this._stencilBuf)).descriptor;return n.width===e&&n.height===t||i.resize(e,t),i}},{key:"releaseFbo",value:function(e){this._fboPool.push(e)}},{key:"getSharedStencilBuffer",value:function(){return this._stencilBuf}},{key:"beforeRenderLayers",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=e.getViewport(),n=i.width,r=i.height;this._prevFBO=e.getBoundFramebufferObject();var a=this.getFbos(n,r);if(e.bindFramebuffer(a.output),e.setColorMask(!0,!0,!0,!0),(0,m.pC)(t)){var s=t.color,o=s.r,u=s.g,l=s.b,h=s.a;e.setClearColor(h*o/255,h*u/255,h*l/255,h)}else e.setClearColor(0,0,0,0);e.setDepthWriteEnabled(!0),e.setClearDepth(1),e.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT),e.setDepthWriteEnabled(!1)}},{key:"beforeRenderLayer",value:function(e,t,i){var n=e.context,r=e.blendMode,a=e.effects,s=e.requireFBO,o=e.drawPhase;if(s||Li(o,r,a,i))n.bindFramebuffer(this._fbos.blend),n.setColorMask(!0,!0,!0,!0),n.setClearColor(0,0,0,0),n.setDepthWriteEnabled(!0),n.setClearDepth(1),n.clear(n.gl.COLOR_BUFFER_BIT|n.gl.DEPTH_BUFFER_BIT),n.setDepthWriteEnabled(!1);else{var u=this._getOutputFBO();n.bindFramebuffer(u)}n.setDepthWriteEnabled(!1),n.setDepthTestEnabled(!1),n.setStencilTestEnabled(!0),n.setClearStencil(t),n.setStencilWriteMask(255),n.clear(n.gl.STENCIL_BUFFER_BIT)}},{key:"compositeLayer",value:function(e,t){var i=e.context,n=e.blendMode,r=e.effects,a=e.requireFBO,s=e.drawPhase;if(a||Li(s,n,r,t)){(0,m.pC)(r)&&r.length>0&&s===w.jx.MAP&&this._applyEffects(e,r);var o=this._getOutputFBO();i.bindFramebuffer(o),i.setStencilTestEnabled(!1),i.setStencilWriteMask(0),i.setBlendingEnabled(!0),i.setBlendFunctionSeparate(Y.zi.ONE,Y.zi.ONE_MINUS_SRC_ALPHA,Y.zi.ONE,Y.zi.ONE_MINUS_SRC_ALPHA),i.setColorMask(!0,!0,!0,!0);var u=(0,m.Wi)(n)||s===w.jx.HIGHLIGHT?"normal":n;this._blendEffect.draw(e,this._fbos.blend.colorTexture,Y.cw.NEAREST,u,t)}}},{key:"renderLayers",value:function(e){if(e.bindFramebuffer(this._prevFBO),this._fbos){var t=this._getOutputFBO();e.setDepthTestEnabled(!1),e.setStencilWriteMask(0),this._isClippedToWorldExtent?(e.setStencilTestEnabled(!0),e.setStencilFunction(Y.wb.EQUAL,1,255)):e.setStencilTestEnabled(!1),this.blitTexture(e,t.colorTexture,Y.cw.NEAREST)}}},{key:"prepareDisplay",value:function(e,t,i){var n=e.context;if(n.bindFramebuffer(this._prevFBO),n.setColorMask(!0,!0,!0,!0),(0,m.pC)(t)){var r=t.color,a=r.r,s=r.g,o=r.b,u=r.a;n.setClearColor(u*a/255,u*s/255,u*o/255,u)}else n.setClearColor(0,0,0,0);n.setStencilWriteMask(255),n.setClearStencil(0),n.clear(n.gl.COLOR_BUFFER_BIT|n.gl.STENCIL_BUFFER_BIT),this._isClippedToWorldExtent=this._worldExtentClipRenderer.render(e,i)}},{key:"dispose",value:function(){if(this.materialManager.dispose(),this.textureManager.dispose(),this._blitRenderer=(0,m.O3)(this._blitRenderer),this._worldExtentClipRenderer=(0,m.O3)(this._worldExtentClipRenderer),this._brushCache&&(this._brushCache.forEach((function(e){return e.dispose()})),this._brushCache.clear(),this._brushCache=null),this._fbos)for(var e in this._fbos)this._fbos[e]&&this._fbos[e].dispose();var t,i=(0,s.Z)(this._fboPool);try{for(i.s();!(t=i.n()).done;){t.value.dispose()}}catch(r){i.e(r)}finally{i.f()}if(this._fboPool.length=0,this.effects)for(var n in this.effects)this.effects[n]&&this.effects[n].dispose();this._effectsManager.dispose(),this._vtlMaterialManager=(0,m.O3)(this._vtlMaterialManager),this._prevFBO=null}},{key:"getBrush",value:function(e,t){var i=function(e,t){switch(e){case w.LW.LINE:return T.U.line;case w.LW.TEXT:return T.U.text;case w.LW.LABEL:return T.U.label;case w.LW.FILL:return t===w.mD.DOT_DENSITY?T.U.dotDensity:T.U.fill;case w.LW.MARKER:switch(t){case w.mD.HEATMAP:return T.U.heatmap;case w.mD.PIE_CHART:return T.U.pieChart;default:return T.U.marker}}}(e,t),n=this._brushCache.get(i);return void 0===n&&(n=new i,this._brushCache.set(i,n)),this._brushCache.get(i)}},{key:"renderObject",value:function(e,t,i,n){var r=T.U[i];if(!r)return null;var a=this._brushCache.get(r);void 0===a&&(a=new r,this._brushCache.set(r,a)),a.prepareState(e,t,n),a.draw(e,t,n)}},{key:"renderObjects",value:function(e,t,i,n){var r=T.U[i];if(!r)return null;var a=this._brushCache.get(r);void 0===a&&(a=new r,this._brushCache.set(r,a)),a.drawMany(e,t,n)}},{key:"registerRenderPass",value:function(e){var t=this,i=e.brushes.map((function(e){return t._brushCache.has(e)||t._brushCache.set(e,new e),t._brushCache.get(e)}));return new Di(i,e)}},{key:"setHighlightOptions",value:function(e){this.effects.highlight.setHighlightOptions(e)}},{key:"blitTexture",value:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(Y.zi.ONE,Y.zi.ONE_MINUS_SRC_ALPHA,Y.zi.ONE,Y.zi.ONE_MINUS_SRC_ALPHA),e.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(e,t,i,n)}},{key:"getPostProcessingEffects",value:function(e){return this._effectsManager.getPostProcessingEffects(e)}},{key:"_getOutputFBO",value:function(){return null!=this._renderTarget?this._renderTarget:this._fbos.output}},{key:"_applyEffects",value:function(e,t){var i,n=e.context,r=this._effectsManager.getPostProcessingEffects(t),a=(0,s.Z)(r);try{for(a.s();!(i=a.n()).done;){var o=i.value,u=o.postProcessingEffect,l=o.effect;n.bindFramebuffer(this._fbos.blend),u.draw(e,this._fbos.blend,l)}}catch(h){a.e(h)}finally{a.f()}}}]),e}();function Li(e,t,i,n){return e!==w.jx.HIGHLIGHT&&(1!==n||(0,m.pC)(t)&&"normal"!==t||(0,m.pC)(i)&&i.length>0)}var Zi=i(43244),zi=i(91505),Gi=i(30308),Vi=(0,u.Z)((function e(t,i,n,r,a,s,u,l){(0,o.Z)(this,e),this.createQuery=t,this.resultAvailable=i,this.getResult=n,this.disjoint=r,this.beginTimeElapsed=a,this.endTimeElapsed=s,this.createTimestamp=u,this.timestampBits=l}));function Wi(e,t){if(t.disjointTimerQuery)return null;var i=e.getExtension("EXT_disjoint_timer_query_webgl2");return i&&(0,Gi.Z)(e)?new Vi((function(){return e.createQuery()}),(function(t){return e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE)}),(function(t){return e.getQueryParameter(t,e.QUERY_RESULT)}),(function(){return e.getParameter(i.GPU_DISJOINT_EXT)}),(function(t){return e.beginQuery(i.TIME_ELAPSED_EXT,t)}),(function(){return e.endQuery(i.TIME_ELAPSED_EXT)}),(function(e){return i.queryCounterEXT(e,i.TIMESTAMP_EXT)}),(function(){return e.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)})):(i=e.getExtension("EXT_disjoint_timer_query"))?new Vi((function(){return i.createQueryEXT()}),(function(e){return i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT)}),(function(e){return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)}),(function(){return e.getParameter(i.GPU_DISJOINT_EXT)}),(function(e){return i.beginQueryEXT(i.TIME_ELAPSED_EXT,e)}),(function(){return i.endQueryEXT(i.TIME_ELAPSED_EXT)}),(function(e){return i.queryCounterEXT(e,i.TIMESTAMP_EXT)}),(function(){return i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)})):null}var Xi=(0,v.Z)("esri-2d-profiler"),Hi=function(){function e(t,i){var n=this;if((0,o.Z)(this,e),this._events=new zi.Z,this._entries=new Map,this._timings=new Zi.Z(10),Xi){this._ext=Wi(t.gl,{}),this._debugOutput=i;var r=t.gl;if(this.enableCommandLogging){var a=function(e){if("function"==typeof r[e]){var t=r[e],i=e.includes("draw");r[e]=function(){for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return n._events.emit("command",{container:n._currentContainer,pass:n._currentPass,brush:n._currentBrush,method:e,args:s,isDrawCommand:i}),n._currentSummary&&(n._currentSummary.commands++,i&&n._currentSummary.drawCommands++),t.apply(r,s)}}};for(var s in r)a(s)}}}return(0,u.Z)(e,[{key:"enableCommandLogging",get:function(){return!("object"==typeof Xi&&Xi.disableCommands)}},{key:"recordContainerStart",value:function(e){Xi&&(this._currentContainer=e)}},{key:"recordContainerEnd",value:function(){Xi&&(this._currentContainer=null)}},{key:"recordPassStart",value:function(e){Xi&&(this._currentPass=e,this._initSummary())}},{key:"recordPassEnd",value:function(){Xi&&(this._currentPass=null,this._emitSummary())}},{key:"recordBrushStart",value:function(e){Xi&&(this._currentBrush=e)}},{key:"recordBrushEnd",value:function(){Xi&&(this._currentBrush=null)}},{key:"recordStart",value:function(e){if(Xi&&(0,m.pC)(this._ext)){if(this._entries.has(e)){var t=this._entries.get(e),i=this._ext.resultAvailable(t.query),n=this._ext.disjoint();if(i&&!n){var r=this._ext.getResult(t.query)/1e6,a=0;if((0,m.pC)(this._timings.enqueue(r))){var o,u=this._timings.entries,l=u.length,h=0,c=(0,s.Z)(u);try{for(c.s();!(o=c.n()).done;){h+=o.value}}catch(g){c.e(g)}finally{c.f()}a=h/l}var f=r.toFixed(2),d=a?a.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed("Frame report for ".concat(e,", ").concat(f," ms (").concat(d," last 10 avg)\n").concat(t.commandsLen," Commands (").concat(t.drawCommands," draw)")),console.log("RenderPass breakdown: "),console.table(t.summaries),console.log("Commands: ",t.commands),console.groupEnd()):console.log("Frame report for ".concat(e,", ").concat(f," ms (").concat(d," last 10 avg)")),this._debugOutput.innerHTML="".concat(f," (").concat(d,")")}var _,p=(0,s.Z)(t.handles);try{for(p.s();!(_=p.n()).done;){_.value.remove()}}catch(g){p.e(g)}finally{p.f()}this._entries.delete(e)}var v={name:e,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(v.handles.push(this._events.on("command",(function(e){v.commandsLen++,v.commands.push(e),e.isDrawCommand&&v.drawCommands++}))),v.handles.push(this._events.on("summary",(function(e){v.summaries.push(e)})))),this._ext.beginTimeElapsed(v.query),this._entries.set(e,v)}}},{key:"recordEnd",value:function(e){Xi&&(0,m.pC)(this._ext)&&this._entries.has(e)&&this._ext.endTimeElapsed()}},{key:"_initSummary",value:function(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}},{key:"_emitSummary",value:function(){this.enableCommandLogging&&this._events.emit("summary",this._currentSummary)}}]),e}(),qi=i(84786),ji=i(7796),Yi=i(49800),Ki=i(37825),Qi=(0,u.Z)((function e(){(0,o.Z)(this,e),this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Y.zi.ONE,dstRGB:Y.zi.ZERO,srcAlpha:Y.zi.ONE,dstAlpha:Y.zi.ZERO},this.blendEquation={mode:Y.db.ADD,modeAlpha:Y.db.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Y.LR.BACK,this.frontFace=Y.Wf.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Y.wb.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Y.LR.FRONT_AND_BACK,func:Y.wb.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Y.LR.FRONT_AND_BACK,fail:Y.xS.KEEP,zFail:Y.xS.KEEP,zPass:Y.xS.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array})),$i=function(){function e(t){(0,o.Z)(this,e),this._allocations=new Map,t?Error.stackTraceLimit=1/0:(this.add=function(){},this.remove=function(){})}return(0,u.Z)(e,[{key:"add",value:function(e){this._allocations.set(e,(new Error).stack)}},{key:"remove",value:function(e){this._allocations.delete(e)}},{key:"print",value:function(){if(this._allocations.size>0){console.log("".concat(this._allocations.size," live object allocations:"));var e=new Map;this._allocations.forEach((function(t){var i;e.set(t,(null!==(i=e.get(t))&&void 0!==i?i:0)+1)})),e.forEach((function(e,t){var i=t.split("\n");i.shift(),i.shift(),console.log("".concat(e,": ").concat(i.shift())),i.forEach((function(e){return console.log("   ",e)}))}))}}}]),e}(),Ji=!1,en=function(){function e(){for((0,o.Z)(this,e),this._current=new Array,this._max=new Array,this._allocations=new $i(Ji);this._current.length<Y._g.COUNT;)this._current.push(0),this._max.push(0)}return(0,u.Z)(e,[{key:"resetMax",value:function(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}},{key:"increment",value:function(e,t){var i=++this._current[e];this._max[e]=Math.max(i,this._max[e]),this._allocations.add(t)}},{key:"decrement",value:function(e,t){--this._current[e],this._allocations.remove(t)}},{key:"max",get:function(){return this._max}},{key:"current",get:function(){return this._current}},{key:"total",get:function(){return this.current.reduce((function(e,t){return e+t}),0)}},{key:"printResourceCount",value:function(){if(this.total>0){console.log("Live objects:");for(var e=0;e<Y._g.COUNT;++e){var t=this._current[e];t>0&&console.log("".concat(Y._g[e],": ").concat(t))}}this._allocations.print()}}]),e}(),tn=i(68267),nn=i(36207),rn=i(3384),an=i(43411);function sn(e,t){var i=new di.X(e,{colorTarget:Y.Lm.TEXTURE,depthStencilTarget:Y.OU.NONE},{target:Y.No.TEXTURE_2D,wrapMode:Y.e8.CLAMP_TO_EDGE,pixelFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,samplingMode:Y.cw.NEAREST,width:1,height:1});var n=j.f.createVertex(e,Y.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),r=new Q.U(e,new Map([["position",0]]),{geometry:[new ci.G("position",2,Y.g.UNSIGNED_SHORT,0,4)]},{geometry:n}),a=(0,zt.f)(5633261.287538229,2626832.878767164,1434988.0495278358),s=(0,zt.f)(5633271.46742708,2626873.6381334523,1434963.231608387),o=function(i,n){var r="\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ".concat(t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":"","\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  "),a=e.programCache.acquire(r,"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",new Map([["position",0]])),s=new Float32Array(6);(0,an.LF)(i,s,3);var o=new Float32Array(6);return(0,an.LF)(n,o,3),e.useProgram(a),a.setUniform3f("u_highA",s[0],s[2],s[4]),a.setUniform3f("u_lowA",s[1],s[3],s[5]),a.setUniform3f("u_highB",o[0],o[2],o[4]),a.setUniform3f("u_lowB",o[1],o[3],o[5]),a}(a,s),u=e.getBoundFramebufferObject(),l=e.getViewport(),h=l.x,c=l.y,f=l.width,d=l.height;e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.bindVAO(r),e.drawArrays(Y.MX.TRIANGLE_STRIP,0,4);var _=new Uint8Array(4);i.readPixels(0,0,1,1,Y.VI.RGBA,Y.Br.UNSIGNED_BYTE,_),o.dispose(),r.dispose(!1),n.dispose(),i.dispose(),e.setViewport(h,c,f,d),e.bindFramebuffer(u);var p=(a[2]-s[2])/25,v=(0,Ae.v)(_);return Math.abs(p-v)}var on,un,ln,hn=i(78041),cn={exports:{}};on=cn,un=function(){var e=function(e){var t;window.console&&window.console.error?window.console.error(e):(t=e,window.console&&window.console.log&&window.console.log(t))},t={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},i=null,n=null;function r(e){if(null==i)for(var t in i={},n={},e)"number"==typeof e[t]&&(i[e[t]]=t,n[t]=e[t])}function a(){if(null==i)throw"WebGLDebugUtils.init(ctx) not called"}function s(e){a();var t=i[e];return void 0!==t?"gl."+t:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function o(e,i,r,a){var o;if(void 0!==(o=t[e])&&void 0!==(o=o[i])&&o[r]){if("object"==typeof o[r]&&void 0!==o[r].enumBitwiseOr){for(var u=o[r].enumBitwiseOr,l=0,h=[],c=0;c<u.length;++c){var f=n[u[c]];0!=(a&f)&&(l|=f,h.push(s(f)))}return l===a?h.join(" | "):s(a)}return s(a)}return null===a?"null":void 0===a?"undefined":a.toString()}function u(e,t,i){e.__defineGetter__(i,(function(){return t[i]})),e.__defineSetter__(i,(function(e){t[i]=e}))}function l(e){var t=e.getParameter(e.MAX_VERTEX_ATTRIBS),i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i);for(var n=0;n<t;++n)e.disableVertexAttribArray(n),e.vertexAttribPointer(n,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(n,0);e.deleteBuffer(i);var r=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(n=0;n<r;++n)e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null);for(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT);e.getError(););}return{init:r,mightBeEnum:function(e){return a(),void 0!==i[e]},glEnumToString:s,glFunctionArgToString:o,glFunctionArgsToString:function(e,t){for(var i="",n=t.length,r=0;r<n;++r)i+=(0==r?"":", ")+o(e,n,r,t[r]);return i},makeDebugContext:function t(i,n,a,l){l=l||i,r(i),n=n||function(t,i,n){for(var r="",a=n.length,u=0;u<a;++u)r+=(0==u?"":", ")+o(i,a,u,n[u]);e("WebGL error "+s(t)+" in "+i+"("+r+")")};var h={};function c(e,t){return function(){a&&a(t,arguments);var i=e[t].apply(e,arguments),r=l.getError();return 0!=r&&(h[r]=!0,n(r,t,arguments)),i}}var f={};for(var d in i)if("function"==typeof i[d])if("getExtension"!=d)f[d]=c(i,d);else{var _=c(i,d);f[d]=function(){return t(_.apply(i,arguments),n,a,l)}}else u(f,i,d);return f.getError=function(){for(var e in h)if(h.hasOwnProperty(e)&&h[e])return h[e]=!1,e;return i.NO_ERROR},f},makeLostContextSimulatingCanvas:function(e){var t,i,n=[],r=[],a={},s=1,o=!1,h=[],c=0,f=0,d=!1,_=0,p={};function v(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}e.getContext=(i=e.getContext,function(){var n=i.apply(e,arguments);if(n instanceof WebGLRenderingContext){if(n!=t){if(t)throw"got different context";a=x(t=n)}return a}return n});var m=function(e){n.push(v(e))},g=function(e){r.push(v(e))};function y(){++f,o||c==f&&e.loseContext()}function b(e,t){var i=e[t];return function(){if(y(),!o)return i.apply(e,arguments)}}function E(e){return{statusMessage:e,preventDefault:function(){d=!0}}}return function(e){var t=e.addEventListener;e.addEventListener=function(i,n,r){switch(i){case"webglcontextlost":m(n);break;case"webglcontextrestored":g(n);break;default:t.apply(e,arguments)}}}(e),e.loseContext=function(){if(!o){for(o=!0,c=0,++s;t.getError(););(function(){for(var e=Object.keys(p),t=0;t<e.length;++t)delete p[e]})(),p[t.CONTEXT_LOST_WEBGL]=!0;var i=E("context lost"),r=n.slice();setTimeout((function(){for(var t=0;t<r.length;++t)r[t](i);_>=0&&setTimeout((function(){e.restoreContext()}),_)}),0)}},e.restoreContext=function(){o&&r.length&&setTimeout((function(){if(!d)throw"can not restore. webglcontestlost listener did not call event.preventDefault";(function(){for(var e=0;e<h.length;++e){var i=h[e];i instanceof WebGLBuffer?t.deleteBuffer(i):i instanceof WebGLFramebuffer?t.deleteFramebuffer(i):i instanceof WebGLProgram?t.deleteProgram(i):i instanceof WebGLRenderbuffer?t.deleteRenderbuffer(i):i instanceof WebGLShader?t.deleteShader(i):i instanceof WebGLTexture&&t.deleteTexture(i)}})(),l(t),o=!1,f=0,d=!1;for(var e=r.slice(),i=E("context restored"),n=0;n<e.length;++n)e[n](i)}),0)},e.loseContextInNCalls=function(e){if(o)throw"You can not ask a lost contet to be lost";c=f+e},e.getNumCalls=function(){return f},e.setRestoreTimeout=function(e){_=e},e;function x(e){for(var i in e)"function"==typeof e[i]?a[i]=b(e,i):u(a,e,i);a.getError=function(){if(y(),!o)for(;e=t.getError();)p[e]=!0;for(var e in p)if(p[e])return delete p[e],e;return a.NO_ERROR};for(var n=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],r=0;r<n.length;++r){var l=n[r];a[l]=function(t){return function(){if(y(),o)return null;var i=t.apply(e,arguments);return i.__webglDebugContextLostId__=s,h.push(i),i}}(e[l])}var c=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(r=0;r<c.length;++r)a[l=c[r]]=function(t){return function(){return y(),o?null:t.apply(e,arguments)}}(a[l]);var f=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(r=0;r<f.length;++r)a[l=f[r]]=function(t){return function(){return y(),!o&&t.apply(e,arguments)}}(a[l]);return a.checkFramebufferStatus=function(t){return function(){return y(),o?a.FRAMEBUFFER_UNSUPPORTED:t.apply(e,arguments)}}(a.checkFramebufferStatus),a.getAttribLocation=function(t){return function(){return y(),o?-1:t.apply(e,arguments)}}(a.getAttribLocation),a.getVertexAttribOffset=function(t){return function(){return y(),o?0:t.apply(e,arguments)}}(a.getVertexAttribOffset),a.isContextLost=function(){return o},a}},resetToInitialState:l}},void 0!==(ln=un())&&(on.exports=ln);var fn=le.Z.getLogger("esri.views.WebGLDriverTest");function dn(){return dn=(0,a.Z)((0,n.Z)().mark((function e(t){var i,r,a,s,o,u,l,h,c,f,d,_,p;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=new Image).src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",i.width=5,i.height=5,e.next=6,i.decode();case 6:if(t.gl){e.next=8;break}return e.abrupt("return",!0);case 8:return r=new di.X(t,{colorTarget:Y.Lm.TEXTURE,depthStencilTarget:Y.OU.NONE},{target:Y.No.TEXTURE_2D,wrapMode:Y.e8.CLAMP_TO_EDGE,pixelFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,samplingMode:Y.cw.NEAREST,width:1,height:1}),a=j.f.createVertex(t,Y.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new Q.U(t,new Map([["a_pos",0]]),X.cD,{geometry:a}),"\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor = texture2D(u_texture, v_uv);\n  }\n  ",o=t.programCache.acquire("\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor = texture2D(u_texture, v_uv);\n  }\n  ",new Map([["a_pos",0]])),t.useProgram(o),u=new ye.x(t,{dataType:Y.Br.UNSIGNED_BYTE,pixelFormat:Y.VI.RGBA,preMultiplyAlpha:!1,wrapMode:Y.e8.CLAMP_TO_EDGE,samplingMode:Y.cw.LINEAR},i),t.bindTexture(u,0),o.setUniform1i("u_texture",0),l=t.getBoundFramebufferObject(),h=t.getViewport(),c=h.x,f=h.y,d=h.width,_=h.height,t.bindFramebuffer(r),t.setViewport(0,0,1,1),t.setClearColor(0,0,0,0),t.setBlendingEnabled(!1),t.clearSafe(Y.lk.COLOR_BUFFER_BIT),t.bindVAO(s),t.drawArrays(Y.MX.TRIANGLE_STRIP,0,4),p=new Uint8Array(4),e.abrupt("return",(r.readPixels(0,0,1,1,Y.VI.RGBA,Y.Br.UNSIGNED_BYTE,p),o.dispose(),s.dispose(!1),a.dispose(),r.dispose(),u.dispose(),t.setViewport(c,f,d,_),t.bindFramebuffer(l),i.src="",255===p[0]));case 16:case"end":return e.stop()}}),e)}))),dn.apply(this,arguments)}var _n=function(){function e(t){var i=this;(0,o.Z)(this,e),this.context=t,this._floatBufferBlendWorking=function(e){var t,i,n,r,a;if(!e.gl)return!1;if(e.type===Yi.zO.WEBGL1)return!(null===(t=e.capabilities.textureFloat)||void 0===t||!t.textureFloat||null===(i=e.capabilities.colorBufferFloat)||void 0===i||!i.textureFloat);if(!(null!==(n=e.capabilities.textureFloat)&&void 0!==n&&n.textureFloat&&null!==(r=e.capabilities.colorBufferFloat)&&void 0!==r&&r.textureFloat&&null!==(a=e.capabilities.colorBufferFloat)&&void 0!==a&&a.floatBlend))return!1;var s=new di.X(e,{colorTarget:Y.Lm.TEXTURE,depthStencilTarget:Y.OU.NONE},{target:Y.No.TEXTURE_2D,wrapMode:Y.e8.CLAMP_TO_EDGE,pixelFormat:Y.VI.RGBA,dataType:Y.Br.FLOAT,internalFormat:Y.lP.RGBA32F,samplingMode:Y.cw.NEAREST,width:1,height:1}),o=j.f.createVertex(e,Y.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),u=new Q.U(e,new Map([["a_pos",0]]),{geometry:[new ci.G("a_pos",2,Y.g.UNSIGNED_SHORT,0,4)]},{geometry:o}),l=e.programCache.acquire("\n  precision highp float;\n  attribute vec2 a_pos;\n\n  void main() {\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n   precision highp float;\n\n   void main() {\n    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);\n   }\n  ",new Map([["a_pos",0]]));e.useProgram(l);var h=e.getBoundFramebufferObject(),c=e.getViewport(),f=c.x,d=c.y,_=c.width,p=c.height;e.bindFramebuffer(s),e.setViewport(0,0,1,1),e.bindVAO(u),e.drawArrays(Y.MX.TRIANGLE_STRIP,0,4);var v=(0,nn.sm)({blending:hn.IB});e.setPipelineState(v),e.drawArrays(Y.MX.TRIANGLE_STRIP,0,4),cn.exports.init(e);var m=e.gl.getError();return e.setViewport(f,d,_,p),e.bindFramebuffer(h),l.dispose(),u.dispose(!1),o.dispose(),s.dispose(),1282!==m||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}(t),function(e){return dn.apply(this,arguments)}(t).then((function(e){return i._svgAlwaysPremultipliesAlpha=!e}))}return(0,u.Z)(e,[{key:"floatBufferBlendWorking",get:function(){if((0,m.Wi)(this._floatBufferBlendWorking))throw new Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}},{key:"svgAlwaysPremultipliesAlpha",get:function(){if((0,m.Wi)(this._svgAlwaysPremultipliesAlpha))throw new Error("svgAlwaysPremultipliesAlpha test not yet available");return this._svgAlwaysPremultipliesAlpha}},{key:"doublePrecisionRequiresObfuscation",get:function(){if((0,m.Wi)(this._doublePrecisionRequiresObfuscation)){var e=sn(this.context,!1),t=sn(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==e&&(0===t||e/t>5)}return this._doublePrecisionRequiresObfuscation}},{key:"ignoresSamplerPrecision",get:function(){return(0,m.Wi)(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=function(e){var t=new di.X(e,{colorTarget:Y.Lm.TEXTURE,depthStencilTarget:Y.OU.NONE},{target:Y.No.TEXTURE_2D,wrapMode:Y.e8.CLAMP_TO_EDGE,pixelFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,samplingMode:Y.cw.NEAREST,width:1,height:1}),i=new Uint8Array(4),n=j.f.createVertex(e,Y.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),r=new Q.U(e,new Map([["a_position",0]]),{geometry:[new ci.G("a_position",2,Y.g.SHORT,0,4)]},{geometry:n}),a=e.programCache.acquire("\nprecision highp float;\nattribute vec2 a_pos;\nuniform highp sampler2D u_texture;\nvarying vec4 v_color;\n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset = pow(2.0, float(bitIndex));\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value = texture2D(u_texture, vec2(0.0));\n  float bit = getBit(value.x * 255.0, 1);\n\n  v_color = bit * vec4(1.0);\n  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n","\nprecision highp float;\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor = v_color;\n}\n",new Map([["a_pos",0]]));e.useProgram(a);var s=new ye.x(e,{target:Y.No.TEXTURE_2D,wrapMode:Y.e8.CLAMP_TO_EDGE,pixelFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,samplingMode:Y.cw.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));a.setUniform1i("u_texture",0),e.bindTexture(s,0);var o=e.getBoundFramebufferObject();e.bindFramebuffer(t),e.useProgram(a);var u=e.getViewport(),l=u.x,h=u.y,c=u.width,f=u.height;e.setViewport(0,0,1,1),e.bindVAO(r),e.drawArrays(Y.MX.TRIANGLE_STRIP,0,4),e.setViewport(l,h,c,f),t.readPixels(0,0,1,1,Y.VI.RGBA,Y.Br.UNSIGNED_BYTE,i),a.dispose(),r.dispose(!1),n.dispose(),t.dispose();var d=255!==i[0]||255!==i[1]||255!==i[2]||255!==i[3];return d&&fn.warn("A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [".concat(i[0],".").concat(i[1],".").concat(i[2],".").concat(i[3],"]")),e.bindFramebuffer(o),d}(this.context)),this._ignoresSamplerPrecision}}]),e}();function pn(e,t,i,n,r){if(n&&(0,Gi.Z)(e))return!0;if(t[i])return!1;var a,o=(0,s.Z)(r);try{for(o.s();!(a=o.n()).done;){var u=a.value;if(e.getExtension(u))return!0}}catch(l){o.e(l)}finally{o.f()}return!1}var vn=function(){function e(t,i){(0,o.Z)(this,e),this.gl=t,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}return(0,u.Z)(e,[{key:"drawBuffers",get:function(){return this._drawBuffers||(this._drawBuffers=function(e,t){if(t.disjointTimerQuery)return null;if((0,Gi.Z)(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;var i=e.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}(this.gl,this._disabledExtensions)),this._drawBuffers}},{key:"instancing",get:function(){return this._instancing||(this._instancing=function(e){if((0,Gi.Z)(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};var t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}(this.gl)),this._instancing}},{key:"vao",get:function(){return this._vertexArrayObject||(this._vertexArrayObject=function(e,t){if((0,Gi.Z)(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;var i=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}(this.gl,this._disabledExtensions)),this._vertexArrayObject}},{key:"compressedTextureETC",get:function(){return this._compressedTextureETC||(this._compressedTextureETC=function(e,t){if(t.compressedTextureETC)return null;var i=e.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}(this.gl,this._disabledExtensions)),this._compressedTextureETC}},{key:"compressedTextureS3TC",get:function(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=function(e,t){if(t.compressedTextureS3TC)return null;var i=e.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}(this.gl,this._disabledExtensions)),this._compressedTextureS3TC}},{key:"textureFilterAnisotropic",get:function(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=function(e,t){if(t.textureFilterAnisotropic)return null;var i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}(this.gl,this._disabledExtensions)),this._textureFilterAnisotropic}},{key:"disjointTimerQuery",get:function(){return this._disjointTimerQuery||(this._disjointTimerQuery=Wi(this.gl,this._disabledExtensions)),this._disjointTimerQuery}},{key:"textureFloat",get:function(){return this._textureFloat||(this._textureFloat=function(e,t){if((0,Gi.Z)(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:e.HALF_FLOAT,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F};if(e instanceof WebGLRenderingContext){var i=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}(this.gl,this._disabledExtensions)),this._textureFloat}},{key:"colorBufferFloat",get:function(){return this._colorBufferFloat||(this._colorBufferFloat=function(e,t){if((0,Gi.Z)(e)){var i=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float")||!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),n=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),r=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||n||r?{textureFloat:!!n,textureHalfFloat:!!i,floatBlend:!!r,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){var a=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float"),s=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),o=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return a||s||o?{textureFloat:!!s,textureHalfFloat:!!a,floatBlend:!!o,RGBA16F:a?a.RGBA16F_EXT:void 0,RGB16F:a?a.RGB16F_EXT:void 0,RGBA32F:s?s.RGBA32F_EXT:void 0}:null}return null}(this.gl,this._disabledExtensions)),this._colorBufferFloat}},{key:"blendMinMax",get:function(){return this._minMaxBlending||(this._minMaxBlending=function(e,t){if((0,Gi.Z)(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;var i=e.getExtension("EXT_blend_minmax");return i?{MIN:i.MIN_EXT,MAX:i.MAX_EXT}:null}(this.gl,this._disabledExtensions)),this._minMaxBlending}},{key:"depthTexture",get:function(){return null===this._depthTexture&&(this._depthTexture=pn(this.gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}},{key:"standardDerivatives",get:function(){return null===this._standardDerivatives&&(this._standardDerivatives=pn(this.gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}},{key:"shaderTextureLOD",get:function(){return null===this._shaderTextureLOD&&(this._shaderTextureLOD=pn(this.gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}},{key:"fragDepth",get:function(){return null===this._fragDepth&&(this._fragDepth=pn(this.gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}},{key:"loseContext",get:function(){return this._loseContext||(this._loseContext=function(e,t){var i=t.loseContext&&e.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:function(){return i.loseContext()}}:null}(this.gl,this._debugWebGLExtensions)),this._loseContext}},{key:"textureNorm16",get:function(){return this._textureNorm16||(this._textureNorm16=function(e,t){if(!(0,Gi.Z)(e))return null;if(t.textureNorm16)return null;var i=e.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}(this.gl,this._disabledExtensions)),this._textureNorm16}},{key:"textureFloatLinear",get:function(){return null===this._textureFloatLinear&&(this._textureFloatLinear=pn(this.gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}},{key:"enable",value:function(e){return this[e]}}]),e}(),mn=function(){function e(t,i){(0,o.Z)(this,e),this.gl=t,this.instanceCounter=new en,this.programCache=new tn.G(this),this._state=new Qi,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=(0,Gi.Z)(t)?Yi.zO.WEBGL2:Yi.zO.WEBGL1,this._loadExtensions(),this.configure(i)}return(0,u.Z)(e,[{key:"configure",value:function(e){var t=this;this._capabilities=new vn(this.gl,e),this._parameters=this._loadParameters(e);var i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new Qi,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new nn.jp({setBlending:function(e){if(e){t.setBlendingEnabled(!0),t.setBlendEquationSeparate(e.opRgb,e.opAlpha),t.setBlendFunctionSeparate(e.srcRgb,e.dstRgb,e.srcAlpha,e.dstAlpha);var i=e.color;t.setBlendColor(i.r,i.g,i.b,i.a)}else t.setBlendingEnabled(!1)},setCulling:function(e){e?(t.setFaceCullingEnabled(!0),t.setCullFace(e.face),t.setFrontFace(e.mode)):t.setFaceCullingEnabled(!1)},setPolygonOffset:function(e){e?(t.setPolygonOffsetFillEnabled(!0),t.setPolygonOffset(e.factor,e.units)):t.setPolygonOffsetFillEnabled(!1)},setDepthTest:function(e){e?(t.setDepthTestEnabled(!0),t.setDepthFunction(e.func)):t.setDepthTestEnabled(!1)},setStencilTest:function(e){if(e){t.setStencilTestEnabled(!0);var i=e.function;t.setStencilFunction(i.func,i.ref,i.mask);var n=e.operation;t.setStencilOp(n.fail,n.zFail,n.zPass)}else t.setStencilTestEnabled(!1)},setDepthWrite:function(e){e?(t.setDepthWriteEnabled(!0),t.setDepthRange(e.zNear,e.zFar)):t.setDepthWriteEnabled(!1)},setColorWrite:function(e){e?t.setColorMask(e.r,e.g,e.b,e.a):t.setColorMask(!1,!1,!1,!1)},setStencilWrite:function(e){e?t.setStencilWriteMask(e.mask):t.setStencilWriteMask(0)}}),this.enforceState(),this._driverTest=new _n(this)}},{key:"driverTest",get:function(){return this._driverTest}},{key:"contextAttributes",get:function(){return this.gl.getContextAttributes()}},{key:"parameters",get:function(){return this._parameters}},{key:"dispose",value:function(){this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Y.w0.ARRAY_BUFFER),this.unbindBuffer(Y.w0.ELEMENT_ARRAY_BUFFER),(0,Gi.Z)(this.gl)&&(this.unbindBuffer(Y.w0.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Y.w0.PIXEL_PACK_BUFFER),this.unbindBuffer(Y.w0.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Y.w0.COPY_READ_BUFFER),this.unbindBuffer(Y.w0.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,(0,Ki.hZ)()&&this.instanceCounter.printResourceCount()}},{key:"setPipelineState",value:function(e){this._stateTracker.setPipeline(e)}},{key:"setBlendingEnabled",value:function(e){this._state.blend!==e&&(!0===e?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}},{key:"externalProgramUpdate",value:function(){var e;null!==(e=this._state.program)&&void 0!==e&&e.stop(),this._state.program=null}},{key:"externalTextureUnitUpdate",value:function(e,t){for(var i=0;i<e.length;++i)this._state.textureUnitMap[e[i]]=null;t>=0&&(this._state.activeTexture=t)}},{key:"externalVertexArrayObjectUpdate",value:function(){var e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}},{key:"externalVertexBufferUpdate",value:function(){this._state.vertexBuffer=null}},{key:"externalIndexBufferUpdate",value:function(){this._state.indexBuffer=null}},{key:"setBlendColor",value:function(e,t,i,n){e===this._state.blendColor.r&&t===this._state.blendColor.g&&i===this._state.blendColor.b&&n===this._state.blendColor.a||(this.gl.blendColor(e,t,i,n),this._state.blendColor.r=e,this._state.blendColor.g=t,this._state.blendColor.b=i,this._state.blendColor.a=n,this._stateTracker.invalidateBlending())}},{key:"setBlendFunction",value:function(e,t){e===this._state.blendFunction.srcRGB&&t===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,t),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=t,this._stateTracker.invalidateBlending())}},{key:"setBlendFunctionSeparate",value:function(e,t,i,n){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===t&&this._state.blendFunction.dstAlpha===n||(this.gl.blendFuncSeparate(e,t,i,n),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=n,this._stateTracker.invalidateBlending())}},{key:"setBlendEquation",value:function(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}},{key:"setBlendEquationSeparate",value:function(e,t){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}},{key:"setColorMask",value:function(e,t,i,n){this._state.colorMask.r===e&&this._state.colorMask.g===t&&this._state.colorMask.b===i&&this._state.colorMask.a===n||(this.gl.colorMask(e,t,i,n),this._state.colorMask.r=e,this._state.colorMask.g=t,this._state.colorMask.b=i,this._state.colorMask.a=n,this._stateTracker.invalidateColorWrite())}},{key:"setClearColor",value:function(e,t,i,n){this._state.clearColor.r===e&&this._state.clearColor.g===t&&this._state.clearColor.b===i&&this._state.clearColor.a===n||(this.gl.clearColor(e,t,i,n),this._state.clearColor.r=e,this._state.clearColor.g=t,this._state.clearColor.b=i,this._state.clearColor.a=n)}},{key:"setFaceCullingEnabled",value:function(e){this._state.faceCulling!==e&&(!0===e?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}},{key:"setPolygonOffsetFillEnabled",value:function(e){this._state.polygonOffsetFill!==e&&(!0===e?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}},{key:"setPolygonOffset",value:function(e,t){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===t||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=t,this.gl.polygonOffset(e,t),this._stateTracker.invalidatePolygonOffset())}},{key:"setCullFace",value:function(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}},{key:"setFrontFace",value:function(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}},{key:"setScissorTestEnabled",value:function(e){this._state.scissorTest!==e&&(!0===e?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}},{key:"setScissorRect",value:function(e,t,i,n){this._state.scissorRect.x===e&&this._state.scissorRect.y===t&&this._state.scissorRect.width===i&&this._state.scissorRect.height===n||(this.gl.scissor(e,t,i,n),this._state.scissorRect.x=e,this._state.scissorRect.y=t,this._state.scissorRect.width=i,this._state.scissorRect.height=n)}},{key:"setDepthTestEnabled",value:function(e){this._state.depthTest!==e&&(!0===e?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}},{key:"setClearDepth",value:function(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}},{key:"setDepthFunction",value:function(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}},{key:"setDepthWriteEnabled",value:function(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}},{key:"setDepthRange",value:function(e,t){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===t||(this.gl.depthRange(e,t),this._state.depthRange.zNear=e,this._state.depthRange.zFar=t,this._stateTracker.invalidateDepthWrite())}},{key:"setStencilTestEnabled",value:function(e){this._state.stencilTest!==e&&(!0===e?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}},{key:"setClearStencil",value:function(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}},{key:"setStencilFunction",value:function(e,t,i){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===t&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(e,t,i),this._state.stencilFunction.face=Y.LR.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=t,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}},{key:"setStencilFunctionSeparate",value:function(e,t,i,n){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===n||(this.gl.stencilFuncSeparate(e,t,i,n),this._state.stencilFunction.face=e,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=n,this._stateTracker.invalidateStencilTest())}},{key:"setStencilWriteMask",value:function(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}},{key:"setStencilOp",value:function(e,t,i){this._state.stencilOperation.face===Y.LR.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===t&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(e,t,i),this._state.stencilOperation.face=Y.LR.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=t,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}},{key:"setStencilOpSeparate",value:function(e,t,i,n){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===n||(this.gl.stencilOpSeparate(e,t,i,n),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=n,this._stateTracker.invalidateStencilTest())}},{key:"setActiveTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this._state.activeTexture;return e>=0&&(t||e!==this._state.activeTexture)&&(this.gl.activeTexture(Y.Ld+e),this._state.activeTexture=e),i}},{key:"clear",value:function(e){e&&this.gl.clear(e)}},{key:"clearSafe",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;e&&(e&Y.lk.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&Y.lk.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&Y.lk.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(t),this.gl.clear(e))}},{key:"drawArrays",value:function(e,t,i){if((0,Ki.hZ)()&&(this._numOfDrawCalls++,this._numOfTriangles+=yn(e,i)),this.gl.drawArrays(e,t,i),(0,Ki.hZ)()){var n=(0,rn.HH)(this);n&&console.error("drawArrays:",n)}}},{key:"drawElements",value:function(e,t,i,n){if((0,Ki.hZ)()&&(this._numOfDrawCalls++,this._numOfTriangles+=yn(e,t)),this.gl.drawElements(e,t,i,n),(0,Ki.hZ)()){var r=(0,rn.HH)(this);if(r){var a,s=this.getBoundVAO(),o=null===s||void 0===s?void 0:s.indexBuffer,u={indexBuffer:o,vertexBuffers:null===s||void 0===s?void 0:s.vertexBuffers},l={mode:e,count:t,type:i,offset:n},h=null!==(a=(0,m.yw)(o,(function(e){return e.size})))&&void 0!==a?a:0,c=n+t,f=h<c?". Buffer is too small. Attempted to draw index ".concat(c," of ").concat(h):"";console.error("drawElements: ".concat(r).concat(f),{args:l,vao:u})}}}},{key:"logInfo",value:function(){(0,Ki.hZ)()&&console.log("DrawCalls: ".concat(this._numOfDrawCalls,", Triangles: ").concat(this._numOfTriangles))}},{key:"resetInfo",value:function(){(0,Ki.hZ)()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}},{key:"capabilities",get:function(){return this._capabilities}},{key:"setViewport",value:function(e,t,i,n){i=Math.max(Math.round(i),1),n=Math.max(Math.round(n),1);var r=this._state.viewport;r.x===e&&r.y===t&&r.width===i&&r.height===n||(r.x=e,r.y=t,r.width=i,r.height=n,this.gl.viewport(e,t,i,n))}},{key:"getViewport",value:function(){return{x:this._state.viewport.x,y:this._state.viewport.y,width:this._state.viewport.width,height:this._state.viewport.height}}},{key:"useProgram",value:function(e){var t,i;this._state.program!==e&&(null!==(t=this._state.program)&&void 0!==t&&t.stop(),this._state.program=e,this.gl.useProgram(null!==(i=null===e||void 0===e?void 0:e.glName)&&void 0!==i?i:null))}},{key:"bindTexture",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(t>=this.parameters.maxTextureImageUnits||t<0)&&console.error("Input texture unit is out of range of available units!");var n=this._state.textureUnitMap[t];return(0,m.Wi)(e)||null==e.glName?((0,m.pC)(n)&&(this.setActiveTexture(t,i),this.gl.bindTexture(n.descriptor.target,null)),this._state.textureUnitMap[t]=null,n):i||n!==e?(this.setActiveTexture(t,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[t]=e,n):(e.isDirty&&(this.setActiveTexture(t,i),e.applyChanges()),n)}},{key:"unbindTexture",value:function(e){if(!(0,m.Wi)(e))for(var t=0;t<this.parameters.maxTextureImageUnits;t++)this._state.textureUnitMap[t]===e&&(this.bindTexture(null,t),this._state.textureUnitMap[t]=null)}},{key:"bindFramebuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if((0,m.Wi)(e))return this.gl.bindFramebuffer(Y.qi.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(Y.qi.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}},{key:"bindFramebufferSeparate",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t===Y.qi.READ_FRAMEBUFFER,r=n?this._state.readFramebuffer:this._state.drawFramebuffer;(i||r!==e)&&((0,m.Wi)(e)?this.gl.bindFramebuffer(t,null):e.initializeAndBind(t),n?this._state.readFramebuffer=(0,m.Pt)(e,null):this._state.drawFramebuffer=(0,m.Pt)(e,null))}},{key:"blitFramebuffer",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.width,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.height,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:t.width,l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:t.height,h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:Y.lk.COLOR_BUFFER_BIT,c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:Y.cw.NEAREST;this.bindFramebufferSeparate(e,Y.qi.READ_FRAMEBUFFER),this.bindFramebufferSeparate(t,Y.qi.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,n,r,a,s,o,u,l,h,c)}},{key:"bindBuffer",value:function(e,t){var i;if(e)switch(null!==(i=t)&&void 0!==i||(t=e.bufferType),t){case Y.w0.ARRAY_BUFFER:this._state.vertexBuffer=gn(this.gl,e,t,this._state.vertexBuffer);break;case Y.w0.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=gn(this.gl,e,t,this._state.indexBuffer);break;case Y.w0.UNIFORM_BUFFER:this._state.uniformBuffer=gn(this.gl,e,t,this._state.uniformBuffer);break;case Y.w0.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=gn(this.gl,e,t,this._state.pixelPackBuffer);break;case Y.w0.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=gn(this.gl,e,t,this._state.pixelUnpackBuffer);break;case Y.w0.COPY_READ_BUFFER:this._state.copyReadBuffer=gn(this.gl,e,t,this._state.copyReadBuffer);break;case Y.w0.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=gn(this.gl,e,t,this._state.copyWriteBuffer)}}},{key:"bindRenderbuffer",value:function(e){var t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}},{key:"_getBufferBinding",value:function(e,t){if(t>=this.parameters.maxUniformBufferBindings||t<0)return console.error("Uniform buffer binding point is out of range!"),null;var i=this._state.uniformBufferBindingPoints,n=i[t];return(0,m.Wi)(n)&&(n={buffer:null,offset:0,size:0},i[t]=n),n}},{key:"bindBufferBase",value:function(e,t,i){var n=this._getBufferBinding(e,t);(0,m.Wi)(n)||n.buffer===i&&0===n.offset&&0===n.size||(this.gl.bindBufferBase(e,t,i?i.glName:null),n.buffer=i,n.offset=0,n.size=0)}},{key:"bindBufferRange",value:function(e,t,i,n,r){var a=this._getBufferBinding(e,t);(0,m.Wi)(a)||a.buffer===i&&a.offset===n&&a.size===r||(n%this._parameters.uniformBufferOffsetAlignment==0?(this.gl.bindBufferRange(e,t,i.glName,n,r),a.buffer=i,a.offset=n,a.size=r):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"))}},{key:"bindUBO",value:function(e,t,i,n){(0,m.Wi)(t)?this.bindBufferBase(Y.w0.UNIFORM_BUFFER,e,null):((0,Ki.hZ)()&&(null!==n&&void 0!==n?n:t.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),t.initialize(),void 0!==i&&void 0!==n?this.bindBufferRange(Y.w0.UNIFORM_BUFFER,e,t.buffer,i,n):this.bindBufferBase(Y.w0.UNIFORM_BUFFER,e,t.buffer))}},{key:"unbindUBO",value:function(e){for(var t=0,i=this._state.uniformBufferBindingPoints.length;t<i;t++){var n=this._state.uniformBufferBindingPoints[t];(0,m.pC)(n)&&n.buffer===e.buffer&&this.bindBufferBase(Y.w0.UNIFORM_BUFFER,t,null)}}},{key:"unbindBuffer",value:function(e){switch(e){case Y.w0.ARRAY_BUFFER:this._state.vertexBuffer=gn(this.gl,null,e,this._state.vertexBuffer);break;case Y.w0.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=gn(this.gl,null,e,this._state.indexBuffer);break;case Y.w0.UNIFORM_BUFFER:this._state.uniformBuffer=gn(this.gl,null,e,this._state.uniformBuffer);break;case Y.w0.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=gn(this.gl,null,e,this._state.pixelPackBuffer);break;case Y.w0.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=gn(this.gl,null,e,this._state.pixelUnpackBuffer);break;case Y.w0.COPY_READ_BUFFER:this._state.copyReadBuffer=gn(this.gl,null,e,this._state.copyReadBuffer);break;case Y.w0.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=gn(this.gl,null,e,this._state.copyWriteBuffer)}}},{key:"bindVAO",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;(0,m.Wi)(e)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e)}},{key:"clientWaitAsync",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){var t,i,r,a,s=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=s.length>0&&void 0!==s[0]?s[0]:(0,Ne.HA)(10),i=this.gl,r=i.fenceSync(Y.V7.SYNC_GPU_COMMANDS_COMPLETE,0),this.instanceCounter.increment(Y._g.Sync,r),i.flush();case 3:return e.next=5,(0,he.e4)(t);case 5:a=i.clientWaitSync(r,0,0);case 6:if(a===Y.Y5.TIMEOUT_EXPIRED){e.next=3;break}case 7:if(this.instanceCounter.decrement(Y._g.Sync,r),i.deleteSync(r),a!==Y.Y5.WAIT_FAILED){e.next=9;break}throw new Error("Client wait failed");case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getBoundFramebufferObject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y.qi.FRAMEBUFFER;return e===Y.qi.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}},{key:"getBoundVAO",value:function(){return this._state.vertexArrayObject}},{key:"resetState",value:function(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Y.w0.ARRAY_BUFFER),this.unbindBuffer(Y.w0.ELEMENT_ARRAY_BUFFER),(0,Gi.Z)(this.gl)&&(this.unbindBuffer(Y.w0.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Y.w0.PIXEL_PACK_BUFFER),this.unbindBuffer(Y.w0.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Y.w0.COPY_READ_BUFFER),this.unbindBuffer(Y.w0.COPY_WRITE_BUFFER));for(var e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(Y.zi.ONE,Y.zi.ZERO),this.setBlendEquation(Y.db.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Y.LR.BACK),this.setFrontFace(Y.Wf.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Y.wb.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Y.wb.ALWAYS,0,0),this.setStencilOp(Y.xS.KEEP,Y.xS.KEEP,Y.xS.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}},{key:"enforceState",value:function(){var e,t,i,n,r=this.gl,a=this.capabilities.vao;a&&a.bindVertexArray(null);for(var s=0;s<this.parameters.maxVertexAttributes;s++)r.disableVertexAttribArray(s);if(this._state.vertexBuffer?r.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):r.bindBuffer(Y.w0.ARRAY_BUFFER,null),this._state.indexBuffer?r.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):r.bindBuffer(Y.w0.ELEMENT_ARRAY_BUFFER,null),(0,Gi.Z)(r)){var o,u;this._state.uniformBuffer?r.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):r.bindBuffer(Y.w0.UNIFORM_BUFFER,null);for(var l=0;l<this._parameters.maxUniformBufferBindings;l++){var h=this._state.uniformBufferBindingPoints[l];if((0,m.pC)(h)){var c=h.buffer,f=h.offset,d=h.size;null!==c?0===f&&0===d?r.bindBufferBase(Y.w0.UNIFORM_BUFFER,l,c.glName):r.bindBufferRange(Y.w0.UNIFORM_BUFFER,l,c.glName,f,d):r.bindBufferBase(Y.w0.UNIFORM_BUFFER,l,null)}}this._state.pixelPackBuffer?r.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):r.bindBuffer(Y.w0.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?r.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):r.bindBuffer(Y.w0.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?r.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):r.bindBuffer(Y.w0.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?r.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):r.bindBuffer(Y.w0.COPY_WRITE_BUFFER,null),r.bindFramebuffer(Y.qi.READ_FRAMEBUFFER,null),r.readBuffer(r.BACK),this._state.readFramebuffer&&(r.bindFramebuffer(Y.qi.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),r.readBuffer(Y.VY.COLOR_ATTACHMENT0)),r.bindFramebuffer(Y.qi.DRAW_FRAMEBUFFER,null!==(o=null===(u=this._state.drawFramebuffer)||void 0===u?void 0:u.glName)&&void 0!==o?o:null)}else this._state.readFramebuffer=this._state.drawFramebuffer,r.bindFramebuffer(Y.qi.FRAMEBUFFER,null!==(e=null===(t=this._state.drawFramebuffer)||void 0===t?void 0:t.glName)&&void 0!==e?e:null);if(a&&this._state.vertexArrayObject){var _=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(_)}r.useProgram(null!==(i=null===(n=this._state.program)||void 0===n?void 0:n.glName)&&void 0!==i?i:null),r.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),r.bindRenderbuffer(r.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),!0===this._state.blend?r.enable(this.gl.BLEND):r.disable(this.gl.BLEND),r.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),r.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),r.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),r.clearDepth(this._state.clearDepth),r.clearStencil(this._state.clearStencil),r.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),r.cullFace(this._state.cullFace),r.depthFunc(this._state.depthFunction),r.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),!0===this._state.depthTest?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),r.depthMask(this._state.depthWrite),r.frontFace(this._state.frontFace),r.lineWidth(1),!0===this._state.faceCulling?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),r.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),!0===this._state.polygonOffsetFill?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),r.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),!0===this._state.scissorTest?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),r.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),r.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),!0===this._state.stencilTest?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),r.stencilMask(this._state.stencilWriteMask);for(var p=0;p<this.parameters.maxTextureImageUnits;p++){r.activeTexture(Y.Ld+p),r.bindTexture(Y.No.TEXTURE_2D,null),r.bindTexture(Y.No.TEXTURE_CUBE_MAP,null),(0,Gi.Z)(r)&&(r.bindTexture(Y.No.TEXTURE_3D,null),r.bindTexture(Y.No.TEXTURE_2D_ARRAY,null));var v=this._state.textureUnitMap[p];(0,m.pC)(v)&&r.bindTexture(v.descriptor.target,v.glName)}r.activeTexture(Y.Ld+this._state.activeTexture),r.viewport(this._state.viewport.x,this._state.viewport.y,this._state.viewport.width,this._state.viewport.height),this.resetInfo()}},{key:"_loadExtensions",value:function(){this.type===Yi.zO.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}},{key:"_loadParameters",value:function(e){var t,i=this.capabilities.textureFilterAnisotropic,n=null!==(t=e.maxAnisotropy)&&void 0!==t?t:1/0,r=(0,Gi.Z)(this.gl),a=this.gl,s={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:i?Math.min(this.gl.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY),n):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:r?a.getParameter(a.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:r?a.getParameter(a.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:r?a.getParameter(a.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:r?a.getParameter(a.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:r?a.getParameter(a.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:r?a.getParameter(a.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:r?a.getParameter(a.MAX_SAMPLES):1};return ye.x.TEXTURE_UNIT_FOR_UPDATES=s.maxTextureImageUnits-1,s}}]),e}();function gn(e,t,i,n){return t?n!==t&&e.bindBuffer(i,t.glName):e.bindBuffer(i,null),t}function yn(e,t){switch(e){case Y.MX.POINTS:return 2*t;case Y.MX.TRIANGLES:return t/3;case Y.MX.TRIANGLE_STRIP:case Y.MX.TRIANGLE_FAN:return t-2;default:return 0}}var bn=function(e){(0,f.Z)(i,e);var t=(0,d.Z)(i);function i(e,n){var r;(0,o.Z)(this,i),(r=t.call(this))._trash=new Set,r._renderRemainingTime=0,r._lastFrameRenderTime=0,r.renderRequested=!1,r.stage=(0,l.Z)(r),r._stationary=!0;var a=n.canvas,s=void 0===a?document.createElement("canvas"):a,u=n.alpha,h=void 0===u||u,c=n.stencil,f=void 0===c||c,d=n.contextOptions,g=void 0===d?{}:d;r._canvas=s;var b=(0,Yi.sj)("2d",s,{alpha:h,antialias:!1,depth:!0,stencil:f});return r.context=new mn((0,m.pC)(b)?b:null,g),r.resourceManager=new E.Z,r.painter=new Ni(r.context,(0,l.Z)(r),r.resourceManager),(0,v.Z)("esri-2d-profiler")&&(r._debugOutput=document.createElement("div"),r._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),e.appendChild(r._debugOutput)),r._renderParameters={drawPhase:0,state:r.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null,deltaTime:-1,time:0,inFadeTransition:!1,effects:null,context:r.context,painter:r.painter,timeline:n.timeline||new qi.T,renderingOptions:n.renderingOptions,requestRender:function(){return r.requestRender()},requireFBO:!1,profiler:new Hi(r.context,r._debugOutput),dataUploadCounter:0},r._taskHandle=(0,y.A)({render:function(e){return r.renderFrame(e)}}),r._taskHandle.pause(),r._lostWebGLContextHandle=(0,p.on)(s,"webglcontextlost",(function(){r.emit("webgl-error",{error:new _.Z("webgl-context-lost")})})),s.setAttribute("style","width: 100%; height:100%; display:block;"),e.appendChild(s),r}return(0,u.Z)(i,[{key:"destroy",value:function(){this.removeAllChildren(),this._emptyTrash(),this._taskHandle.remove(),this._taskHandle=null,this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null),this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas),this._debugOutput&&this._debugOutput.parentNode&&this._debugOutput.parentNode.removeChild(this._debugOutput),this.highlightOptions=null,this.resourceManager.destroy(),this.painter.dispose(),this.context.dispose(),this._canvas=null}},{key:"background",get:function(){return this._background},set:function(e){this._background=e,this.requestRender()}},{key:"highlightOptions",get:function(){return this._highlightOptions},set:function(e){var t=this;this._highlightOptionsHandle&&(this._highlightOptionsHandle.remove(),this._highlightOptionsHandle=null),this._highlightOptions=e,this._highlightOptions&&(this._highlightOptionsHandle=(0,g.YP)((function(){var e;return null===(e=t._highlightOptions)||void 0===e?void 0:e.version}),(function(){t.painter.setHighlightOptions(e),t.requestRender()}),g.nn))}},{key:"renderingOptions",get:function(){return this._renderingOptions},set:function(e){this._renderingOptions=e,this.requestRender()}},{key:"state",get:function(){return this._state},set:function(e){this._state=e,this.requestRender()}},{key:"stationary",get:function(){return this._stationary},set:function(e){this._stationary!==e&&(this._stationary=e,this.requestRender())}},{key:"trashDisplayObject",value:function(e){this._trash.add(e),this.requestRender()}},{key:"untrashDisplayObject",value:function(e){return this._trash.delete(e)}},{key:"requestRender",value:function(){this._renderRemainingTime=2e3,this.renderRequested||(this.renderRequested=!0,this.emit("will-render"),this._taskHandle.resume())}},{key:"renderFrame",value:function(e){var t=this._lastFrameRenderTime?e.time-this._lastFrameRenderTime:0;this._renderRemainingTime-=t,this._renderRemainingTime<=0&&this._taskHandle.pause(),this._lastFrameRenderTime=e.time,this.renderRequested=!1,this._renderParameters.state=this._state,this._renderParameters.stationary=this.stationary,this._renderParameters.pixelRatio=window.devicePixelRatio,this._renderParameters.globalOpacity=1,this._renderParameters.time=e.time,this._renderParameters.deltaTime=e.deltaTime,this._renderParameters.effects=null,this.processRender(this._renderParameters),this._emptyTrash(),this.emit("post-render")}},{key:"_createTransforms",value:function(){return{dvs:(0,b.c)()}}},{key:"renderChildren",value:function(e){var t,i=(0,s.Z)(this.children);try{for(i.s();!(t=i.n()).done;){t.value.beforeRender(e)}}catch(a){i.e(a)}finally{i.f()}this._renderChildren(this.children,e);var n,r=(0,s.Z)(this.children);try{for(r.s();!(n=r.n()).done;){n.value.afterRender(e)}}catch(a){r.e(a)}finally{r.f()}}},{key:"_renderChildren",value:function(e,t){var i=this.context;i.resetInfo(),t.profiler.recordStart("drawLayers"),t.dataUploadCounter=0,t.drawPhase=w.jx.MAP,this.painter.beforeRenderLayers(i,this.background);var n,r=(0,s.Z)(e);try{for(r.s();!(n=r.n()).done;){n.value.processRender(t)}}catch(f){r.e(f)}finally{r.f()}this.painter.prepareDisplay(t,this.background,this.state.padding),this.painter.renderLayers(i),t.drawPhase=w.jx.HIGHLIGHT,this.painter.beforeRenderLayers(i);var a,o=(0,s.Z)(e);try{for(o.s();!(a=o.n()).done;){a.value.processRender(t)}}catch(f){o.e(f)}finally{o.f()}if(this.painter.renderLayers(i),this._isLabelDrawPhaseRequired(e)){t.drawPhase=w.jx.LABEL,this.painter.beforeRenderLayers(i);var u,l=(0,s.Z)(e);try{for(l.s();!(u=l.n()).done;){u.value.processRender(t)}}catch(f){l.e(f)}finally{l.f()}this.painter.renderLayers(i)}if((0,v.Z)("esri-tiles-debug")){t.drawPhase=w.jx.DEBUG,this.painter.beforeRenderLayers(i);var h,c=(0,s.Z)(e);try{for(c.s();!(h=c.n()).done;){h.value.processRender(t)}}catch(f){c.e(f)}finally{c.f()}this.painter.renderLayers(i)}t.profiler.recordEnd("drawLayers"),i.logInfo()}},{key:"doRender",value:function(e){var t=this.context,n=e.state,r=e.pixelRatio;this._resizeCanvas(e),t.setViewport(0,0,r*n.size[0],r*n.size[1]),t.setDepthWriteEnabled(!0),t.setStencilWriteMask(255),(0,h.Z)((0,c.Z)(i.prototype),"doRender",this).call(this,e)}},{key:"takeScreenshot",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var i,a,s,o,u,l,h,c,f,d,_,p,v;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={framebufferWidth:Math.round(this.state.size[0]*t.resolutionScale),framebufferHeight:Math.round(this.state.size[1]*t.resolutionScale)},a=i.framebufferWidth,s=i.framebufferHeight,1,o=this.context,u=this._state.clone(),null!=t.rotation&&(l=u.viewpoint,u.viewpoint.rotation=t.rotation,u.viewpoint=l),h=(0,r.Z)((0,r.Z)({},this._renderParameters),{},{drawPhase:null,globalOpacity:1,stationary:!0,state:u,pixelRatio:1,time:performance.now(),deltaTime:0,blendMode:null,effects:null,inFadeTransition:!1}),c=new di.X(o,{colorTarget:Y.Lm.TEXTURE,depthStencilTarget:Y.OU.DEPTH_STENCIL_RENDER_BUFFER,width:a,height:s}),f=o.getBoundFramebufferObject(),d=o.getViewport(),o.bindFramebuffer(c),o.setViewport(0,0,a,s),this._renderChildren(t.children,h),_=this._readbackScreenshot(c,(0,r.Z)((0,r.Z)({},t.cropArea),{},{y:s-(t.cropArea.y+t.cropArea.height)})),o.bindFramebuffer(f),o.setViewport(d.x,d.y,d.width,d.height),this.requestRender(),e.next=8,_;case 8:return p=e.sent,e.abrupt("return",(1===t.outputScale?v=p:(v=new ImageData(Math.round(p.width*t.outputScale),Math.round(p.height*t.outputScale)),(0,ji.TT)(p,v,!0)),v));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_readbackScreenshot",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,i){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,ji.r7)(i.width,i.height,document.createElement("canvas")),e.next=3,t.readPixelsAsync(i.x,i.y,i.width,i.height,Y.VI.RGBA,Y.Br.UNSIGNED_BYTE,new Uint8Array(r.data.buffer));case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_resizeCanvas",value:function(e){var t=this._canvas,i=t.style,n=e.state.size,r=e.pixelRatio,a=n[0],s=n[1],o=Math.round(a*r),u=Math.round(s*r);t.width===o&&t.height===u||(t.width=o,t.height=u),i.width=a+"px",i.height=s+"px"}},{key:"_emptyTrash",value:function(){for(;this._trash.size>0;){var e=Array.from(this._trash);this._trash.clear();for(var t=0,i=e;t<i.length;t++){i[t].processDetach()}}}},{key:"_isLabelDrawPhaseRequired",value:function(e){var t,i=!1,n=(0,s.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!(r instanceof x.W)){i=i||!1;break}if(r.hasLabels)return!0;i=i||this._isLabelDrawPhaseRequired(r.children)}}catch(a){n.e(a)}finally{n.f()}return i}}]),i}(x.W),En=i(27366),xn=i(85015),wn=i(41691),Tn=i(14916),Rn=i(49861),Fn=(i(25243),i(69912)),Bn=i(93433),An=i(16889),kn=i(44333),Cn=function(){function e(t,i){(0,o.Z)(this,e),this.width=t,this.height=i;var n=Math.ceil(t/1),r=Math.ceil(i/1);this._cols=n,this._rows=r,this._cells=kn.p.create(n*r)}return(0,u.Z)(e,[{key:"insertMetrics",value:function(e){var t=this._hasCollision(e);return 0===t&&this._markMetrics(e),t}},{key:"getCellId",value:function(e,t){return e+t*this._cols}},{key:"has",value:function(e){return this._cells.has(e)}},{key:"hasRange",value:function(e,t){return this._cells.hasRange(e,t)}},{key:"set",value:function(e){this._cells.set(e)}},{key:"setRange",value:function(e,t){this._cells.setRange(e,t)}},{key:"_hasCollision",value:function(e){var t=e.id,i=0,n=0;e.save();do{var r=e.boundsCount;i+=r;for(var a=0;a<r;a++){var s=e.boundsComputedAnchorX(a),o=e.boundsComputedAnchorY(a),u=e.boundsWidth(a)+2,l=e.boundsHeight(a)+2;switch(this._collide(s,o,u,l)){case 2:return 2;case 1:n++}}}while(e.peekId()===t&&e.next());return e.restore(),i===n?1:0}},{key:"_collide",value:function(e,t,i,n){var r=e-i/2,a=t-n/2,s=r+i,o=a+n;if(s<0||o<0||r>this.width||a>this.height)return 1;for(var u=(0,An.uZ)(Math.floor(r/1),0,this._cols),l=(0,An.uZ)(Math.floor(a/1),0,this._rows),h=(0,An.uZ)(Math.ceil(s/1),0,this._cols),c=(0,An.uZ)(Math.ceil(o/1),0,this._rows),f=l;f<=c;f++)for(var d=u;d<=h;d++){var _=this.getCellId(d,f);if(this.has(_))return 2}return 0}},{key:"_mark",value:function(e,t,i,n){for(var r=e-i/2,a=t-n/2,s=r+i,o=a+n,u=(0,An.uZ)(Math.floor(r/1),0,this._cols),l=(0,An.uZ)(Math.floor(a/1),0,this._rows),h=(0,An.uZ)(Math.ceil(s/1),0,this._cols),c=(0,An.uZ)(Math.ceil(o/1),0,this._rows),f=l;f<=c;f++)for(var d=u;d<=h;d++){var _=this.getCellId(d,f);this.set(_)}return!1}},{key:"_markMetrics",value:function(e){var t=e.id;do{for(var i=e.boundsCount,n=0;n<i;n++){var r=e.boundsComputedAnchorX(n),a=e.boundsComputedAnchorY(n),s=e.boundsWidth(n)+2,o=e.boundsHeight(n)+2;this._mark(r,a,s,o)}}while(e.peekId()===t&&e.next())}}]),e}(),Sn=i(49229),On=i(80724),Mn=Math.PI;function In(e,t){switch(t.transformationType){case On.hL.Additive:return function(e,t){return e+(Pn(t.minSize,e)||t.minDataValue)}(e,t);case On.hL.Constant:return function(e,t){var i=e.stops,n=i&&i.length&&i[0].size;return null==n&&(n=e.minSize),Pn(n,t)}(t,e);case On.hL.ClampedLinear:return function(e,t){var i=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),n=Pn(t.minSize,e),r=Pn(t.maxSize,e);return e<=t.minDataValue?n:e>=t.maxDataValue?r:n+i*(r-n)}(e,t);case On.hL.Proportional:return function(e,t){var i=e/t.minDataValue,n=Pn(t.minSize,e),r=Pn(t.maxSize,e),a=null;return a=i*n,(0,An.uZ)(a,n,r)}(e,t);case On.hL.Stops:return function(e,t){var i=function(e,t){if(!t)return;var i=0,n=t.length-1;return t.some((function(t,r){return e<t?(n=r,!0):(i=r,!1)})),[i,n,(e-t[i])/(t[n]-t[i])]}(e,t.cache.ipData),n=(0,Se.Z)(i,3),r=n[0],a=n[1],s=n[2];if(r===a)return Pn(t.stops[r].size,e);var o=Pn(t.stops[r].size,e);return o+(Pn(t.stops[a].size,e)-o)*s}(e,t);case On.hL.RealWorldSize:return function(e,t){var i=Sn.a[t.valueUnit],n=Pn(t.minSize,e),r=Pn(t.maxSize,e),a=t.valueRepresentation,s=null;return s="area"===a?2*Math.sqrt(e/Mn)/i:"radius"===a||"distance"===a?2*e/i:e/i,(0,An.uZ)(s,n,r)}(e,t);case On.hL.Identity:return e;case On.hL.Unknown:return null}}function Pn(e,t){return"number"==typeof e?e:In(t,e)}var Dn=255;function Un(e,t){var i=[];e.forEachTile((function(e){return i.push(e)})),i.sort((function(e,t){return e.instanceId-t.instanceId})),i.forEach((function(e){(0,m.pC)(e.labelMetrics)&&e.isReady&&t(e,e.labelMetrics.getCursor())}))}function Nn(e){return function(t){return(0,ce.F2)(In(t,e))}}function Ln(e,t){if(function(e){return e.layer&&("feature"===e.layer.type||"csv"===e.layer.type||"geojson"===e.layer.type||"ogc-feature"===e.layer.type||"stream"===e.layer.type||"subtype-group"===e.layer.type||"wfs"===e.layer.type)}(t)){var i="subtype-group"===t.layer.type?t.layer.sublayers.items:[t.layer],n=t.layer.geometryType,r=!function(e){var t,i=(0,s.Z)(e);try{for(i.s();!(t=i.n()).done;){var n=t.value,r="featureReduction"in n&&n.featureReduction&&"labelingInfo"in n.featureReduction&&n.featureReduction,a=[].concat((0,Bn.Z)(n.labelingInfo||[]),(0,Bn.Z)((null===r||void 0===r?void 0:r.labelingInfo)||[]));if(n.labelsVisible&&a.length&&a.some((function(e){return"none"===e.deconflictionStrategy})))return!0}}catch(o){i.e(o)}finally{i.f()}return!1}(i),a={};if("subtype-group"!==t.layer.type){var o;if("heatmap"===(null===(o=t.tileRenderer)||void 0===o?void 0:o.type))return;var u=function(e){var t="visualVariables"in e&&e.visualVariables;if(!t)return null;var i,n=(0,s.Z)(t);try{for(n.s();!(i=n.n()).done;){var r=i.value;if("size"===r.type)return Nn(r)}}catch(a){n.e(a)}finally{n.f()}return null}(t.layer.renderer);a[0]=u}var l=t.tileRenderer;if(!(0,m.Wi)(l)){var h=t.layer.visible&&!t.suspended;e.push({tileRenderer:l,vvEvaluators:a,deconflictionEnabled:r,geometryType:n,visible:h})}}}var Zn=function(){function e(){(0,o.Z)(this,e)}return(0,u.Z)(e,[{key:"run",value:function(e,t,i){for(var n=[],r=e.length-1;r>=0;r--)Ln(n,e[r]);this._transformMetrics(n,t),this._runCollision(n,t,i)}},{key:"_runCollision",value:function(e,t,i){var n,r=this,a=(0,Se.Z)(t.state.size,2),o=a[0],u=a[1],l=new Cn(o*t.pixelRatio,u*t.pixelRatio),h=(0,s.Z)(e);try{var c=function(){var e=n.value,t=e.tileRenderer,a=e.deconflictionEnabled,s=e.visible,o=t.featuresView.attributeView;a?s?(r._prepare(t),r._collideVisible(l,t,i),r._collideInvisible(l,t)):Un(t,(function(e,t){for(;t.nextId();)o.setLabelMinZoom(t.id,Dn)})):Un(t,(function(e,t){for(;t.nextId();)o.setLabelMinZoom(t.id,0)}))};for(h.s();!(n=h.n()).done;)c()}catch(f){h.e(f)}finally{h.f()}}},{key:"_isFiltered",value:function(e,t,i){var n=t.getFilterFlags(e),r=!i.hasFilter||!!(n&pe.Zd),a=(0,m.Wi)(i.featureEffect)||i.featureEffect.excludedLabelsVisible||!!(n&pe.iV);return!(r&&a)}},{key:"_prepare",value:function(e){var t=this,i=e.featuresView.attributeView,n=new Set;Un(e,(function(r,a){for(;a.nextId();)n.has(a.id)||(n.add(a.id),t._isFiltered(a.id,i,e.layerView)?i.setLabelMinZoom(a.id,254):0!==i.getLabelMinZoom(a.id)?i.setLabelMinZoom(a.id,Dn):i.setLabelMinZoom(a.id,0))}))}},{key:"_collideVisible",value:function(e,t,i){var n=t.featuresView.attributeView,r=new Set;Un(t,(function(t,a){for(;a.nextId();)if(!r.has(a.id))if(t.key.level===i){if(0===n.getLabelMinZoom(a.id))switch(e.insertMetrics(a)){case 1:break;case 2:n.setLabelMinZoom(a.id,254),r.add(a.id);break;case 0:n.setLabelMinZoom(a.id,0),r.add(a.id)}}else n.setLabelMinZoom(a.id,254)}))}},{key:"_collideInvisible",value:function(e,t){var i=t.featuresView.attributeView,n=new Set;Un(t,(function(t,r){for(;r.nextId();)if(!n.has(r.id)&&i.getLabelMinZoom(r.id)===Dn)switch(e.insertMetrics(r)){case 1:break;case 2:i.setLabelMinZoom(r.id,Dn),n.add(r.id);break;case 0:i.setLabelMinZoom(r.id,0),n.add(r.id)}}))}},{key:"_transformMetrics",value:function(e,t){var i,n=(0,s.Z)(e);try{var r=function(){var e=i.value,n=e.tileRenderer,r=e.geometryType,a=e.vvEvaluators;Un(n,(function(e,i){var s=n.featuresView.attributeView,o=e.transforms.labelMat2d;o[4]=Math.round(o[4]),o[5]=Math.round(o[5]);for(var u=o[4],l=o[5],h="polyline"===r;i.next();){var c=i.boundsCount,f=i.anchorX,d=i.anchorY,_=i.size,p=a[0];if((0,m.pC)(p)){var v=p(s.getVVSize(i.id));_=isNaN(v)||null==v||v===1/0?_:v}for(var g=i.directionX*(_/2),y=i.directionY*(_/2),b=0;b<c;b++){var E=f,x=i.anchorY;if(h){var w=E+i.boundsX(b)+g,T=x+i.boundsY(b)+y;t.state.rotation?(w=o[0]*w+o[2]*T+o[4],T=o[1]*w+o[3]*T+o[5]):(w+=u,T+=l),i.setBoundsComputedAnchorX(b,Math.floor(w)),i.setBoundsComputedAnchorY(b,Math.floor(T))}else{t.state.rotation?(E=o[0]*f+o[2]*d+o[4],x=o[1]*f+o[3]*d+o[5]):(E+=u,x+=l);var R=E+i.boundsX(b)+g,F=x+i.boundsY(b)+y;i.setBoundsComputedAnchorX(b,R),i.setBoundsComputedAnchorY(b,F)}}}}))};for(n.s();!(i=n.n()).done;)r()}catch(a){n.e(a)}finally{n.f()}}}]),e}();le.Z.getLogger("esri.views.2d.layers.labels.LabelManager");var zn=function(e){(0,f.Z)(i,e);var t=(0,d.Z)(i);function i(e){var n;return(0,o.Z)(this,i),(n=t.call(this,e))._applyVisibilityPassThrottled=(0,Tn.P)(n._applyVisibilityPass,32,(0,l.Z)(n)),n.lastUpdateId=-1,n.updateRequested=!1,n.view=null,n}return(0,u.Z)(i,[{key:"initialize",value:function(){this.collisionEngine=new Zn}},{key:"destroy",value:function(){this.collisionEngine=null,this._applyVisibilityPassThrottled.remove(),this._applyVisibilityPassThrottled=null}},{key:"updating",get:function(){return this.updateRequested}},{key:"update",value:function(e){this._applyVisibilityPassThrottled(e)}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"requestUpdate",value:function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}},{key:"processUpdate",value:function(e){this._set("updateParameters",e),this.updateRequested&&(this.updateRequested=!1,this.update(e))}},{key:"_applyVisibilityPass",value:function(e){try{var t=this.view.featuresTilingScheme.getClosestInfoForScale(e.state.scale).level;this.collisionEngine.run(this.view.allLayerViews.items,e,t)}catch(B){}}}]),i}((0,wn.p)(xn.Z));(0,En._)([(0,Rn.Cb)()],zn.prototype,"updateRequested",void 0),(0,En._)([(0,Rn.Cb)({readOnly:!0})],zn.prototype,"updateParameters",void 0),(0,En._)([(0,Rn.Cb)()],zn.prototype,"updating",null),(0,En._)([(0,Rn.Cb)()],zn.prototype,"view",void 0);var Gn=zn=(0,En._)([(0,Fn.j)("esri.views.2d.layers.labels.LabelManager")],zn),Vn=i(34035),Wn=i(75391),Xn=i(13894),Hn=i(7882),qn=i(86226),jn=i(91806),Yn="esri-zoom-box__container",Kn="esri-zoom-box__overlay",Qn="esri-zoom-box__overlay-background",$n="esri-zoom-box__outline",Jn="Shift",er="Ctrl",tr=function(e){(0,f.Z)(i,e);var t=(0,d.Z)(i);function i(e){var n;return(0,o.Z)(this,i),(n=t.call(this,e))._container=null,n._overlay=null,n._backgroundShape=null,n._boxShape=null,n._box={x:0,y:0,width:0,height:0},n._redraw=n._redraw.bind((0,l.Z)(n)),n}return(0,u.Z)(i,[{key:"destroy",value:function(){this.view=null}},{key:"view",set:function(e){var t=this;this._handles&&this._handles.forEach((function(e){e.remove()})),this._handles=null,this._destroyOverlay(),this._set("view",e),e&&(e.on("drag",[Jn],(function(e){return t._handleDrag(e,1)}),jn.f.INTERNAL),e.on("drag",[Jn,er],(function(e){return t._handleDrag(e,-1)}),jn.f.INTERNAL))}},{key:"_start",value:function(){this._createContainer(),this._createOverlay(),this.navigation.begin()}},{key:"_update",value:function(e,t,i,n){this._box.x=e,this._box.y=t,this._box.width=i,this._box.height=n,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}},{key:"_end",value:function(e,t,i,n,r){var a=this.view,s=a.toMap((0,ce.vW)(e+.5*i,t+.5*n)),o=Math.max(i/a.width,n/a.height);-1===r&&(o=1/o),this._destroyOverlay(),this.navigation.end(),a.goTo({center:s,scale:a.scale*o})}},{key:"_updateBox",value:function(e,t,i,n){var r=this._boxShape;r.setAttributeNS(null,"x",""+e),r.setAttributeNS(null,"y",""+t),r.setAttributeNS(null,"width",""+i),r.setAttributeNS(null,"height",""+n),r.setAttributeNS(null,"class",$n)}},{key:"_updateBackground",value:function(e,t,i,n){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(e,t,i,n,this.view.width,this.view.height))}},{key:"_createContainer",value:function(){var e=document.createElement("div");e.className=Yn,this.view.root.appendChild(e),this._container=e}},{key:"_createOverlay",value:function(){var e=this.view.width,t=this.view.height,i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M 0 0 L "+e+" 0 L "+e+" "+t+" L 0 "+t+" Z"),i.setAttributeNS(null,"class",Qn);var n=document.createElementNS("http://www.w3.org/2000/svg","rect"),r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),r.setAttributeNS(null,"class",Kn),r.appendChild(i),r.appendChild(n),this._container.appendChild(r),this._backgroundShape=i,this._boxShape=n,this._overlay=r}},{key:"_destroyOverlay",value:function(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}},{key:"_toSVGPath",value:function(e,t,i,n,r,a){var s=e+i,o=t+n;return"M 0 0 L "+r+" 0 L "+r+" "+a+" L 0 "+a+" ZM "+e+" "+t+" L "+e+" "+o+" L "+s+" "+o+" L "+s+" "+t+" Z"}},{key:"_handleDrag",value:function(e,t){var i,n,r,a,s=e.x,o=e.y,u=e.origin.x,l=e.origin.y;switch(s>u?(i=u,r=s-u):(i=s,r=u-s),o>l?(n=l,a=o-l):(n=o,a=l-o),e.action){case"start":this._start();break;case"update":this._update(i,n,r,a);break;case"end":this._end(i,n,r,a,t)}e.stopPropagation()}},{key:"_redraw",value:function(){if(this._rafId&&(this._rafId=null,this._overlay)){var e=this._box,t=e.x,i=e.y,n=e.width,r=e.height;this._updateBox(t,i,n,r),this._updateBackground(t,i,n,r),this._rafId=requestAnimationFrame(this._redraw)}}}]),i}(xn.Z);(0,En._)([(0,Rn.Cb)()],tr.prototype,"navigation",void 0),(0,En._)([(0,Rn.Cb)()],tr.prototype,"view",null);var ir=tr=(0,En._)([(0,Fn.j)("esri.views.2d.navigation.ZoomBox")],tr),nr=(i(59486),function(){function e(t){(0,o.Z)(this,e),this.gain=t}return(0,u.Z)(e,[{key:"update",value:function(e){if(this.hasLastValue){var t=this.computeDelta(e);this._updateDelta(t)}this.lastValue=e}},{key:"reset",value:function(){this.lastValue=void 0,this.filteredDelta=void 0}},{key:"hasLastValue",get:function(){return void 0!==this.lastValue}},{key:"hasFilteredDelta",get:function(){return void 0!==this.filteredDelta}},{key:"computeDelta",value:function(e){return e-this.lastValue}},{key:"_updateDelta",value:function(e){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*e:this.filteredDelta=e}}]),e}()),rr=function(){function e(t,i,n){(0,o.Z)(this,e),this._initialVelocity=t,this._stopVelocity=i,this._friction=n,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}return(0,u.Z)(e,[{key:"duration",get:function(){return this._duration}},{key:"isFinished",value:function(e){return e>this.duration}},{key:"friction",get:function(){return this._friction}},{key:"value",value:function(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}},{key:"valueDelta",value:function(e,t){var i=this.value(e);return this.value(e+t)-i}},{key:"valueFromInitialVelocity",value:function(e,t){t=Math.min(t,this.duration);var i=1-this.friction;return e*(Math.pow(i,t)-1)/Math.log(i)}}]),e}(),ar=function(e){(0,f.Z)(i,e);var t=(0,d.Z)(i);function i(e,n,r,a,s){var u;return(0,o.Z)(this,i),(u=t.call(this,e,n,r)).sceneVelocity=a,u.direction=s,u}return(0,u.Z)(i,[{key:"value",value:function(e){return(0,h.Z)((0,c.Z)(i.prototype),"valueFromInitialVelocity",this).call(this,this.sceneVelocity,e)}}]),i}(rr),sr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.84;(0,o.Z)(this,e),this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=n,this.enabled=!0,this.time=new nr(.6),this.screen=[new nr(.4),new nr(.4)],this.scene=[new nr(.6),new nr(.6),new nr(.6)],this.tmpDirection=(0,zt.c)()}return(0,u.Z)(e,[{key:"add",value:function(e,t,i){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(i)<.015)return;this.screen[0].update(e[0]),this.screen[1].update(e[1]),this.scene[0].update(t[0]),this.scene[1].update(t[1]),this.scene[2].update(t[2]),this.time.update(i)}}},{key:"reset",value:function(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}},{key:"evaluateMomentum",value:function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var e=this.screen[0].filteredDelta,t=this.screen[1].filteredDelta,i=Math.sqrt(e*e+t*t)/this.time.filteredDelta;return Math.abs(i)<this.minimumInitialVelocity?null:this.createMomentum(i,this.stopVelocity,this.friction)}},{key:"createMomentum",value:function(e,t,i){(0,Zt.s)(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);var n=(0,Zt.l)(this.tmpDirection);n>0&&(0,Zt.g)(this.tmpDirection,this.tmpDirection,1/n);var r=n/this.time.filteredDelta;return new ar(e,t,i,r,this.tmpDirection)}}]),e}(),or=function(e){(0,f.Z)(i,e);var t=(0,d.Z)(i);function i(e){var n;return(0,o.Z)(this,i),(n=t.call(this,e)).animationTime=0,n.momentumEstimator=new sr(500,6,.92),n.momentum=null,n.tmpMomentum=(0,zt.c)(),n.momentumFinished=!1,n.viewpoint=new Xn.Z({targetGeometry:new Hn.Z,scale:0,rotation:0}),(0,g.gx)((function(){return n.momentumFinished}),(function(){return n.navigation.stop()})),n}return(0,u.Z)(i,[{key:"begin",value:function(e,t){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(t),this.previousDrag=t}},{key:"update",value:function(e,t){this.addToEstimator(t);var i=t.center.x,n=t.center.y,r=this.previousDrag;i=r?r.center.x-i:-i,n=r?n-r.center.y:n,e.viewpoint=(0,qn.Rx)(this.viewpoint,e.viewpoint,[i||0,n||0]),this.previousDrag=t}},{key:"end",value:function(e,t){this.addToEstimator(t);var i=e.navigation.momentumEnabled;this.momentum=i?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(e),this.previousDrag=null,this.navigation.end()}},{key:"addToEstimator",value:function(e){var t=e.center.x,i=e.center.y,n=(0,ce.s1)(-t,i),r=(0,zt.f)(-t,i,0);this.momentumEstimator.add(n,r,.001*e.timestamp)}},{key:"onAnimationUpdate",value:function(e){var t=this;this.navigation.animationManager.animateContinous(e.viewpoint,(function(i,n){t.momentumFinished=!t.momentum||t.momentum.isFinished(t.animationTime);var r=.001*n;if(!t.momentumFinished){var a=t.momentum.valueDelta(t.animationTime,r);(0,Zt.g)(t.tmpMomentum,t.momentum.direction,a),(0,qn.Rx)(i,i,t.tmpMomentum),e.constraints.constrainByGeometry(i)}t.animationTime+=r}))}},{key:"stopMomentumNavigation",value:function(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}}]),i}(xn.Z);(0,En._)([(0,Rn.Cb)()],or.prototype,"momentumFinished",void 0),(0,En._)([(0,Rn.Cb)()],or.prototype,"viewpoint",void 0),(0,En._)([(0,Rn.Cb)()],or.prototype,"navigation",void 0);var ur=or=(0,En._)([(0,Fn.j)("esri.views.2d.navigation.actions.Pan")],or),lr=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2.5,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12;(0,o.Z)(this,e),this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=n,this.maxVelocity=r,this.enabled=!0,this.value=new nr(.8),this.time=new nr(.3)}return(0,u.Z)(e,[{key:"add",value:function(e,t){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(t)<.01)return;if(this.value.hasFilteredDelta){var i=this.value.computeDelta(e);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(t),this.value.update(e)}}},{key:"reset",value:function(){this.value.reset(),this.time.reset()}},{key:"evaluateMomentum",value:function(){if(!this.enabled||!this.value.hasFilteredDelta)return null;var e=this.value.filteredDelta/this.time.filteredDelta;return e=(0,An.uZ)(e,-this.maxVelocity,this.maxVelocity),Math.abs(e)<this.minimumInitialVelocity?null:this.createMomentum(e,this.stopVelocity,this.friction)}},{key:"createMomentum",value:function(e,t,i){return new rr(e,t,i)}}]),e}(),hr=function(e){(0,f.Z)(i,e);var t=(0,d.Z)(i);function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12;return(0,o.Z)(this,i),t.call(this,e,n,r,a)}return(0,u.Z)(i,[{key:"add",value:function(e,t){if(this.value.hasLastValue){for(var n=this.value.lastValue,r=e-n;r>Math.PI;)r-=2*Math.PI;for(;r<-Math.PI;)r+=2*Math.PI;e=n+r}(0,h.Z)((0,c.Z)(i.prototype),"add",this).call(this,e,t)}}]),i}(lr),cr=function(e){(0,f.Z)(i,e);var t=(0,d.Z)(i);function i(e,n,r){return(0,o.Z)(this,i),t.call(this,e,n,r)}return(0,u.Z)(i,[{key:"value",value:function(e){var t=(0,h.Z)((0,c.Z)(i.prototype),"value",this).call(this,e);return Math.exp(t)}},{key:"valueDelta",value:function(e,t){var n=(0,h.Z)((0,c.Z)(i.prototype),"value",this).call(this,e),r=(0,h.Z)((0,c.Z)(i.prototype),"value",this).call(this,e+t)-n;return Math.exp(r)}}]),i}(rr),fr=function(e){(0,f.Z)(i,e);var t=(0,d.Z)(i);function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2.5,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12;return(0,o.Z)(this,i),t.call(this,e,n,r,a)}return(0,u.Z)(i,[{key:"add",value:function(e,t){(0,h.Z)((0,c.Z)(i.prototype),"add",this).call(this,Math.log(e),t)}},{key:"createMomentum",value:function(e,t,i){return new cr(e,t,i)}}]),i}(lr),dr=function(e){(0,f.Z)(i,e);var t=(0,d.Z)(i);function i(e){var n;return(0,o.Z)(this,i),(n=t.call(this,e))._animationTime=0,n._momentumFinished=!1,n._rotationMomentumEstimator=new hr(.6,.15,.95),n._rotationDirection=1,n._zoomDirection=1,n._zoomMomentumEstimator=new fr,n._zoomOnly=null,n.zoomMomentum=null,n.rotateMomentum=null,n.viewpoint=new Xn.Z({targetGeometry:new Hn.Z,scale:0,rotation:0}),n.own((0,g.gx)((function(){return n._momentumFinished}),(function(){return n.navigation.stop()}))),n}return(0,u.Z)(i,[{key:"begin",value:function(e,t){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=t.angle,this._previousRadius=this._startRadius=t.radius,this._previousCenter=t.center,this._updateTimestamp=null,e.constraints.rotationEnabled&&this.addToRotateEstimator(0,t.timestamp),this.addToZoomEstimator(t,1)}},{key:"update",value:function(e,t){null===this._updateTimestamp&&(this._updateTimestamp=t.timestamp);var i=t.angle,n=t.radius,r=t.center,a=Math.abs(180*(i-this._startAngle)/Math.PI),s=Math.abs(n-this._startRadius),o=this._startRadius/n;if(this._previousRadius){var u=n/this._previousRadius,l=180*(i-this._previousAngle)/Math.PI;this._rotationDirection=l>=0?1:-1,this._zoomDirection=u>=1?1:-1,e.constraints.rotationEnabled?(null===this._zoomOnly&&t.timestamp-this._updateTimestamp>200&&(this._zoomOnly=s-a>0),null===this._zoomOnly||this._zoomOnly?l=0:this.addToRotateEstimator(i-this._startAngle,t.timestamp)):l=0,this.addToZoomEstimator(t,o),this.navigation.setViewpoint([r.x,r.y],1/u,l,[this._previousCenter.x-r.x,r.y-this._previousCenter.y])}this._previousAngle=i,this._previousRadius=n,this._previousCenter=r}},{key:"end",value:function(e){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(e),this.navigation.end()}},{key:"addToRotateEstimator",value:function(e,t){this._rotationMomentumEstimator.add(e,.001*t)}},{key:"addToZoomEstimator",value:function(e,t){this._zoomMomentumEstimator.add(t,.001*e.timestamp)}},{key:"canZoomIn",value:function(e){var t=e.scale,i=e.constraints.effectiveMaxScale;return 0===i||t>i}},{key:"canZoomOut",value:function(e){var t=e.scale,i=e.constraints.effectiveMinScale;return 0===i||t<i}},{key:"onAnimationUpdate",value:function(e){var t=this;this.navigation.animationManager.animateContinous(e.viewpoint,(function(i,n){var r=!t.canZoomIn(e)&&t._zoomDirection>1||!t.canZoomOut(e)&&t._zoomDirection<1,a=!t.rotateMomentum||t.rotateMomentum.isFinished(t._animationTime),s=r||!t.zoomMomentum||t.zoomMomentum.isFinished(t._animationTime),o=.001*n;if(t._momentumFinished=a&&s,!t._momentumFinished){var u=t.rotateMomentum?Math.abs(t.rotateMomentum.valueDelta(t._animationTime,o))*t._rotationDirection*180/Math.PI:0,l=t.zoomMomentum?Math.abs(t.zoomMomentum.valueDelta(t._animationTime,o)):1,h=(0,Lt.a)(),c=(0,Lt.a)();if(t._previousCenter){(0,fe.a)(h,t._previousCenter.x,t._previousCenter.y),(0,qn.Dq)(c,e.size,e.padding),(0,fe.b)(h,h,c);var f=e.constraints,d=e.scale,_=d*l;l<1&&!f.canZoomInTo(_)?(l=d/f.effectiveMaxScale,t.zoomMomentum=null,t.rotateMomentum=null):l>1&&!f.canZoomOutTo(_)&&(l=d/f.effectiveMinScale,t.zoomMomentum=null,t.rotateMomentum=null),(0,qn.UZ)(i,e.viewpoint,l,u,h,e.size),e.constraints.constrainByGeometry(i)}}t._animationTime+=o}))}},{key:"stopMomentumNavigation",value:function(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}}]),i}(xn.Z);(0,En._)([(0,Rn.Cb)()],dr.prototype,"_momentumFinished",void 0),(0,En._)([(0,Rn.Cb)()],dr.prototype,"viewpoint",void 0),(0,En._)([(0,Rn.Cb)()],dr.prototype,"navigation",void 0);var _r=dr=(0,En._)([(0,Fn.j)("esri.views.2d.navigation.actions.Pinch")],dr),pr=(0,Lt.a)(),vr=(0,Lt.a)(),mr=function(e){(0,f.Z)(i,e);var t=(0,d.Z)(i);function i(e){var n;return(0,o.Z)(this,i),(n=t.call(this,e))._previousCenter=(0,Lt.a)(),n.viewpoint=new Xn.Z({targetGeometry:new Hn.Z,scale:0,rotation:0}),n}return(0,u.Z)(i,[{key:"begin",value:function(e,t){this.navigation.begin(),(0,fe.a)(this._previousCenter,t.center.x,t.center.y)}},{key:"update",value:function(e,t){var i=e.state,n=i.size,r=i.padding;(0,fe.a)(pr,t.center.x,t.center.y),(0,qn.ni)(vr,n,r),e.viewpoint=(0,qn.$H)(this.viewpoint,e.state.paddedViewState.viewpoint,(0,qn.dI)(vr,this._previousCenter,pr)),(0,fe.c)(this._previousCenter,pr)}},{key:"end",value:function(){this.navigation.end()}}]),i}(xn.Z);(0,En._)([(0,Rn.Cb)()],mr.prototype,"viewpoint",void 0),(0,En._)([(0,Rn.Cb)()],mr.prototype,"navigation",void 0);var gr=mr=(0,En._)([(0,Fn.j)("esri.views.2d.actions.Rotate")],mr),yr=new Xn.Z({targetGeometry:new Hn.Z}),br=[0,0],Er=function(e){(0,f.Z)(i,e);var t=(0,d.Z)(i);function i(e){var n;return(0,o.Z)(this,i),(n=t.call(this,e))._endTimer=null,n.animationManager=null,n}return(0,u.Z)(i,[{key:"initialize",value:function(){this.pan=new ur({navigation:this}),this.rotate=new gr({navigation:this}),this.pinch=new _r({navigation:this}),this.zoomBox=new ir({view:this.view,navigation:this})}},{key:"destroy",value:function(){this.pan.destroy(),this.rotate.destroy(),this.pinch.destroy(),this.zoomBox.destroy(),this.pan=this.rotate=this.pinch=this.zoomBox=this.animationManager=null}},{key:"begin",value:function(){this._set("interacting",!0)}},{key:"end",value:function(){this._lastEventTimestamp=performance.now(),this._startTimer(250)}},{key:"zoom",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var i,r=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.length>1&&void 0!==r[1]?r[1]:this._getDefaultAnchor(),this.stop(),this.begin(),!this.view.constraints.snapToZoom||!this.view.constraints.effectiveLODs){e.next=3;break}return e.abrupt("return",t<1?this.zoomIn(i):this.zoomOut(i));case 3:this.setViewpoint(i,t,0,[0,0]);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"zoomIn",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var i,r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.view,r=i.constraints.snapToNextScale(i.scale),e.abrupt("return",this._zoomToScale(r,t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"zoomOut",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var i,r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.view,r=i.constraints.snapToPreviousScale(i.scale),e.abrupt("return",this._zoomToScale(r,t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setViewpoint",value:function(e,t,i,n){this.begin(),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,e,t,i,n),this.end()}},{key:"setViewpointImmediate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._getDefaultAnchor();this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,n,e,t,i)}},{key:"continousRotateClockwise",value:function(){var e=this.get("view.viewpoint");this.animationManager.animateContinous(e,(function(e){(0,qn.$H)(e,e,-1)}))}},{key:"continousRotateCounterclockwise",value:function(){var e=this.get("view.viewpoint");this.animationManager.animateContinous(e,(function(e){(0,qn.$H)(e,e,1)}))}},{key:"resetRotation",value:function(){this.view.rotation=0}},{key:"continousPanLeft",value:function(){this._continuousPan([-10,0])}},{key:"continousPanRight",value:function(){this._continuousPan([10,0])}},{key:"continousPanUp",value:function(){this._continuousPan([0,10])}},{key:"continousPanDown",value:function(){this._continuousPan([0,-10])}},{key:"stop",value:function(){this.pan.stopMomentumNavigation(),this.animationManager.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}},{key:"_continuousPan",value:function(e){var t=this,i=this.view.viewpoint;this.animationManager.animateContinous(i,(function(i){(0,qn.Rx)(i,i,e),t.view.constraints.constrainByGeometry(i)}))}},{key:"_startTimer",value:function(e){var t=this;return null!==this._endTimer||(this._endTimer=setTimeout((function(){t._endTimer=null;var e=performance.now()-t._lastEventTimestamp;e<250?t._endTimer=t._startTimer(e):t._set("interacting",!1)}),e)),this._endTimer}},{key:"_getDefaultAnchor",value:function(){var e=this.view,t=e.size,i=e.padding,n=i.left,r=i.right,a=i.top,s=i.bottom;return br[0]=.5*(t[0]-r+n),br[1]=.5*(t[1]-s+a),br}},{key:"_zoomToScale",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var i,r,a,s,o,u,l,h,c,f=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=f.length>1&&void 0!==f[1]?f[1]:this._getDefaultAnchor(),r=this.view,a=r.constraints,s=r.scale,o=r.viewpoint,u=r.size,l=r.padding,h=a.canZoomInTo(t),c=a.canZoomOutTo(t),t<s&&!h||t>s&&!c){e.next=4;break}return e.abrupt("return",((0,qn.gG)(yr,o,t/s,0,i,u,l),a.constrainByGeometry(yr),r.goTo(yr,{animate:!0})));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_scaleRotateTranslateViewpoint",value:function(e,t,i,n,r){var a=this.view,s=a.size,o=a.padding,u=a.constraints,l=a.scale,h=a.viewpoint,c=l*i,f=u.canZoomInTo(c),d=u.canZoomOutTo(c);return(i<1&&!f||i>1&&!d)&&(i=1),(0,qn.Rx)(h,h,r),(0,qn.gG)(e,h,i,n,t,s,o),u.constrainByGeometry(e)}}]),i}(xn.Z);(0,En._)([(0,Rn.Cb)()],Er.prototype,"animationManager",void 0),(0,En._)([(0,Rn.Cb)({type:Boolean,readOnly:!0})],Er.prototype,"interacting",void 0),(0,En._)([(0,Rn.Cb)()],Er.prototype,"pan",void 0),(0,En._)([(0,Rn.Cb)()],Er.prototype,"pinch",void 0),(0,En._)([(0,Rn.Cb)()],Er.prototype,"rotate",void 0),(0,En._)([(0,Rn.Cb)()],Er.prototype,"view",void 0),(0,En._)([(0,Rn.Cb)()],Er.prototype,"zoomBox",void 0);var xr=Er=(0,En._)([(0,Fn.j)("esri.views.2d.navigation.MapViewNavigation")],Er),wr=i(100),Tr=i(35995),Rr=i(87422),Fr={shaders:{vertexShader:(0,H.w)("magnifier/magnifier.vert"),fragmentShader:(0,H.w)("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};var Br=i(38330);function Ar(e){return kr.apply(this,arguments)}function kr(){return kr=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a,s,o,u;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.e(3581).then(i.bind(i,83581)),a=i.e(8938).then(i.bind(i,78938)),e.t0=Br.t,e.next=5,r;case 5:return e.t1=e.sent.default,e.t2={signal:t},s=(0,e.t0)(e.t1,e.t2),e.t3=Br.t,e.next=11,a;case 11:return e.t4=e.sent.default,e.t5={signal:t},o=(0,e.t3)(e.t4,e.t5),e.next=16,s;case 16:return e.t6=e.sent,e.next=19,o;case 19:return e.t7=e.sent,u={mask:e.t6,overlay:e.t7},e.abrupt("return",((0,he.k_)(t),u));case 22:case"end":return e.stop()}}),e)}))),kr.apply(this,arguments)}var Cr=function(e){(0,f.Z)(i,e);var t=(0,d.Z)(i);function i(){var e;return(0,o.Z)(this,i),(e=t.call(this))._handles=new wr.Z,e._resourcePixelRatio=1,e.visible=!1,e}return(0,u.Z)(i,[{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this._disposeRenderResources(),this._resourcesTask&&(this._resourcesTask.abort(),this._resourcesTask=null)}},{key:"background",get:function(){return this._background},set:function(e){this._background=e,this.requestRender()}},{key:"magnifier",get:function(){return this._magnifier},set:function(e){var t=this;this._magnifier=e,this._handles.removeAll(),this._handles.add([(0,g.YP)((function(){return e.version}),(function(){t.visible=e.visible&&(0,m.pC)(e.position)&&e.size>0,t.requestRender()}),g.nn),(0,g.YP)((function(){return[e.maskUrl,e.overlayUrl]}),(function(){return t._reloadResources()})),(0,g.YP)((function(){return e.size}),(function(){t._disposeRenderResources(),t.requestRender()}))])}},{key:"_createTransforms",value:function(){return{dvs:(0,b.c)()}}},{key:"doRender",value:function(e){var t,i=e.context;if(this._resourcesTask){if(e.drawPhase===w.jx.MAP&&this._canRender()){this._updateResources(e);var n=this._magnifier;if(!(0,m.Wi)(n.position)){var r=e.pixelRatio,a=n.size*r,s=1/n.factor,o=Math.ceil(s*a);this._readbackTexture.resize(o,o);var u=e.state.size,l=r*u[0],h=r*u[1],c=.5*o,f=.5*o,d=(0,An.uZ)(r*n.position.x,c,l-c-1),_=(0,An.uZ)(h-r*n.position.y,f,h-f-1);i.setBlendingEnabled(!0);var p=d-c,v=_-f,g=this._readbackTexture;i.bindTexture(g,0),i.gl.copyTexImage2D(g.descriptor.target,0,g.descriptor.pixelFormat,p,v,o,o,0);var y=null===(t=this.background)||void 0===t?void 0:t.color,b=y?[y.a*y.r/255,y.a*y.g/255,y.a*y.b/255,y.a]:[1,1,1,1],E=(d+n.offset.x*r)/l*2-1,x=(_-n.offset.y*r)/h*2-1,T=a/l*2,R=a/h*2,F=this._program;i.bindVAO(this._vertexArrayObject),i.bindTexture(this._overlayTexture,6),i.bindTexture(this._maskTexture,7),i.useProgram(F),F.setUniform4fv("u_background",b),F.setUniform1i("u_readbackTexture",0),F.setUniform1i("u_overlayTexture",6),F.setUniform1i("u_maskTexture",7),F.setUniform4f("u_drawPos",E,x,T,R),F.setUniform1i("u_maskEnabled",n.maskEnabled?1:0),F.setUniform1i("u_overlayEnabled",n.overlayEnabled?1:0),i.setStencilTestEnabled(!1),i.setColorMask(!0,!0,!0,!0),i.drawArrays(Y.MX.TRIANGLE_STRIP,0,4),i.bindVAO()}}}else this._reloadResources()}},{key:"_canRender",value:function(){return this.mask&&this.overlay&&null!=this._magnifier}},{key:"_reloadResources",value:function(){var e=this;this._resourcesTask&&this._resourcesTask.abort();var t=(0,m.pC)(this._magnifier)?this._magnifier.maskUrl:null,i=(0,m.pC)(this._magnifier)?this._magnifier.overlayUrl:null;this._resourcesTask=(0,he.vr)(function(){var r=(0,a.Z)((0,n.Z)().mark((function r(a){var s,o,u,l,h,c,f;return(0,n.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=(0,m.Wi)(t)||(0,m.Wi)(i)?Ar(a):null,o=(0,m.pC)(t)?(0,oe.default)(t,{responseType:"image",signal:a}).then((function(e){return e.data})):s.then((function(e){return e.mask})),u=(0,m.pC)(i)?(0,oe.default)(i,{responseType:"image",signal:a}).then((function(e){return e.data})):s.then((function(e){return e.overlay})),n.next=5,Promise.all([o,u]);case 5:l=n.sent,h=(0,Se.Z)(l,2),c=h[0],f=h[1],e.mask=c,e.overlay=f,e._disposeRenderResources(),e.requestRender();case 10:case"end":return n.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},{key:"_disposeRenderResources",value:function(){this._readbackTexture=(0,m.O3)(this._readbackTexture),this._overlayTexture=(0,m.O3)(this._overlayTexture),this._maskTexture=(0,m.O3)(this._maskTexture),this._vertexArrayObject=(0,m.O3)(this._vertexArrayObject),this._program=(0,m.O3)(this._program)}},{key:"_updateResources",value:function(e){if(e.pixelRatio!==this._resourcePixelRatio&&this._disposeRenderResources(),!this._readbackTexture){var t=e.context;this._resourcePixelRatio=e.pixelRatio;var i=Math.ceil(this._magnifier.size*e.pixelRatio);this._program=function(e){return(0,K.H)(e,Fr)}(t);var n=new Uint16Array([0,1,0,0,1,1,1,0]),r=Fr.attributes;this._vertexArrayObject=new Q.U(t,r,X.cD,{geometry:j.f.createVertex(t,Y.l1.STATIC_DRAW,n)}),this.overlay.width=i,this.overlay.height=i,this._overlayTexture=new ye.x(t,{target:Y.No.TEXTURE_2D,pixelFormat:Y.VI.RGBA,internalFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,wrapMode:Y.e8.CLAMP_TO_EDGE,samplingMode:Y.cw.NEAREST,flipped:!0,preMultiplyAlpha:!(0,Tr.zd)(this.overlay.src)||!e.context.driverTest.svgAlwaysPremultipliesAlpha},this.overlay),this.mask.width=i,this.mask.height=i,this._maskTexture=new ye.x(t,{target:Y.No.TEXTURE_2D,pixelFormat:Y.VI.ALPHA,internalFormat:Y.VI.ALPHA,dataType:Y.Br.UNSIGNED_BYTE,wrapMode:Y.e8.CLAMP_TO_EDGE,samplingMode:Y.cw.NEAREST,flipped:!0},this.mask);var a=1/this._magnifier.factor;this._readbackTexture=new ye.x(t,{target:Y.No.TEXTURE_2D,pixelFormat:Y.VI.RGBA,internalFormat:Y.VI.RGBA,dataType:Y.Br.UNSIGNED_BYTE,wrapMode:Y.e8.CLAMP_TO_EDGE,samplingMode:Y.cw.LINEAR,flipped:!1,width:Math.ceil(a*i),height:Math.ceil(a*i)})}}}]),i}(Rr.s)},78041:function(e,t,i){i.d(t,{Bh:function(){return _},E0:function(){return f},IB:function(){return u},K5:function(){return h},j7:function(){return l},je:function(){return d},ve:function(){return c},wu:function(){return s}});var n=i(68401),r=i(8548),a=i(36207),s=(0,a.wK)(r.zi.SRC_ALPHA,r.zi.ONE,r.zi.ONE_MINUS_SRC_ALPHA,r.zi.ONE_MINUS_SRC_ALPHA),o=(0,a.if)(r.zi.ONE,r.zi.ONE),u=(0,a.if)(r.zi.ZERO,r.zi.ONE_MINUS_SRC_ALPHA);function l(e){return e===n.Am.FrontFace?null:e===n.Am.Alpha?u:o}function h(e){return e===n.Am.FrontFace?a.LZ:null}var c=5e5,f={factor:-1,units:-2};function d(e){return e?f:null}function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.wb.LESS;return e===n.Am.NONE||e===n.Am.FrontFace?t:r.wb.LEQUAL}},68401:function(e,t,i){var n,r,a,s,o,u,l,h,c,f,d,_,p,v;i.d(t,{Am:function(){return s},CE:function(){return d},Gv:function(){return r},JJ:function(){return p},MX:function(){return f},Rw:function(){return u},V_:function(){return c},Vr:function(){return n},Yg:function(){return _},hU:function(){return l},jq:function(){return h}}),function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"}(n||(n={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(r||(r={})),function(e){e[e.NONE=0]="NONE",e[e.SMAA=1]="SMAA"}(a||(a={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"}(s||(s={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(o||(o={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(u||(u={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(l||(l={})),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(h||(h={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(c||(c={})),function(e){e[e.Triangle=0]="Triangle",e[e.Point=1]="Point",e[e.Line=2]="Line"}(f||(f={})),function(e){e[e.STRETCH=1]="STRETCH",e[e.PAD=2]="PAD"}(d||(d={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(_||(_={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(p||(p={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(v||(v={}))},68267:function(e,t,i){i.d(t,{G:function(){return u}});var n=i(15671),r=i(43144),a=i(92026),s=i(59447),o=i(47428),u=function(){function e(t){(0,n.Z)(this,e),this._rctx=t,this._store=new s.r}return(0,r.Z)(e,[{key:"dispose",value:function(){this._store.forEach((function(e){return e.forEach((function(e){return e.dispose()}))})),this._store.clear()}},{key:"acquire",value:function(e,t,i,n){var r=this._store.get(e,t);if((0,a.pC)(r))return r.ref(),r;var s=new o.$(this._rctx,e,t,i,n);return s.ref(),this._store.set(e,t,s),s}},{key:"test",get:function(){var e=0;return this._store.forEach((function(t){return t.forEach((function(t){return e+=t.hasGLName?2:1}))})),{cachedWebGLObjects:e}}}]),e}()},43411:function(e,t,i){function n(e,t,i){for(var n=0;n<i;++n)t[2*n]=e[n],t[2*n+1]=e[n]-t[2*n]}function r(e,t){for(var i=e.length,n=0;n<i;++n)s[0]=e[n],t[n]=s[0];return t}function a(e,t){for(var i=e.length,n=0;n<i;++n)s[0]=e[n],s[1]=e[n]-s[0],t[n]=s[1];return t}i.d(t,{GB:function(){return a},LF:function(){return n},U8:function(){return r}});var s=new Float32Array(2)},65706:function(e,t,i){function n(e){return"number"==typeof e.options[e.value]}function r(e){var t="";for(var i in e){var r=e[i];if("boolean"==typeof r)r&&(t+="#define ".concat(i,"\n"));else if("number"==typeof r)t+="#define ".concat(i," ").concat(r.toFixed(),"\n");else if("object"==typeof r)if(n(r)){var a=r.value,s=r.options,o=r.namespace,u=o?"".concat(o,"_"):"";for(var l in s)t+="#define ".concat(u).concat(l," ").concat(s[l].toFixed(),"\n");t+="#define ".concat(i," ").concat(u).concat(a,"\n")}else{var h=r.options,c=0;for(var f in h)t+="#define ".concat(h[f]," ").concat((c++).toFixed(),"\n");t+="#define ".concat(i," ").concat(h[r.value],"\n")}}return t}i.d(t,{K:function(){return r}})},36207:function(e,t,i){i.d(t,{BK:function(){return _},LZ:function(){return d},if:function(){return u},jp:function(){return V},sg:function(){return c},sm:function(){return w},wK:function(){return l},zp:function(){return f}});var n=i(1413),r=i(15671),a=i(43144),s=i(68401),o=i(8548);function u(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.db.ADD,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0,0];return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:n[0],g:n[1],b:n[2],a:n[3]}}}function l(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o.db.ADD,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:o.db.ADD,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0,0,0];return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:n,opRgb:r,opAlpha:a,color:{r:s[0],g:s[1],b:s[2],a:s[3]}}}var h={face:o.LR.BACK,mode:o.Wf.CCW},c={face:o.LR.FRONT,mode:o.Wf.CCW},f=function(e){return e===s.Vr.Back?h:e===s.Vr.Front?c:null},d={zNear:0,zFar:1},_={r:!0,g:!0,b:!0,a:!0};function p(e){return F.intern(e)}function v(e){return A.intern(e)}function m(e){return C.intern(e)}function g(e){return O.intern(e)}function y(e){return I.intern(e)}function b(e){return D.intern(e)}function E(e){return N.intern(e)}function x(e){return Z.intern(e)}function w(e){return G.intern(e)}var T=function(){function e(t,i){(0,r.Z)(this,e),this.makeKey=t,this.makeRef=i,this.interns=new Map}return(0,a.Z)(e,[{key:"intern",value:function(e){if(!e)return null;var t=this.makeKey(e),i=this.interns;return i.has(t)||i.set(t,this.makeRef(e)),i.get(t)}}]),e}();function R(e){return"["+e.join(",")+"]"}var F=new T(B,(function(e){return(0,n.Z)({__tag:"Blending"},e)}));function B(e){return e?R([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}var A=new T(k,(function(e){return(0,n.Z)({__tag:"Culling"},e)}));function k(e){return e?R([e.face,e.mode]):null}var C=new T(S,(function(e){return(0,n.Z)({__tag:"PolygonOffset"},e)}));function S(e){return e?R([e.factor,e.units]):null}var O=new T(M,(function(e){return(0,n.Z)({__tag:"DepthTest"},e)}));function M(e){return e?R([e.func]):null}var I=new T(P,(function(e){return(0,n.Z)({__tag:"StencilTest"},e)}));function P(e){return e?R([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}var D=new T(U,(function(e){return(0,n.Z)({__tag:"DepthWrite"},e)}));function U(e){return e?R([e.zNear,e.zFar]):null}var N=new T(L,(function(e){return(0,n.Z)({__tag:"ColorWrite"},e)}));function L(e){return e?R([e.r,e.g,e.b,e.a]):null}var Z=new T(z,(function(e){return(0,n.Z)({__tag:"StencilWrite"},e)}));function z(e){return e?R([e.mask]):null}var G=new T((function(e){return e?R([B(e.blending),k(e.culling),S(e.polygonOffset),M(e.depthTest),P(e.stencilTest),U(e.depthWrite),L(e.colorWrite),z(e.stencilWrite)]):null}),(function(e){return{blending:p(e.blending),culling:v(e.culling),polygonOffset:m(e.polygonOffset),depthTest:g(e.depthTest),stencilTest:y(e.stencilTest),depthWrite:b(e.depthWrite),colorWrite:E(e.colorWrite),stencilWrite:x(e.stencilWrite)}}));var V=function(){function e(t){(0,r.Z)(this,e),this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=t}return(0,a.Z)(e,[{key:"setPipeline",value:function(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}},{key:"invalidateBlending",value:function(){this._blendingInvalid=!0,this._pipelineInvalid=!0}},{key:"invalidateCulling",value:function(){this._cullingInvalid=!0,this._pipelineInvalid=!0}},{key:"invalidatePolygonOffset",value:function(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}},{key:"invalidateDepthTest",value:function(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}},{key:"invalidateStencilTest",value:function(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}},{key:"invalidateDepthWrite",value:function(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}},{key:"invalidateColorWrite",value:function(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}},{key:"invalidateStencilWrite",value:function(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}},{key:"_setBlending",value:function(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}},{key:"_setCulling",value:function(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}},{key:"_setPolygonOffset",value:function(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}},{key:"_setDepthTest",value:function(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}},{key:"_setStencilTest",value:function(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}},{key:"_setDepthWrite",value:function(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}},{key:"_setColorWrite",value:function(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}},{key:"_setStencilWrite",value:function(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}},{key:"_setSubState",value:function(e,t,i,n){return(i||e!==t)&&(n(e),this._pipelineInvalid=!0),e}}]),e}()}}]);
//# sourceMappingURL=7832.2772d807.chunk.js.map