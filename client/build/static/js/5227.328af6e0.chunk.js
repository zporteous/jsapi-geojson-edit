"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[5227],{32500:function(e,t,i){i.d(t,{I:function(){return C},b:function(){return w}});var n,a,r,o=i(30168),s=i(92026),l=i(6394),c=i(71011),u=i(33280),h=i(94951),p=i(15226),d=i(26461),f=i(116),v=i(82552),g=i(82999),_=i(58406),y=i(98634),m=i(64201),b=i(19253),M=i(68401),S=i(4760);function w(e){var t=new m.kG;(0,v.S)(t,e),t.include(h.w),t.attributes.add(S.T.POSITION,"vec3"),t.attributes.add(S.T.UV0,"vec2"),t.varyings.add("vpos","vec3"),e.hasMultipassTerrain&&t.varyings.add("depth","float");var i=t.vertex,w=t.fragment;return i.uniforms.add(new g.A("textureCoordinateScaleFactor",(function(e){return(0,s.pC)(e.texture)&&(0,s.pC)(e.texture.descriptor.textureCoordinateScaleFactor)?e.texture.descriptor.textureCoordinateScaleFactor:l.O}))),i.code.add((0,y.H)(n||(n=(0,o.Z)(["\n    void main(void) {\n      vpos = position;\n      ","\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  "])),e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":"")),t.include(u.f5,e),t.include(p.l,e),w.uniforms.add([new b.A("tex",(function(e){return e.texture})),new _.p("opacity",(function(e){return e.opacity}))]),t.varyings.add("vTexCoord","vec2"),e.output===c.H.Alpha?w.code.add((0,y.H)(a||(a=(0,o.Z)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n\n      float alpha = texture2D(tex, vTexCoord).a * opacity;\n      if (alpha  < ",") {\n        discard;\n      }\n\n      gl_FragColor = vec4(alpha);\n    }\n    "])),e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":"",y.H.float(d.F))):(w.include(f.Y),w.code.add((0,y.H)(r||(r=(0,o.Z)(["\n    void main() {\n      discardBySlice(vpos);\n      ","\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ",") {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      ","\n    }\n    "])),e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":"",y.H.float(d.F),e.transparencyPassType===M.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""))),t}var C=Object.freeze(Object.defineProperty({__proto__:null,build:w},Symbol.toStringTag,{value:"Module"}))},18300:function(e,t,i){i.d(t,{L:function(){return b},b:function(){return _}});var n,a,r=i(30168),o=i(14226),s=i(81949),l=i(88396),c=i(6394),u=i(8084),h=i(82999),p=i(58406),d=i(98634),f=i(8654),v=i(64201),g=i(4760);function _(e){var t=new v.kG;t.include(u.j,e);var i=t.vertex,s=t.fragment;return i.uniforms.add([new f.g("modelView",(function(e,t){return(0,o.j)(m,t.camera.viewMatrix,e.origin)})),new f.g("proj",(function(e,t){return t.camera.projectionMatrix})),new p.p("glowWidth",(function(e,t){return e.glowWidth*t.camera.pixelRatio})),new h.A("pixelToNDC",(function(e,t){return(0,l.a)(y,2/t.camera.fullViewport[2],2/t.camera.fullViewport[3])}))]),t.attributes.add(g.T.START,"vec3"),t.attributes.add(g.T.END,"vec3"),t.attributes.add(g.T.UP,"vec3"),t.attributes.add(g.T.EXTRUDE,"vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),i.code.add((0,d.H)(n||(n=(0,r.Z)(["void main() {\nvec3 pos = mix(start, end, extrude.x);\nvec4 viewPos = modelView * vec4(pos, 1);\nvec4 projPos = proj * viewPos;\nvec2 ndcPos = projPos.xy / projPos.w;\nvec3 viewUp = (modelView * vec4(extrude.y * up, 0)).xyz;\nvec4 projPosUp = proj * vec4(viewPos.xyz + viewUp, 1);\nvec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);\nvec2 lxy = abs(sign(projExtrudeDir) - ndcPos);\nndcPos += length(lxy) * projExtrudeDir;\nvec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));\nvec3 viewPlaneNormal = (modelView * vec4(worldPlaneNormal, 0)).xyz;\nvViewStart = (modelView * vec4(start, 1)).xyz;\nvViewEnd = (modelView * vec4(end, 1)).xyz;\nvViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));\nfloat xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;\nndcPos.x += xPaddingPixels * pixelToNDC.x;\nuv = ndcPos * 0.5 + 0.5;\ngl_Position = vec4(ndcPos, 0, 1);\n}"])))),s.uniforms.add(new p.p("perScreenPixelRatio",(function(e,t){return t.camera.perScreenPixelRatio}))),s.code.add((0,d.H)(a||(a=(0,r.Z)(["float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {\nvec3 origin = mix(start, end, 0.5);\nvec3 basis = end - origin;\nvec3 posAtOrigin = pos - origin;\nfloat x = dot(normalize(basis), posAtOrigin);\nfloat y = dot(plane.xyz, posAtOrigin);\nfloat dx = max(abs(x) - length(basis), 0.0);\nfloat dy = y;\nfloat dist = length(vec2(dx, dy));\nfloat width = fwidth(y);\nfloat maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;\nfloat pixelDist = dist / min(width, maxPixelDistance);\nreturn abs(pixelDist);\n}\nvoid main() {\nvec3 pos;\nvec3 normal;\nfloat depthDiscontinuityAlpha;\nif (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\ndiscard;\n}\nfloat distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);\nvec4 color = laserlineProfile(distance);\nfloat alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));\ngl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);\n}"])))),t}var y=(0,c.a)(),m=(0,s.c)(),b=Object.freeze(Object.defineProperty({__proto__:null,build:_},Symbol.toStringTag,{value:"Module"}))},83671:function(e,t,i){i.d(t,{L:function(){return T},b:function(){return k},d:function(){return O}});var n,a,r,o,s,l,c,u,h,p,d=i(30168),f=i(16889),v=i(92026),g=i(88396),_=i(6394),y=i(8084),m=i(74321),b=i(82999),M=i(86360),S=i(68827),w=i(58406),C=i(60465),x=i(98634),E=i(64201),O=(0,f.Vl)(6);function k(e){var t=new E.kG;t.extensions.add("GL_OES_standard_derivatives"),t.include(m.k),t.include(y.j,e);var i=t.fragment;return e.heightManifoldEnabled&&i.uniforms.add(new S.y("heightPlane")),e.pointDistanceEnabled&&i.uniforms.add(new S.y("pointDistanceSphere")),e.lineVerticalPlaneEnabled&&(i.uniforms.add(new S.y("lineVerticalPlane")),i.uniforms.add(new M.K("lineVerticalStart")),i.uniforms.add(new M.K("lineVerticalEnd"))),(e.heightManifoldEnabled||e.pointDistanceEnabled||e.lineVerticalPlaneEnabled)&&i.uniforms.add(new C.d("maxPixelDistance")),(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)&&i.code.add((0,x.H)(n||(n=(0,d.Z)(["float planeDistancePixels(vec4 plane, vec3 pos) {\nfloat dist = dot(plane.xyz, pos) + plane.w;\nfloat width = fwidth(dist);\ndist /= min(width, maxPixelDistance);\nreturn abs(dist);\n}"])))),e.pointDistanceEnabled&&i.code.add((0,x.H)(a||(a=(0,d.Z)(["float sphereDistancePixels(vec4 sphere, vec3 pos) {\nfloat dist = distance(sphere.xyz, pos) - sphere.w;\nfloat width = fwidth(dist);\ndist /= min(width, maxPixelDistance);\nreturn abs(dist);\n}"])))),e.intersectsLineEnabled&&(i.uniforms.add(new M.K("intersectsLineStart")),i.uniforms.add(new M.K("intersectsLineEnd")),i.uniforms.add(new M.K("intersectsLineDirection")),i.uniforms.add(new C.d("intersectsLineRadius")),i.uniforms.add(new w.p("perScreenPixelRatio",(function(e,t){return t.camera.perScreenPixelRatio}))),i.code.add((0,x.H)(r||(r=(0,d.Z)(["float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {\nfloat dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);\nreturn abs(dist) - radius;\n}"]))))),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&i.code.add((0,x.H)(o||(o=(0,d.Z)(["bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {\nvec3 dir = end - start;\nfloat t2 = dot(dir, pos - start);\nfloat l2 = dot(dir, dir);\nreturn t2 >= 0.0 && t2 <= l2;\n}"])))),i.code.add((0,x.H)(s||(s=(0,d.Z)(["void main() {\nvec3 pos;\nvec3 normal;\nfloat depthDiscontinuityAlpha;\nif (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\ndiscard;\n}\nvec4 color = vec4(0, 0, 0, 0);"])))),e.heightManifoldEnabled&&(i.uniforms.add(new b.A("angleCutoff",(function(e){return A(e)}))),i.code.add((0,x.H)(l||(l=(0,d.Z)(["{\nfloat heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, heightPlane.xyz)));\nvec4 heightManifoldColor = laserlineProfile(planeDistancePixels(heightPlane, pos));\ncolor = max(color, heightManifoldColor * heightManifoldAlpha);\n}"]))))),e.pointDistanceEnabled&&(i.uniforms.add(new b.A("angleCutoff",(function(e){return A(e)}))),i.code.add((0,x.H)(c||(c=(0,d.Z)(["{\nfloat pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);\nvec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);\nfloat pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));\ncolor = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);\n}"]))))),e.lineVerticalPlaneEnabled&&(i.uniforms.add(new b.A("angleCutoff",(function(e){return A(e)}))),i.code.add((0,x.H)(u||(u=(0,d.Z)(["{\nif (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {\nfloat lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);\nvec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);\nfloat lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));\ncolor = max(color, lineVerticalColor * lineVerticalAlpha);\n}\n}"]))))),e.intersectsLineEnabled&&(i.uniforms.add(new b.A("angleCutoff",(function(e){return A(e)}))),i.code.add((0,x.H)(h||(h=(0,d.Z)(["{\nif (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {\nfloat intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);\nvec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);\nfloat intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));\ncolor = max(color, intersectsLineColor * intersectsLineAlpha);\n}\n}"]))))),i.code.add((0,x.H)(p||(p=(0,d.Z)(["gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);\n}"])))),t}function A(e){var t=(0,v.pC)(e.angleCutoff)?e.angleCutoff:O;return(0,g.a)(P,Math.cos(t),Math.cos(Math.max(0,t-(0,f.Vl)(2))))}var P=(0,_.a)(),T=Object.freeze(Object.defineProperty({__proto__:null,defaultAngleCutoff:O,build:k},Symbol.toStringTag,{value:"Module"}))},72511:function(e,t,i){i.d(t,{S:function(){return R},b:function(){return A}});var n,a,r,o,s,l,c,u,h,p=i(30168),d=i(67077),f=i(43505),v=i(71011),g=i(33280),_=i(94951),y=i(15226),m=i(26461),b=i(116),M=i(82552),S=i(49450),w=i(95276),C=i(98634),x=i(8654),E=i(64201),O=i(68401),k=i(4760);function A(e){var t=new E.kG,i=e.hasMultipassTerrain&&(e.output===v.H.Color||e.output===v.H.Alpha);t.include(_.w),t.include(f.A,e),t.include(g.f5,e);var d=t.vertex,A=t.fragment;return A.include(b.Y),(0,M.S)(t,e),A.uniforms.add(new w.N("uColor",(function(e){return e.color}))),t.attributes.add(k.T.POSITION,"vec3"),t.varyings.add("vWorldPosition","vec3"),i&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add(k.T.OFFSET,"vec3"),e.shadingEnabled&&(d.uniforms.add(new x.g("viewNormal",(function(e,t){return t.camera.viewInverseTransposeMatrix}))),t.attributes.add(k.T.NORMAL,"vec3"),t.varyings.add("vViewNormal","vec3")),d.code.add((0,C.H)(n||(n=(0,p.Z)(["\n    void main(void) {\n      vWorldPosition = ",";\n  "])),e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position")),e.shadingEnabled&&d.code.add((0,C.H)(a||(a=(0,p.Z)(["vec3 worldNormal = normal;\nvViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;"])))),d.code.add((0,C.H)(r||(r=(0,p.Z)(["\n    ","\n    gl_Position = transformPosition(proj, view, vWorldPosition);\n  }\n  "])),i?"depth = (view * vec4(vWorldPosition, 1.0)).z;":"")),i&&t.include(y.l,e),A.code.add((0,C.H)(o||(o=(0,p.Z)(["\n    void main() {\n      discardBySlice(vWorldPosition);\n      ","\n    "])),i?"terrainDepthTest(gl_FragCoord, depth);":"")),e.shadingEnabled?(A.uniforms.add(new S.J("shadingDirection",(function(e){return e.shadingDirection}))),A.uniforms.add(new w.N("shadedColor",(function(e){return P(e.shadingTint,e.color)}))),A.code.add((0,C.H)(s||(s=(0,p.Z)(["vec3 viewNormalNorm = normalize(vViewNormal);\nfloat shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\nvec4 finalColor = mix(uColor, shadedColor, shadingFactor);"]))))):A.code.add((0,C.H)(l||(l=(0,p.Z)(["vec4 finalColor = uColor;"])))),A.code.add((0,C.H)(c||(c=(0,p.Z)(["\n      if (finalColor.a < ",") {\n        discard;\n      }\n      ","\n\n      ","\n    }\n    "])),C.H.float(m.b),e.output===v.H.Alpha?(0,C.H)(u||(u=(0,p.Z)(["gl_FragColor = vec4(finalColor.a);"]))):"",e.output===v.H.Color?(0,C.H)(h||(h=(0,p.Z)(["gl_FragColor = highlightSlice(finalColor, vWorldPosition); ",""])),e.transparencyPassType===O.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""):"")),t}function P(e,t){var i=1-e[3],n=e[3]+t[3]*i;return 0===n?(T[3]=n,T):(T[0]=(e[0]*e[3]+t[0]*t[3]*i)/n,T[1]=(e[1]*e[3]+t[1]*t[3]*i)/n,T[2]=(e[2]*e[3]+t[2]*t[3]*i)/n,T[3]=t[3],T)}var T=(0,d.c)(),R=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}))},11316:function(e,t,i){i.d(t,{S:function(){return d},b:function(){return p}});var n,a,r=i(30168),o=i(82552),s=i(95276),l=i(58406),c=i(98634),u=i(64201),h=i(4760);function p(e){var t=new u.kG;return t.extensions.add("GL_OES_standard_derivatives"),(0,o.S)(t,e),t.attributes.add(h.T.POSITION,"vec3"),t.attributes.add(h.T.UV0,"vec2"),t.varyings.add("vUV","vec2"),t.vertex.code.add((0,c.H)(n||(n=(0,r.Z)(["void main(void) {\nvUV = uv0;\ngl_Position = proj * view * vec4(position, 1.0);\n}"])))),t.fragment.uniforms.add([new s.N("backgroundColor",(function(e){return e.backgroundColor})),new s.N("gridColor",(function(e){return e.gridColor})),new l.p("gridWidth",(function(e){return e.gridWidth}))]),t.fragment.code.add((0,c.H)(a||(a=(0,r.Z)(["void main() {\nconst float LINE_WIDTH = 1.0;\nvec2 uvScaled = vUV * gridWidth;\nvec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));\nvec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);\ngrid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);\ngrid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);\nfloat gridFade = max(grid.x, grid.y);\nfloat gridAlpha = gridColor.a * gridFade;\ngl_FragColor =\nvec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +\nvec4(gridColor.rgb, 1.0) * gridAlpha;\n}"])))),t}var d=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}))},151:function(e,t,i){function n(){return new Float32Array(4)}function a(e){var t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function r(e,t,i,n){var a=new Float32Array(4);return a[0]=e,a[1]=t,a[2]=i,a[3]=n,a}function o(){return n()}function s(){return r(1,1,1,1)}function l(){return r(1,0,0,0)}function c(){return r(0,1,0,0)}function u(){return r(0,0,1,0)}function h(){return r(0,0,0,1)}i.d(t,{a:function(){return a},c:function(){return n},f:function(){return r}});var p=o(),d=s(),f=l(),v=c(),g=u(),_=h();Object.freeze(Object.defineProperty({__proto__:null,create:n,clone:a,fromValues:r,createView:function(e,t){return new Float32Array(e,t,4)},zeros:o,ones:s,unitX:l,unitY:c,unitZ:u,unitW:h,ZEROS:p,ONES:d,UNIT_X:f,UNIT_Y:v,UNIT_Z:g,UNIT_W:_},Symbol.toStringTag,{value:"Module"}))},66576:function(e,t,i){i.d(t,{B:function(){return M}});var n=i(74165),a=i(15861),r=i(1413),o=i(37762),s=i(92026),l=i(80292),c=i(35995),u=i(71907),h=i(33397),p=i(25265),d=i(49861);function f(e){return v[function(e){return e instanceof Blob?e.type:function(e){var t=(0,c.Ml)(e);return y[t]||g}(e.url)}(e)]||_}var v={},g="text/plain",_=v[g],y={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(var m in y)v[y[m]]=m;var b=i(53283);function M(e){var t=(0,s.pC)(e)&&e.origins?e.origins:[void 0];return function(i,n){var a,u=function(e,t,i){if((0,s.pC)(e)&&"resource"===e.type)return function(e,t,i){var n=(0,h.VZ)(t,i);return{type:String,read:function(e,t,i){var a=(0,b.r)(e,t,i);return n.type===String?a:"function"==typeof n.type?new n.type({url:a}):void 0},write:{writer:function(t,a,o,u){if(!u||!u.resources)return"string"==typeof t?void(a[o]=(0,b.t)(t,u)):void(a[o]=t.write({},u));var h=function(e){return(0,s.Wi)(e)?null:"string"==typeof e?e:e.url}(t),d=h?(0,b.t)(h,(0,r.Z)((0,r.Z)({},u),{},{verifyItemRelativeUrls:u&&u.verifyItemRelativeUrls?{writtenUrls:u.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null}),b.M.NO):null,v=n.type!==String&&(!(0,l.l)(this)||u&&u.origin&&this.originIdOf(i)>(0,p.M9)(u.origin));u&&u.portalItem&&(0,s.pC)(d)&&!(0,c.YP)(d)?v?function(e,t,i,n,a,r,o,s){var l=o.portalItem.resourceFromPath(n),u=C(i,n,o);f(u)===(0,c.Ml)(l.path)?(w(e,t,l,u,o.resources.toUpdate),a[r]=n):S(e,t,i,n,a,r,o,s)}(this,i,t,d,a,o,u,e):function(e,t,i,n){n.resources.toKeep.push({resource:n.portalItem.resourceFromPath(e)}),t[i]=e}(d,a,o,u):u&&u.portalItem&&((0,s.Wi)(d)||(0,s.pC)((0,b.i)(d))||(0,c.jc)(d)||v)?S(this,i,t,d,a,o,u,e):a[o]=d}}}}(e,t,i);switch((0,s.pC)(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":return{read:b.p.read,write:b.p.write}}}(e,i,n),v=(0,o.Z)(t);try{for(v.s();!(a=v.n()).done;){var g=a.value,_=(0,d.CJ)(i,g,n);for(var y in u)_[y]=u[y]}}catch(m){v.e(m)}finally{v.f()}}}function S(e,t,i,n,a,r,o,l){var h=(0,u.D)(),p=C(i,n,o),d=(0,c.v_)((0,s.U2)(l,"prefix"),h),v="".concat(d,".").concat(f(p)),g=o.portalItem.resourceFromPath(v);(0,c.jc)(n)&&o.resources.pendingOperations.push(function(e){return x.apply(this,arguments)}(n).then((function(e){g.path="".concat(d,".").concat(f(e)),a[r]=g.itemRelativeUrl})).catch((function(){}))),w(e,t,g,p,o.resources.toAdd),a[r]=g.itemRelativeUrl}function w(e,t,i,n,a){a.push({resource:i,content:n,finish:function(i){!function(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}(e,t,i)}})}function C(e,t,i){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}function x(){return x=(0,a.Z)((0,n.Z)().mark((function e(t){var a,r,o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(i.bind(i,76200));case 2:return a=e.sent.default,e.next=5,a(t,{responseType:"blob"});case 5:return r=e.sent,o=r.data,e.abrupt("return",o);case 8:case"end":return e.stop()}}),e)}))),x.apply(this,arguments)}},80292:function(e,t,i){function n(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,{l:function(){return n}})},45238:function(e,t,i){i.d(t,{EU:function(){return h},Ue:function(){return s},WH:function(){return p},ZZ:function(){return u},qC:function(){return c},uT:function(){return l}});var n=i(16889),a=i(48976),r=i(98131),o=i(11186);function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return[e[0],e[1],e[2],e[3]]}function l(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s();return(0,o.c)(i,e),i[3]=t,i}function c(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s();return(0,a.s)(v,e,p(e)),(0,a.s)(g,t,p(t)),(0,a.m)(v,g,v),d(i,(0,n.BV)((0,a.g)(i,v)))}function u(e){return e}function h(e){return e[3]}function p(e){return(0,n.Vl)(e[3])}function d(e,t){return e[3]=t,e}var f=[0,0,1,0],v=(0,r.a)(),g=(0,r.a)();s()},45227:function(e,t,i){i.r(t),i.d(t,{DrawGraphicTool3D:function(){return Ji},ExtentTransformTool:function(){return Ho},GraphicMoveTool:function(){return ja},GraphicReshapeTool:function(){return pr},GraphicTransformTool:function(){return Zr}});var n=i(1413),a=i(15671),r=i(43144),o=i(60136),s=i(54062),l=i(27366),c=i(42537),u=i(92026),h=i(94172),p=i(49861),d=(i(63780),i(93169)),f=i(25243),v=i(69912),g=i(74509),_=i(64575),y=i(17842),m=i(32718),b=(i(75366),i(71353)),M=i(93433),S=i(74165),w=i(15861),C=i(85015),x=i(66978),E=i(58935),O=i(68860),k=i(88396),A=i(6394),P=i(11186),T=i(69662),R=i(41201),Z=i(37762),D=i(29439),L=(i(42877),function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}}),G=function e(t,i,n){for(var a=0,r=i.length;a<r;a++){var o=i[a];Array.isArray(o)?e(t,o,n):null!=o&&!1!==o&&("string"==typeof o&&(o=L(o)),n.push(o))}};function I(e,t,i){if(Array.isArray(t))i=t,t=void 0;else if(t&&("string"==typeof t||t.hasOwnProperty("vnodeSelector"))||i&&("string"==typeof i||i.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");var n,a;return i&&1===i.length&&"string"==typeof i[0]?n=i[0]:i&&(G(e,i,a=[]),0===a.length&&(a=void 0)),{vnodeSelector:e,properties:t,children:a,text:""===n?void 0:n,domNode:null}}i(88367);var V={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"},z=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).x=0,n.y=0,n.text="-",n.fontSize=14,n.anchor="center",n.visible=!0,n._backgroundColor="rgba(0, 0, 0, 0.6)",n._textColor="white",n._textShadowColor=[0,0,0],n._textShadowSize=1,n}return(0,r.Z)(i,[{key:"position",get:function(){return[this.x,this.y]},set:function(e){this._set("x",e[0]),this._set("y",e[1])}},{key:"_textShadow",get:function(){var e=(0,D.Z)(this._textColor,3),t=e[0],i=e[1],n=e[2];return"0 0 ".concat(this._textShadowSize,"px rgb(").concat(t,", ").concat(i,", ").concat(n,")")}},{key:"_padding",get:function(){return.5*this.fontSize}},{key:"_borderRadius",get:function(){return this._padding}},{key:"render",value:function(){return I("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this._backgroundColor,color:this._textColor,padding:this._padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}},{key:"renderCanvas",value:function(e){if(this.visible){var t=e.font.replace(/^(.*?)px/,"");e.font="".concat(this.fontSize,"px ").concat(t);var i=this._padding,n=this._borderRadius,a=e.measureText(this.text).width,r=this.fontSize,o=W[this.anchor];e.textAlign="center",e.textBaseline="middle";var s=a+2*i,l=r+2*i,c=this.x+o.x*s,u=this.y+o.y*l;this._roundedRect(e,c,u,s,l,n),e.fillStyle=this._backgroundColor,e.fill();var h=this.x+(o.x+.5)*s,p=this.y+(o.y+.5)*l;this._renderTextShadow(e,this.text,h,p),e.fillStyle=this._textColor,e.fillText(this.text,h,p)}}},{key:"_renderTextShadow",value:function(e,t,i,n){e.lineJoin="miter",e.fillStyle="rgba(".concat(this._textShadowColor[0],", ").concat(this._textShadowColor[1],", ").concat(this._textShadowColor[2],", ").concat(1/N.length,")");var a,r=this._textShadowSize,o=(0,Z.Z)(N);try{for(o.s();!(a=o.n()).done;){var s=(0,D.Z)(a.value,2),l=s[0],c=s[1];e.fillText(t,i+r*l,n+r*c)}}catch(u){o.e(u)}finally{o.f()}}},{key:"_roundedRect",value:function(e,t,i,n,a,r){e.beginPath(),e.moveTo(t,i+r),e.arcTo(t,i,t+r,i,r),e.lineTo(t+n-r,i),e.arcTo(t+n,i,t+n,i+r,r),e.lineTo(t+n,i+a-r),e.arcTo(t+n,i+a,t+n-r,i+a,r),e.lineTo(t+r,i+a),e.arcTo(t,i+a,t,i+a-r,r),e.closePath()}},{key:"_cssClasses",value:function(){var e={"esri-text-overlay-item":!0};for(var t in V)e[V[t]]=this.anchor===t;return e}}]),i}(C.Z);(0,l._)([(0,p.Cb)()],z.prototype,"x",void 0),(0,l._)([(0,p.Cb)()],z.prototype,"y",void 0),(0,l._)([(0,p.Cb)()],z.prototype,"position",null),(0,l._)([(0,p.Cb)()],z.prototype,"text",void 0),(0,l._)([(0,p.Cb)()],z.prototype,"fontSize",void 0),(0,l._)([(0,p.Cb)()],z.prototype,"anchor",void 0),(0,l._)([(0,p.Cb)()],z.prototype,"visible",void 0),(0,l._)([(0,p.Cb)()],z.prototype,"_backgroundColor",void 0),(0,l._)([(0,p.Cb)()],z.prototype,"_textColor",void 0),(0,l._)([(0,p.Cb)()],z.prototype,"_textShadowColor",void 0),(0,l._)([(0,p.Cb)()],z.prototype,"_textShadowSize",void 0),(0,l._)([(0,p.Cb)()],z.prototype,"_textShadow",null),(0,l._)([(0,p.Cb)()],z.prototype,"_padding",null),(0,l._)([(0,p.Cb)()],z.prototype,"_borderRadius",null),z=(0,l._)([(0,v.j)("esri.views.overlay.TextOverlayItem")],z);for(var W={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},N=[],F=0;F<360;F+=22.5)N.push([Math.cos(Math.PI*F/180),Math.sin(Math.PI*F/180)]);var U=z,H=i(59418),j={default:15,far:25},B=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).context=null,n.stagedVertex=null,n.visible=!0,n.edgeDistance="default",n._messagesUnits=null,n._labelInfos=[],n._nextLabelIndex=0,n}return(0,r.Z)(i,[{key:"initialize",value:function(){var e=this,t=(0,x.vr)(function(){var t=(0,w.Z)((0,S.Z)().mark((function t(i){var n;return(0,S.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,R.ME)("esri/core/t9n/Units");case 2:n=t.sent,(0,x.k_)(i),e._messagesUnits=n;case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),i=function(){return(0,u.yw)(e.context,(function(e){return e.editGeometryOperations}))};this.own([(0,h.YP)((function(){return[(0,u.pC)(e.context)&&e.getCameraOrExtent(e.context),e.visible,e._edgeDistancePixels,e.stagedVertex,e._messagesUnits]}),(function(){return e._update()}))].concat((0,M.Z)(["vertex-add","vertex-update","vertex-remove"].map((function(t){return(0,h.on)(i,t,(function(){return e._update()}))}))),[(0,c.kB)((function(){return t.abort()}))]))}},{key:"destroy",value:function(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}},{key:"updating",get:function(){return(0,u.Wi)(this._messagesUnits)}},{key:"test",get:function(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map((function(e){return e.label.text}))}}},{key:"_edgeDistancePixels",get:function(){return j[this.edgeDistance]}},{key:"_update",value:function(){var e=this;this._nextLabelIndex=0;var t=this.context;if((0,u.Wi)(t))this._destroyUnusedLabels();else{var i=t.editGeometryOperations.data,n=i.components,a=i.geometry,r=i.coordinateHelper;if(a){for(var o=n.length,s=function(i){var s=[];if(n[i].iterateVertices((function(e){s.push(r.toXYZ(e.pos))})),0===i&&(0,u.pC)(e.stagedVertex)&&s.push(r.toXYZ(e.stagedVertex)),s.length<2)return"continue";var l=s[0],c=s[s.length-1];"polygon"===a.type&&s.length>2&&!(0,P.z)(l,c)&&s.push(l);var h=1===o&&!(0,T.bu)(s,!1,!1),p=X,d=Q;e.toScreenPointArray(t,l,p);for(var f=1;f<s.length;++f){var v,g=s[f-1],_=s[f];e.toScreenPointArray(t,_,d),e._addLabel(t,g,p,_,d,h),p=(v=[d,p])[0],d=v[1]}},l=0;l<o;++l)s(l);this._destroyUnusedLabels()}else this._destroyUnusedLabels()}}},{key:"_addLabel",value:function(e,t,i,n,a,r){var o=this._getOrCreateLabel(e).label;if(!this.visible||(0,k.s)(i,a)<3025)o.visible=!1;else{var s=(0,u.pC)(e.graphicState)?e.graphicState.isDraped?"on-the-ground":"absolute-height":(0,g.VW)(e.editGeometryOperations.data.geometry,e.elevationInfo),l=e.editGeometryOperations.data.spatialReference,c=(0,H.MU)(t,n,l,s),h=this._messagesUnits,p=(0,O.RG)(e.view);o.text=(0,u.pC)(h)&&(0,u.pC)(c)?(0,E.N9)(h,c,p):"",o.visible=!0;var d=a[0]-i[0],f=a[1]-i[1];r?(0,k.a)(Y,-f,d):(0,k.a)(Y,f,-d),(0,k.i)(Y,Y),(0,k.f)(Y,Y,this._edgeDistancePixels),(0,k.l)(q,i,a,.5),(0,k.b)(q,q,Y),o.position=[q[0],q[1]],Math.abs(Y[0])>Math.abs(Y[1])?o.anchor=Y[0]>0?"left":"right":o.anchor=-Y[1]<0?"top":"bottom"}}},{key:"_getOrCreateLabel",value:function(e){if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];var t=new U({fontSize:10,anchor:"center"});e.view.overlay.items.add(t);var i={label:t};return this._labelInfos.push(i),this._nextLabelIndex=this._labelInfos.length,i}},{key:"_destroyUnusedLabels",value:function(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}},{key:"_destroyLabel",value:function(e){var t=e.label;(0,u.yw)(this.context,(function(e){return e.view.overlay.items.remove(t)})),t.destroy()}}]),i}(C.Z);(0,l._)([(0,p.Cb)()],B.prototype,"context",void 0),(0,l._)([(0,p.Cb)()],B.prototype,"stagedVertex",void 0),(0,l._)([(0,p.Cb)()],B.prototype,"visible",void 0),(0,l._)([(0,p.Cb)()],B.prototype,"edgeDistance",void 0),(0,l._)([(0,p.Cb)()],B.prototype,"updating",null),(0,l._)([(0,p.Cb)()],B.prototype,"_messagesUnits",void 0),(0,l._)([(0,p.Cb)()],B.prototype,"_edgeDistancePixels",null),B=(0,l._)([(0,v.j)("esri.views.interactive")],B);var Y=(0,A.a)(),q=(0,A.a)(),X=(0,y.s1)(),Q=(0,y.s1)(),J=i(11208),K=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){return(0,a.Z)(this,i),t.apply(this,arguments)}return(0,r.Z)(i,[{key:"getCameraOrExtent",value:function(e){return e.view.state.camera}},{key:"toScreenPointArray",value:function(e,t){var i=e.view,n=e.elevationInfo,a=e.editGeometryOperations,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,y.s1)(),o=a.data.coordinateHelper.spatialReference;return(0,J.RS)(t,o,n,i,$),i.state.camera.projectToScreen($,r),r}}]),i}(B);K=(0,l._)([(0,v.j)("esri.views.3d.interactive.SegmentLabels3D")],K);var $=(0,b.c)(),ee=i(51995),te=i(11752),ie=i(61120),ne=i(100),ae=i(90045),re=i(151),oe=i(70444),se=i(95773),le=i(85981),ce=i(40885),ue=function(){function e(t){var i=this;(0,a.Z)(this,e),this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=t,this._handle=(0,h.YP)((function(){return i.view.ready}),(function(e){i._resourcesCreated&&(e?i._createResources():i._destroyResources())}))}return(0,r.Z)(e,[{key:"applyProps",value:function(e){var t=!1;for(var i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}},{key:"destroy",value:function(){this.attached=!1,this._handle.remove()}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}},{key:"_createResources",value:function(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}},{key:"_destroyResources",value:function(){this.destroyResources(),this._resourcesCreated=!1}}]),e}(),he=i(16889),pe=i(67077),de=i(55652),fe=i(23470),ve=i(50256),ge=i(55158),_e=i(4760),ye=i(82144),me=i(31132),be=i(27627),Me=i(18300),Se=i(8548),we=i(36207),Ce=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){return(0,a.Z)(this,i),t.apply(this,arguments)}return(0,r.Z)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get().build(this.configuration);return new be.$(e.rctx,t,i.attributeLocations)}},{key:"initializePipeline",value:function(){return(0,we.sm)({blending:(0,we.if)(Se.zi.ONE,Se.zi.ONE_MINUS_SRC_ALPHA),colorWrite:we.BK})}}]),i}(me.A);Ce.shader=new ye.J(Me.L,(function(){return i.e(7515).then(i.bind(i,97515))})),Ce.attributeLocations=new Map([[_e.T.START,0],[_e.T.END,1],[_e.T.UP,2],[_e.T.EXTRUDE,3]]);var xe=i(44070),Ee=i(45412),Oe=function(){function e(t){(0,a.Z)(this,e),this._renderCoordsHelper=t,this._buffers=null,this._origin=(0,b.c)(),this._dirty=!1,this._count=0,this._vao=null}return(0,r.Z)(e,[{key:"vertices",set:function(e){var t,i=new Float64Array(3*e.length),n=0,a=(0,Z.Z)(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;i[n++]=r[0],i[n++]=r[1],i[n++]=r[2]}}catch(o){a.e(o)}finally{a.f()}this.buffers=[i]}},{key:"buffers",set:function(e){if(this._buffers=e,this._buffers.length>0){var t=this._buffers[0],i=3*Math.floor(t.length/3/2);(0,P.s)(this._origin,t[i+0],t[i+1],t[i+2])}else(0,P.s)(this._origin,0,0,0);this._dirty=!0}},{key:"origin",get:function(){return this._origin}},{key:"draw",value:function(e){var t=this._ensureVAO(e);(0,u.pC)(t)&&(e.bindVAO(t),e.drawArrays(Se.MX.TRIANGLES,0,this._count))}},{key:"dispose",value:function(){(0,u.pC)(this._vao)&&this._vao.dispose()}},{key:"_ensureVAO",value:function(e){return(0,u.Wi)(this._buffers)?null:((0,u.Wi)(this._vao)&&(this._vao=this._createVAO(e,this._buffers)),this._ensureVertexData(this._vao,this._buffers),this._vao)}},{key:"_createVAO",value:function(e,t){var i=this._createDataBuffer(t);return this._dirty=!1,new Ee.U(e,Ce.attributeLocations,{data:(0,ve.K)(Pe)},{data:xe.f.createVertex(e,Se.l1.STATIC_DRAW,i)})}},{key:"_ensureVertexData",value:function(e,t){if(this._dirty){var i=this._createDataBuffer(t);e.vertexBuffers.data.setData(i),this._dirty=!1}}},{key:"_numberOfRenderVertices",value:function(e){return 2*(e.length/3-1)*3}},{key:"_createDataBuffer",value:function(e){var t=this,i=e.reduce((function(e,i){return e+t._numberOfRenderVertices(i)}),0);this._count=i;var n,a=Pe.createBuffer(i),r=this._origin,o=0,s=0,l=(0,Z.Z)(e);try{for(l.s();!(n=l.n()).done;){for(var c=n.value,u=0;u<c.length;u+=3){var h=(0,P.s)(Ae,c[u+0],c[u+1],c[u+2]);0===u?s=this._renderCoordsHelper.getAltitude(h):this._renderCoordsHelper.setAltitude(h,s);var p=this._renderCoordsHelper.worldUpAtPosition(h,ke),d=o+2*u,f=(0,P.b)(Ae,h,r);if(u<c.length-3){a.up.setVec(d,p),a.up.setVec(d+3,p),a.up.setVec(d+5,p);for(var v=0;v<6;v++)a.start.setVec(d+v,f);a.extrude.setValues(d+0,0,-1),a.extrude.setValues(d+1,1,-1),a.extrude.setValues(d+2,1,1),a.extrude.setValues(d+3,0,-1),a.extrude.setValues(d+4,1,1),a.extrude.setValues(d+5,0,1)}if(u>0){a.up.setVec(d-2,p),a.up.setVec(d-4,p),a.up.setVec(d-5,p);for(var g=-6;g<0;g++)a.end.setVec(d+g,f)}}o+=this._numberOfRenderVertices(c)}}catch(_){l.e(_)}finally{l.f()}return a.buffer}}]),e}(),ke=(0,b.c)(),Ae=(0,b.c)(),Pe=(0,ge.U$)().vec3f(_e.T.START).vec3f(_e.T.END).vec3f(_e.T.UP).vec2f(_e.T.EXTRUDE),Te=i(32534),Re=i(93822),Ze=i(22909),De=i(33559),Le=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments)).contrastControlEnabled=!1,e}return(0,r.Z)(i)}(De.m);(0,l._)([(0,De.o)()],Le.prototype,"contrastControlEnabled",void 0);var Ge=i(98634),Ie=i(7566),Ve=i(83671),ze=(Ge.K,function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){return(0,a.Z)(this,i),t.apply(this,arguments)}return(0,r.Z)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get().build(this.configuration);return new be.$(e.rctx,t,Ie.i)}},{key:"initializePipeline",value:function(){return(0,we.sm)({blending:(0,we.if)(Se.zi.ONE,Se.zi.ONE_MINUS_SRC_ALPHA),colorWrite:we.BK})}}]),i}(me.A));ze.shader=new ye.J(Ve.L,(function(){return i.e(5693).then(i.bind(i,45693))}));var We=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments)).heightManifoldEnabled=!1,e.pointDistanceEnabled=!1,e.lineVerticalPlaneEnabled=!1,e.intersectsLineEnabled=!1,e}return(0,r.Z)(i)}(Le);(0,l._)([(0,De.o)()],We.prototype,"heightManifoldEnabled",void 0),(0,l._)([(0,De.o)()],We.prototype,"pointDistanceEnabled",void 0),(0,l._)([(0,De.o)()],We.prototype,"lineVerticalPlaneEnabled",void 0),(0,l._)([(0,De.o)()],We.prototype,"intersectsLineEnabled",void 0);var Ne=(0,b.c)(),Fe=(0,pe.c)(),Ue={glowColor:[1,.5,0],glowWidth:8,glowFalloff:8,innerColor:[1,1,1],innerWidth:1,globalAlpha:.75,angleCutoff:(0,he.Vl)(6),globalAlphaContrastBoost:2,__tagStrict:"NoParameters"};function He(e,t,i,n){var a=Ne,r=Fe;(0,P.m)(a,t,n),(0,P.c)(r,i),r[3]=0,(0,ae.t)(r,r,n),(0,de.Yq)(a,r,e)}var je,Be=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{contrastControlEnabled:!1};(0,a.Z)(this,e),this._renderCoordsHelper=t,this._config=n,this._technique=null,this._heightManifoldEnabled=!1,this._heightManifoldTarget=(0,b.c)(),this._pointDistanceEnabled=!1,this._pointDistanceOrigin=(0,b.c)(),this._pointDistanceTarget=(0,b.c)(),this._lineVerticalPlaneEnabled=!1,this._lineVerticalPlaneSegment=(0,le.Ue)(),this._intersectsLineEnabled=!1,this._intersectsLineSegment=(0,le.Ue)(),this._intersectsLineRadius=3,this._intersectsLineInfinite=!1,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this.canRender=!0,this._tempNormal=(0,b.c)(),this._tempDir=(0,b.c)(),this._tempUp=(0,b.c)(),this._tempVec3A=(0,b.c)(),this._tempVec3B=(0,b.c)(),this._tempVec4=(0,pe.c)(),this._tempPlane=(0,de.Ue)(),this._tempSphere=(0,fe.c)(),this._parameters=(0,Ze.Uf)(i,Ue)}return(0,r.Z)(e,[{key:"renderSlots",get:function(){return[this._config.contrastControlEnabled?Re.r.LASERLINES_CONTRAST_CONTROL:Re.r.LASERLINES]}},{key:"needsLinearDepth",get:function(){return!0}},{key:"heightManifoldEnabled",get:function(){return this._heightManifoldEnabled},set:function(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())}},{key:"heightManifoldTarget",get:function(){return this._heightManifoldTarget},set:function(e){(0,P.c)(this._heightManifoldTarget,e),this._requestRender()}},{key:"pointDistanceEnabled",get:function(){return this._pointDistanceEnabled},set:function(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())}},{key:"pointDistanceTarget",get:function(){return this._pointDistanceTarget},set:function(e){(0,P.c)(this._pointDistanceTarget,e),this._requestRender()}},{key:"pointDistanceOrigin",get:function(){return this._pointDistanceOrigin},set:function(e){(0,P.c)(this._pointDistanceOrigin,e),this._requestRender()}},{key:"lineVerticalPlaneEnabled",get:function(){return this._lineVerticalPlaneEnabled},set:function(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())}},{key:"lineVerticalPlaneSegment",get:function(){return this._lineVerticalPlaneSegment},set:function(e){(0,le.JG)(e,this._lineVerticalPlaneSegment),this._requestRender()}},{key:"intersectsLineEnabled",get:function(){return this._intersectsLineEnabled},set:function(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())}},{key:"intersectsLineSegment",get:function(){return this._intersectsLineSegment},set:function(e){(0,le.JG)(e,this._intersectsLineSegment),this._requestRender()}},{key:"intersectsLineRadius",get:function(){return this._intersectsLineRadius},set:function(e){e!==this._intersectsLineRadius&&(this._intersectsLineRadius=e,this._requestRender())}},{key:"intersectsLineInfinite",get:function(){return this._intersectsLineInfinite},set:function(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())}},{key:"pathVerticalPlaneEnabled",get:function(){return this._pathVerticalPlaneEnabled},set:function(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,(0,u.pC)(this._pathVerticalPlaneData)&&this._requestRender())}},{key:"pathVerticalPlaneVertices",set:function(e){(0,u.Wi)(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new Oe(this._renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()}},{key:"pathVerticalPlaneBuffers",set:function(e){(0,u.Wi)(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new Oe(this._renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()}},{key:"setParameters",value:function(e){(0,Ze.LO)(this._parameters,e)&&this._requestRender()}},{key:"initializeRenderContext",value:function(e){this._context=e;var t=e.renderContext.rctx;this._quadVAO=(0,Te.ow)(t),this._techniqueRepository=e.shaderTechniqueRepository,this._techniqueConfig=new We;var i=new Le;i.contrastControlEnabled=this._config.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquire(Ce,i)}},{key:"uninitializeRenderContext",value:function(){this._quadVAO=(0,u.O3)(this._quadVAO),this._technique=(0,u.RY)(this._technique),this._pathVerticalPlaneData=(0,u.O3)(this._pathVerticalPlaneData),this._pathTechnique=(0,u.RY)(this._pathTechnique)}},{key:"prepareTechnique",value:function(){return this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled?(this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._technique=this._techniqueRepository.releaseAndAcquire(ze,this._techniqueConfig,this._technique),this._technique):this._pathTechnique}},{key:"render",value:function(e,t){(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(e,t),this.pathVerticalPlaneEnabled&&this._renderPath(e)}},{key:"_renderUnified",value:function(e,t){var i=e.rctx,n=i.bindTechnique(t,this._parameters,e.bindParameters);this._bindGlobalUniforms(e,n),this._bindHeightManifoldUniforms(e,n),this._bindPointDistanceUniforms(e,n),this._bindLineVerticalPlaneUniforms(e,n),this._bindIntersectsLineUniforms(e,n),i.bindVAO(this._quadVAO),i.drawArrays(Se.MX.TRIANGLE_STRIP,0,4)}},{key:"_renderPath",value:function(e){if(!(0,u.Wi)(this._pathVerticalPlaneData)&&!(0,u.Wi)(this._pathTechnique)){var t=e.rctx,i=this._pathTechnique,a=t.bindTechnique(i,(0,n.Z)((0,n.Z)({},this._parameters),{},{origin:this._pathVerticalPlaneData.origin}),e.bindParameters);this._bindGlobalUniforms(e,a),this._pathVerticalPlaneData.draw(e.rctx)}}},{key:"_bindHeightManifoldUniforms",value:function(e,t){if(this.heightManifoldEnabled){var i=this._tempVec3A,n=this._tempPlane,a=e.bindParameters.camera;this._renderCoordsHelper.worldUpAtPosition(this._heightManifoldTarget,i),He(n,this._heightManifoldTarget,i,a.viewMatrix),t.setUniform4fv("heightPlane",n)}}},{key:"_bindPointDistanceUniforms",value:function(e,t){if(this._pointDistanceEnabled){var i=e.bindParameters.camera,n=this._tempSphere;(0,P.c)(n,this._pointDistanceOrigin),(0,P.m)(n,n,i.viewMatrix),n[3]=(0,P.i)(this._pointDistanceOrigin,this._pointDistanceTarget),t.setUniform4f("pointDistanceSphere",n[0],n[1],n[2],n[3])}}},{key:"_bindLineVerticalPlaneUniforms",value:function(e,t){if(this._lineVerticalPlaneEnabled){var i=this._renderCoordsHelper,n=e.bindParameters.camera,a=this._tempPlane,r=this._tempVec3A,o=this._tempUp,s=this._tempDir,l=this._tempNormal;(0,le.KU)(this._lineVerticalPlaneSegment,.5,r),i.worldUpAtPosition(r,o),(0,P.n)(s,this._lineVerticalPlaneSegment.vector),(0,P.f)(l,o,s),(0,P.n)(l,l),He(a,this._lineVerticalPlaneSegment.origin,l,n.viewMatrix),t.setUniform4fv("lineVerticalPlane",a);var c=this._tempVec3A;(0,P.c)(c,this._lineVerticalPlaneSegment.origin),i.setAltitude(c,0),(0,P.m)(c,c,n.viewMatrix),t.setUniform3fv("lineVerticalStart",c);var u=this._tempVec3B;(0,P.a)(u,this._lineVerticalPlaneSegment.origin,this._lineVerticalPlaneSegment.vector),i.setAltitude(u,0),(0,P.m)(u,u,n.viewMatrix),t.setUniform3fv("lineVerticalEnd",u)}}},{key:"_bindIntersectsLineUniforms",value:function(e,t){if(this._intersectsLineEnabled){var i=qe,n=Xe,a=e.bindParameters.camera;if(this._intersectsLineInfinite){if((0,oe.iL)((0,ce.re)(this._intersectsLineSegment.origin,this._intersectsLineSegment.vector),Ye),Ye.c0=-Number.MAX_VALUE,!(0,se.zq)(a.frustum,Ye))return;(0,oe.Ws)(Ye,i),(0,oe.S$)(Ye,n)}else(0,P.c)(i,this._intersectsLineSegment.origin),(0,P.a)(n,this._intersectsLineSegment.origin,this._intersectsLineSegment.vector);var r=this._tempVec3A;(0,P.m)(r,i,a.viewMatrix),t.setUniform3fv("intersectsLineStart",r);var o=this._tempVec4;(0,P.c)(o,this._intersectsLineSegment.vector),this._tempVec4[3]=0,(0,ae.t)(this._tempVec4,this._tempVec4,a.viewMatrix),(0,P.m)(n,n,a.viewMatrix),t.setUniform3fv("intersectsLineEnd",n),(0,P.n)(o,o),t.setUniform3f("intersectsLineDirection",o[0],o[1],o[2]),t.setUniform1f("intersectsLineRadius",this._intersectsLineRadius)}}},{key:"_bindGlobalUniforms",value:function(e,t){var i=e.bindParameters.camera;this._heightManifoldEnabled?t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._heightManifoldTarget)):this._pointDistanceEnabled?t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._pointDistanceTarget)):this._lineVerticalPlaneEnabled&&t.setUniform1f("maxPixelDistance",2*i.computeScreenPixelSizeAt(this._lineVerticalPlaneSegment.origin)),t.bindTexture("frameColor",e.offscreenRenderingHelper.mainColorTexture)}},{key:"_requestRender",value:function(){this._context&&this._context.requestRender()}}]),e}(),Ye=(0,oe.Ue)(),qe=(0,b.c)(),Xe=(0,b.c)(),Qe=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e.view))._angleCutoff=Ve.d,n._style={},n._heightManifoldTarget=(0,b.c)(),n._heightManifoldEnabled=!1,n._intersectsLine=(0,le.Ue)(),n._intersectsLineEnabled=!1,n._intersectsLineInfinite=!1,n._lineVerticalPlaneSegment=null,n._pathVerticalPlaneBuffers=null,n._pointDistanceLine=null,n.applyProps(e),n}return(0,r.Z)(i,[{key:"testData",get:function(){return this.renderer}},{key:"createResources",value:function(){this._ensureRenderer()}},{key:"destroyResources",value:function(){this._disposeRenderer()}},{key:"updateVisibility",value:function(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}},{key:"angleCutoff",get:function(){return this._angleCutoff},set:function(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}},{key:"style",get:function(){return this._style},set:function(e){this._style=e,this._syncStyle()}},{key:"heightManifoldTarget",get:function(){return this._heightManifoldEnabled?this._heightManifoldTarget:null},set:function(e){(0,u.pC)(e)?((0,P.c)(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}},{key:"intersectsWorldUpAtLocation",set:function(e){if((0,u.Wi)(e))this.intersectsLine=null;else{var t=this.view.renderCoordsHelper.worldUpAtPosition(e,Je);this.intersectsLine=(0,le.al)(e,t),this.intersectsLineInfinite=!0}}},{key:"intersectsLine",get:function(){return this._intersectsLineEnabled?this._intersectsLine:null},set:function(e){(0,u.pC)(e)?((0,le.JG)(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}},{key:"intersectsLineInfinite",get:function(){return this._intersectsLineInfinite},set:function(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}},{key:"lineVerticalPlaneSegment",get:function(){return this._lineVerticalPlaneSegment},set:function(e){this._lineVerticalPlaneSegment=(0,u.pC)(e)?(0,le.JG)(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}},{key:"pathVerticalPlane",get:function(){return this._pathVerticalPlaneBuffers},set:function(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}},{key:"pointDistanceLine",get:function(){return this._pointDistanceLine},set:function(e){this._pointDistanceLine=(0,u.pC)(e)?{origin:(0,b.a)(e.origin),target:(0,b.a)(e.target)}:null,this._syncPointDistance(),this._syncRenderer()}},{key:"_syncRenderer",value:function(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||(0,u.pC)(this._pointDistanceLine)||(0,u.pC)(this._pathVerticalPlaneBuffers))?this._ensureRenderer():this._disposeRenderer()}},{key:"_ensureRenderer",value:function(){(0,u.pC)(this.renderer)||(this.renderer=new Be(this.view.renderCoordsHelper,void 0,{contrastControlEnabled:!0}),this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this.renderer.renderSlots,this.renderer))}},{key:"_syncStyle",value:function(){(0,u.Wi)(this.renderer)||(this.renderer.setParameters(this._style),null!=this._style.intersectsLineRadius&&(this.renderer.intersectsLineRadius=this._style.intersectsLineRadius))}},{key:"_syncAngleCutoff",value:function(){(0,u.Wi)(this.renderer)||this.renderer.setParameters({angleCutoff:this._angleCutoff})}},{key:"_syncHeightManifold",value:function(){(0,u.Wi)(this.renderer)||(this.renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this.renderer.heightManifoldTarget=this._heightManifoldTarget))}},{key:"_syncIntersectsLine",value:function(){(0,u.Wi)(this.renderer)||(this.renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this.renderer.intersectsLineSegment=this._intersectsLine))}},{key:"_syncIntersectsLineInfinite",value:function(){(0,u.Wi)(this.renderer)||(this.renderer.intersectsLineInfinite=this._intersectsLineInfinite)}},{key:"_syncPathVerticalPlane",value:function(){(0,u.Wi)(this.renderer)||(this.renderer.pathVerticalPlaneEnabled=(0,u.pC)(this._pathVerticalPlaneBuffers)&&this.visible,(0,u.pC)(this._pathVerticalPlaneBuffers)&&(this.renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}},{key:"_syncLineVerticalPlane",value:function(){(0,u.Wi)(this.renderer)||(this.renderer.lineVerticalPlaneEnabled=(0,u.pC)(this._lineVerticalPlaneSegment)&&this.visible,(0,u.pC)(this._lineVerticalPlaneSegment)&&(this.renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}},{key:"_syncPointDistance",value:function(){(0,u.Wi)(this.renderer)||(this.renderer.pointDistanceEnabled=(0,u.pC)(this._pointDistanceLine)&&this.visible,(0,u.pC)(this._pointDistanceLine)&&(this.renderer.pointDistanceOrigin=this._pointDistanceLine.origin,this.renderer.pointDistanceTarget=this._pointDistanceLine.target))}},{key:"_disposeRenderer",value:function(){(0,u.pC)(this.renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this.renderer),this.renderer=null)}}]),i}(ue),Je=(0,b.c)(),Ke=i(14226),$e=i(81949),et=i(68401),tt=i(59887),it=i(97882),nt=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e.view))._resources=null,n._transform=(0,$e.c)(),n}return(0,r.Z)(i,[{key:"object",get:function(){return(0,u.pC)(this._resources)?this._resources.object:null}},{key:"transform",get:function(){return this._transform},set:function(e){(0,Ke.c)(this._transform,e),(0,u.pC)(this._resources)&&(this._resources.object.transformation=this._transform)}},{key:"recreate",value:function(){this.attached&&this.createResources()}},{key:"recreateGeometry",value:function(){if(!(0,u.Wi)(this._resources)){var e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),t.addMany(e.geometries)}}},{key:"createResources",value:function(){this.destroyResources();var e=this.view._stage;if(e){var t=new it.F({isPickable:!1,updatePolicy:et.jq.SYNC});e.add(t);var i=new tt.T({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial((function(t){return e.add(t)})),e.add(i),t.add(i),this.visible||i.setVisible(!1),this._resources={layer:t,object:i}}}},{key:"destroyResources",value:function(){var e=this.view._stage;!(0,u.Wi)(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial((function(t){e.remove(t),t.dispose()})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}},{key:"updateVisibility",value:function(e){(0,u.Wi)(this._resources)||this._resources.object.setVisible(e)}}]),i}(ue),at=i(70619),rt=i(56529),ot=i(58901),st=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e))._ray=(0,ce.Ue)(),n._externalResources=null,n._handles=new ne.Z,n._isWorldDown=!1,n._start=(0,b.c)(),n._end=(0,b.f)(1,0,0),n._width=1,n._color=(0,re.f)(1,0,1,1),n._polygonOffset=!1,n._writeDepthEnabled=!0,n._innerWidth=0,n._innerColor=(0,re.f)(1,1,1,1),n._stipplePattern=null,n._stippleOffColor=null,n._stipplePreferContinuous=!0,n._falloff=0,n._extensionType=je.LINE,n._laserlineStyle=null,n._laserlineEnabled=!1,n._renderOccluded=rt.yD.OccludeAndTransparent,n._fadedExtensions=dt,n.applyProps(e),n}return(0,r.Z)(i,[{key:"createExternalResources",value:function(){var e=this,t=new ot.U(this.materialParameters);this._handles.add((0,h.YP)((function(){return e.view.state.camera}),(function(){e._updateGeometry()})));var i=new Qe({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:t,laserline:i}}},{key:"destroyExternalResources",value:function(){(0,u.pC)(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}},{key:"forEachExternalMaterial",value:function(e){(0,u.pC)(this._externalResources)&&e(this._externalResources.material)}},{key:"createGeometries",value:function(e){var t=[(0,b.c)(),(0,b.c)()],i=this.extensionType===je.FADED;i&&t.push((0,b.c)(),(0,b.c)());var n=i?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,a=at.Z.createPolylineGeometry(t,null,n);e.addGeometry(a,(0,u.Wg)(this._externalResources).material),this._updateVertices(e)}},{key:"updateVisibility",value:function(e){(0,te.Z)((0,ie.Z)(i.prototype),"updateVisibility",this).call(this,e),(0,u.pC)(this._externalResources)&&(this._externalResources.laserline.visible=e)}},{key:"setStartEndFromWorldDownAtLocation",value:function(e){this._isWorldDown=!0,(0,P.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,P.b)(this._end,e,this._end),(0,ce.zk)(this._start,this._end,this._ray),this._updateGeometry()}},{key:"start",get:function(){return this._start},set:function(e){this._isWorldDown=!1,(0,P.k)(this._start,e)||((0,P.c)(this._start,e),(0,ce.zk)(this._start,this._end,this._ray),this._updateGeometry())}},{key:"end",get:function(){return this._end},set:function(e){this._isWorldDown=!1,(0,P.k)(this._end,e)||((0,P.c)(this._end,e),(0,ce.zk)(this._start,this._end,this._ray),this._updateGeometry())}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){(0,ae.g)(e,this._color)||((0,ae.c)(this._color,e),this._updateMaterial())}},{key:"polygonOffset",get:function(){return this._polygonOffset},set:function(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}},{key:"writeDepthEnabled",get:function(){return this._writeDepthEnabled},set:function(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){(0,ae.g)(e,this._innerColor)||((0,ae.c)(this._innerColor,e),this._updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=(0,u.pC)(e)!==(0,u.pC)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){((0,u.Wi)(e)||(0,u.Wi)(this._stippleOffColor)||!(0,ae.g)(e,this._stippleOffColor))&&(this._stippleOffColor=(0,u.pC)(e)?(0,re.a)(e):null,this._updateMaterial())}},{key:"stipplePreferContinuous",get:function(){return this._stipplePreferContinuous},set:function(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}},{key:"extensionType",get:function(){return this._extensionType},set:function(e){e!==this._extensionType&&(this._extensionType=e,this._updateGeometry())}},{key:"_laserlineAttached",get:function(){return this._laserlineEnabled&&(0,u.pC)(this._laserlineStyle)}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,(0,u.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,(0,u.pC)(e)&&(this._externalResources.laserline.style=e))}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,(0,u.pC)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}},{key:"fadedExtensions",get:function(){return this._fadedExtensions},set:function(e){this._fadedExtensions=(0,u.Pt)(e,dt),this.recreateGeometry()}},{key:"_updateMaterial",value:function(){(0,u.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}},{key:"_updateGeometry",value:function(){(0,u.pC)(this.object)&&this._updateVertices(this.object)}},{key:"_updateVertices",value:function(e){var t=this._extensionType===je.FADED?this._updateLineSegmentFinite(ht):this._updateLineSegmentInfinite(this._extensionType,ht);this._updateVertexAttributes(e,t),(0,u.pC)(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}},{key:"_updateLineSegmentFinite",value:function(e){return(0,le.zk)(this._start,this._end,e)}},{key:"_updateLineSegmentInfinite",value:function(e,t){var i=this.view.state.camera;switch((0,oe.iL)(this._ray,lt),e){case je.LINE:lt.c0=-Number.MAX_VALUE;break;case je.RAY:case je.GROUND_RAY:var n=this._ray.origin,a=(0,u.Pt)(this.view.elevationProvider.getElevation(n[0],n[1],n[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),r=this.view.renderCoordsHelper.getAltitude(n);this._isWorldDown&&r<a&&(0,P.o)(lt.ray.direction,lt.ray.direction),this._extensionType===je.GROUND_RAY&&null!=a&&(lt.c1=Math.abs(r-a))}if(!(0,se.zq)(i.frustum,lt))return(0,le.zk)(this._start,this._end,t);var o=(0,oe.Ws)(lt,ct),s=(0,oe.S$)(lt,ut);return(0,le.zk)(o,s,t)}},{key:"_updateVertexAttributes",value:function(e,t){var i=e.geometries[0].getMutableAttribute(_e.T.POSITION).data;if(this.extensionType===je.FADED){var n=(0,le.KU)(t,-this.fadedExtensions.start,ct);i[0]=n[0],i[1]=n[1],i[2]=n[2];var a=(0,le.KU)(t,0,ct);i[3]=a[0],i[4]=a[1],i[5]=a[2];var r=(0,le.KU)(t,1,ct);i[6]=r[0],i[7]=r[1],i[8]=r[2];var o=(0,le.KU)(t,1+this.fadedExtensions.end,ct);i[9]=o[0],i[10]=o[1],i[11]=o[2]}else{var s=(0,le.KU)(t,0,ct);i[0]=s[0],i[1]=s[1],i[2]=s[2];var l=(0,le.KU)(t,1,ct);i[3]=l[0],i[4]=l[1],i[5]=l[2]}e.geometryVertexAttrsUpdated(e.geometryRecords[0])}}]),i}(nt),lt=(0,oe.Ue)(),ct=(0,b.c)(),ut=(0,b.c)(),ht=(0,le.Ue)();!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(je||(je={}));var pt=1/3,dt={start:pt,end:pt},ft=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e))._handles=new ne.Z,n._location=(0,b.c)(),n._direction=(0,b.f)(1,0,0),n._width=1,n._offset=1,n._length=18,n._color=(0,re.f)(1,0,1,1),n._renderOccluded=rt.yD.OccludeAndTransparent,n.applyProps(e),n}return(0,r.Z)(i,[{key:"location",get:function(){return this._location},set:function(e){(0,P.k)(this._location,e)||((0,P.c)(this._location,e),this._updateGeometry())}},{key:"direction",get:function(){return this._direction},set:function(e){(0,P.k)(this._direction,e)||((0,P.c)(this._direction,e),this._updateGeometry())}},{key:"setDirectionFromPoints",value:function(e,t){(0,P.n)(this._direction,(0,P.b)(this._direction,t,e)),this._updateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._updateMaterial())}},{key:"offset",get:function(){return this._offset},set:function(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}},{key:"length",get:function(){return this._length},set:function(e){e!==this._length&&(this._length=e,this._updateGeometry())}},{key:"color",get:function(){return this._color},set:function(e){(0,ae.g)(e,this._color)||((0,ae.c)(this._color,e),this._updateMaterial())}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}},{key:"createExternalResources",value:function(){var e=this,t=new ot.U(this.materialParameters);this._handles.add((0,h.YP)((function(){return e.view.state.camera}),(function(){e._updateGeometry()}))),this._externalResources={material:t}}},{key:"destroyExternalResources",value:function(){this._handles.removeAll(),this._externalResources=null}},{key:"createGeometries",value:function(e){var t=at.Z.createPolylineGeometry([(0,b.c)(),(0,b.c)()]),i=at.Z.createPolylineGeometry([(0,b.c)(),(0,b.c)()]),n=(0,u.Wg)(this._externalResources).material;e.addGeometry(t,n),e.addGeometry(i,n),this._updateVertices(e)}},{key:"forEachExternalMaterial",value:function(e){(0,u.pC)(this._externalResources)&&e(this._externalResources.material)}},{key:"_updateMaterial",value:function(){(0,u.Wi)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}},{key:"_updateGeometry",value:function(){var e=this.object;(0,u.Wi)(e)||this._updateVertices(e)}},{key:"_updateVertices",value:function(e){var t=this.view.state.camera;t.projectToScreen(this.location,gt),(0,P.a)(vt,this.location,this.direction),t.projectToScreen(vt,_t),(0,k.i)(_t,(0,k.g)(_t,_t,gt)),this._updateVertexAttributes(t,e,0,gt,_t,1),this._updateVertexAttributes(t,e,1,gt,_t,-1)}},{key:"_updateVertexAttributes",value:function(e,t,i,n,a,r){var o=t.geometryRecords[i],s=o.geometry.getMutableAttribute(_e.T.POSITION).data,l=(0,k.f)(yt,(0,k.a)(yt,a[1]*r,a[0]*-r),this.offset+this.width/2),c=(0,k.b)(mt,(0,k.b)(mt,(0,k.b)(mt,n,(0,k.f)(mt,a,this.length/2)),l),l),u=(0,k.b)(bt,c,(0,k.f)(bt,a,-this.length));e.unprojectFromScreen(c,vt),s[0]=vt[0],s[1]=vt[1],s[2]=vt[2],e.unprojectFromScreen(u,vt),s[3]=vt[0],s[4]=vt[1],s[5]=vt[2],t.geometryVertexAttrsUpdated(o)}}]),i}(nt),vt=(0,b.c)(),gt=(0,y.s1)(),_t=(0,y.s1)(),yt=(0,y.s1)(),mt=(0,y.s1)(),bt=(0,y.s1)(),Mt=i(79803),St=i(41414),wt=i(11185),Ct=i(79100),xt=i(76873),Et=function(){function e(t){(0,a.Z)(this,e),this.resourceFactory=t,this._resources=null,this._visible=!0,this._attached=!1}return(0,r.Z)(e,[{key:"destroy",value:function(){this._destroyResources()}},{key:"object",get:function(){return(0,u.pC)(this._resources)?this._resources.object:null}},{key:"resources",get:function(){return(0,u.pC)(this._resources)?this._resources.external:null}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this._syncVisible())}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}},{key:"recreate",value:function(){this.attached&&this._createResources()}},{key:"recreateGeometry",value:function(){if(this.resourceFactory.recreateGeometry){var e=this.resourceFactory.view._stage;if(!(0,u.Wi)(this._resources)&&e){var t=this._resources.object;this._resources.external.forEach((function(t){t.type===Ct.U.Geometry&&e.remove(t)})),t.removeAllGeometries();var i=this.resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer);e.addMany(i)}}else this.recreate()}},{key:"_createOrDestroyResources",value:function(){this._attached?this._resources||this._createResources():this._destroyResources()}},{key:"_createResources",value:function(){this._destroyResources();var e=this.resourceFactory,t=e.view,i=t._stage;if(i){var n=new it.F({isPickable:!1,updatePolicy:et.jq.SYNC});i.add(n);var a=new tt.T({castShadow:!1}),r=e.createResources(a,n);r.forEach((function(e){i.add(e),e instanceof xt.x&&i.loadImmediate(e)})),i.add(a),n.add(a);var o=e.cameraChanged?(0,h.YP)((function(){return t.state.camera}),(function(t){return e.cameraChanged(t)}),h.nn):null;this._resources={layer:n,object:a,external:r,cameraHandle:o},this._syncVisible()}}},{key:"_destroyResources",value:function(){if(!(0,u.Wi)(this._resources)){var e=this.resourceFactory.view._stage;null!==e&&void 0!==e&&e.remove(this._resources.object),null!==e&&void 0!==e&&e.remove(this._resources.layer),this._resources.external.forEach((function(t){null!==e&&void 0!==e&&e.remove(t),"dispose"in t&&t.dispose()})),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}}},{key:"_syncVisible",value:function(){(0,u.Wi)(this._resources)||this._resources.object.setVisible(this._visible)}}]),e}(),Ot=i(69691),kt=i(78935),At=i(55360),Pt=i(21400),Tt=function(){function e(t){var i=this;(0,a.Z)(this,e),this.view=null,this._geometry=null,this._size=3,this._color=(0,pe.f)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,pe.f)(1,1,1,1),this._elevationInfo=null,this.resources=new Et({view:t.view,createResources:function(e){return i._createResources(e)},recreateGeometry:function(e,t){return e.geometry=i._recreateGeometry(t,e.material),(0,u.pC)(e.geometry)?[e.geometry]:[]}});var n=!0;for(var r in t)r in this?"attached"===r?n=t[r]:this[r]=t[r]:console.error("Cannot set unknown property",r);this.attached=n}return(0,r.Z)(e,[{key:"destroy",value:function(){this.resources.destroy()}},{key:"visible",get:function(){return this.resources.visible},set:function(e){this.resources.visible=e}},{key:"attached",get:function(){return this.resources.attached},set:function(e){this.resources.attached=e}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.resources.recreateGeometry()}},{key:"size",get:function(){return this._size},set:function(e){if(e!==this._size){var t=this.preferredTextureSize;this._size=e,t<this.preferredTextureSize?(0,u.pC)(this.resources)&&this.resources.recreate():this._updateSizeAttribute()}}},{key:"color",get:function(){return this._color},set:function(e){(0,ae.g)(e,this._color)||((0,ae.c)(this._color,e),this._updateMaterial())}},{key:"pixelSnappingEnabled",get:function(){return this._pixelSnappingEnabled},set:function(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}},{key:"primitive",get:function(){return this._primitive},set:function(e){this._primitive!==e&&(this._primitive=e,(0,u.pC)(this.resources)&&this.resources.recreate())}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){(0,ae.g)(e,this._outlineColor)||((0,ae.c)(this._outlineColor,e),this._updateMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources&&this.resources.recreateGeometry()}},{key:"_updateMaterial",value:function(){var e=this.resources.resources;(0,u.Wi)(e)||e.material.setParameters(this._materialParameters(e.texture.id))}},{key:"_updateSizeAttribute",value:function(){var e=this.resources.resources,t=this.resources.object;if(!(0,u.Wi)(e)&&!(0,u.Wi)(t)){var i=e.geometry;if(!(0,u.Wi)(i)){var n=i.getMutableAttribute(_e.T.SIZE).data,a=this.geometrySize;n[0]=a,n[1]=a,t.geometryVertexAttrsUpdated(t.geometryRecords[0])}}}},{key:"_materialParameters",value:function(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:Zt,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}},{key:"geometrySize",get:function(){return this._size/Rt}},{key:"_recreateGeometry",value:function(e,t){var i=this._createRenderGeometry();return(0,u.pC)(i)&&e.addGeometry(i,t),i}},{key:"_createResources",value:function(e){var t=(0,At.cU)(this._primitive,this.preferredTextureSize),i=new Pt.A(this._materialParameters(t.id)),n=this._recreateGeometry(e,i);return{material:i,texture:t,geometry:n,forEach:function(e){e(t),e(i),(0,u.pC)(this.geometry)&&e(this.geometry)}}}},{key:"preferredTextureSize",get:function(){return(0,he.uZ)((0,he.Sf)(2*this.geometrySize),16,128)}},{key:"calculateMapBounds",value:function(e){if((0,u.Wi)(this.resources.resources)||(0,u.Wi)(this.resources.resources.geometry))return!1;var t=this.resources.resources.geometry.vertexAttributes.get(_e.T.POSITION);return(0,Mt.SH)(t.data,this.view.renderCoordsHelper.spatialReference,Dt,this.view.spatialReference),(0,St.G1)(e,Dt),!0}},{key:"_createRenderGeometry",value:function(){var e=this.geometry;if((0,u.Wi)(e))return null;var t=this.view,i=t.renderCoordsHelper,n=t.elevationProvider,a=(0,Ot.w7)(e,n,kt.o.fromElevationInfo(this.elevationInfo),i),r=(0,P.s)(wt.WM.get(),e.x,e.y,a),o=wt.WM.get();(0,Mt.SH)(r,e.spatialReference,o,i.spatialReference);var s=this.geometrySize;return at.Z.createPointGeometry(null,o,null,[s,s],[0,0,0,1])}}]),e}(),Rt=At.Ns,Zt=[Rt/2,Rt/2,1-Rt/2,1-Rt/2],Dt=(0,b.c)(),Lt=i(74894),Gt=i(66832),It=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e))._handles=new ne.Z,n._quadMaterial=null,n._outlineMaterial=null,n._maxSize=0,n._position=(0,b.c)(),n._up=(0,b.c)(),n._right=(0,b.c)(),n._renderOccluded=rt.yD.OccludeAndTransparent,n._color=(0,re.f)(1,0,0,1),n._outlineColor=(0,re.f)(0,0,0,1),n._outlineSize=0,n._size=32,n._outlineRenderOccluded=rt.yD.Opaque,n.applyProps(e),n}return(0,r.Z)(i,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}},{key:"color",get:function(){return this._color},set:function(e){(0,ae.c)(this._color,e),this._updateQuadMaterial()}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){(0,ae.c)(this._outlineColor,e),this._updateOutlineMaterial()}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){var t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this._updateTransform())}},{key:"outlineRenderOccluded",get:function(){return this._outlineRenderOccluded},set:function(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}},{key:"geometry",set:function(e){var t=e.previous,i=e.center,n=e.next;this._maxSize=Math.min((0,P.i)(i,t),(0,P.i)(i,n))/3,(0,P.n)(this._up,(0,P.b)(this._up,t,i)),(0,P.n)(this._right,(0,P.b)(this._right,n,i)),(0,P.c)(this._position,i),this.recreateGeometry()}},{key:"createExternalResources",value:function(){var e=this;this._quadMaterial=new Gt.E(this.quadMaterialParameters),this._outlineMaterial=new ot.U(this.outlineMaterialParameters),this._handles.add((0,h.YP)((function(){return e.view.state.camera}),(function(){return e._updateTransform()})))}},{key:"destroyExternalResources",value:function(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}},{key:"forEachExternalMaterial",value:function(e){e(this._quadMaterial),e(this._outlineMaterial)}},{key:"createGeometries",value:function(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}},{key:"_createQuadGeometry",value:function(e){var t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}},{key:"_createOutlineGeometry",value:function(e){if(0!==this._outlineSize){var t=(0,P.a)(wt.WM.get(),this._up,this._right),i=at.Z.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}}},{key:"_updateTransform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object,t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),n=Math.min(this._maxSize,i);(0,Ke.f)(Vt,this._position),(0,Ke.h)(Vt,Vt,[n,n,n]),(0,u.pC)(e)&&(e.transformation=Vt)}},{key:"_quadGeometryData",value:function(e,t){var i=(0,P.a)(wt.WM.get(),e,t);return new Lt.Z([[_e.T.POSITION,{size:3,data:[0,0,0].concat((0,M.Z)(t),(0,M.Z)(e),(0,M.Z)(i)),exclusive:!0}]],[[_e.T.POSITION,new Uint16Array([0,1,2,1,2,3])]])}},{key:"quadMaterialParameters",get:function(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}},{key:"_updateQuadMaterial",value:function(){this._quadMaterial&&this._quadMaterial.setParameters(this.quadMaterialParameters)}},{key:"outlineMaterialParameters",get:function(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}},{key:"_updateOutlineMaterial",value:function(){this._outlineMaterial&&this._outlineMaterial.setParameters(this.outlineMaterialParameters)}}]),i}(nt),Vt=(0,$e.c)(),zt=i(76014),Wt=i(64674),Nt=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){return(0,a.Z)(this,i),t.apply(this,arguments)}return(0,r.Z)(i,[{key:"visualizeIntersectionPoint",value:function(e,t){var i=t.coordinateHelper,n=t.view;return(0,c.ed)(new Tt({view:n,primitive:"circle",geometry:i.vectorToPoint(e.intersectionPoint),elevationInfo:(0,u.Pt)(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:ee.Z.toUnitRGBA(zt.c.orange),pixelSnappingEnabled:!1}))}},{key:"visualizePoint",value:function(e,t){var i=t.coordinateHelper,n=t.view;return(0,c.ed)(new Tt({view:n,primitive:"circle",geometry:i.vectorToPoint(e.point),elevationInfo:(0,u.Pt)(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:ee.Z.toUnitRGBA(zt.c.orange),pixelSnappingEnabled:!1}))}},{key:"visualizeLine",value:function(e,t){var i=t.coordinateHelper,n=t.view;return(0,c.ed)(this._createLineSegmentHintFromMap(e.type,e.lineStart,e.lineEnd,i,(0,u.Pt)(e.elevationInfo,t.elevationInfo),n,e.fadeLeft,e.fadeRight))}},{key:"visualizeParallelSign",value:function(e,t){var i=t.coordinateHelper,n=t.view,a=(0,u.Pt)(e.elevationInfo,t.elevationInfo),r=(0,J.$r)(e.lineStart,i,a,t.view),o=(0,J.$r)(e.lineEnd,i,a,t.view),s=(0,P.h)(o,r,o,.5),l=new ft({view:n,attached:!1,offset:zt.c.parallelLineHintOffset,length:zt.c.parallelLineHintLength,width:zt.c.parallelLineHintWidth,color:ee.Z.toUnitRGBA(zt.c.orange),location:s,renderOccluded:rt.yD.Opaque});return l.setDirectionFromPoints(r,s),l.attached=!0,(0,c.ed)(l)}},{key:"visualizeRightAngleQuad",value:function(e,t){var i=t.coordinateHelper,n=t.view,a=(0,u.Pt)(e.elevationInfo,t.elevationInfo);return(0,c.ed)(new It({view:n,attached:!0,color:ee.Z.toUnitRGBA(zt.c.orange),renderOccluded:rt.yD.Transparent,outlineRenderOccluded:rt.yD.Opaque,outlineColor:ee.Z.toUnitRGBA(zt.c.orange),outlineSize:zt.c.rightAngleHintOutlineSize,size:zt.c.rightAngleHintSize,geometry:{previous:(0,J.$r)(e.previousVertex,i,a,n),center:(0,J.$r)(e.centerVertex,i,a,n),next:(0,J.$r)(e.nextVertex,i,a,n)}}))}},{key:"_createLineSegmentHintFromMap",value:function(e,t,i,n,a,r){var o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],l=(0,b.c)(),c=(0,b.c)();return(0,J.By)(t,i,n,a,r,l,c),this._createLineSegmentHint(e,r,l,c,o,s)}},{key:"_createLineSegmentHint",value:function(e,t,i,n){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=new st({view:t,extensionType:je.FADED,start:i,end:n,color:ee.Z.toUnitRGBA(zt.c.orange),renderOccluded:rt.yD.Opaque});switch(e){case Wt.ze.TARGET:o.width=zt.c.lineHintWidthTarget,o.fadedExtensions={start:0,end:zt.c.lineHintFadedExtensions};break;case Wt.ze.REFERENCE_EXTENSION:o.width=zt.c.lineHintWidthReference,o.fadedExtensions={start:0,end:0};break;case Wt.ze.REFERENCE:o.width=zt.c.lineHintWidthReference,o.fadedExtensions={start:a?zt.c.lineHintFadedExtensions:0,end:r?zt.c.lineHintFadedExtensions:0}}return o.attached=!0,o}}]),i}(i(38561).a),Ft=i(97326),Ut=i(86950),Ht=i(86700),jt={main:new ee.Z([255,127,0]),selected:new ee.Z([255,255,255]),staged:new ee.Z([12,207,255]),outline:new ee.Z([0,0,0,.5]),selectedOutline:new ee.Z([255,255,255])},Bt=.3;function Yt(e,t){var i=e.clone();return i.a*=t,i}function qt(e,t){var i=e.clone(),n=(0,Ut._Y)(i);n.s*=t;var a=(0,Ut.xr)(n);return i.r=a.r,i.g=a.g,i.b=a.b,i}function Xt(e,t){if(t)for(var i in t)e[i]=t[i]}var Qt=(0,r.Z)((function e(t){(0,a.Z)(this,e),this.color=jt.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=rt.yD.Opaque,Xt(this,t)})),Jt=function(){function e(t){(0,a.Z)(this,e),this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=jt.main,this.outlineColor=jt.outline,this.renderOccluded=rt.yD.Opaque,this.hoverOutlineColor=jt.selectedOutline,Xt(this,t)}return(0,r.Z)(e,[{key:"apply",value:function(e,t){var i=this[e];t.setParameters({color:si(i),transparent:"color"!==e||i.a<1,renderOccluded:this.renderOccluded})}}]),e}(),Kt=function(){function e(t){(0,a.Z)(this,e),this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=Yt(jt.main,.5),this.hoverColor=jt.main,this.renderOccluded=rt.yD.Transparent,this.minSquaredEdgeLength=900,Xt(this,t)}return(0,r.Z)(e,[{key:"apply",value:function(e,t){var i=this[e];t.setParameters({color:si(i),transparent:i.a<1,renderOccluded:this.renderOccluded})}}]),e}(),$t=(0,r.Z)((function e(t){(0,a.Z)(this,e),this.vertex=new Jt({color:jt.main,outlineColor:jt.outline}),this.edge=new Jt({color:qt(Yt(jt.main,2/3),.5),outlineColor:Yt(jt.outline,.5),size:8,collisionPadding:8}),this.selected=new Jt({color:jt.selected,outlineColor:jt.outline}),this.edgeOffset=new Kt,Xt(this,t)})),ei=function(){function e(t){(0,a.Z)(this,e),this.color=jt.selected,this.width=1.5,this.stipplePattern=(0,Ht.z5)(5),this.stippleOffColor=jt.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=jt.selected,this.renderOccluded=rt.yD.OccludeAndTransparent,Xt(this,t)}return(0,r.Z)(e,[{key:"apply",value:function(e){e.color=si(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=si(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=si(this.innerColor),e.renderOccluded=this.renderOccluded}}]),e}(),ti=function(){function e(t){(0,a.Z)(this,e),this.color=jt.selected,this.size=4,this.outlineSize=1,this.outlineColor=jt.outline,this.shape="square",Xt(this,t)}return(0,r.Z)(e,[{key:"apply",value:function(e){e.color=si(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=si(this.outlineColor),e.primitive=this.shape}}]),e}(),ii=function(){function e(t){(0,a.Z)(this,e),this.innerColor=jt.selected,this.innerWidth=1,this.glowColor=jt.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=Bt,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=jt.main,Xt(this,t)}return(0,r.Z)(e,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i={glowColor:ee.Z.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:ee.Z.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=i:e.laserlineStyle=i}}]),e}(),ni=(0,r.Z)((function e(t){(0,a.Z)(this,e),this.outline=new ei({color:jt.outline,renderOccluded:rt.yD.OccludeAndTransparentStencil,stippleOffColor:jt.selected,stipplePattern:(0,Ht.z5)(5),width:1.5,innerWidth:0}),this.staged=new ei({color:jt.selected,renderOccluded:rt.yD.OccludeAndTransparentStencil,innerColor:jt.staged,stippleOffColor:jt.outline,stipplePattern:(0,Ht.z5)(5),width:1.5}),this.shadowStyle=new ii({globalAlpha:Bt,glowColor:jt.main,glowFalloff:8,glowWidth:8,innerColor:jt.selected,innerWidth:1}),Xt(this,t)})),ai=(0,r.Z)((function e(t){(0,a.Z)(this,e),this.outline=new ti({color:jt.selected,outlineColor:jt.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new ii({globalAlpha:Bt,glowColor:jt.main,glowFalloff:1.5,glowWidth:6,innerColor:jt.selected,innerWidth:1,radius:2}),Xt(this,t)})),ri=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this)).extensionType=je.GROUND_RAY,Xt((0,Ft.Z)(n),e),n}return(0,r.Z)(i)}(ei),oi=(0,r.Z)((function e(t){(0,a.Z)(this,e),this.lineGraphics=new ni,this.pointGraphics=new ai,this.heightPlane=new ii({globalAlpha:Bt,glowColor:jt.main,glowFalloff:8,glowWidth:8,innerColor:jt.selected,innerWidth:1}),this.heightBox=new ii({globalAlpha:Bt,glowColor:jt.main,glowFalloff:8,glowWidth:8,innerColor:jt.selected,innerWidth:0,heightFillColor:jt.main}),this.zVerticalLine=new ri({color:Yt(jt.main,.5),falloff:2,innerColor:Yt(jt.selected,0),renderOccluded:rt.yD.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:je.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,Xt(this,t)}));function si(e){return(0,pe.b)(ee.Z.toUnitRGBA(e))}var li=new(function(){function e(t){(0,a.Z)(this,e),this.visualElements=new oi,this.reshapeManipulators=new $t,this.zManipulator=new Qt,Xt(this,t)}return(0,r.Z)(e,[{key:"colorToVec4",value:function(e){return si(e)}}]),e}()),ci=i(91505),ui=i(65618),hi=i(79056),pi=i(26279),di=i(78289),fi=function(){function e(t){(0,a.Z)(this,e),this.resourceFactory=t,this._resources=null,this._visible=!0,this._attached=!1}return(0,r.Z)(e,[{key:"destroy",value:function(){this._destroyResources()}},{key:"resources",get:function(){return(0,u.pC)(this._resources)?this._resources.external:null}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}},{key:"recreate",value:function(){this.attached&&this._createResources()}},{key:"recreateGeometry",value:function(){this.resourceFactory.recreateGeometry?(0,u.Wi)(this._resources)||(this._ensureRenderGeometriesRemoved(),this.resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}},{key:"_createOrDestroyResources",value:function(){this._attached?(0,u.Wi)(this._resources)&&this._createResources():this._destroyResources()}},{key:"_createResources",value:function(){var e;this._destroyResources();var t=this.resourceFactory.createResources(),i=new vi({view:this.resourceFactory.view}),n=null===(e=this.resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;this._resources={layerView:new vi({view:this.resourceFactory.view}),external:t,geometriesAdded:!1},n&&(this._resources.drapeSourceRenderer=n.registerGeometryDrapeSource(i)),this._syncGeometriesToRenderer()}},{key:"_destroyResources",value:function(){var e;if(!(0,u.Wi)(this._resources)){this._ensureRenderGeometriesRemoved();var t=null===(e=this.resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resources=null}}},{key:"_syncGeometriesToRenderer",value:function(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}},{key:"_ensureRenderGeometriesRemoved",value:function(){(0,u.Wi)(this._resources)||(0,u.Wi)(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,di.$.Geometry.UPDATE),this._resources.geometriesAdded=!1)}},{key:"_ensureRenderGeometriesAdded",value:function(){(0,u.Wi)(this._resources)||(0,u.Wi)(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,di.$.Geometry.UPDATE),this._resources.geometriesAdded=!0)}}]),e}(),vi=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).drapeSourceType=pi.L.Features,n.updatePolicy=et.jq.SYNC,n}return(0,r.Z)(i)}((0,hi.IG)(C.Z));(0,l._)([(0,p.Cb)({constructOnly:!0})],vi.prototype,"view",void 0),(0,l._)([(0,p.Cb)({readOnly:!0})],vi.prototype,"drapeSourceType",void 0),vi=(0,l._)([(0,v.j)("DrapedVisualElementLayerView")],vi);var gi=i(75558),_i=i(81955),yi=i(69831),mi=function(){function e(t){var i=this;(0,a.Z)(this,e),this.view=null,this._attachmentOrigin=(0,ui.Tx)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new ci.Z,this._isDraped=!1,this._geometry=null,this._width=1,this._color=(0,re.f)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,re.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=rt.yD.OccludeAndTransparentStencil,this.resources=new Et({view:t.view,createResources:function(e){return i._createResources(e)},recreateGeometry:function(e,t){return e.geometries.length=0,i._recreateGeometry(t,e.material,e.geometries),e.geometries}}),this._attachmentOrigin.spatialReference=t.view.spatialReference,this.drapedResources=new fi({view:t.view,createResources:function(){return i._createDrapedResources()},recreateGeometry:function(e){e.geometries=i._createRenderGeometriesDraped(e.material),i._attachmentOriginChanged()}});var n=!0;for(var r in this._laserline=new Qe({view:t.view}),t)r in this?"attached"===r?n=t[r]:this[r]=t[r]:console.error("Cannot set unknown property",r);this.attached=n}return(0,r.Z)(e,[{key:"destroy",value:function(){this.resources.destroy(),this.drapedResources.destroy(),this._laserline.destroy()}},{key:"isDraped",get:function(){return this._isDraped},set:function(e){e!==this._isDraped&&(this._isDraped=e,this._updateAttached(this.attached),this._laserline.attached=this.laserlineAttached)}},{key:"laserlineAttached",get:function(){return this.attached&&this.visible&&(0,u.pC)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}},{key:"visible",get:function(){return this.resources.visible},set:function(e){this.resources.visible=e,this.drapedResources.visible=e,this._laserline.attached=this.laserlineAttached}},{key:"attached",get:function(){return this.resources.attached||this.drapedResources.attached},set:function(e){this._updateAttached(e)}},{key:"_updateAttached",value:function(e){this.resources.attached=!this.isDraped&&e,this.drapedResources.attached=this.isDraped&&e,this._laserline.attached=this.laserlineAttached,this.attached&&this._attachmentOriginChanged()}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.resources.recreateGeometry(),this.drapedResources.recreateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){(0,ae.g)(e,this._color)||((0,ae.c)(this._color,e),this._updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){(0,ae.g)(e,this._innerColor)||((0,ae.c)(this._innerColor,e),this._updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=(0,u.pC)(e)!==(0,u.pC)(this._stipplePattern);this._stipplePattern=e,t?this.resources.recreate():this._updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){e&&this._stippleOffColor&&(0,ae.g)(e,this._stippleOffColor)||(this._stippleOffColor=e?(0,re.a)(e):null,this._updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.resources.recreateGeometry()}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,this._laserline.attached=this.laserlineAttached,(0,u.pC)(e)&&(this._laserline.style=e)}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this.laserlineAttached)}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}},{key:"attachmentOrigin",get:function(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;var e=(0,u.pC)(this.resources.resources)?this.resources.resources.geometries:null;if(!e||0===e.length)return null;(0,P.s)(Si,0,0,0);var t,i=0,n=(0,Z.Z)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value,r=a.vertexAttributes.get(_e.T.POSITION),o=a.indices.get(_e.T.POSITION),s=(0,u.Wg)(this.resources.resources).material.isClosed(r.data,o);(0,_i.qZ)(r,o,s,Mi)&&((0,P.a)(Si,Si,Mi),i++)}}catch(l){n.e(l)}finally{n.f()}return 0===i?null:((0,P.g)(Si,Si,1/i),this.view.renderCoordsHelper.fromRenderCoords(Si,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}},{key:"_updateMaterial",value:function(){(0,u.pC)(this.resources.resources)&&this.resources.resources.material.setParameters(this.materialParameters),(0,u.pC)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameters(this.materialParameters)}},{key:"isClosed",get:function(){return(0,u.pC)(this.geometry)&&"polygon"===this.geometry.type}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this.isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this.normalizedRenderOccluded}}},{key:"normalizedRenderOccluded",get:function(){return this.isDraped&&this._renderOccluded===rt.yD.OccludeAndTransparentStencil?rt.yD.OccludeAndTransparent:this._renderOccluded}},{key:"_recreateGeometry",value:function(e,t,i){var n,a=this._createRenderGeometries(),r=(0,Z.Z)(a);try{for(r.s();!(n=r.n()).done;){var o=n.value;e.addGeometry(o,t),i.push(o)}}catch(s){r.e(s)}finally{r.f()}this._attachmentOriginChanged()}},{key:"_attachmentOriginChanged",value:function(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}},{key:"_createResources",value:function(e){var t=new ot.U(this.materialParameters),i=[];return this._recreateGeometry(e,t,i),{material:t,geometries:i,forEach:function(e){e(t),i.forEach(e)}}}},{key:"_createDrapedResources",value:function(){var e=new ot.U(this.materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}},{key:"_createRenderGeometriesDraped",value:function(e){var t=this.geometry;if((0,u.Wi)(t))return[];var i,n=(0,gi.rm)(t,this.view.basemapTerrain.spatialReference),a=[],r=(0,Z.Z)(n.lines);try{for(r.s();!(i=r.n()).done;){var o=i.value.position,s={overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:o},removeDuplicateStartEnd:this.isClosed?gi.NW.REMOVE:gi.NW.KEEP},l=new yi.z((0,gi.YU)(s),e),c=(0,St.cS)(bi);(0,St.G1)(c,o),(0,ae.s)(l.boundingSphere,.5*(c[0]+c[3]),.5*(c[1]+c[4]),0,.5*Math.sqrt((c[3]-c[0])*(c[3]-c[0])+(c[4]-c[1])*(c[4]-c[1]))),a.push(l)}}catch(h){r.e(h)}finally{r.f()}return a}},{key:"calculateMapBounds",value:function(e){if((0,u.Wi)(this.resources.resources))return!1;var t,i=this.view.renderCoordsHelper,n=(0,Z.Z)(this.resources.resources.geometries);try{for(n.s();!(t=n.n()).done;){var a=t.value.vertexAttributes.get(_e.T.POSITION),r=new Float64Array(a.data.length);(0,Mt.CM)(a.data,i.spatialReference,0,r,this.view.spatialReference,0,a.data.length/3),(0,St.G1)(e,r)}}catch(o){n.e(o)}finally{n.f()}return!0}},{key:"_createRenderGeometries",value:function(){var e,t=this.geometry;if((0,u.Wi)(t))return[];var i,n=(0,gi.VP)(t,this.view.elevationProvider,this.view.renderCoordsHelper,kt.o.fromElevationInfo(null!==(e=this.elevationInfo)&&void 0!==e?e:new _.ZP({mode:(0,g.VW)(t,null)}))),a=[],r=[],o=(0,Z.Z)(n.lines);try{for(o.s();!(i=o.n()).done;){var s=i.value,l=s.position,c={overlayInfo:null,attributeData:{position:l,mapPosition:s.mapPosition},removeDuplicateStartEnd:this.isClosed?gi.NW.REMOVE:gi.NW.KEEP};a.push((0,gi.YU)(c)),r.push(l)}}catch(h){o.e(h)}finally{o.f()}return this._laserline.pathVerticalPlane=r,a}}]),e}(),bi=(0,St.Ue)(),Mi=(0,b.c)(),Si=(0,b.c)(),wi=i(36759),Ci=i(25158),xi=i(71011),Ei=i(23620),Oi=i(94425),ki=i(97731),Ai=i(33236),Pi=i(78041),Ti=i(8883),Ri=i(72511),Zi=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){return(0,a.Z)(this,i),t.apply(this,arguments)}return(0,r.Z)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get().build(this.configuration);return new be.$(e.rctx,t,Li)}},{key:"_setPipelineState",value:function(e){var t=this.configuration,i=e===et.Am.NONE,n=e===et.Am.FrontFace;return(0,we.sm)({blending:t.output!==xi.H.Color&&t.output!==xi.H.Alpha||!t.transparent?null:i?Pi.wu:(0,Pi.j7)(e),culling:(0,we.zp)(t.cullFace),depthTest:{func:n?Se.wb.LESS:t.shadingEnabled?Se.wb.LEQUAL:Se.wb.LESS},depthWrite:i?t.writeDepth&&we.LZ:(0,Pi.K5)(e),colorWrite:we.BK,polygonOffset:i||n?null:Pi.E0})}},{key:"initializePipeline",value:function(){return this._setPipelineState(this.configuration.transparencyPassType)}}]),i}(me.A);Zi.shader=new ye.J(Ri.S,(function(){return i.e(6556).then(i.bind(i,36556))}));var Di=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments)).output=xi.H.Color,e.cullFace=et.Vr.None,e.transparencyPassType=et.Am.NONE,e.hasSlicePlane=!1,e.transparent=!1,e.writeDepth=!0,e.screenSizeEnabled=!0,e.shadingEnabled=!0,e.hasMultipassTerrain=!1,e.cullAboveGround=!1,e}return(0,r.Z)(i)}(Ti.W);(0,l._)([(0,De.o)({count:xi.H.COUNT})],Di.prototype,"output",void 0),(0,l._)([(0,De.o)({count:et.Vr.COUNT})],Di.prototype,"cullFace",void 0),(0,l._)([(0,De.o)({count:et.Am.COUNT})],Di.prototype,"transparencyPassType",void 0),(0,l._)([(0,De.o)()],Di.prototype,"hasSlicePlane",void 0),(0,l._)([(0,De.o)()],Di.prototype,"transparent",void 0),(0,l._)([(0,De.o)()],Di.prototype,"writeDepth",void 0),(0,l._)([(0,De.o)()],Di.prototype,"screenSizeEnabled",void 0),(0,l._)([(0,De.o)()],Di.prototype,"shadingEnabled",void 0),(0,l._)([(0,De.o)()],Di.prototype,"hasMultipassTerrain",void 0),(0,l._)([(0,De.o)()],Di.prototype,"cullAboveGround",void 0);var Li=new Map([[_e.T.POSITION,0],[_e.T.NORMAL,1],[_e.T.OFFSET,2]]),Gi=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e,new Vi)).supportsEdges=!0,n.techniqueConfig=new Di,n._vertexAttributeLocations=Li,n}return(0,r.Z)(i,[{key:"getConfiguration",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.screenSizeEnabled=this.parameters.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.parameters.shadingEnabled,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig}},{key:"intersect",value:function(e,t,i,n,a,r,o){var s=this;if(this.parameters.screenSizeEnabled){var l=e.vertexAttributes.get(_e.T.OFFSET),c={applyToVertex:function(e,t,i,a){var r=(0,P.s)(Wi,l.data[3*a+0],l.data[3*a+1],l.data[3*a+2]),o=(0,P.s)(Ni,e,t,i);return(0,P.g)(r,r,s.parameters.screenSizeScale*n.camera.computeRenderPixelSizeAt(r)),(0,P.a)(o,o,r),[o[0],o[1],o[2]]},applyToAabb:function(e){var t=(0,St.be)(e,Wi);return(0,St.bA)(e,s.parameters.screenSizeScale*n.camera.computeRenderPixelSizeAt(t))}};(0,Ze.Bw)(e,t,n,a,r,c,o)}else(0,Ze.Bw)(e,t,n,a,r,void 0,o)}},{key:"requiresSlot",value:function(e,t){if((0,Oi.S)(t)===xi.H.Highlight)return e===Re.r.OPAQUE_MATERIAL;var i=Re.r.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?Re.r.TRANSPARENT_MATERIAL:Re.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i||e===Re.r.DRAPED_MATERIAL}},{key:"createGLMaterial",value:function(e){return e.output===xi.H.Color||e.output===xi.H.Alpha||e.output===xi.H.Highlight?new Ii(e):null}},{key:"createBufferWriter",value:function(){return new zi(this.parameters.screenSizeEnabled)}}]),i}(rt.F5),Ii=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){return(0,a.Z)(this,i),t.apply(this,arguments)}return(0,r.Z)(i,[{key:"beginSlot",value:function(e){return this.ensureTechnique(Zi,e)}}]),i}(Ei.Z),Vi=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments)).color=(0,pe.f)(1,1,1,1),e.shadingTint=(0,pe.f)(0,0,0,.25),e.shadingDirection=(0,P.n)((0,b.c)(),[.5,-.5,-.5]),e.screenSizeScale=14,e.transparent=!1,e.writeDepth=!0,e.hasSlicePlane=!1,e.cullFace=et.Vr.None,e.screenSizeEnabled=!1,e.shadingEnabled=!0,e}return(0,r.Z)(i)}(rt.Mt),zi=function(){function e(t){(0,a.Z)(this,e),this.screenSizeEnabled=t;var i=(0,ge.U$)().vec3f(_e.T.POSITION).vec3f(_e.T.NORMAL);this.screenSizeEnabled&&i.vec3f(_e.T.OFFSET),this.vertexBufferLayout=i}return(0,r.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get(_e.T.POSITION).length}},{key:"write",value:function(e,t,i,n){if((0,Ai.NK)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,n),this.screenSizeEnabled){if(!t.vertexAttributes.has(_e.T.OFFSET))throw new Error("".concat(_e.T.OFFSET," vertex attribute required for screenSizeEnabled ShadedColorMaterial"));var a=t.vertexAttributes.get(_e.T.OFFSET),r=t.indices.get(_e.T.OFFSET);(0,ki.hu)(3===a.size);var o=i.getField(_e.T.OFFSET,Ci.ct);if(!o)throw new Error("unable to acquire view for "+_e.T.OFFSET);(0,Ai.ho)(r,a.data,e.invTranspTransformation,o,n)}}}]),e}(),Wi=(0,b.c)(),Ni=(0,b.c)(),Fi=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).view=null,n._renderOccluded=rt.yD.OccludeAndTransparent,n._vertices=null,n._spatialReference=null,n._color=li.colorToVec4(li.reshapeManipulators.vertex.color),n._size=li.reshapeManipulators.vertex.size,n._outlineColor=li.colorToVec4(li.reshapeManipulators.vertex.outlineColor),n._outlineSize=li.reshapeManipulators.vertex.outlineSize,n._elevationInfo=null,n.applyProps(e),n}return(0,r.Z)(i,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}},{key:"vertices",get:function(){return this._vertices},set:function(e){this._vertices=e,this.recreateGeometry()}},{key:"spatialReference",get:function(){return this._spatialReference},set:function(e){this._spatialReference=e,this.recreateGeometry()}},{key:"color",get:function(){return this._color},set:function(e){(0,ae.g)(e,this._color)||((0,ae.c)(this._color,e),this._updateMaterial())}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this._updateMaterial())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){(0,ae.g)(e,this._outlineColor)||((0,ae.c)(this._outlineColor,e),this._updateOutlineMaterial())}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.recreateGeometry()}},{key:"vertexMaterialParameters",get:function(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}},{key:"vertexOutlineMaterialParameters",get:function(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}},{key:"_updateMaterial",value:function(){this.attached&&this.vertexMaterial.setParameters(this.vertexMaterialParameters)}},{key:"_updateOutlineMaterial",value:function(){this.attached&&this.vertexOutlineMaterial.setParameters(this.vertexOutlineMaterialParameters)}},{key:"_createRenderGeometries",value:function(){var e=this.vertices;if((0,u.Wi)(e)||0===e.length)return[];for(var t=(0,wi.VP)(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,kt.o.fromElevationInfo(this.elevationInfo)),i=[],n=t.numVertices,a=t.position,r=0;r<n;++r){var o=(0,P.s)(Ui,a[3*r+0],a[3*r+1],a[3*r+2]),s=Hi(.5,o),l=Hi(.5,o);i.push({vertexGeometry:s,vertexOutlineGeometry:l})}return i}},{key:"createGeometries",value:function(e){var t,i=this._createRenderGeometries(),n=(0,Z.Z)(i);try{for(n.s();!(t=n.n()).done;){var a=t.value,r=a.vertexGeometry,o=a.vertexOutlineGeometry;e.addGeometry(r,this.vertexMaterial),e.addGeometry(o,this.vertexOutlineMaterial)}}catch(s){n.e(s)}finally{n.f()}}},{key:"createExternalResources",value:function(){this.vertexMaterial=new Gi((0,n.Z)((0,n.Z)({},this.vertexMaterialParameters),{},{writeDepth:!0,cullFace:et.Vr.Back,screenSizeEnabled:!0})),this.vertexOutlineMaterial=new Gi((0,n.Z)((0,n.Z)({},this.vertexOutlineMaterialParameters),{},{transparent:!0,writeDepth:!0,cullFace:et.Vr.Front,screenSizeEnabled:!0,shadingEnabled:!1}))}},{key:"destroyExternalResources",value:function(){this.vertexMaterial=null,this.vertexOutlineMaterial=null}},{key:"forEachExternalMaterial",value:function(e){e(this.vertexMaterial),e(this.vertexOutlineMaterial)}}]),i}(nt),Ui=(0,b.c)();function Hi(e,t){return at.Z.createSphereGeometry(e,16,16,{offset:t})}var ji=i(94687),Bi=i(77566),Yi=i(36397),qi=i(54016),Xi=i(52349),Qi=i(61920),Ji=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e))._activeVertexVisualElement=null,n._createGraphicState=null,n._outlineVisualElement=null,n._verticesVisualElement=null,n.geometryType=null,n.labelOptions=new Xi.Z,n.tooltipOptions=new Qi.Z,n.type="draw-3d",n}return(0,r.Z)(i,[{key:"initialize",value:function(){var e=this.elevationInfo,t=e.mode,i=e.offset;this.internalGraphicsLayer.elevationInfo=new _.ZP({mode:t,offset:i})}},{key:"normalizeCtorArgs",value:function(e){if(!e.elevationInfo){var t,i=null===(t=e.hasZ)||void 0===t||t;return(0,n.Z)((0,n.Z)({},e),{},{elevationInfo:{mode:i?"absolute-height":"on-the-ground",offset:0}})}return e}},{key:"initializeGraphic",value:function(e){var t=this,i=this._createGraphicState=new ji.F({graphic:e});return(0,c.AL)([this.view.maskOccludee(e),this.view.trackGraphicState(i),(0,h.YP)((function(){return{element:t._outlineVisualElement,isDraped:i.isDraped}}),(function(e){var t=e.element,i=e.isDraped;(0,u.yw)(t,(function(e){return e.isDraped=i}))}),h.nn)])}},{key:"makeDrawOperation",value:function(){var e=this.geometryType,t="circle"!==e&&"rectangle"!==e;return new Yi.w({view:this.view,manipulators:this.manipulators,geometryType:(0,Bi.I)(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new qi.iW(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new qi.aL(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new Nt,segmentLabels:t?new K:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:(0,u.pC)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===(0,g.Zz)(this.hasZ,this.elevationInfo)})}},{key:"onActiveVertexChanged",value:function(e){var t=this;return(0,u.pC)(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[e],null):(this._activeVertexVisualElement=new Fi({view:this.view,spatialReference:this.view.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:li.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=li.colorToVec4(li.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,(0,c.kB)((function(){t._activeVertexVisualElement=(0,u.SC)(t._activeVertexVisualElement)})))}},{key:"onOutlineChanged",value:function(e){var t=this;if((0,u.pC)(this._outlineVisualElement))return this._outlineVisualElement.geometry=e,null;var i=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new mi({view:this.view,geometry:e,elevationInfo:i,isDraped:(0,u.pC)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===(0,g.Zz)(this.hasZ,i),attached:!1}),li.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),li.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,(0,c.kB)((function(){t._outlineVisualElement=(0,u.SC)(t._outlineVisualElement)}))}},{key:"onRegularVerticesChanged",value:function(e){var t=this;return(0,u.pC)(this._verticesVisualElement)?(this._verticesVisualElement.vertices=e,null):(this._verticesVisualElement=new Fi({view:this.view,spatialReference:this.view.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:li.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,(0,c.kB)((function(){t._verticesVisualElement=(0,u.SC)(t._verticesVisualElement)})))}}]),i}(Bi.T);(0,l._)([(0,p.Cb)({constructOnly:!0})],Ji.prototype,"elevationInfo",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],Ji.prototype,"geometryType",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,type:Xi.Z})],Ji.prototype,"labelOptions",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,type:Qi.Z})],Ji.prototype,"tooltipOptions",void 0),(0,l._)([(0,p.Cb)()],Ji.prototype,"type",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],Ji.prototype,"view",void 0),Ji=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Ji);var Ki=i(40281),$i=i(41691),en=i(37818),tn=(i(59486),i(41644)),nn=i(23879),an=i(22753),rn=i(11873),on=i(92183),sn=i(65156),ln=i(77648);function cn(e,t,i){return function(e,t,i){var n=(0,y.Wv)((0,k.c)(wt.WM.get(),t));if(n[2]=0,!e.unprojectFromRenderScreen(n,i.origin))return null;var a=(0,y.Wv)((0,k.c)(wt.WM.get(),t));a[2]=1;var r=e.unprojectFromRenderScreen(a,wt.WM.get());return(0,u.Wi)(r)?null:((0,P.b)(i.direction,r,i.origin),i)}(e,e.screenToRender(t,(0,y.Wv)(wt.WM.get())),i)}var un=i(30425),hn=i(99034),pn=i(7882),dn=function(){function e(t){for(var i in(0,a.Z)(this,e),this.camera=new un.V,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=(0,$e.c)(),this._worldFrame=null,this._renderLocation=(0,b.c)(),this._renderLocationDirty=!0,this._location=new pn.Z({x:0,y:0,z:0}),this._elevationAlignedLocation=new pn.Z,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=hn.jg.None,this._focused=!1,this.events=new ci.Z.EventEmitter,this._screenLocation={screenPointArray:(0,y.s1)(),renderScreenPointArray:(0,y.J$)(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=t.view.spatialReference,t)this[i]=t[i];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}return(0,r.Z)(e,[{key:"destroy",value:function(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}},{key:"renderObjects",get:function(){return this._renderObjects},set:function(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}},{key:"available",get:function(){return this._available},set:function(e){e!==this._available&&(this._available=e,this._updateEngineObject())}},{key:"disableDisplay",value:function(){var e=this;return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:(0,nn.IH)((function(){e._noDisplayCount--,0===e._noDisplayCount&&e._updateEngineObject()}))}}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}},{key:"worldSized",get:function(){return this._worldSized},set:function(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}},{key:"modelTransform",get:function(){return this._modelTransform},set:function(e){fn(e)&&(this._screenLocationDirty=!0),(0,Ke.c)(this._modelTransform,e),this._updateEngineObject()}},{key:"renderLocation",get:function(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=(0,$e.c)()),function(e,t,i){switch(e.viewingMode){case"local":return(0,Ke.i)(i),!0;case"global":var n=(0,on.Iu)(e.renderCoordsHelper.spatialReference);(0,Mt.PR)(t,0,Sn,0,n.radius),(0,Mt.yH)((0,he.Vl)(Sn[0]),(0,he.Vl)(Sn[1]),i)}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation},set:function(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}},{key:"location",get:function(){return this._location},set:function(e){(0,en.WG)(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}},{key:"elevationAlignedLocation",get:function(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation},set:function(e){(0,en.WG)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}},{key:"_updateElevationAlignedLocation",value:function(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;var e=(0,u.pC)(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}},{key:"grabbableForEvent",value:function(){return!0}},{key:"grabbing",get:function(){return this._grabbing},set:function(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}},{key:"hovering",get:function(){return this._hovering},set:function(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}},{key:"selected",get:function(){return this._selected},set:function(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}},{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&(this._state=e,this._updateEngineObject())}},{key:"updateStateEnabled",value:function(e,t){t?this.state|=e:this.state&=~e}},{key:"_setFocused",value:function(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}},{key:"focused",get:function(){return this._focused}},{key:"screenLocation",get:function(){return this._ensureScreenLocation(),this._screenLocation}},{key:"_ensureScreenLocation",value:function(){if(this._screenLocationDirty){var e;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,fn(this._modelTransform)){var t=this._calculateModelTransformOffset(On);e=(0,P.a)(t,t,this.renderLocation)}else e=this.renderLocation;this.camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}}},{key:"applyObjectTransform",get:function(){return this._applyObjectTransform},set:function(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}},{key:"intersectionDistance",value:function(e,t){if(!this.available)return null;var i=(0,y.md)(e,vn),n=this._getCollisionRadius(t),a=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if((0,k.s)(this.screenLocation.screenPointArray,i)<n*n)return this.screenLocation.renderScreenPointArray[2]+a;break;case"line":var r=this.collisionType.paths,o=this._getWorldToScreenObjectScale(),s=this._calculateObjectTransform(o,bn),l=n*this.screenLocation.pixelSize,c=cn(this.camera,i,_n);if((0,u.Wi)(c))return null;var h,p=(0,Z.Z)(r);try{for(p.s();!(h=p.n()).done;){var d=h.value;if(0!==d.length)for(var f=(0,P.m)(Sn,d[0],s),v=1;v<d.length;v++){var g=(0,P.m)(wn,d[v],s),_=(0,le.Gr)((0,le.zk)(f,g,gn),c);if(null!=_&&_<l*l){var m=(0,P.a)(wt.WM.get(),f,g);(0,P.g)(m,m,.5);var M=(0,y.So)(wt.WM.get());return this.camera.projectToRenderScreen(m,M),M[2]+a}(0,P.c)(f,g)}}}catch(ie){p.e(ie)}finally{p.f()}break;case"disc":var S,w=this.collisionType.direction,C=null!==(S=this.collisionType.offset)&&void 0!==S?S:b.Z,x=this._getWorldToScreenObjectScale(),E=this._calculateObjectTransform(x,bn),O=n*this.screenLocation.pixelSize,A=cn(this.camera,i,_n);if((0,u.Wi)(A))return null;var T=(0,an.f)(yn,E),R=(0,P.t)(xn,w,T),D=(0,P.m)(En,C,E);(0,de.Yq)(D,R,Mn);var L=Cn;if((0,de.BR)(Mn,A,L)&&(0,P.d)(L,D)<O*O)return this.screenLocation.renderScreenPointArray[2]+a;break;case"ribbon":var G=this.collisionType,I=G.paths,V=G.direction,z=this._getWorldToScreenObjectScale(),W=this._calculateObjectTransform(z,bn),N=n*this.camera.computeScreenPixelSizeAt(this.renderLocation),F=cn(this.camera,i,_n);if((0,u.Wi)(F))return null;var U=(0,an.f)(yn,W),H=(0,P.t)(xn,V,U),j=this._calculateModelTransformPosition(En);(0,de.Yq)(j,H,Mn);var B=Cn;if(!(0,de.BR)(Mn,F,B))break;var Y,q=(0,Z.Z)(I);try{for(q.s();!(Y=q.n()).done;){var X=Y.value;if(0!==X.length)for(var Q=(0,P.m)(Sn,X[0],W),J=1;J<X.length;J++){var K=(0,P.m)(wn,X[J],W),$=(0,le.Jk)((0,le.zk)(Q,K,gn),B);if(null!=$&&$<N*N){var ee=(0,P.a)(wt.WM.get(),Q,K);(0,P.g)(ee,ee,.5);var te=(0,y.So)(wt.WM.get());return this.camera.projectToRenderScreen(ee,te),te[2]+a}(0,P.c)(Q,K)}}}catch(ie){q.e(ie)}finally{q.f()}break;default:(0,tn.Bg)(this.collisionType)}return null}},{key:"attach",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}};if(this.view._stage){var i=t.manipulator3D;if((0,u.Wi)(i.engineLayerId)){var n=new it.F({isPickable:!1,updatePolicy:et.jq.SYNC});this.view._stage.add(n),i.engineLayerId=n.id,this._engineLayer=n}else(null===(e=this.view._stage)||void 0===e?void 0:e.getObject)&&(this._engineLayer=this.view._stage.getObject(i.engineLayerId));i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,(0,u.Wi)(this._materialIdReferences)&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),(0,Mt.Up)(this._location.spatialReference,this.view.spatialReference)||(this.location=new pn.Z({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}}},{key:"detach",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}},t=e.manipulator3D;t.engineLayerReferences--;var i=0===t.engineLayerReferences;i&&(t.engineLayerId=null),this._removeResourcesFromStage(i),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}},{key:"onViewChange",value:function(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}},{key:"onElevationChange",value:function(e){(0,Mt.nF)(this.location,kn,e.spatialReference),(0,sn.Qn)(e.extent,kn)&&(this.location=this._location)}},{key:"_evaluateElevationAlignment",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.location;if((0,u.Wi)(this.elevationInfo))return!1;var t=null,i=0,n=(0,u.Pt)(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":t=(0,u.Pt)((0,ln.KO)(this.view.elevationProvider,e,"ground"),0);break;case"relative-to-ground":i=(0,u.Pt)((0,ln.KO)(this.view.elevationProvider,e,"ground"),0)+n;break;case"relative-to-scene":i=(0,u.Pt)((0,ln.KO)(this.view.elevationProvider,e,"scene"),0)+n;break;case"absolute-height":i=n}return(i!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=i,this._elevation.override=t,!0)}},{key:"_updateEngineObject",value:function(){if(this._attached)if(this.available){var e=this._getWorldToScreenObjectScale(),t=bn;if(!0===this.autoScaleRenderObjects){var i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);var n,a=this._ensureEngineResources().objectsByState,r=(this.focused?hn.Q9.Focused:hn.Q9.Unfocused)|(this.selected?hn.Q9.Selected:hn.Q9.Unselected),o=this._noDisplayCount>0,s=(0,Z.Z)(a);try{for(s.s();!(n=s.n()).done;){var l=n.value,c=l.stateMask,u=l.objects;if(o){var h,p=(0,Z.Z)(u);try{for(p.s();!(h=p.n()).done;){h.value.setVisible(!1)}}catch(S){p.e(S)}finally{p.f()}}else{var d=(c&hn.Q9.All)!==hn.Q9.None,f=(c&hn.jg.All)!==hn.jg.None,v=!d||(r&c)==(c&hn.Q9.All),g=!f||(this.state&c)==(c&hn.jg.All);if(v&&g){var _,y=(0,Z.Z)(u);try{for(y.s();!(_=y.n()).done;){var m=_.value;m.setVisible(!0),m.transformation=t}}catch(S){y.e(S)}finally{y.f()}}else{var b,M=(0,Z.Z)(u);try{for(M.s();!(b=M.n()).done;){b.value.setVisible(!1)}}catch(S){M.e(S)}finally{M.f()}}}}}catch(S){s.e(S)}finally{s.f()}}else this._removeResourcesFromStage()}},{key:"_ensureEngineResources",value:function(){if((0,u.Wi)(this._engineResources)){var e=(0,u.Wg)(this._engineLayer),t=[],i=new Set;this.renderObjects.forEach((function(e){var n=e.material;i.has(n)||(t.push(n),i.add(n))}));var n=new Map;this._renderObjects.forEach((function(e){var t=new tt.T({castShadow:!1});!function(e,t){var i=t.geometry,n=t.material,a=t.transform;Array.isArray(i)?i.forEach((function(t){return e.addGeometry(t,n,a)})):e.addGeometry(i,n,a)}(t,e);var i=e.stateMask||0,a=n.get(i)||[];a.push(t),n.set(i,a)}));var a=[];n.forEach((function(e,t){return a.push({stateMask:t,objects:e})})),this._engineResources={objectsByState:a,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}},{key:"_addResourcesToStage",value:function(){var e=this;if(!this._engineResourcesAddedToStage&&!(0,u.Wi)(this._engineResources)){var t=this._engineResources,i=t.objectsByState,n=t.layer;t.materials.forEach((function(t){var i=(0,u.Wg)(e._materialIdReferences),n=i.get(t.id)||0;0===n&&e.view._stage.add(t),i.set(t.id,n+1)})),i.forEach((function(t){var i=t.objects;n.addMany(i),e.view._stage.addMany(i)})),this._engineResourcesAddedToStage=!0}}},{key:"_removeResourcesFromStage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._engineResourcesAddedToStage&&!(0,u.Wi)(this._engineResources)&&this.view._stage){var i=this._engineResources,n=i.objectsByState,a=i.layer,r=i.materials;n.forEach((function(t){var i=t.objects;a.removeMany(i),e.view._stage.removeMany(i)})),r.forEach((function(t){var i=(0,u.Wg)(e._materialIdReferences),n=i.get(t.id);1===n?(e.view._stage.remove(t),i.delete(t.id)):i.set(t.id,n-1)})),t&&this.view._stage.remove(a),this._engineResourcesAddedToStage=!1}}},{key:"_getCollisionRadius",value:function(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}},{key:"_getFocusedSize",value:function(e,t){return e*(t?this.focusMultiplier:1)}},{key:"_getWorldToScreenObjectScale",value:function(){return this._worldSized?1:this.screenLocation.pixelSize}},{key:"_calculateModelTransformPosition",value:function(e){var t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,mn);return(0,P.s)(e,i[12],i[13],i[14])}},{key:"_calculateModelTransformOffset",value:function(e){var t=this._calculateModelTransformPosition(e);return(0,P.b)(e,t,this.renderLocation)}},{key:"_calculateObjectTransform",value:function(e,t){return(0,Ke.s)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&(0,Ke.m)(t,t,this._worldFrame),(0,Ke.m)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,(0,u.pC)(this._applyObjectTransform)&&this._applyObjectTransform(t),t}},{key:"test",get:function(){var e=!1;if((0,u.pC)(this._engineResources))for(var t in this._engineResources.objectsByState){var i,n=this._engineResources.objectsByState[t],a=(0,Z.Z)(n.objects);try{for(a.s();!(i=a.n()).done;){if(i.value.isVisible){e=!0;break}}}catch(r){a.e(r)}finally{a.f()}if(e)break}return{areAnyResourcesVisible:e}}}]),e}();function fn(e){return 0!==e[12]||0!==e[13]||0!==e[14]}var vn=(0,y.s1)(),gn=(0,le.Ue)(),_n=(0,ce.Ue)(),yn=(0,rn.c)(),mn=(0,$e.c)(),bn=(0,$e.c)(),Mn=(0,de.Ue)(),Sn=(0,b.c)(),wn=(0,b.c)(),Cn=(0,b.c)(),xn=(0,b.c)(),En=(0,b.c)(),On=(0,b.c)(),kn=new pn.Z({x:0,y:0,z:0,spatialReference:null}),An=i(96387);function Pn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rt.yD.OccludeAndTransparent,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=(0,pe.f)(e[0],e[1],e[2],e.length>3?e[3]:1),a=e[3]<1;return i?new Gi({color:n,transparent:a,writeDepth:!0,cullFace:et.Vr.Back,renderOccluded:t}):new Gt.E({color:n,transparent:a,writeDepth:!0,cullFace:et.Vr.Back,renderOccluded:t})}function Tn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rt.yD.OccludeAndTransparent,i=(0,pe.f)(e[0],e[1],e[2],4===e.length?e[3]:1);return new Gt.E({color:i,transparent:!0,writeDepth:!0,cullFace:et.Vr.Front,renderOccluded:t})}function Rn(e,t,i,n){var a=(0,P.b)(wt.WM.get(),e,i),r=Zn(a,(0,P.f)(wt.WM.get(),n,a),i,wt.MP.get());(0,Ke.a)(r,r);var o=(0,P.m)(wt.WM.get(),t,r);return Math.atan2(o[1],o[0])}function Zn(e,t,i,n){var a=(0,P.n)(wt.WM.get(),e),r=(0,P.n)(wt.WM.get(),t),o=(0,P.f)(wt.WM.get(),a,r);return n[0]=a[0],n[1]=a[1],n[2]=a[2],n[3]=0,n[4]=r[0],n[5]=r[1],n[6]=r[2],n[7]=0,n[8]=o[0],n[9]=o[1],n[10]=o[2],n[11]=0,n[12]=i[0],n[13]=i[1],n[14]=i[2],n[15]=1,n}function Dn(e,t){var i=e.getViewForGraphic(t);return(0,u.pC)(i)&&"computeAttachmentOrigin"in i?i.computeAttachmentOrigin(t,e.spatialReference):null}function Ln(e,t,i){var n=Dn(e,i);(0,u.pC)(n)?t.elevationAlignedLocation=n:function(e,t){if((0,u.Wi)(t))return;var i="mesh"===t.type?t.anchor:(0,An.zE)(t);(0,u.Wi)(i)||(e.location=(0,en.kB)(i))}(t,i.geometry)}var Gn,In,Vn=i(77498);function zn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,g.RL)(e);return"on-the-ground"!==t.mode&&!((0,u.Wi)(e.geometry)||!e.geometry.hasZ)}!function(e){e[e.TRANSLATE_Z=0]="TRANSLATE_Z",e[e.TRANSLATE_XY=1]="TRANSLATE_XY",e[e.SCALE=2]="SCALE",e[e.ROTATE=3]="ROTATE",e[e.SCALE_ROTATE=4]="SCALE_ROTATE"}(Gn||(Gn={})),function(e){e[e.NONE=0]="NONE",e[e.ANY=1]="ANY",e[e.Z=2]="Z",e[e.XY=4]="XY"}(In||(In={}));var Wn=function(){function e(){(0,a.Z)(this,e),this.grabbingState=In.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}return(0,r.Z)(e,[{key:"update",value:function(e){var t=this;this.grabbingState=In.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((function(e,i){if(i===Gn.TRANSLATE_Z&&(t.zManipulator=e),e instanceof dn&&(e.selected&&(0===t.numSelected&&(t.firstSelected=e),t.numSelected++),(0,u.Wi)(t.firstGrabbedXY)&&e.grabbing&&i===Gn.TRANSLATE_XY&&(t.firstGrabbedXY=e)),e.grabbing)switch(t.grabbingState|=In.ANY,i){case Gn.TRANSLATE_Z:t.grabbingState|=In.Z;break;case Gn.TRANSLATE_XY:t.grabbingState|=In.XY}}))}}]),e}();function Nn(e){var t=e.view,i=e.graphic,n=new ji.F({graphic:i}),a=function(e,t){var i=e.view,n=e.graphic,a=new mi({view:i,geometry:Un(n)?n.geometry:null,elevationInfo:(0,g.RL)(n),attached:!1});li.visualElements.lineGraphics.shadowStyle.apply(a);var r=function(){a.attached=t.displaying};li.visualElements.lineGraphics.outline.apply(a);var o=[(0,h.YP)((function(){return t.displaying}),r),(0,h.YP)((function(){return t.isDraped}),(function(e){a.isDraped=e})),t.on("changed",(function(){return a.geometry=Un(n)?n.geometry:null})),(0,c.ed)(a)];return r(),{visualElement:a,remove:function(){return(0,c.AL)(o).remove()}}}(e,n),r=[a,Fn(e,a.visualElement,n),t.maskOccludee(i),t.trackGraphicState(n)];return{visualElement:a.visualElement,remove:function(){return(0,c.AL)(r).remove()}}}function Fn(e,t,i){var n=e.graphic,a=e.view,r=[],o=(0,g.RL)(n),s="on-the-ground"===o.mode||!o.offset&&"absolute-height"!==o.mode,l=new Wn,p=new st({view:a,extensionType:li.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:rt.yD.OccludeAndTransparent});li.visualElements.pointGraphics.shadowStyle.apply(p);var d=(0,he.Vl)(li.visualElements.heightPlaneAngleCutoff),f=new Qe({view:a,attached:!1,angleCutoff:d});li.visualElements.heightPlane.apply(f);var v=1,_=1,y=function(){if(l.update(e),!i.displaying||s&&(i.isDraped||!Un(n)||!n.geometry.hasZ))return t.laserlineEnabled=!1,p.attached=!1,void(f.attached=!1);t.laserlineEnabled=!0;var a=l.grabbingState&In.XY?li.visualElements.laserlineAlphaMultiplier:1;a!==v&&(v=a,li.visualElements.lineGraphics.shadowStyle.apply(t,a),li.visualElements.pointGraphics.shadowStyle.apply(p,a));var r=l.grabbingState&In.Z?li.visualElements.laserlineAlphaMultiplier:1;r!==_&&(_=r,li.visualElements.heightPlane.apply(f,r)),function(e,t){var i=1===t.numSelected?t.firstSelected:t.numSelected>1&&(0,u.pC)(t.firstGrabbedXY)?t.firstGrabbedXY:null;(0,u.pC)(i)?(e.setStartEndFromWorldDownAtLocation(i.renderLocation),e.attached=!0):e.attached=!1}(p,l),function(e,t,i,n){if(n.numSelected>0){(0,P.s)(Hn,0,0,0);var a=0;e.forEachManipulator((function(e,t){t===Gn.TRANSLATE_XY&&e.selected&&e instanceof dn&&((0,P.a)(Hn,Hn,e.renderLocation),a++)})),a>0?(i.heightManifoldTarget=(0,P.g)(Hn,Hn,1/a),i.attached=!0):i.attached=!1}else{var r=t.attachmentOrigin;(0,u.pC)(r)&&e.view.renderCoordsHelper.toRenderCoords(r,Hn)?(i.heightManifoldTarget=Hn,i.attached=!0):i.attached=!1}}(e,t,f,l)};li.visualElements.zVerticalLine.apply(p),r.push(i.on("changed",y),(0,h.YP)((function(){return i.displaying}),y),t.events.on("attachment-origin-changed",y),(0,c.ed)(p),(0,c.ed)(f));var m=[],b=function(){(0,c.AL)(m).remove(),m.length=0,e.forEachManipulator((function(e){return m.push(e.events.on("grab-changed",y))})),e.forEachManipulator((function(e){return m.push(e.events.on("select-changed",y))})),y()};return b(),r.push(e.onManipulatorsChanged(b),(0,c.iU)((function(){return(0,c.AL)(m)}))),(0,c.AL)(r)}function Un(e){return(0,u.pC)(e.geometry)&&("polygon"===e.geometry.type||"polyline"===e.geometry.type)}var Hn=(0,b.c)();function jn(e){var t=e.view,i=e.graphic,n=new ji.F({graphic:i}),a=[],r=function(e,t,i){var n=e.view,a=e.graphic,r=new Tt({view:n,geometry:Bn(a),elevationInfo:(0,g.RL)(a),attached:!1});return function(e,t,i,n){var a=function(){return t.attached=i.displaying};(function(e,t,i,n){var a=e.view,r=e.graphic,o=null,s=function(e){(0,u.pC)(o)&&(o.remove(),o=null),i.isDraped&&(0,u.pC)(e)&&(o=function(e,t,i){var n=e.elevationProvider.spatialReference;(0,Mt.KC)(t,Yn,n);var a=Yn[0],r=Yn[1];return e.elevationProvider.on("elevation-change",(function(e){(0,sn.jE)(e.extent,a,r)&&i()}))}(a,e,(function(){t.geometry=e})))},l=function(){var e=Bn(r);s(e),t.geometry=e};n.push(i.on("changed",l),(0,c.iU)((function(){return o}))),l()})(e,t,i,n),li.visualElements.pointGraphics.outline.apply(t),n.push((0,h.YP)((function(){return i.displaying}),a,h.nn))}(e,r,t,i),i.push((0,c.ed)(r)),r}(e,n,a);return function(e,t,i,n){var a=e.view,r=e.graphic,o=new st({view:a,extensionType:li.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:rt.yD.OccludeAndTransparent});li.visualElements.zVerticalLine.apply(o);var s=new Qe({view:a,intersectsLineInfinite:!0,attached:!1});li.visualElements.pointGraphics.shadowStyle.apply(s);var l=(0,he.Vl)(li.visualElements.heightPlaneAngleCutoff),p=new Qe({view:a,attached:!1,angleCutoff:l});li.visualElements.heightPlane.apply(p);var d=(0,g.RL)(e.graphic),f=kt.o.fromElevationInfo(d),v="on-the-ground"===d.mode||!d.offset&&"absolute-height"!==d.mode,_=new Wn,y=1,m=1,b=function(){_.update(e);var i=Bn(r),l=v&&(t.isDraped||(0,u.Wi)(i)||!i.hasZ),c=!0;if(!l&&(0,u.pC)(i)){var h=(0,Ot.w7)(i,a.elevationProvider,f,a.renderCoordsHelper);(0,P.s)(Yn,i.x,i.y,h),(0,Mt.SH)(Yn,i.spatialReference,Yn,a.renderCoordsHelper.spatialReference),o.setStartEndFromWorldDownAtLocation(Yn),s.intersectsWorldUpAtLocation=Yn}else c=!1;var d=_.grabbingState&In.Z?li.visualElements.laserlineAlphaMultiplier:1;d!==y&&(y=d,li.visualElements.heightPlane.apply(p,d));var g=(0,St.cS)(qn);!l&&t.displaying&&n.calculateMapBounds(g)&&(0,Mt.SH)((0,St.KE)(g,Yn),a.spatialReference,Yn,a.renderCoordsHelper.spatialReference)?(p.heightManifoldTarget=Yn,p.attached=!0):p.attached=!1;var b=_.grabbingState&In.XY?li.visualElements.laserlineAlphaMultiplier:1;b!==m&&(m=b,li.visualElements.pointGraphics.shadowStyle.apply(s,b));var M=c&&t.displaying&&!l;s.attached=M,o.attached=M};i.push((0,h.YP)((function(){return[t.displaying,t.isDraped]}),b),t.on("changed",b)),e.forEachManipulator((function(e){i.push(e.events.on("grab-changed",b))})),i.push((0,c.ed)(s)),i.push((0,c.ed)(o)),i.push((0,c.ed)(p)),b()}(e,n,a,r),a.push(t.trackGraphicState(n)),{visualElement:r,remove:function(){(0,c.AL)(a).remove()}}}function Bn(e){var t=e.geometry;return(0,u.Wi)(t)?null:"point"===t.type?t:"mesh"===t.type?t.anchor.clone():null}var Yn=(0,b.c)(),qn=(0,St.Ue)();function Xn(e){switch((0,u.Wg)(e.graphic.geometry).type){case"point":case"mesh":return jn(e);case"polygon":case"polyline":return Nn(e);default:return null}}var Qn,Jn=[1,.5,0],Kn=70,$n=Math.ceil(Kn/3*2),ea=160,ta=5*Math.PI/12,ia=1*Math.PI/3,na=function(){function e(){(0,a.Z)(this,e),this._available=!0}return(0,r.Z)(e,[{key:"location",set:function(e){this._forEachManipulator3D((function(t){return t.location=e}))}},{key:"elevationAlignedLocation",set:function(e){this._forEachManipulator3D((function(t){return t.elevationAlignedLocation=e}))}},{key:"elevationInfo",set:function(e){this._forEachManipulator3D((function(t){return t.elevationInfo=e}))}},{key:"renderLocation",get:function(){var e;return this._forEachManipulator3D((function(t){e||(e=t.renderLocation)})),e}},{key:"available",get:function(){return this._available},set:function(e){this._available=e,this._forEachManipulator3D((function(t){return t.available=e}))}},{key:"hovering",get:function(){return this.someManipulator((function(e){return e.hovering}))}},{key:"grabbing",get:function(){return this.someManipulator((function(e){return e.grabbing}))}},{key:"dragging",get:function(){return this.someManipulator((function(e){return e.dragging}))}},{key:"hasManipulator",value:function(e){return this.someManipulator((function(t){return t===e}))}},{key:"someManipulator",value:function(e){var t=!1;return this.forEachManipulator((function(i){!t&&e(i)&&(t=!0)})),t}},{key:"_forEachManipulator3D",value:function(e){this.forEachManipulator((function(t,i){t instanceof dn&&e(t,i)}))}}]),e}(),aa=i(40927),ra=(i(81268),i(54463),i(76783),i(74229));function oa(e,t){return sa(e,(function(){return t}))}function sa(e,t){var i=(0,b.c)(),a=(0,b.c)(),r=!1;return function(o){var s=t(o);if("start"===o.action){var l=(0,y.md)(o.screenStart,(0,y.c$)(wt.qW.get())),c=cn(e.state.camera,l,va);(0,u.pC)(c)&&(r=(0,de.BR)(s,c,i))}if(!r)return null;var h=(0,y.md)(o.screenEnd,(0,y.c$)(wt.qW.get())),p=cn(e.state.camera,h,va);return(0,u.Wi)(p)?null:(0,de.BR)(s,p,a)?(0,n.Z)((0,n.Z)({},o),{},{renderStart:i,renderEnd:a,plane:s,ray:p}):null}}function la(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=null;return function(s){if("start"===s.action&&(o=e.sceneIntersectionHelper.intersectElevationFromScreen((0,y.s1)(s.screenStart.x,s.screenStart.y),t,i,r),(0,u.pC)(o)&&(0,u.pC)(a)&&!(0,Mt.nF)(o,o,a)))return null;if((0,u.Wi)(o))return null;var l=e.sceneIntersectionHelper.intersectElevationFromScreen((0,y.s1)(s.screenEnd.x,s.screenEnd.y),t,i,r);return(0,u.pC)(l)?(0,u.pC)(a)&&!(0,Mt.nF)(l,l,a)?null:(0,n.Z)((0,n.Z)({},s),{},{mapStart:o,mapEnd:l}):null}}function ca(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return la(e,i,(0,g.Ou)(t,e,i),n,a)}function ua(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return ca(e,i,(0,g.RL)(t),n,a)}function ha(e,t,i){var n=null,a=new ra.hM;return a.next(oa(e,function(e,t){var i=da,n=fa,a=(0,de.Ue)();e.renderCoordsHelper.worldUpAtPosition(t,i);var r=(0,P.f)(a,i,(0,P.b)(n,t,e.state.camera.eye));return(0,P.f)(r,r,i),(0,de.Yq)(t,r,a)}(e,t))).next(function(e,t){var i=(0,b.c)(),n=(0,P.l)(t);e.renderCoordsHelper.worldUpAtPosition(t,i);var a=(0,b.c)(),r=(0,b.c)(),o=function(a){return(0,P.b)(a,a,t),(0,aa.nF)(i,a,a),"global"===e.viewingMode&&(0,P.l)(a)*Math.sign((0,P.e)(i,a))<.001-n&&(0,P.b)(a,(0,P.g)(a,i,.001),t),(0,P.a)(a,a,t),a};return function(e){return e.renderStart=o((0,P.c)(a,e.renderStart)),e.renderEnd=o((0,P.c)(r,e.renderEnd)),e}}(e,t)).next(pa(e,i)).next((function(e){e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,n=e})),function(e){return n=null,a.execute(e),n}}function pa(e,t){var i=e.renderCoordsHelper;return function(e){var a=i.fromRenderCoords(e.renderStart,t),r=i.fromRenderCoords(e.renderEnd,t);return(0,u.pC)(a)&&(0,u.pC)(r)?(0,n.Z)((0,n.Z)({},e),{},{mapStart:a,mapEnd:r}):null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(Qn||(Qn={}));var da=(0,b.c)(),fa=(0,b.c)(),va=(0,ce.Ue)();function ga(e,t,i,n){var a=e.graphic,r=function(e,i){return t({action:e,graphic:a,dxScreen:i.screenDeltaX,dyScreen:i.screenDeltaY})};return i((function(e,t,i){var o=t.next((function(e){return"start"===e.action&&r("start",e),e})).next((0,ra.a9)(a,n)).next((function(e){switch(e.action){case"start":case"update":(e.translationX||e.translationY||e.translationZ)&&r("update",e);break;case"end":r("end",e)}return e}));return i.next((0,ra.bD)(a)).next((function(){r("end",{screenDeltaX:0,screenDeltaY:0})})),o}))}function _a(e){if((0,u.Wi)(e)||"polyline"!==e.type&&"polygon"!==e.type)return 0;var t=("polyline"===e.type?e.paths:e.rings)[0];if(!t||t.length<2)return 0;var i=t[0],n=t[1];return Math.atan2(n[1]-i[1],n[0]-i[0])}var ya,ma=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this))._handles=new ne.Z,n._arrowManipulatorInfos=new Array,n._opaqueMaterial=n._createMaterial(),n._transparentMaterial=n._createMaterial(.5),n._angle=0,n._scale=1,n._radius=Kn,n._updateAfterDrag=!1,n.events=new ci.Z,n._tool=e.tool,n._view=e.view,null!=e.radius&&(n._radius=e.radius),n._createManipulators(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return(0,r.Z)(i,[{key:"orthogonalAvailable",set:function(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}},{key:"destroy",value:function(){var e=this;this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._handles=(0,u.SC)(this._handles),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}},{key:"forEachManipulator",value:function(e){var t,i=(0,Z.Z)(this._arrowManipulatorInfos);try{for(i.s();!(t=i.n()).done;){e(t.value.manipulator,Gn.TRANSLATE_XY)}}catch(n){i.e(n)}finally{i.f()}}},{key:"createGraphicDragPipeline",value:function(e,t,i){var n=this,a=t.graphic,r=(0,g.RL)(a),o=(0,u.Wg)(a.geometry).spatialReference;return ga(t,i,(function(t){return n.createDragPipeline((function(i,n,a,r,o){return t(i,e(i,n,a,r,o),a)}),r,o,a)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e,t,i,a){var r=this;return(0,c.AL)(this._arrowManipulatorInfos.map((function(o,s){var l=o.manipulator;return(0,ra.Xd)(l,(function(o,l,c,u,h){var p=l.next((function(e){return(0,n.Z)((0,n.Z)({},e),{},{manipulatorType:Gn.TRANSLATE_XY})})).next((0,ra.kY)(r._view,o.elevationAlignedLocation)).next(ca(r._view,o.elevationAlignedLocation,t,i,a)).next((0,ra.M2)(o.location,r.angle+(s+1)*Math.PI*.5)).next((0,ra.zh)());e(o,p,c,u,h)}))})))}},{key:"angle",get:function(){return this._angle},set:function(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}},{key:"displayScale",get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()}},{key:"radius",get:function(){return this._radius},set:function(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}},{key:"_updateManipulators",value:function(){for(var e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}},{key:"_updateArrowManipulator",value:function(e,t){var i=e.manipulator,n=e.transform,a=this._radius/Kn,r=54*a,o=r*Math.sqrt(3)/2,s=at.Z.createExtrudedTriangle(o,r/2,r/2,.02);at.Z.transformInPlace(s,(0,Ke.f)(wt.MP.get(),(0,P.s)(wt.WM.get(),0,-o/3,0))),i.renderObjects=[{geometry:s,material:this._opaqueMaterial,stateMask:hn.Q9.Focused},{geometry:s,material:this._transparentMaterial,stateMask:hn.Q9.Unfocused}],i.radius=o/3*2*1.2;var l=(0,Ke.b)(wt.MP.get(),t*Math.PI/2),c=(0,Ke.f)(wt.MP.get(),(0,P.s)(wt.WM.get(),0,100*a,0));(0,Ke.m)(n,l,c)}},{key:"_createManipulators",value:function(){for(var e=0;e<4;e++){var t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}},{key:"_updateManipulatorTransform",value:function(){var e=this.angle,t=(0,Ke.d)(wt.MP.get(),e,(0,b.f)(0,0,1));if(!(0,u.Wi)(t)){var i,n=(0,Ke.u)(wt.MP.get(),(0,P.s)(wt.WM.get(),this.displayScale,this.displayScale,this.displayScale)),a=(0,Ke.m)(wt.MP.get(),n,t),r=(0,Z.Z)(this._arrowManipulatorInfos);try{for(r.s();!(i=r.n()).done;){var o=i.value,s=(0,Ke.m)(wt.MP.get(),a,o.transform);o.manipulator.modelTransform=s}}catch(l){r.e(l)}finally{r.f()}}}},{key:"_createArrowManipulator",value:function(e){var t=this,i=new dn({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,b.f)(0,0,1)}}),n={manipulator:i,transform:(0,$e.c)()};return this._updateArrowManipulator(n,e),this._handles.add(i.events.on("drag",(function(e){t._updateAfterDrag&&"end"===e.action&&!t.dragging&&(t._updateManipulatorTransform(),t._updateAfterDrag=!1)}))),n}},{key:"_createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=ee.Z.toUnitRGBA(jt.main);return t[3]*=e,new Gt.E({color:t,transparent:1!==e,cullFace:et.Vr.Back,renderOccluded:rt.yD.Transparent})}},{key:"test",get:function(){return{arrowManipulators:this._arrowManipulatorInfos.map((function(e){return e.manipulator}))}}}]),i}(na),ba=function(){function e(){(0,a.Z)(this,e),this.view=null,this.elevationInfo=null,this.lastDragEvent=null,this.next=new ra.hM,this._enabled=!1}return(0,r.Z)(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&(0,u.pC)(this.lastDragEvent)){var t=this.lastDragEvent.mapEnd,i=this._snap(this.lastDragEvent.screenEnd);if((0,u.pC)(i)){var n={action:"update",mapStart:this.lastDragEvent.mapStart,mapEnd:!0===e?i:t,screenStart:this.lastDragEvent.screenEnd,screenEnd:this.lastDragEvent.screenEnd};this.next.execute(n)}}this._enabled=e}},{key:"_snap",value:function(e){var t=(0,u.pC)(this.view)?this.view.toMap(e,{exclude:[]}):null;return(0,u.pC)(t)&&(0,u.pC)(this.view)&&(t.z=(0,g.Ou)(t,this.view,this.elevationInfo)),t}},{key:"createDragEventPipelineStep",value:function(e,t){var i=this;return this.view=e,this.elevationInfo=t,this.lastDragEvent=null,function(e){if(i.lastDragEvent="end"!==e.action?(0,n.Z)({},e):null,i._enabled){var t=i._snap(e.screenEnd);return(0,u.pC)(t)?{action:e.action,mapStart:e.mapStart,mapEnd:t,screenStart:e.screenStart,screenEnd:e.screenEnd}:null}return{action:e.action,mapStart:e.mapStart,mapEnd:e.mapEnd,screenStart:e.screenStart,screenEnd:e.screenEnd}}}}]),e}(),Ma=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this))._snapToScene=new ba,n._discMaterial=n._createMaterial(),n._discMaterialTransparent=n._createMaterial(.5),n._scale=1,n._radius=Kn,n._view=e.view,n._tool=e.tool,null!=e.snapToScene&&(n.snapToScene=e.snapToScene),null!=e.radius&&(n._radius=e.radius),n._createManipulator(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return(0,r.Z)(i,[{key:"destroy",value:function(){var e=this;this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null}},{key:"forEachManipulator",value:function(e){e(this._manipulator,Gn.TRANSLATE_XY)}},{key:"displayScale",get:function(){return this._scale},set:function(e){this._scale=e,this._updateManipulatorTransform()}},{key:"snapToScene",get:function(){return this._snapToScene.enabled},set:function(e){this._snapToScene.enabled=e}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}},{key:"createGraphicDragPipeline",value:function(e,t,i){var n=this,a=t.graphic,r=(0,g.RL)(a),o=(0,u.Wg)(a.geometry).spatialReference;return ga(t,i,(function(t){return n.createDragPipeline((function(i,n,a,r,o){return t(i,e(i,n,a,r,o),a)}),r,o,a)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e,t,i,a){var r=this,o=this._view;return(0,ra.Xd)(this._manipulator,(function(s,l,c,u,h){var p=l.next((0,ra.kY)(o,s.elevationAlignedLocation)).next(ca(o,s.elevationAlignedLocation,t,i,a)).next(r._snapToScene.createDragEventPipelineStep(o,t),r._snapToScene.next).next((function(e){return(0,n.Z)((0,n.Z)({},e),{},{manipulatorType:Gn.TRANSLATE_XY})})).next((0,ra.zh)());e(s,p,c,u,h)}))}},{key:"_updateManipulatorTransform",value:function(){var e=(0,Ke.u)(wt.MP.get(),(0,P.s)(wt.WM.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}},{key:"_createManipulator",value:function(){var e=this._view;this._manipulator=new dn({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,b.f)(0,0,1)},worldOriented:!0}),this._updateManipulator()}},{key:"_updateManipulator",value:function(){var e=at.Z.createCylinderGeometry(.02,1,128,(0,b.f)(0,0,1),(0,b.f)(0,0,0)),t=(0,Ke.u)((0,$e.c)(),(0,b.f)(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:hn.Q9.Focused},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:hn.Q9.Unfocused}],this._manipulator.radius=this._radius/Kn*80}},{key:"_createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=ee.Z.toUnitRGBA(jt.main);return t[3]*=e,new Gt.E({color:t,transparent:1!==e,cullFace:et.Vr.Back,renderOccluded:rt.yD.Transparent})}},{key:"test",get:function(){return{discManipulator:this._manipulator}}}]),i}(na),Sa=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this))._radius=Kn,n.events=new ci.Z,n._tool=e.tool,n._view=e.view,null!=e.radius&&(n._radius=e.radius),n._createManipulator(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return(0,r.Z)(i,[{key:"destroy",value:function(){var e=this;this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()}))}},{key:"forEachManipulator",value:function(e){e(this._manipulator,Gn.TRANSLATE_Z)}},{key:"createGraphicDragPipeline",value:function(e,t,i){var n=this,a=(0,u.Wg)(t.graphic.geometry).spatialReference;return ga(t,i,(function(t){return n.createDragPipeline((function(i,n,a,r,o){return t(i,e(i,n,a,r,o),a)}),a)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e,t){var i=this._view;return(0,ra.Xd)(this._manipulator,(function(a,r,o,s,l){var c=r.next((function(e){return(0,n.Z)((0,n.Z)({},e),{},{manipulatorType:Gn.TRANSLATE_Z})})).next(ha(i,a.renderLocation,t)).next((0,ra.zh)());e(a,c,o,s,l)}))}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}},{key:"_updateManipulator",value:function(){var e=this._radius/Kn,t=li.zManipulator.height*e,i=li.zManipulator.coneHeight*e,n=li.zManipulator.coneWidth*e,a=li.zManipulator.width*e,r=[(0,b.f)(0,0,0),(0,b.f)(0,0,t)],o=at.Z.createTubeGeometry(r,a/2,16,!1),s=at.Z.createConeGeometry(i,n/2,16,!1),l=[(0,b.f)(0,0,0),(0,b.f)(0,0,t+i)],c=function(e){var i=(0,$e.c)();if((0,Ke.j)(i,i,[0,0,t]),(0,Ke.r)(i,i,Math.PI/2),e){var a=1+2*e/n;(0,Ke.h)(i,i,[a,a,a])}return i}(0),u=function(e,t){var i=(0,Ut._j)(li.zManipulator.color,t);return[i.r/255,i.g/255,i.b/255,li.zManipulator.color.a*e]},h=Pn(u(1,.25),rt.yD.Occlude),p=Pn(u(1,0),rt.yD.Occlude),d=Pn(u(.7,0),li.zManipulator.renderOccluded),f=Pn(u(.85,0),li.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:s,transform:c,material:h,stateMask:hn.Q9.Unfocused},{geometry:o,material:h,stateMask:hn.Q9.Unfocused},{geometry:s,transform:c,material:p,stateMask:hn.Q9.Focused},{geometry:o,material:p,stateMask:hn.Q9.Focused},{geometry:s,transform:c,material:d,stateMask:hn.Q9.Unfocused},{geometry:o,material:d,stateMask:hn.Q9.Unfocused},{geometry:s,transform:c,material:f,stateMask:hn.Q9.Focused},{geometry:o,material:f,stateMask:hn.Q9.Focused}],this._manipulator.radius=a/2+2,this._manipulator.collisionType={type:"line",paths:[l]}}},{key:"_createManipulator",value:function(){var e=this,t=new dn({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});t.applyObjectTransform=function(t){var i=e._view.state.camera,n=wa;e._view.renderCoordsHelper.toRenderCoords(e._manipulator.elevationAlignedLocation,n);var a=(0,P.j)(i.eye,n),r=i.computeRenderPixelSizeAtDist(a),o=(0,P.b)(Ca,n,i.eye);(0,P.n)(o,o);var s=xa;e._view.renderCoordsHelper.worldUpAtPosition(wa,s);var l=Math.abs((0,P.e)(o,s)),c=(0,P.f)(Ca,o,s),u=(0,P.f)(Ca,c,s),h=(0,he.uZ)(l,.01,1),p=1-Math.sqrt(1-h*h)/h/i.fullWidth,d=e._radius/Kn,f=li.zManipulator.width*d;(0,P.g)(u,(0,P.n)(u,u),(1/p-1)*a+r*f),t[12]-=Ca[0],t[13]-=Ca[1],t[14]-=Ca[2]},this._manipulator=t,this._updateManipulator()}},{key:"test",get:function(){return{manipulator:this._manipulator}}}]),i}(na),wa=(0,b.c)(),Ca=(0,b.c)(),xa=(0,b.c)(),Ea=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;(0,a.Z)(this,i),(n=t.call(this))._handles=new ne.Z,n._angleDeferred=null,n._interactive=!0;var r=e.tool,o=e.view,s=e.snapToScene,l=e.radius;return n._view=o,n.xyManipulation=new Ma({tool:r,view:o,snapToScene:s,radius:l}),n.xyAxisManipulation=new ma({tool:r,view:o,radius:l}),n.zManipulation=new Sa({tool:r,view:o,radius:l}),n.xyManipulation.available=e.xyAvailable,n.xyAxisManipulation.available=e.xyAxisAvailable,n.zManipulation.available=e.zAvailable,n._autoHideXYAxis(),n.forEachManipulator((function(e){n._handles.add(e.events.on("grab-changed",(function(){return n._updateManipulatorInteractivity()})))})),n}return(0,r.Z)(i,[{key:"destroy",value:function(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}},{key:"createGraphicDragPipeline",value:function(e,t,i){return(0,c.AL)([this.xyManipulation.createGraphicDragPipeline((function(t,i,n,a,r){return e(ya.XY,t,i,n,a,r)}),t,i),this.xyAxisManipulation.createGraphicDragPipeline((function(t,i,n,a,r){return e(ya.XY_AXIS,t,i,n,a,r)}),t,i),this.zManipulation.createGraphicDragPipeline((function(t,i,n,a,r){return e(ya.Z,t,i,n,a,r)}),t,i)])}},{key:"createDragPipeline",value:function(e,t,i,n){return(0,c.AL)([this.xyManipulation.createDragPipeline((function(t,i,n,a,r){return e(ya.XY,t,i,n,a,r)}),t,i,n),this.xyAxisManipulation.createDragPipeline((function(t,i,n,a,r){return e(ya.XY_AXIS,t,i,n,a,r)}),t,i,n),this.zManipulation.createDragPipeline((function(t,i,n,a,r){return e(ya.Z,t,i,n,a,r)}),i)])}},{key:"snapToScene",set:function(e){this.xyManipulation.snapToScene=e}},{key:"angle",set:function(e){this._angleDeferred=null,this.xyAxisManipulation.angle=e}},{key:"angleDeferred",set:function(e){this.xyAxisVisible?this.angle=e():this._angleDeferred=e}},{key:"interactive",set:function(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}},{key:"radius",set:function(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}},{key:"displayScale",set:function(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}},{key:"forEachManipulator",value:function(e){this.xyManipulation.forEachManipulator((function(t){return e(t,Gn.TRANSLATE_XY)})),this.xyAxisManipulation.forEachManipulator((function(t){return e(t,Gn.TRANSLATE_XY)})),this.zManipulation.forEachManipulator((function(t){return e(t,Gn.TRANSLATE_Z)}))}},{key:"xyAxisVisible",get:function(){var e=this.xyManipulation.someManipulator((function(e){return e.focused}))||this.xyAxisManipulation.someManipulator((function(e){return e.focused}));return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||e}},{key:"_autoHideXYAxis",value:function(){var e=this,t=this.xyAxisManipulation,i=this.xyManipulation;if(!(0,d.Z)("esri-mobile")){var n=[];i.forEachManipulator((function(e){return n.push(e)})),t.forEachManipulator((function(e){return n.push(e)}));for(var a=function(){var i=[];e.xyAxisVisible?(0,u.pC)(e._angleDeferred)&&(e.angle=e._angleDeferred()):t.forEachManipulator((function(e){return i.push(e.disableDisplay())})),e._handles.remove(Oa),e._handles.add(i,Oa)},r=0,o=n;r<o.length;r++){var s=o[r];this._handles.add(s.events.on("focus-changed",a))}this._view.inputManager&&this._handles.add((0,h.gx)((function(){var t;return null===(t=e._view.inputManager)||void 0===t?void 0:t.latestPointerType}),a)),a()}}},{key:"_updateManipulatorInteractivity",value:function(){var e=this,t=this.grabbing;this.forEachManipulator((function(i){i.interactive=!t&&e._interactive||i.grabbing}))}}],[{key:"radiusForSymbol",value:function(e){var t=(0,u.pC)(e)&&"point-3d"===e.type&&e.symbolLayers;return t&&t.length>0&&t.some((function(e){return"icon"===e.type}))?$n:Kn}}]),i}(na),Oa="disable-xy-axis-display";!function(e){e[e.XY=0]="XY",e[e.XY_AXIS=1]="XY_AXIS",e[e.Z=2]="Z"}(ya||(ya={}));var ka=i(2346),Aa=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this))._view=e.view,n._tool=e.tool,n._graphicState=e.graphicState,n._createManipulator(),n.forEachManipulator((function(e){return n._tool.manipulators.add(e)})),n}return(0,r.Z)(i,[{key:"destroy",value:function(){var e=this;this.forEachManipulator((function(t){e._tool.manipulators.remove(t),t.destroy()})),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}},{key:"forEachManipulator",value:function(e){e(this._manipulator,Gn.TRANSLATE_XY)}},{key:"createGraphicDragPipeline",value:function(e){var t=this;return ga(this._graphicState,e,(function(e){return t.createDragPipeline(e)}),this._view.state.viewingMode)}},{key:"createDragPipeline",value:function(e){var t=this._view,i=this._graphicState.graphic,n=(0,u.pC)(i.geometry)?i.geometry.spatialReference:null;return(0,ra.Xd)(this._manipulator,(function(a,r,o,s,l){var c=r.next(function(e,t,i,n){var a=t.toMap(e.screenStart,{include:[i]});return(0,u.pC)(a)?ua(t,i,a,n):null}(l,t,i,n)).next((0,ra.AN)()).next((0,ra.zh)());e(a,c,o,s,l)}))}},{key:"_createManipulator",value:function(){var e=this._view,t=this._graphicState.graphic;this._manipulator=new ka.L({graphic:t,view:e,selectable:!0,cursor:"move"})}}]),i}(na),Pa=i(57889),Ta=i(29919),Ra=i(87268),Za=i(34019),Da=i(80151),La=i(72189),Ga=i(47898),Ia=i(4943),Va=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).type="translate-graphic",n.distance=Ga.yP,n}return(0,r.Z)(i)}(Ia.h);(0,l._)([(0,p.Cb)()],Va.prototype,"type",void 0),(0,l._)([(0,p.Cb)()],Va.prototype,"distance",void 0),Va=(0,l._)([(0,v.j)("esri.views.interactive.tooltip.TranslateGraphicTooltipInfo")],Va);var za=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).type="translate-z",n.distance=Ga.yP,n}return(0,r.Z)(i)}(Ia.h);(0,l._)([(0,p.Cb)()],za.prototype,"type",void 0),(0,l._)([(0,p.Cb)()],za.prototype,"distance",void 0),za=(0,l._)([(0,v.j)("esri.views.interactive.tooltip.TranslateZTooltipInfo")],za);var Wa=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).type="translate-vertex",n.distance=Ga.yP,n.elevation=null,n.area=null,n.totalLength=null,n}return(0,r.Z)(i)}(Ia.h);(0,l._)([(0,p.Cb)()],Wa.prototype,"type",void 0),(0,l._)([(0,p.Cb)()],Wa.prototype,"distance",void 0),(0,l._)([(0,p.Cb)()],Wa.prototype,"elevation",void 0),(0,l._)([(0,p.Cb)()],Wa.prototype,"area",void 0),(0,l._)([(0,p.Cb)()],Wa.prototype,"totalLength",void 0),Wa=(0,l._)([(0,v.j)("esri.views.interactive.tooltip.TranslateVertexTooltipInfo")],Wa);var Na=i(4914),Fa=(0,r.Z)((function e(t){(0,a.Z)(this,e),this.allGraphics=t,this.type="graphic-move-start"})),Ua=(0,r.Z)((function e(t,i,n){(0,a.Z)(this,e),this.dx=t,this.dy=i,this.allGraphics=n,this.type="graphic-move"})),Ha=(0,r.Z)((function e(t){(0,a.Z)(this,e),this.allGraphics=t,this.type="graphic-move-stop"})),ja=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).graphics=new Ki.Z,n.enableZ=!0,n.tooltipOptions=new Qi.Z,n.type="move-3d",n._snappingPipeline=new Da.n,n._tooltip=null,n}return(0,r.Z)(i,[{key:"initialize",value:function(){var e=this,t=this.graphics,i=this.view;this.own([t.on("change",(function(){return e._refreshManipulators()})),(0,h.YP)((function(){return e.tooltipOptions.enabled}),(function(t){e._tooltip=t?new La.u({view:i}):(0,u.SC)(e._tooltip)}),h.tX)]),this._refreshManipulators(),this.finishToolCreation()}},{key:"destroy",value:function(){this._tooltip=(0,u.SC)(this._tooltip),this.graphics.removeAll(),this._set("view",null)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"reset",value:function(){}},{key:"_refreshManipulators",value:function(){var e=this;this.handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();var t=this.graphics.toArray().filter((function(e){return(0,Pa.P)(e)===Vn.e.SUPPORTED})).map((function(e){return new Ba(e)}));t.length&&(this._createManipulators(t),this._createVisualElements(t),this.handles.add(t.map((function(t){return e.view.trackGraphicState(t.state)}))),this._updateMoveManipulation(t))}},{key:"_createManipulators",value:function(e){var t,i=this,a=(0,Z.Z)(e);try{var r=function(){var a=t.value,r=a.state;a.manipulationXY=new Aa({tool:i,view:i.view,graphicState:r}),a.manipulationXY.forEachManipulator((function(e){return i.handles.add([e.events.on("immediate-click",(function(e){i.emit("immediate-click",(0,n.Z)((0,n.Z)({},e),{},{graphic:r.graphic})),e.stopPropagation()})),e.events.on("grab-changed",(function(e){var t=e.action,n=i.tooltipOptions,a=i._tooltip;(0,u.Wi)(a)||("focus"===t?a.info=new Va({tooltipOptions:n}):a.clear())}))])})),i.handles.add(a.manipulationXY.createDragPipeline((function(t,n,a,r){return i._buildDragEventPipeline(e,ya.XY,t,n,a,r)})))};for(a.s();!(t=a.n()).done;)r()}catch(o){a.e(o)}finally{a.f()}this._createMoveManipulation(e)}},{key:"_createMoveManipulation",value:function(e){var t=this,i=new Ea({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===e.length?Ea.radiusForSymbol(e[0].graphic.symbol):Kn});this._moveManipulation=i,i.elevationInfo={mode:"absolute-height",offset:0},i.forEachManipulator((function(e,a){t.handles.add(e.events.on("immediate-click",(function(a){i.zManipulation.hasManipulator(e)||1!==t.graphics.length||t.emit("immediate-click",(0,n.Z)((0,n.Z)({},a),{},{graphic:t.graphics.getItemAt(0)})),a.stopPropagation()}))),a===Gn.TRANSLATE_XY&&t.handles.add(e.events.on("focus-changed",(function(e){var i=e.action,n=t.tooltipOptions,a=t._tooltip;(0,u.Wi)(a)||("focus"===i?a.info=new Va({tooltipOptions:n}):a.clear())}))),a===Gn.TRANSLATE_Z&&t.handles.add(e.events.on("focus-changed",(function(e){var i=e.action,n=t.tooltipOptions,a=t._tooltip;(0,u.Wi)(a)||("focus"===i?a.info=new za({tooltipOptions:n}):a.clear())})))}));var a,r=function(){return t._updateMoveManipulation(e)},o=(0,Z.Z)(e);try{var s=function(){var e=a.value;t.handles.add([e.state.on("changed",r),(0,h.YP)((function(){return e.state.displaying}),r)])};for(o.s();!(a=o.n()).done;)s()}catch(c){o.e(c)}finally{o.f()}var l=e[e.length-1];this.handles.add(l.state.on("changed",(function(){return t._updateMoveManipulationAngle(l)}))),this.handles.add(i.createDragPipeline((function(i,n,a,r,o){return t._buildDragEventPipeline(e,i,n,a,r,o)}),(0,g.RL)(l.graphic),(0,u.Wg)(l.graphic.geometry).spatialReference,l.graphic)),this._updateMoveManipulationAngle(l)}},{key:"_createVisualElements",value:function(e){var t,i=this,n=(0,Z.Z)(e);try{var a=function(){var n=t.value,a=n.graphic,r=Xn({view:i.view,graphic:a,forEachManipulator:function(e){n.manipulationXY.forEachManipulator(e),i._moveManipulation.forEachManipulator(e)},onManipulatorsChanged:function(){return(0,c.kB)()}});(0,u.Wi)(r)||(n.geometryRepresentation=r.visualElement,n.geometryRepresentation instanceof mi&&i.handles.add([n.geometryRepresentation.events.on("attachment-origin-changed",(function(){n.state.isDraped||i._updateMoveManipulation(e)})),(0,h.YP)((function(){return n.state.isDraped}),(function(){return i._updateMoveManipulation(e)}))]),i.handles.add(r))};for(n.s();!(t=n.n()).done;)a()}catch(r){n.e(r)}finally{n.f()}}},{key:"_updateMoveManipulationAngle",value:function(e){this._moveManipulation.angleDeferred=function(){return _a(e.graphic.geometry)}}},{key:"_updateMoveManipulation",value:function(e){var t,i=(0,ui.Tx)(0,0,0,this.view.spatialReference),n=0,a=!1,r=this._moveManipulation,o=(0,Z.Z)(e);try{for(o.s();!(t=o.n()).done;){var s=t.value;if(s.state.displaying){var l=s.state.graphic;this.enableZ&&zn(l)&&(a=!0);var c=s.geometryRepresentation instanceof mi&&!s.state.isDraped?s.geometryRepresentation.attachmentOrigin:Dn(this.view,l);(0,u.pC)(c)&&(i.x+=c.x,i.y+=c.y,i.z+=c.z,n++)}}}catch(h){o.e(h)}finally{o.f()}n>0?(i.x/=n,i.y/=n,i.z/=n,r.location=i,r.xyManipulation.available=!0,r.xyAxisManipulation.available=!0,r.zManipulation.available=a):r.available=!1}},{key:"_buildDragEventPipeline",value:function(e,t,i,n,a,r){var o=this,s=[],l=[],c=null,u=null,h=function(){var e,t=(0,Z.Z)(s);try{for(t.s();!(e=t.n()).done;){e.value.dragging=!1}}catch(i){t.e(i)}finally{t.f()}s.length=0,l.length=0,c=null,u=null,o._moveManipulation.interactive=!0};if(1===e.length&&t===ya.XY){var p=e[0].graphic;n=this._buildSnappingPipelineSteps(p,(0,g.RL)(p),n,a,r)}var d=n.next((function(t){if("start"===t.action){s.length=0,l.length=0;var n,a=(0,Z.Z)(e);try{for(a.s();!(n=a.n()).done;){var r=n.value;r.dragging||!r.manipulationXY.hasManipulator(i)&&r.manipulationXY.grabbing||(s.push(r),l.push(r.graphic),r.dragging=!0)}}catch(h){a.e(h)}finally{a.f()}if(0!==l.length&&(o._moveManipulation.interactive=!1,c=(0,ra.oq)(l,o.view.state.viewingMode),u=(0,ra.QY)(l),o.emit("graphic-move-start",new Fa(l)),o.destroyed))return null}return 0!==l.length?t:null})).next((function(e){return c(e)})).next((function(i){return o._updateMoveTooltip(i,t,e)})).next((function(e){switch(e.action){case"start":case"update":if(e.translationX||e.translationY||e.translationZ){var t=o.view.toScreen(e.mapStart),i=o.view.toScreen(e.mapEnd),n=i.x-t.x,a=i.y-t.y;if(o.emit("graphic-move",new Ua(n,a,l)),o.destroyed)return null}break;case"end":if(o.emit("graphic-move-stop",new Ha(l)),o.destroyed)return null;h()}}));return a.next((function(e){return u(e)})).next((function(){if(o.emit("graphic-move-stop",new Ha(l)),o.destroyed)return null;h()})),d}},{key:"_updateMoveTooltip",value:function(e,t,i){var n=this.tooltipOptions,a=this._tooltip;if((0,u.Wi)(a))return e;if(a.clear(),t===ya.XY||t===ya.XY_AXIS)if("end"===e.action)a.info=new Va({tooltipOptions:n});else{var r=0===i.length?"absolute-height":i[0].state.isDraped?"on-the-ground":"absolute-height",o=(0,H.GQ)(e.mapStart,e.mapEnd,r);(0,u.pC)(o)&&(a.info=new Va({tooltipOptions:n,distance:o}))}return t===ya.Z&&("end"===e.action?a.info=new za({tooltipOptions:n}):(0,u.yw)((0,Na._e)(e.mapStart,e.mapEnd),(function(e){a.info=new za({tooltipOptions:n,distance:e})}))),e}},{key:"_buildSnappingPipelineSteps",value:function(e,t,i,a,r){var o=this,s=e.geometry;if((0,u.Wi)(s)||"point"!==s.type&&"mesh"!==s.type)return i;var l=("point"===s.type?s:s.anchor).clone(),c=new Za.N({elevationInfo:t,pointer:r,editGeometryOperations:Ra.c.fromGeometry(l,this.view.state.viewingMode),visualizer:new Nt,excludeFeature:e}),h=this.snappingManager;return i.next((function(t){return l.z=(0,g.vQ)(o.view,l,(0,g.RL)(e),{mode:"absolute-height",offset:0}),(0,n.Z)((0,n.Z)({},t),{},{snapOrigin:c.coordinateHelper.pointToVector(l)})})).next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:c,snappingManager:h,cancel:a,updatingHandles:this.updatingHandles}),this._snappingPipeline.next)}},{key:"test",get:function(){return{tooltip:this._tooltip}}}]),i}((0,$i.p)(ci.Z.EventedMixin(Ta.m)));(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],ja.prototype,"view",void 0),(0,l._)([(0,p.Cb)()],ja.prototype,"graphics",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],ja.prototype,"enableZ",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,type:Qi.Z})],ja.prototype,"tooltipOptions",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],ja.prototype,"snappingManager",void 0),(0,l._)([(0,p.Cb)()],ja.prototype,"type",void 0),(0,l._)([(0,p.Cb)()],ja.prototype,"updating",null),ja=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],ja);var Ba=function(){function e(t){(0,a.Z)(this,e),this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new ji.F({graphic:t})}return(0,r.Z)(e,[{key:"graphic",get:function(){return this.state.graphic}}]),e}(),Ya=i(46684),qa=i(29909),Xa=i(74579),Qa=i(3711);function Ja(e,t,i){var n="on-the-ground"===i.mode?Qa.v.XY:Qa.v.XYZ;return new Qa.A(e,n,t,0)}function Ka(e,t,i){var n=(0,b.c)();if(!e.renderCoordsHelper.toRenderCoords(t,n))return null;var a=$a(e,t,(0,de.mJ)(i.plane)),r=$a(e,t,i.edgeDirection);if((0,u.Wi)(a)||(0,u.Wi)(r))return null;var o=(0,P.f)((0,b.c)(),a,r);return(0,de.Yq)(n,o,(0,de.Ue)())}function $a(e,t,i){var n=(0,ui.Tx)(t.x+i[0],t.y+i[1],t.z+i[2],t.spatialReference),a=(0,b.c)(),r=(0,b.c)();return e.renderCoordsHelper.toRenderCoords(t,a)&&e.renderCoordsHelper.toRenderCoords(n,r)?(0,P.r)(r,a,r):null}var er=i(63920),tr=i(153),ir=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).type="reshape-edge-offset",n.distance=Ga.yP,n}return(0,r.Z)(i)}(Ia.h);(0,l._)([(0,p.Cb)()],ir.prototype,"type",void 0),(0,l._)([(0,p.Cb)()],ir.prototype,"distance",void 0),ir=(0,l._)([(0,v.j)("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],ir);var nr=i(21971),ar=i(13615),rr=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e))._vertexManipulatorMaterial=Pn(li.colorToVec4(li.reshapeManipulators.vertex.color),li.reshapeManipulators.vertex.renderOccluded),n._vertexManipulatorOutlineMaterial=Tn(li.colorToVec4(li.reshapeManipulators.vertex.outlineColor),li.reshapeManipulators.vertex.renderOccluded),n._vertexManipulatorHoverOutlineMaterial=Tn(li.colorToVec4(li.reshapeManipulators.vertex.hoverOutlineColor),li.reshapeManipulators.vertex.renderOccluded),n._edgeManipulatorMaterial=Pn(li.colorToVec4(li.reshapeManipulators.edge.color),li.reshapeManipulators.edge.renderOccluded),n._edgeManipulatorOutlineMaterial=Tn(li.colorToVec4(li.reshapeManipulators.edge.outlineColor),li.reshapeManipulators.edge.renderOccluded),n._edgeOffsetManipulatorMaterial=Pn(li.colorToVec4(li.reshapeManipulators.edgeOffset.color),li.reshapeManipulators.edgeOffset.renderOccluded,!1),n._edgeOffsetManipulatorHoverMaterial=Pn(li.colorToVec4(li.reshapeManipulators.edgeOffset.hoverColor),li.reshapeManipulators.edgeOffset.renderOccluded,!1),n._selectedManipulatorMaterial=Pn(li.colorToVec4(li.reshapeManipulators.selected.color),li.reshapeManipulators.selected.renderOccluded),n._selectedManipulatorOutlineMaterial=Tn(li.colorToVec4(li.reshapeManipulators.selected.outlineColor),li.reshapeManipulators.selected.renderOccluded),n._selectedManipulatorHoverOutlineMaterial=Tn(li.colorToVec4(li.reshapeManipulators.selected.hoverOutlineColor),li.reshapeManipulators.selected.renderOccluded),n._selectedIndex=0,n._vertexManipulatorGeometry=null,n._vertexManipulatorOutlineGeometry=null,n._edgeManipulatorGeometry=null,n._edgeManipulatorOutlineGeometry=null,n._edgeOffsetManipulatorGeometryInside=null,n._edgeOffsetManipulatorGeometryOutside=null,n._manipulatorHandles=new ne.Z,n._manipulatorInfos=[],n._editGeometryOperations=null,n._graphicMoveManipulation=null,n._moveManipulation=null,n._numGrabbing=0,n._numDragging=0,n._reshapeEventState=lr.NONE,n._outlineVisualElement=null,n._segmentLabels=null,n.outputGeometry=null,n._snappingPipeline=new Da.n,n._snappingPipelineHandle=new Da.n,n._vertexLaserLineVisualElement=null,n}return(0,r.Z)(i,[{key:"initialize",value:function(){var e=this,t=this.graphic,i=this.view,n=this._graphicState=new ji.F({graphic:t});this._tooltip=new La.u({view:i}),this.own([(0,h.YP)((function(){return n.displaying}),(function(t){var i,n=(0,Z.Z)(e._manipulatorInfos);try{for(n.s();!(i=n.n()).done;){i.value.manipulator.available=t}}catch(a){n.e(a)}finally{n.f()}})),(0,h.YP)((function(){return{labels:e._segmentLabels,enabled:e._labelOptions.enabled,edgeOffsetEnabled:e.enableEdgeOffset}}),(function(e){var t=e.labels,i=e.enabled,n=e.edgeOffsetEnabled;(0,u.pC)(t)&&(t.visible=i,t.edgeDistance=n?"far":"default")}),h.nn),(0,h.gx)((function(){return!e._tooltipOptions.enabled}),(function(){return e._tooltip.clear()}),h.nn),this.view.trackGraphicState(n)])}},{key:"destroy",value:function(){this._segmentLabels=(0,u.SC)(this._segmentLabels),this._tooltip=(0,u.SC)(this._tooltip),this._editGeometryOperations=(0,u.SC)(this._editGeometryOperations),this._moveManipulation=(0,u.SC)(this._moveManipulation),this._graphicMoveManipulation=(0,u.SC)(this._graphicMoveManipulation),this._manipulatorHandles=(0,u.SC)(this._manipulatorHandles),this.manipulators.removeAll(),this._manipulatorInfos=[],this._resetGrabbingDragging()}},{key:"inputGeometry",get:function(){return(0,u.pC)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null},set:function(e){this._recreateEditGeometryAndManipulators(e)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"manipulators",get:function(){return this.tool.manipulators}},{key:"view",get:function(){return this.tool.view}},{key:"graphic",get:function(){return this.tool.graphic}},{key:"enableZShape",get:function(){return this.tool.enableZShape}},{key:"enableZVertex",get:function(){return this.tool.enableZVertex}},{key:"enableMoveGraphic",get:function(){return this.tool.enableMoveGraphic}},{key:"enableMidpoints",get:function(){return this.tool.enableMidpoints}},{key:"enableEdgeOffset",get:function(){return this.tool.enableEdgeOffset}},{key:"_labelOptions",get:function(){return this.tool.labelOptions}},{key:"_tooltipOptions",get:function(){return this.tool.tooltipOptions}},{key:"removeSelectedVertices",value:function(){var e=this._manipulatorInfos.filter((function(e){return e.manipulator.selected&&"vertex"===e.type}));this._removeVertices(e)}},{key:"manipulatorSelectionChanged",value:function(){this.emit("manipulators-changed")}},{key:"_removeManipulators",value:function(){this._moveManipulation=(0,u.SC)(this._moveManipulation),this._graphicMoveManipulation=(0,u.SC)(this._graphicMoveManipulation),this._manipulatorHandles.removeAll(),this.manipulators.removeAll(),this._manipulatorInfos=[]}},{key:"_resetGrabbingDragging",value:function(){this._numGrabbing=0,this._numDragging=0}},{key:"_createManipulators",value:function(){if(!(0,u.Wi)(this._editGeometryOperations)){var e,t=(0,g.RL)(this.graphic),i=(0,Z.Z)(this._editGeometryOperations.data.components);try{for(i.s();!(e=i.n()).done;){var n,a=e.value,r=(0,Z.Z)(a.vertices);try{for(r.s();!(n=r.n()).done;){var o=n.value;this._createVertexOrEdgeManipulator(o,t)}}catch(h){r.e(h)}finally{r.f()}var s,l=(0,Z.Z)(a.edges);try{for(l.s();!(s=l.n()).done;){var c=s.value;this._createVertexOrEdgeManipulator(c,t)}}catch(h){l.e(h)}finally{l.f()}}}catch(h){i.e(h)}finally{i.f()}this._createGraphicMoveManipulators(t)}}},{key:"canRedo",get:function(){return(0,u.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}},{key:"canUndo",get:function(){return(0,u.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}},{key:"redo",value:function(){if((0,u.Wi)(this._editGeometryOperations))return null;var e=this._editGeometryOperations.redo();return(0,u.pC)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}},{key:"undo",value:function(){if((0,u.Wi)(this._editGeometryOperations))return null;this.emit("undo");var e=this._editGeometryOperations.undo();return(0,u.pC)(e)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),e}},{key:"_recreateManipulators",value:function(){this._removeManipulators(),this._resetGrabbingDragging(),this._tooltip.clear(),this._createManipulators()}},{key:"_recreateEditGeometryAndManipulators",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.inputGeometry;this._removeManipulators(),this._resetGrabbingDragging(),this._tooltip.clear(),(0,u.Wi)(e)||((0,u.SC)(this._editGeometryOperations),this._editGeometryOperations=Ra.c.fromGeometry(e,this.view.state.viewingMode),this._createManipulators(),(0,u.SC)(this._segmentLabels),this._segmentLabels=new K({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:(0,g.RL)(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled}))}},{key:"_perGraphicManipulatorDragAction",value:function(e,t){if("end"===t.action)return t;var i,n=0,a=[],r=this._manipulatorInfos.some((function(e){return"vertex"===e.type&&e.manipulator.selected})),o=e===cr.SELECTED_OR_ALL&&r,s=(0,Z.Z)(this._manipulatorInfos);try{for(s.s();!(i=s.n()).done;){var l=i.value;"vertex"===l.type&&(l.manipulator.grabbing||o&&!l.manipulator.selected||a.push(l),n++)}}catch(c){s.e(c)}finally{s.f()}if(0===a.length)return t;if(this._moveVertices(a,t),a.length===n){if(this._updateEventState(lr.MOVING),this.destroyed)return t;this.emit("move",{type:"move",dx:t.screenDeltaX,dy:t.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(lr.RESHAPING),this.destroyed)return t;this.emit("reshape",{type:"reshape",mover:this.graphic})}return t}},{key:"_isMultiVertexSelection",value:function(){var e,t=0,i=(0,Z.Z)(this._manipulatorInfos);try{for(i.s();!(e=i.n()).done;){var n=e.value;"vertex"===n.type&&n.manipulator.selected&&t++}}catch(a){i.e(a)}finally{i.f()}return t>1}},{key:"_perVertexManipulatorDragAction",value:function(e){if(this._updateEventState(lr.RESHAPING),!this.destroyed){var t=e.mapDeltaX,i=e.mapDeltaY,n=e.mapDeltaZ;if(t||i||n){var a,r=[],o=(0,Z.Z)(this._manipulatorInfos);try{for(o.s();!(a=o.n()).done;){var s=a.value;"vertex"===s.type&&(s.manipulator.selected&&!s.manipulator.grabbing||s===e.info)&&r.push(s)}}catch(l){o.e(l)}finally{o.f()}this._moveVertices(r,e,tr.O.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}}}},{key:"_updateEventState",value:function(e){if(e===this._reshapeEventState)return!1;switch(e){case lr.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case lr.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case lr.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case lr.MOVING:switch(this._reshapeEventState){case lr.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case lr.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case lr.RESHAPING:switch(this._reshapeEventState){case lr.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case lr.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;var t=this._reshapeEventState!==e;return this._reshapeEventState=e,t}},{key:"_createGraphicMoveManipulators",value:function(e){var t=this,i=this.graphic,a=this.handles,r=this.tool,o=this.view,s=this._graphicState;if(this._graphicMoveManipulation=new Aa({tool:r,view:o,graphicState:s}),this.enableMoveGraphic){var l=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((function(e,i,n){i.next((function(e){return t._trackNumDragging(e)})).next((function(e){return"start"===e.action&&(l=(0,u.Wg)(t._editGeometryOperations).createUndoGroup()),e})).next((function(e){return t._perGraphicManipulatorDragAction(cr.ALL,e)})).next((function(e){return t._updateTranslateGraphicTooltip(ya.XY,e),e})).next((function(e){"end"===e.action&&(t._tooltip.clear(),l=(0,u.hw)(l))})),n.next(t._cancelDragOperation((function(){return l=(0,u.hw)(l)})))})))}else this._graphicMoveManipulation.forEachManipulator((function(e){e.grabbable=!1,e.cursor=null}));this._graphicMoveManipulation.forEachManipulator((function(e){return t._manipulatorHandles.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(e){t._manipulatorInfos.some((function(e){return e.manipulator.selected}))?t._clearSelection():t.emit("immediate-click",(0,n.Z)((0,n.Z)({},e),{},{graphic:t.graphic})),e.stopPropagation()}))])})),this._moveManipulation=new Ea({tool:r,view:o,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&zn(i),snapToScene:!1,radius:Ea.radiusForSymbol(i.symbol)}),this._moveManipulation.forEachManipulator((function(e,r){a.add([t._watchAndUpdateGrabState(e,!1),e.events.on("immediate-click",(function(a){t._moveManipulation.zManipulation.hasManipulator(e)||t._manipulatorInfos.some((function(e){return e.manipulator.selected}))||t.emit("immediate-click",(0,n.Z)((0,n.Z)({},a),{},{graphic:i})),a.stopPropagation()}))]),a.add(e.events.on("focus-changed",(function(e){"focus"===e.action&&t._tooltipOptions.enabled?t._updateTranslateTooltip(r===Gn.TRANSLATE_Z?ya.Z:ya.XY):t._tooltip.clear()})))})),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};var c=(0,u.Wg)(i.geometry).spatialReference;a.add([this._moveManipulation.createDragPipeline((function(a,o,s,l,c){var h=s.next((function(e){return t._trackNumDragging(e)})).next((function(e){var i=t._manipulatorInfos.filter((function(e){return"vertex"===e.type&&e.manipulator.selected}));return e.manipulatorType===Gn.TRANSLATE_XY&&1===i.length?(0,n.Z)((0,n.Z)({},e),{},{info:i[0],snapOrigin:i[0].handle.pos}):(0,n.Z)((0,n.Z)({},e),{},{info:null})})).next(t._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:function(e){return!!e.info},cancel:l,snappingManager:r.snappingManager,snappingContext:new Za.N({editGeometryOperations:(0,u.Wg)(t._editGeometryOperations),elevationInfo:e,pointer:c,excludeFeature:i,visualizer:new Nt}),updatingHandles:t.updatingHandles}),t._snappingPipelineHandle.next).next((0,ra.AN)()).next((function(e){return t._perGraphicManipulatorDragAction(cr.SELECTED_OR_ALL,e)})).next((function(e){return t._updateTranslateTooltip(a,e),e}));return l.next(t._cancelDragOperation()),h}),e,c,i),(0,h.YP)((function(){return null===s||void 0===s?void 0:s.displaying}),(function(){t._updateMoveManipulationPosition()}),h.nn),s.on("changed",(function(){return t._updateMoveManipulationPosition()})),(0,h.YP)((function(){return null===s||void 0===s?void 0:s.isDraped}),(function(e){var i="align-move-manipulation";e?a.add(t.view.elevationProvider.on("elevation-change",(function(){return t._updateMoveManipulationPosition()})),i):a.remove(i)}),h.nn)]),this._updateMoveManipulationPosition();var p=Xn({view:o,graphic:i,forEachManipulator:function(e){if(!t.destroyed){(0,u.pC)(t._graphicMoveManipulation)&&t._graphicMoveManipulation.forEachManipulator(e);var i,n=(0,Z.Z)(t._manipulatorInfos);try{for(n.s();!(i=n.n()).done;){e(i.value.manipulator,Gn.TRANSLATE_XY)}}catch(a){n.e(a)}finally{n.f()}t._moveManipulation.forEachManipulator(e)}},onManipulatorsChanged:function(e){return t.on("manipulators-changed",e)}});(0,u.pC)(p)&&(this._outlineVisualElement=p.visualElement instanceof mi?p.visualElement:null),(0,u.pC)(this._outlineVisualElement)&&this._manipulatorHandles.add([this._outlineVisualElement.events.on("attachment-origin-changed",(function(){s.isDraped||t._updateMoveManipulationPosition()})),(0,h.YP)((function(){return s.isDraped}),(function(){return t._updateMoveManipulationPosition()}))]),this._manipulatorHandles.add(p)}},{key:"_createEdgeOffsetManipulator",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,g.RL)(this.graphic),a=li.reshapeManipulators.edgeOffset,r=a.size/2,o=r+a.collisionPadding;if((0,u.Wi)(this._edgeOffsetManipulatorGeometryInside)||(0,u.Wi)(this._edgeOffsetManipulatorGeometryOutside)){var s=r/o,l=s*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside=at.Z.createExtrudedTriangle(l,s/2,s/2,a.height,a.offset),this._edgeOffsetManipulatorGeometryOutside=at.Z.createExtrudedTriangle(-l,s/2,s/2,a.height,-a.offset)}var h=[{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorMaterial,stateMask:hn.Q9.Unfocused},{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:hn.Q9.Focused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorMaterial,stateMask:hn.Q9.Unfocused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:hn.Q9.Focused}],p=new dn({view:this.view,renderObjects:h,elevationInfo:"on-the-ground"!==i.mode||(0,Xa.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i,worldOriented:!1,focusMultiplier:1,radius:o,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionType:{type:"disc",direction:(0,b.f)(0,0,1)},collisionPriority:1}),d=new dn({view:this.view,renderObjects:[],worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default"}),f={manipulator:p,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:d,elevationInfo:i,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(f,a.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(f);var v=this._getManipulatorInfoFromHandle(f.handle.leftVertex).manipulator.events.on("location-update",(function(){return t._updateEdgeOffsetManipulator(f)})),_=this._getManipulatorInfoFromHandle(f.handle.rightVertex).manipulator.events.on("location-update",(function(){return t._updateEdgeOffsetManipulator(f)}));f.locationUpdateHandle=(0,c.AL)([v,_]),this._manipulatorHandles.add(f.locationUpdateHandle,p),this._manipulatorHandles.add([this._watchAndUpdateGrabState(p,!0),this._watchAndUpdateGrabState(d,!0)],p),this._manipulatorHandles.add((0,ra.Xd)(p,this._createEdgeOffsetPipeline(f,i)),p),this._manipulatorHandles.add((0,ra.Xd)(d,(function(e,n,a,r){if("touch"===r)t._createEdgeOffsetPipeline(f,i)(e,n,a);else if(t.enableMoveGraphic){var o=t.graphic,s=(0,u.pC)(o.geometry)?o.geometry.spatialReference:null;n.next((function(e){return t._trackNumDragging(e)})).next((0,ra.kY)(t.view,e.elevationAlignedLocation)).next(ca(t.view,e.elevationAlignedLocation,i,s,o)).next((0,ra.zh)()).next((0,ra.AN)()).next((function(e){return t._perGraphicManipulatorDragAction(cr.ALL,e)})).next((function(e){return t._updateTranslateGraphicTooltip(ya.XY,e),e})).next((function(e){"end"===e.action&&t._tooltip.clear()})),a.next(t._cancelDragOperation())}})),p);var y=function(e){t._manipulatorInfos.some((function(e){return e.manipulator.selected}))?t._clearSelection():t.emit("immediate-click",(0,n.Z)((0,n.Z)({},e),{},{graphic:t.graphic})),e.stopPropagation()};return this._manipulatorHandles.add([p.events.on("immediate-click",y),d.events.on("immediate-click",y),p.events.on("focus-changed",(function(e){var i=e.action,n=t._tooltipOptions;"focus"===i&&n.enabled?t._tooltip.info=new ir({tooltipOptions:n}):t._tooltip.clear()}))],p),this._manipulatorInfos.push(f),this.manipulators.add(p),this.manipulators.add(d),this.emit("manipulators-changed"),f}},{key:"_autoHideEdgeOffsetManipulator",value:function(e,t){var i=this,n=e.manipulator,a=e.edgeManipulator,r=function(){(0,u.hw)(e.visibilityHandle);var r=function(e,t,i){var n=i.projectToRenderScreen(e,(0,y.J$)()),a=i.projectToRenderScreen(t,(0,y.J$)());return(0,u.pC)(n)&&(0,u.pC)(a)?(0,P.p)((0,P.b)(n,n,a)):0}(i._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,i._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,i.view.state.camera)<t;(!n.focused&&!a.focused||r)&&(n.grabbable=!r,a.grabbable=!r,e.visibilityHandle=(0,c.AL)([n.disableDisplay(),{remove:function(){n.grabbable=!0,a.grabbable=i.enableMoveGraphic}}]))};this._manipulatorHandles.add([n.events.on("focus-changed",r),a.events.on("focus-changed",r),{remove:function(){(0,u.hw)(e.visibilityHandle),i.manipulators.remove(a)}}],n),r()}},{key:"_updateEdgeOffsetManipulator",value:function(e){this._updateManipulatorPosition(e);var t=(0,u.Wg)(this._editGeometryOperations).data.coordinateHelper,i=Ka(this.view,e.manipulator.elevationAlignedLocation,Ja(t,e.handle,(0,u.Wg)(e.manipulator.elevationInfo))),n=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator.renderLocation,a=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator.renderLocation,r=(0,u.pC)(i)?function(e,t,i){var n=(0,de.mJ)(e),a=(0,P.r)((0,b.c)(),t,i),r=(0,P.f)((0,b.c)(),a,n),o=(0,P.f)((0,b.c)(),a,r);return(0,$e.f)(a[0],a[1],a[2],0,r[0],r[1],r[2],0,o[0],o[1],o[2],0,0,0,0,1)}(i,n,a):$e.I;e.manipulator.modelTransform=r,e.edgeManipulator.elevationAlignedLocation=e.manipulator.elevationAlignedLocation,e.edgeManipulator.modelTransform=r;var o=(0,P.l)((0,P.b)(hr,n,a))/2;e.edgeManipulator.collisionType={type:"line",paths:[[[-o,0,0],[o,0,0]]]}}},{key:"_createEdgeOffsetPipeline",value:function(e,t){var i=this;return function(n,a,r){i._clearSelection();var o=i._initializeEdgeOffset(e,t),s=o.step,l=o.cleanup;a.next((function(e){return i._trackNumDragging(e)})).next((0,ra.kY)(i.view,n.elevationAlignedLocation)).next(s).next(function(e){return sa(e,(function(e){return e.plane}))}(i.view)).next(pa(i.view,(0,u.Wg)(i._editGeometryOperations).data.spatialReference)).next((0,ra.AN)()).next(i._applyComputeEdgeOffsetDistanceStep()).next(i._applyEdgeOffsetStep(e)).next(i._showEdgeOffsetTooltip()).next((function(e){"end"===e.action&&l()})),r.next((function(e){return l(),e})).next((function(e){return i._tooltip.clear(),e})).next(i._cancelDragOperation())}}},{key:"_initializeEdgeOffset",value:function(e,t){var i=this,a=(0,u.Wg)(this._editGeometryOperations),r=Ja(a.data.coordinateHelper,e.handle,t),o=a.createUndoGroup(),s=Ka(this.view,e.manipulator.elevationAlignedLocation,r);r.requiresSplitEdgeLeft&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.leftVertex.leftEdge),1),r.requiresSplitEdgeRight&&this._splitEdgeManipulator(this._getManipulatorInfoFromHandle(e.handle.rightVertex.rightEdge),0);var l,p=function(){return new qa.Z({paths:[[e.handle.leftVertex.pos,e.handle.rightVertex.pos]],spatialReference:(0,u.Wg)(i._editGeometryOperations).data.spatialReference})},d=new mi({view:this.view,isDraped:this._graphicState.isDraped,geometry:p(),elevationInfo:e.elevationInfo,width:li.visualElements.lineGraphics.outline.width,color:li.colorToVec4(jt.main),attached:!0}),f=function(){i._cleanEdgeOffsetCollapsedEdges(e),l=(0,u.hw)(l)},v=this.on("undo",f);return l=(0,c.AL)([(0,c.ed)(d),(0,h.YP)((function(){return i._graphicState.isDraped}),(function(e){return d.isDraped=e})),this._graphicState.on("changed",(function(){return d.geometry=p()})),o,v]),{step:function(e){return(0,u.Wi)(r)||(0,u.Wi)(s)?(f(),null):(0,n.Z)((0,n.Z)({},e),{},{operation:r,plane:s})},cleanup:f}}},{key:"_applyEdgeOffsetStep",value:function(e){var t=this;return function(i){if(t.destroyed||(0,u.Wi)(i.operation))return i;t._updateEventState(lr.RESHAPING);var n=i.mapDeltaX,a=i.mapDeltaY,r=i.mapDeltaZ;return(n||a||r)&&(t._offsetEdge(e,i),t.emit("reshape",{type:"reshape",mover:t.graphic})),i}}},{key:"_applyComputeEdgeOffsetDistanceStep",value:function(){return function(e){var t=e.operation,i=e.mapEnd;if((0,u.Wi)(t)||(0,u.Wi)(i))return e;var a=t.signedDistanceToPoint(i);return(0,n.Z)((0,n.Z)({},e),{},{signedDistance:a})}}},{key:"_showEdgeOffsetTooltip",value:function(){var e=this;return function(t){var i=t.mapEnd,n=t.signedDistance,a=t.operation,r=e._tooltip,o=e._tooltipOptions;if(!o.enabled||(0,u.Wi)(n))return r.clear(),t;var s=function(e,t,i,n,a){if(e){var r=a.toXYZ(a.pointToVector(i)),o=(0,de.nF)(n,r,wt.WM.get()),s=(0,ar.FB)(o,r,a.spatialReference);if((0,u.pC)(s))return(0,Ga.yG)(s.value*Math.sign(t),s.unit)}return(0,Ga.yG)(t*(0,O.c9)(i.spatialReference),"meters")}(e._graphicState.isDraped,-n,i,a.plane,(0,u.Wg)(e._editGeometryOperations).data.coordinateHelper);return(0,u.Wi)(r.info)||"reshape-edge-offset"!==r.info.type?r.info=new ir({tooltipOptions:o,distance:s}):r.info.distance=s,t}}},{key:"_cleanEdgeOffsetCollapsedEdges",value:function(e){var t,i,n=null===(t=e.handle.leftVertex.leftEdge)||void 0===t?void 0:t.leftVertex,a=e.handle.leftVertex,r=null===(i=e.handle.rightVertex.rightEdge)||void 0===i?void 0:i.rightVertex,o=e.handle.rightVertex,s=(0,u.Wg)(this._editGeometryOperations).data.coordinateHelper,l=1e-6,c=[];n&&s.distance(n.pos,a.pos)<l&&c.push(this._getManipulatorInfoFromHandle(a)),(s.distance(a.pos,o.pos)<l||r&&s.distance(r.pos,o.pos)<l)&&c.push(this._getManipulatorInfoFromHandle(o)),c.length&&this._removeVertices(c)}},{key:"_computeVertexManipulatorSizeAndOutline",value:function(e){var t=e.size/2,i=t+e.collisionPadding;return{size:t/i,outlineSize:(t+e.outlineSize)/i}}},{key:"_createVertexOrEdgeManipulator",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,g.RL)(this.graphic);if("edge"===e.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(e,i);if(!this.enableMidpoints)return null}if((0,u.Wi)(this._vertexManipulatorGeometry)||(0,u.Wi)(this._vertexManipulatorOutlineGeometry)){var a=this._computeVertexManipulatorSizeAndOutline(li.reshapeManipulators.vertex),r=a.size,o=a.outlineSize;this._vertexManipulatorGeometry=at.Z.createSphereGeometry(r,16,16),this._vertexManipulatorOutlineGeometry=at.Z.createSphereGeometry(o,16,16)}if((0,u.Wi)(this._edgeManipulatorGeometry)||(0,u.Wi)(this._edgeManipulatorOutlineGeometry)){var s=this._computeVertexManipulatorSizeAndOutline(li.reshapeManipulators.edge),l=s.size,h=s.outlineSize;this._edgeManipulatorGeometry=at.Z.createSphereGeometry(l,16,16),this._edgeManipulatorOutlineGeometry=at.Z.createSphereGeometry(h,16,16)}var p=(0,u.pC)(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:sr.Vertex|hn.Q9.Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:sr.Vertex|hn.Q9.Unfocused|hn.Q9.Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:sr.Vertex|hn.Q9.Focused|hn.Q9.Unselected},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:hn.Q9.Selected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:hn.Q9.Selected|hn.Q9.Unfocused},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:hn.Q9.Selected|hn.Q9.Focused}];this.enableMidpoints&&p.push({geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:sr.Edge|hn.Q9.Focused|hn.Q9.Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:sr.Edge|hn.Q9.Focused|hn.Q9.Unselected},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:sr.Edge|hn.Q9.Unfocused|hn.Q9.Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:sr.Edge|hn.Q9.Unfocused|hn.Q9.Unselected});var d=new dn({view:this.view,renderObjects:p,elevationInfo:i,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible)});this._setTypeSpecificManipulatorSettings(d,e,i);var f="edge"===e.type?{manipulator:d,handle:e,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:d,handle:e,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(f),this.manipulators.add(d),this._updateManipulatorPosition(f),"edge"===f.type){var v=this._getManipulatorInfoFromHandle(f.handle.leftVertex).manipulator.events.on("location-update",(function(){return t._updateManipulatorPosition(f)})),_=this._getManipulatorInfoFromHandle(f.handle.rightVertex).manipulator.events.on("location-update",(function(){return t._updateManipulatorPosition(f)}));f.locationUpdateHandle=(0,c.AL)([v,_]),this._manipulatorHandles.add(f.locationUpdateHandle,d)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(d,!0),d);var y=(0,ra.Xd)(d,(function(e,a,r,o){var s=null;a.next((function(e){return t._trackNumDragging(e)})).next((function(e){if("start"===e.action&&(s=(0,u.Wg)(t._editGeometryOperations).createUndoGroup()),"edge"===f.type){var i=t._splitEdgeManipulator(f);return(0,n.Z)((0,n.Z)({},e),{},{info:i,snapOrigin:i.handle.pos})}return(0,n.Z)((0,n.Z)({},e),{},{info:f,snapOrigin:f.handle.pos})})).next((0,ra.kY)(t.view,e.elevationAlignedLocation)).next(ua(t.view,t.graphic,e.elevationAlignedLocation,e.location.spatialReference,t.graphic)).next(t._snappingPipeline.createSnapDragEventPipelineStep({predicate:function(){return!t._isMultiVertexSelection()},cancel:r,snappingManager:t.tool.snappingManager,snappingContext:new Za.N({editGeometryOperations:(0,u.Wg)(t._editGeometryOperations),elevationInfo:i,pointer:o,excludeFeature:t.graphic,visualizer:new Nt}),updatingHandles:t.updatingHandles}),t._snappingPipeline.next).next((0,ra.AN)()).next((function(i){t._perVertexManipulatorDragAction(i),"end"===i.action&&(s=(0,u.hw)(s)),t._updateTranslateVertexTooltip(e,ya.XY,i)})),r.next(t._cancelDragOperation((function(){return s=(0,u.hw)(s)})))}));return this._manipulatorHandles.add([y,d.events.on("immediate-click",(function(e){return t._manipulatorClickCallback(e,f)})),d.events.on("select-changed",(function(){f.selectedIndex=++t._selectedIndex,t._updateMoveManipulationPosition()})),d.events.on("focus-changed",(function(e){"focus"===e.action&&"edge"!==f.type?t._updateTranslateVertexTooltip(d,ya.XY):t._tooltip.clear()}))],d),this.emit("manipulators-changed"),f}},{key:"_trackNumDragging",value:function(e){switch(e.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return e}},{key:"_cancelDragOperation",value:function(e){var t=this;return function(){switch(t._numDragging--,t.undo(),t.outputGeometry=(0,u.pC)(t._editGeometryOperations)?t._editGeometryOperations.data.geometry:null,(0,u.pC)(t.tool.snappingManager)&&t.tool.snappingManager.doneSnapping(),t._tooltip.clear(),t._reshapeEventState){case lr.NONE:break;case lr.MOVING:t.emit("move",{type:"move",dx:0,dy:0,mover:t.graphic});break;case lr.RESHAPING:t.emit("reshape",{type:"reshape",mover:t.graphic})}e&&e(),t.destroyed||t._updateEventState(lr.NONE)}}},{key:"_setTypeSpecificManipulatorSettings",value:function(e,t,i){switch(t.type){case"vertex":e.state=sr.Vertex,e.selectable=!0,e.cursor="move",e.collisionPriority=2,e.radius=li.reshapeManipulators.vertex.size/2+li.reshapeManipulators.vertex.collisionPadding,e.elevationInfo=i,e.interactive=(0,u.pC)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":e.state=sr.Edge,e.selectable=!1,e.cursor="copy",e.collisionPriority=-1,e.radius=li.reshapeManipulators.edge.size/2+li.reshapeManipulators.edge.collisionPadding,e.elevationInfo="on-the-ground"!==i.mode||(0,Xa.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:i}}},{key:"_watchAndUpdateGrabState",value:function(e,t){var i=this;return e.events.on("grab-changed",(function(n){return i._onGrabStateChanged(e,t,n.action,n.pointerType)}))}},{key:"_onGrabStateChanged",value:function(e,t,i){var n=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";if("start"===i)t&&this._updateSelection(e),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(lr.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==a||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach((function(e){e.manipulator.interactive=!n._numGrabbing&&(0,u.pC)(n.graphic.geometry)&&"point"!==n.graphic.geometry.type,"edgeManipulator"in e&&(e.edgeManipulator.interactive=!n._numGrabbing)})),(0,u.Wg)(this._graphicMoveManipulation).forEachManipulator((function(e){return e.interactive=!n._numGrabbing})))}},{key:"_clearSelection",value:function(){var e,t=(0,Z.Z)(this._manipulatorInfos);try{for(t.s();!(e=t.n()).done;){var i=e.value;i.manipulator.grabbing||(i.manipulator.selected=!1)}}catch(n){t.e(n)}finally{t.f()}}},{key:"_updateSelection",value:function(e){e.grabbing&&!e.selected&&e.selectable&&(this._clearSelection(),e.selected=!0,this.emit("manipulators-changed"))}},{key:"_removeManipulator",value:function(e){e&&(e.manipulator.grabbing&&this._onGrabStateChanged(e.manipulator,!1,"end"),this._manipulatorHandles.remove(e.manipulator),this._manipulatorInfos.splice(this._manipulatorInfos.indexOf(e),1),this.manipulators.remove(e.manipulator),this.emit("manipulators-changed"))}},{key:"_getManipulatorInfoFromHandle",value:function(e){if(e){var t,i=(0,Z.Z)(this._manipulatorInfos);try{for(i.s();!(t=i.n()).done;){var n=t.value;if(e===n.handle)return n}}catch(a){i.e(a)}finally{i.f()}}return null}},{key:"_updateManipulatorPosition",value:function(e){if(e){var t=(0,u.Wg)(this._editGeometryOperations);if("vertex"===e.type)e.manipulator.location=t.data.coordinateHelper.vectorToDehydratedPoint(e.handle.pos,ur),e.manipulator.grabbing&&(0,u.pC)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=e.manipulator.renderLocation);else if("edge"===e.type){var i=this._getManipulatorInfoFromHandle(e.handle.leftVertex).manipulator,n=this._getManipulatorInfoFromHandle(e.handle.rightVertex).manipulator;if((0,u.pC)(e.manipulator.elevationInfo)&&"on-the-ground"===e.manipulator.elevationInfo.mode){var a=i.location,r=n.location,o=a.x+.5*(r.x-a.x),s=a.y+.5*(r.y-a.y),l=a.hasZ&&r.hasZ?0:void 0;e.manipulator.location=(0,ui.Tx)(o,s,l,t.data.spatialReference)}else(0,P.h)(hr,i.renderLocation,n.renderLocation,.5),e.manipulator.renderLocation=hr}}}},{key:"_splitEdgeManipulator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=(0,u.Wg)(this._editGeometryOperations),n=(0,u.Wg)(i.splitEdge(e.handle,t).createdVertex);e.locationUpdateHandle.remove(),e.locationUpdateHandle=void 0;var a,r=(0,g.RL)(this.graphic);this.enableEdgeOffset?(this._removeManipulator(e),a=this._createVertexOrEdgeManipulator(n)):((a=e).handle=n,a.type="vertex",this._setTypeSpecificManipulatorSettings(e.manipulator,e.handle,r)),n.leftEdge&&this._createVertexOrEdgeManipulator(n.leftEdge),n.rightEdge&&this._createVertexOrEdgeManipulator(n.rightEdge),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(a),this.enableEdgeOffset||this._updateTranslateVertexTooltip(a.manipulator,ya.XY),this._updateSelection(e.manipulator);var o=this._updateEventState(lr.RESHAPING),s=i.data.coordinateHelper.vectorToArray(a.handle.pos),l=i.data.components.indexOf(n.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:s,componentIndex:l,vertexIndex:(0,u.Wg)(n.index)}],added:s}),o&&this._updateEventState(lr.NONE),a}},{key:"_updateMoveManipulationPosition",value:function(){var e,t=this,i=(0,P.s)(hr,0,0,0),n=0,a=!1,r=null,o=null,s=(0,Z.Z)(this._manipulatorInfos);try{for(s.s();!(e=s.n()).done;){var l=e.value;"vertex"===l.type&&(l.manipulator.selected?(n++,(0,P.a)(i,i,l.manipulator.renderLocation),(0,u.Wi)(r)||l.selectedIndex>r.selectedIndex?(o=r,r=l):((0,u.Wi)(o)||l.selectedIndex>o.selectedIndex)&&(o=l)):a=!0)}}catch(g){s.e(g)}finally{s.f()}if(0!==n){var c=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=c,this._moveManipulation.xyAxisManipulation.available=c,this._moveManipulation.zManipulation.available=c&&this.enableZVertex&&zn(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=c&&1!==n}else{var h=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=h,this._moveManipulation.xyAxisManipulation.available=h,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=h,this._moveManipulation.zManipulation.available=h&&this.enableZShape&&zn(this.graphic)}if(0!==n){var p=0;if((0,u.pC)(r)){var d=r.handle.pos,f=(0,u.pC)(o)?o.handle.pos:r.handle.leftEdge&&r.handle.leftEdge.leftVertex?r.handle.leftEdge.leftVertex.pos:null,v=(0,u.Wi)(o)&&r.handle.rightEdge&&r.handle.rightEdge.rightVertex?r.handle.rightEdge.rightVertex.pos:null;f&&v?this._moveManipulation.xyAxisManipulation.available=!1:f?p=or(f,d):v&&(p=or(d,v))}this._moveManipulation.angle=p,this._moveManipulation.radius=$n}else this._moveManipulation.angleDeferred=function(){return _a((0,u.Wg)(t.graphic.geometry))},this._moveManipulation.radius=Ea.radiusForSymbol(this.graphic.symbol);0!==n&&a?((0,P.g)(i,i,1/n),ur.spatialReference=(0,u.Wg)(this._editGeometryOperations).data.spatialReference,ur.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(i,ur),this._moveManipulation.elevationAlignedLocation=ur):(0,u.pC)(this._outlineVisualElement)&&!this._graphicState.isDraped&&(0,u.pC)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:Ln(this.view,this._moveManipulation,this.graphic)}},{key:"_removeVertices",value:function(e){var t,i=[],n=(0,u.Wg)(this._editGeometryOperations),a=(0,Z.Z)(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;if("vertex"===r.type&&n.canRemoveVertex()){i.push(r.handle),this._removeManipulator(r),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(r.handle.rightEdge));var o=(0,u.Wg)(n.removeVertices([r.handle]).removedVertices[0].createdEdge);o&&this._createVertexOrEdgeManipulator(o)}}}catch(c){a.e(c)}finally{a.f()}if(i.length>0){var s=i.map((function(e){var t=n.data.components.indexOf(e.component);return{coordinates:n.data.coordinateHelper.vectorToArray(e.pos),componentIndex:t,vertexIndex:(0,u.Wg)(e.index)}}));this.outputGeometry=n.data.geometry;var l=this._updateEventState(lr.RESHAPING);if(this.destroyed)return;if(this.emit("vertex-remove",{type:"vertex-remove",removed:s.map((function(e){return e.coordinates})),vertices:s}),this.destroyed)return;if(l&&(this._updateEventState(lr.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}},{key:"_moveVertices",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"start"===t.action?tr.O.NEW_STEP:tr.O.ACCUMULATE_STEPS,n=(0,u.Wg)(this._editGeometryOperations);n.moveVertices(e.map((function(e){return e.handle})),t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,i),this.outputGeometry=n.data.geometry;var a,r=(0,Z.Z)(e);try{for(r.s();!(a=r.n()).done;){var o=a.value;this._updateManipulatorPosition(o)}}catch(s){r.e(s)}finally{r.f()}}},{key:"_offsetEdge",value:function(e,t){if(!(0,u.Wi)(t.operation)&&!(0,u.Wi)(t.signedDistance)){var i=(0,u.Wg)(this._editGeometryOperations),n=t.operation.clone();n.distance=t.signedDistance,i.updateVertices([e.handle.leftVertex,e.handle.rightVertex],n),this.outputGeometry=i.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(e.handle.rightVertex))}}},{key:"_manipulatorClickCallback",value:function(e,t){e.shiftKey||this._clearSelection(),"vertex"===t.type&&(t.manipulator.selected=!t.manipulator.selected,e.button===er.t.Right&&this._removeVertices([t])),"edge"===t.type&&e.button===er.t.Left&&this._splitEdgeManipulator(t),e.stopPropagation()}},{key:"_updateTranslateTooltip",value:function(e,t){var i=this._manipulatorInfos.filter((function(e){return"vertex"===e.type&&e.manipulator.selected}));1===i.length?this._updateTranslateVertexTooltip(i[0].manipulator,e,t):this._updateTranslateGraphicTooltip(e,t)}},{key:"_updateTranslateGraphicTooltip",value:function(e,t){var i=this._tooltipOptions;if(i.enabled){var n=e===ya.Z,a=n?new za({tooltipOptions:i}):new Va({tooltipOptions:i});if((0,u.pC)(t)&&"end"!==t.action){var r=t.mapStart,o=t.mapEnd,s=n?(0,Na._e)(r,o):(0,H.GQ)(r,o,this._graphicState.isDraped?"on-the-ground":"absolute-height");a.distance=(0,u.pC)(s)?s:Ga.yP}this._tooltip.info=a}}},{key:"_updateTranslateVertexTooltip",value:function(e,t,i){var a=this._tooltipOptions;if(a.enabled){var r=t===ya.Z,o=new Wa({tooltipOptions:a});if((0,u.pC)(i)&&"end"!==i.action){var s=i.mapStart,l=i.mapEnd,c=r?(0,Na._e)(s,l):(0,H.GQ)(s,l,this._graphicState.isDraped?"on-the-ground":"absolute-height");o.distance=(0,u.pC)(c)?c:Ga.yP}var h=(0,Na.g1)(e.elevationAlignedLocation);(0,u.pC)(h)&&(o.elevation=(0,n.Z)({mode:"absolute-height"},h));var p=this.graphic.geometry;(0,u.pC)(p)&&!r&&(o.area="polygon"===p.type?(0,nr.M)(p,this._graphicState.isDraped):null,o.totalLength="polyline"===p.type?(0,H.Ul)(p,this._graphicState.isDraped?"on-the-ground":"absolute-height"):null),this._tooltip.info=o}}},{key:"test",get:function(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}}]),i}(ci.Z.EventedMixin($i.r));function or(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI/2}(0,l._)([(0,p.Cb)()],rr.prototype,"_segmentLabels",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],rr.prototype,"tool",void 0),(0,l._)([(0,p.Cb)()],rr.prototype,"_tooltip",void 0),(0,l._)([(0,p.Cb)()],rr.prototype,"inputGeometry",null),(0,l._)([(0,p.Cb)()],rr.prototype,"outputGeometry",void 0),(0,l._)([(0,p.Cb)({readOnly:!0})],rr.prototype,"updating",null),(0,l._)([(0,p.Cb)()],rr.prototype,"manipulators",null),(0,l._)([(0,p.Cb)()],rr.prototype,"view",null),(0,l._)([(0,p.Cb)()],rr.prototype,"graphic",null),(0,l._)([(0,p.Cb)()],rr.prototype,"enableZShape",null),(0,l._)([(0,p.Cb)()],rr.prototype,"enableZVertex",null),(0,l._)([(0,p.Cb)()],rr.prototype,"enableMoveGraphic",null),(0,l._)([(0,p.Cb)()],rr.prototype,"enableMidpoints",null),(0,l._)([(0,p.Cb)()],rr.prototype,"enableEdgeOffset",null),(0,l._)([(0,p.Cb)()],rr.prototype,"_labelOptions",null),(0,l._)([(0,p.Cb)()],rr.prototype,"_tooltipOptions",null),rr=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],rr);var sr,lr,cr,ur=(0,ui.Tx)(0,0,null,null),hr=(0,b.c)();!function(e){e.Vertex=hn.jg.Custom1,e.Edge=hn.jg.Custom2}(sr||(sr={})),function(e){e[e.NONE=0]="NONE",e[e.MOVING=1]="MOVING",e[e.RESHAPING=2]="RESHAPING"}(lr||(lr={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(cr||(cr={}));var pr=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e))._handles=new ne.Z,n._internalGeometryUpdate=!1,n.enableZShape=!0,n.enableZVertex=!0,n.enableMoveGraphic=!0,n.enableMidpoints=!0,n.enableEdgeOffset=!1,n.type="reshape-3d",n.labelOptions=new Xi.Z,n.tooltipOptions=new Qi.Z,n.snappingManager=null,n.automaticManipulatorSelection=!1,n}return(0,r.Z)(i,[{key:"initialize",value:function(){var e=this,t=this._reshapeOperation=new rr({tool:this});this.own([t.on("reshape",(function(t){"reshape"===t.type&&e._onReshapeGeometryChanged(),e.emit("reshape",t)})),t.on("move",(function(t){"move"===t.type&&e._onReshapeGeometryChanged(),e.emit("move",t)})),t.on("vertex-add",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-add",t)})),t.on("vertex-remove",(function(t){e._onReshapeGeometryChanged(),e.emit("vertex-remove",t)})),t.on("immediate-click",(function(t){return e.emit("immediate-click",t)})),this.view.on("pointer-down",["Shift"],(function(e){e.stopPropagation()})),(0,h.YP)((function(){return e.graphic}),(function(){return e._updateGraphic()}),h.tX)]),this.finishToolCreation()}},{key:"destroy",value:function(){this._handles=(0,u.SC)(this._handles),this._reshapeOperation=(0,u.SC)(this._reshapeOperation)}},{key:"updating",get:function(){var e,t;return null!==(e=null===(t=this._reshapeOperation)||void 0===t?void 0:t.updating)&&void 0!==e&&e}},{key:"_updateGeometry",value:function(){var e=(0,Ya.b)(this.graphic);this._reshapeOperation.inputGeometry=(0,u.pC)(e)?e.clone():null}},{key:"_updateGraphic",value:function(){var e=this;if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),(0,Ya.P)(this.graphic)===Vn.e.SUPPORTED){var t=(0,h.YP)((function(){var t;return null===(t=e.graphic)||void 0===t?void 0:t.geometry}),(function(){!1===e._internalGeometryUpdate&&e._updateGeometry()}),h.Z_);this._handles.add(t,"onGraphicGeometryChange")}}},{key:"manipulatorSelectionChanged",value:function(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}},{key:"_updateGeometryInternally",value:function(e){this._internalGeometryUpdate=!0,this.graphic.geometry=e,this._internalGeometryUpdate=!1}},{key:"_onReshapeGeometryChanged",value:function(){(0,u.Wi)(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}},{key:"canUndo",get:function(){var e;return null!==(e=this._reshapeOperation.canUndo)&&void 0!==e&&e}},{key:"undo",value:function(){(0,u.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),(0,u.pC)(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}},{key:"canRedo",get:function(){var e;return null!==(e=this._reshapeOperation.canRedo)&&void 0!==e&&e}},{key:"redo",value:function(){(0,u.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),(0,u.pC)(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}},{key:"onInputEvent",value:function(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}},{key:"reset",value:function(){}},{key:"test",get:function(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}}]),i}(ci.Z.EventedMixin(Ta.m));(0,l._)([(0,p.Cb)()],pr.prototype,"_reshapeOperation",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],pr.prototype,"view",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],pr.prototype,"graphic",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],pr.prototype,"enableZShape",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],pr.prototype,"enableZVertex",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],pr.prototype,"enableMoveGraphic",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],pr.prototype,"enableMidpoints",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],pr.prototype,"enableEdgeOffset",void 0),(0,l._)([(0,p.Cb)()],pr.prototype,"type",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,type:Xi.Z})],pr.prototype,"labelOptions",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,type:Qi.Z})],pr.prototype,"tooltipOptions",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],pr.prototype,"snappingManager",void 0),(0,l._)([(0,p.Cb)()],pr.prototype,"updating",null),(0,l._)([(0,p.Cb)()],pr.prototype,"automaticManipulatorSelection",void 0),pr=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],pr);var dr=i(50951),fr=i(17768),vr=i(99346),gr=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).type="transform-rotate",n.rotationType="geographic",n}return(0,r.Z)(i)}(Ia.h);(0,l._)([(0,p.Cb)()],gr.prototype,"type",void 0),(0,l._)([(0,p.Cb)()],gr.prototype,"rotation",void 0),(0,l._)([(0,p.Cb)()],gr.prototype,"rotationPrecision",void 0),(0,l._)([(0,p.Cb)()],gr.prototype,"orientation",void 0),(0,l._)([(0,p.Cb)()],gr.prototype,"orientationPrecision",void 0),(0,l._)([(0,p.Cb)()],gr.prototype,"rotationType",void 0),gr=(0,l._)([(0,v.j)("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],gr);var _r=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).type="transform-scale",n.sizeUnit=null,n.sizePrecision=null,n}return(0,r.Z)(i)}(Ia.h);(0,l._)([(0,p.Cb)()],_r.prototype,"type",void 0),(0,l._)([(0,p.Cb)()],_r.prototype,"scale",void 0),(0,l._)([(0,p.Cb)()],_r.prototype,"size",void 0),(0,l._)([(0,p.Cb)()],_r.prototype,"sizeUnit",void 0),(0,l._)([(0,p.Cb)()],_r.prototype,"sizePrecision",void 0),_r=(0,l._)([(0,v.j)("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],_r);var yr,mr,br=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).type="transform-absolute",n.orientationEnabled=!0,n.orientationPrecision=null,n.rotationType="geographic",n.sizeUnit=null,n.sizeEnabled=!0,n.sizePrecision=null,n}return(0,r.Z)(i)}(Ia.h);(0,l._)([(0,p.Cb)()],br.prototype,"type",void 0),(0,l._)([(0,p.Cb)()],br.prototype,"orientation",void 0),(0,l._)([(0,p.Cb)()],br.prototype,"orientationEnabled",void 0),(0,l._)([(0,p.Cb)()],br.prototype,"orientationPrecision",void 0),(0,l._)([(0,p.Cb)()],br.prototype,"rotationType",void 0),(0,l._)([(0,p.Cb)()],br.prototype,"size",void 0),(0,l._)([(0,p.Cb)()],br.prototype,"sizeUnit",void 0),(0,l._)([(0,p.Cb)()],br.prototype,"sizeEnabled",void 0),(0,l._)([(0,p.Cb)()],br.prototype,"sizePrecision",void 0),br=(0,l._)([(0,v.j)("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],br),function(e){e.ScaleIn=hn.jg.Custom2,e.ScaleOut=hn.jg.Custom3,e.RotateLeft=hn.jg.Custom4,e.RotateRight=hn.jg.Custom5,e.Unlocked=hn.jg.Custom7,e.DelayedFocused=hn.jg.Custom8,e.TouchInput=hn.jg.Custom12}(yr||(yr={}));var Mr=function(){function e(t){var i=this,n=t.adapter,r=t.tooltipOptions,o=t.mode,s=t.tool;(0,a.Z)(this,e),this.mode=null,this._handles=new ne.Z,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new ci.Z,this.getFocused=function(){return i._ringManipulator.focused},this.getScale=function(){return(0,u.pC)(i._scaleRotateDragData)&&"scale"===i._scaleRotateDragData.mode?i.adapter.scale:1},this.tool=s,this.mode=o,this.adapter=n,this._tooltipOptions=r,this._tooltip=new La.u({view:s.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this._handles.add((0,h.gx)((function(){return!i._tooltipOptions.enabled}),(function(){return i._tooltip.clear()}),h.nn))}return(0,r.Z)(e,[{key:"angle",get:function(){return this.adapter.angle}},{key:"scale",get:function(){return this.adapter.scale}},{key:"location",set:function(e){this._ringManipulator.location=e}},{key:"elevationAlignedLocation",set:function(e){this._ringManipulator.elevationAlignedLocation=e}},{key:"grabbing",get:function(){return this._ringManipulator.grabbing}},{key:"interactive",set:function(e){this._ringManipulator.interactive=e}},{key:"destroy",value:function(){(0,u.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=(0,u.SC)(this._handles),this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=(0,u.SC)(this._tooltip)}},{key:"startAnimation",value:function(e){var t=this;this.cancelActiveAnimation(),e.start();var i=(0,vr.A)({update:function(i){var n=i.deltaTime;e.update(n)&&t.cancelActiveAnimation()}});this._activeAnimation=(0,n.Z)((0,n.Z)({},e),{},{frameTask:i})}},{key:"cancelActiveAnimation",value:function(){(0,u.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=(0,u.SC)(this._activeAnimation))}},{key:"forEachManipulator",value:function(e){e(this._ringManipulator,Gn.SCALE_ROTATE)}},{key:"_createManipulator",value:function(){var e=this,t=this._createRingManipulator();this._ringManipulator=t,this.tool.manipulators.add(t);var i=this.tool.graphicState.graphic,n=(0,ra.Xd)(t,(function(t,n,a){e._scaleRotateDragData=null;var r=e.adapter.startInteraction(),o={mode:"none",origin:(0,b.a)(t.renderLocation),initialAngle:e.adapter.angle,angle:0,angleDir:0,scaleDir:0};e._scaleRotateDragData=o,e._updateDragState();var s=wt.WM.get();e.tool.view.renderCoordsHelper.worldUpAtPosition(t.renderLocation,s),n.next(oa(e.tool.view,(0,de.Yq)(t.renderLocation,s,(0,de.Ue)()))).next((function(t){var n=(0,de.mJ)(t.plane),a=Rn(t.renderStart,t.renderEnd,o.origin,n),s=fr.Q4.shortestSignedDiff(o.angle,a);o.angleDir=(0,he.uZ)(o.angleDir+s,-.3,.3),o.angle=a;var l=function(e,t){var i=(0,P.b)(wt.WM.get(),t.renderStart,e.origin),n=(0,P.b)(wt.WM.get(),t.renderEnd,e.origin),a=(0,P.l)(i),r=(0,P.l)(n);return 0===a?0:r/a}(o,t),c=l-e.adapter.scale;if(o.scaleDir=(0,he.uZ)(o.scaleDir+c,-.2,.2),e._onScaleChanged(),"none"===o.mode){var h=e.mode||function(e,t,i,n){var a=e.renderStart,r=e.renderEnd,o=Sr(a,n,wt.WM.get()),s=Sr(r,n,wt.WM.get());if((0,P.d)(o,s)<100)return null;var l=(0,P.b)(wt.WM.get(),a,i),c=(0,P.f)(wt.WM.get(),l,(0,de.mJ)(t)),u=a,h=(0,P.a)(wt.WM.get(),u,c),p=Sr(i,n,wt.WM.get()),d=o,f=Sr(h,n,wt.WM.get()),v=(0,P.b)(wt.WM.get(),f,d),g=(0,P.b)(wt.WM.get(),o,p),_=(0,ce.re)(d,v),y=(0,ce.re)(p,g);return(0,ce.Jk)(_,s)<(0,ce.Jk)(y,s)?"rotate":"scale"}(t,t.plane,o.origin,e.tool.view.state.camera);if((0,u.pC)(h)){switch(h){case"rotate":e.tool.emit("graphic-rotate-start",{graphic:i,angle:0}),e.tool.emit("record-undo",{record:e.adapter.createUndoRecord()});break;case"scale":e.tool.emit("graphic-scale-start",{graphic:i,xScale:1,yScale:1}),e.tool.emit("record-undo",{record:e.adapter.createUndoRecord()})}o.mode=h}}switch(o.mode){case"rotate":r.state.angle=o.initialAngle+a;break;case"scale":r.state.scale=l,e._onScaleChanged()}switch(e._updateDragState(),e._updateManipulatorTransform(),t.action){case"start":case"update":switch(o.mode){case"rotate":e.tool.emit("graphic-rotate",{graphic:i,angle:(0,he.BV)(o.angle)});break;case"scale":e.tool.emit("graphic-scale",{graphic:i,xScale:l,yScale:l})}break;case"end":switch(o.mode){case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:i,angle:(0,he.BV)(o.angle)});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:i,xScale:l,yScale:l})}}return"end"===t.action&&(e.startAnimation(wr(e,(function(){return e._onScaleChanged()}))),e._scaleRotateDragData=null,e._updateDragState(),r.done()),t})).next(e._updateTooltipPipelineStep(o)),a.next((function(){if(r.cancel(),(0,u.pC)(e._scaleRotateDragData)){switch(e._scaleRotateDragData.mode){case"none":break;case"rotate":e.tool.emit("graphic-rotate-stop",{graphic:i,angle:0});break;case"scale":e.tool.emit("graphic-scale-stop",{graphic:i,xScale:1,yScale:1})}e.startAnimation(wr(e,(function(){return e._onScaleChanged()}))),e._scaleRotateDragData=null,e._updateDragState()}e._updateFocusTooltip()}))}));this._handles.add([n,t.events.on("focus-changed",(function(t){"focus"===t.action?e.startAnimation(function(e,t){var i=0,n=null,a=function(){return!1};return{start:function(){n=e.getFocused,e.getFocused=a,i=0,t()},update:function(e){return i+=e,!n()||i>200?mr.STOP:mr.CONTINUE},destroy:function(){e.getFocused=n,t()}}}(e,(function(){return e._updateDelayedFocusedState()}))):e._updateDelayedFocusedState()})),t.events.on("immediate-click",(function(e){e.stopPropagation()})),(0,h.YP)((function(){var t;return null===(t=e.tool.graphicState)||void 0===t?void 0:t.displaying}),(function(t){return e._ringManipulator.available=t}),h.nn)])}},{key:"_updateTooltipPipelineStep",value:function(e){var t=this;return function(i){var n=t._tooltipOptions;if(!n.enabled)return i;if("end"===i.action)return t._updateFocusTooltip(),i;var a=t._tooltip,r=t._tooltipOptions.visualVariables,o=(0,u.pC)(r)?r.size:null,s=(0,u.pC)(r)?r.rotation:null;switch(e.mode){case"scale":a.info=new _r({tooltipOptions:n,scale:{value:t.adapter.scale},size:(0,Ga.yG)((0,u.Pt)(t.adapter.size,-1),"meters"),sizeUnit:(0,u.pC)(o)?o.unit:null,sizePrecision:(0,u.pC)(o)?Cr(o.valueType):null});break;case"rotate":var l=(0,u.pC)(s)?Cr(s.valueType):null,c=(0,u.pC)(s)?s.rotationType:"geographic";a.info=new gr({tooltipOptions:n,rotation:(0,Ga.GJ)((0,u.Pt)(-t.adapter.relativeAngle,0),"radians","geographic"),rotationPrecision:l,orientation:(0,Ga.GJ)(-t.adapter.angle,"radians","geographic"),orientationPrecision:l,rotationType:c})}return i}}},{key:"_updateFocusTooltip",value:function(){if(this._tooltipOptions.enabled)if(this.getFocused()){var e=this._tooltipOptions.visualVariables,t=(0,u.pC)(e)?e.rotation:null,i=(0,u.pC)(e)?e.size:null;this._tooltip.info=new br({tooltipOptions:this._tooltipOptions,orientation:(0,Ga.GJ)(-this.adapter.angle,"radians","geographic"),orientationEnabled:null==this.mode||"rotate"===this.mode,orientationPrecision:(0,u.pC)(t)?Cr(t.valueType):null,rotationType:(0,u.pC)(t)?t.rotationType:"geographic",size:(0,Ga.yG)((0,u.Pt)(this.adapter.size,-1),"meters"),sizeUnit:(0,u.pC)(i)?i.unit:null,sizeEnabled:null==this.mode||"scale"===this.mode,sizePrecision:(0,u.pC)(i)?Cr(i.valueType):null})}else this._tooltip.clear()}},{key:"_onScaleChanged",value:function(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}},{key:"_updateDelayedFocusedState",value:function(){this._ringManipulator.updateStateEnabled(yr.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}},{key:"_updateDragState",value:function(){if(this._ringManipulator.updateStateEnabled(yr.Unlocked,!((0,u.pC)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),(0,u.pC)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(yr.ScaleIn|yr.ScaleOut,!1),this._ringManipulator.updateStateEnabled(yr.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(yr.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(yr.RotateLeft|yr.RotateRight,!1),this._ringManipulator.updateStateEnabled(yr.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(yr.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(yr.ScaleIn|yr.ScaleOut|yr.RotateLeft|yr.RotateRight,!1)}},{key:"_updateManipulatorTransform",value:function(){var e=(0,Ke.d)(wt.MP.get(),this.adapter.angle,(0,b.f)(0,0,1));if(!(0,u.Wi)(e)){var t=this.getScale(),i=(0,Ke.u)(wt.MP.get(),(0,P.s)(wt.WM.get(),t,t,t));this._ringManipulator.modelTransform=(0,Ke.m)(wt.MP.get(),i,e)}}},{key:"_createRingManipulator",value:function(){for(var e=function(e,t,i){for(var n=[],a=Math.ceil(128*(t-e)/(2*Math.PI)),r=0;r<a+1;r++){var o=e+r*(t-e)/a;n.push((0,b.f)(i*Math.cos(o),i*Math.sin(o),0))}return n},t=function(t){return e(0,2*Math.PI,t)},i=function(e,t){return at.Z.createPathExtrusionGeometry(function(e){return[[-e/2,0],[e/2,0],[e/2,.25],[-e/2,.25]]}(t),e,[],[],!1)},n=t(ea),a=i(n,24),r={left:[],right:[]},o=[],s=0;s<2;s++){var l=s*Math.PI-Math.PI/4,c=Math.PI/2-ta,u=l+c,h=l+Math.PI/2-c,p=e(u,h,190),d=i(p,9);o.push(p),o.push(e(u,h,201)),r.left.push(d),r.right.push(d);for(var f=0;f<2;f++){var v=0===f,_=(0,$e.c)();if(v){(0,Ke.h)(_,_,[1,-1,1]),(0,Ke.e)(_,_,-u,[0,0,1]);var y=Math.round(.2*(p.length-1));_[12]=p[y][0],_[13]=p[y][1],_[14]=p[y][2]}else{(0,Ke.e)(_,_,h,[0,0,1]);var m=Math.round(.8*(p.length-1));_[12]=p[m][0],_[13]=p[m][1],_[14]=p[m][2]}var M=at.Z.createExtrudedTriangle(60,0,23,.5);at.Z.transformInPlace(M,_),(v?r.left:r.right).push(M)}}for(var S=[],w=0;w<2;w++){var C=w*Math.PI-Math.PI/4,x=Math.PI/2-ia,E=C+x,O=C+Math.PI/2-x,k=e(E,O,213);S.push(i(k,9))}var A=t(190),P=t(213),T=i(A,9),R=i(P,9),Z=t(130),D=t(107),L=i(Z,9),G=i(D,9),I=this._createMaterial(),V=this._createMaterial(.66),z=this._createMaterial(.5),W=this._createMaterial(.33),N=[{geometry:a,material:I,stateMask:yr.DelayedFocused},{geometry:a,material:z,stateMask:hn.Q9.None}];this.mode&&"scale"!==this.mode||(N=N.concat([{geometry:S,material:I,stateMask:yr.DelayedFocused|yr.Unlocked},{geometry:T,material:V,stateMask:yr.DelayedFocused|yr.ScaleIn},{geometry:R,material:W,stateMask:yr.DelayedFocused|yr.ScaleIn},{geometry:L,material:V,stateMask:yr.DelayedFocused|yr.ScaleOut},{geometry:G,material:W,stateMask:yr.DelayedFocused|yr.ScaleOut}])),this.mode&&"rotate"!==this.mode||(N=N.concat([{geometry:r.right,material:I,stateMask:yr.DelayedFocused|yr.Unlocked},{geometry:r.left,material:I,stateMask:yr.DelayedFocused|yr.RotateLeft},{geometry:r.right,material:I,stateMask:yr.DelayedFocused|yr.RotateRight}]));var F=[n].concat(o);return new dn({view:this.tool.view,renderObjects:N,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:(0,g.RL)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:F,direction:(0,b.f)(0,0,1)}})}},{key:"_createMaterial",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=(0,pe.b)([].concat((0,M.Z)(Jn),[e]));return new Gt.E({color:t,transparent:1!==e,cullFace:et.Vr.Back,renderOccluded:rt.yD.Transparent})}},{key:"test",get:function(){return{ringManipulator:this._ringManipulator,tooltip:this._tooltip}}}]),e}();function Sr(e,t,i){return t.projectToScreen(e,xr),(0,P.s)(i,xr[0],xr[1],0)}function wr(e,t){var i=null,n=1,a=function(){return n};return{start:function(){n=e.getScale(),i=e.getScale,e.getScale=a,t()},update:function(e){return n+=((n+1)/2-n)*Math.min(3*e,1),t(),Math.abs(n-1)<.01?mr.STOP:mr.CONTINUE},destroy:function(){e.getScale=i,t()}}}function Cr(e){switch(e){case"integer":case"long":return 0;default:return null}}!function(e){e[e.CONTINUE=0]="CONTINUE",e[e.STOP=1]="STOP"}(mr||(mr={}));var xr=(0,y.s1)(),Er=i(45238);function Or(e){return(0,u.pC)(e.geometry)&&"mesh"===e.geometry.type?function(e){return(0,u.pC)(e.transform)?function(e,t){var i=t.clone(),n=null;return{undo:function(t){n=(0,u.pC)(e.transform)?e.transform.clone():null,e.transform=i,t.notifyGeometryChanged()},redo:function(t){i=(0,u.pC)(e.transform)?e.transform.clone():null,e.transform=n,t.notifyGeometryChanged()}}}(e,e.transform):function(e){var t,i=e.vertexAttributes.clonePositional();return{undo:function(n){t=e.vertexAttributes.clonePositional(),e.vertexAttributes=i,n.notifyGeometryChanged()},redo:function(n){i=e.vertexAttributes.clonePositional(),e.vertexAttributes=t,n.notifyGeometryChanged()}}}(e)}(e.geometry):function(e){var t=e.geometry,i=u.YP;return{undo:function(e){i=e.geometry,e.geometry=t},redo:function(e){t=e.geometry,e.geometry=i}}}(e)}var kr=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).interactionState=null,n}return(0,r.Z)(i,[{key:"initialize",value:function(){var e=this;this.own([(0,h.gx)((function(){return(0,u.pC)(e.interactionState)&&e.interactionState.angle!==e.interactionState.previousAngle?{interactionState:e.interactionState,angle:e.interactionState.state.angle}:null}),(function(t){var i=t.interactionState;e._updateMeshRotation(i)}),h.Z_),(0,h.gx)((function(){return(0,u.pC)(e.interactionState)&&e.interactionState.scale!==e.interactionState.previousScale?{interactionState:e.interactionState,scale:e.interactionState.state.scale}:null}),(function(t){var i=t.interactionState;e._updateMeshSize(i)}),h.Z_)])}},{key:"angle",get:function(){var e=this.geometry.transform;if((0,u.Wi)(e))return 0;var t=(0,Er.ZZ)(e.rotation)[2];return Math.abs(t)>.999999?(0,he.Vl)((0,Er.EU)(e.rotation))*Math.sign(t):0}},{key:"scale",get:function(){return(0,u.pC)(this.interactionState)?this.interactionState.scale:1}},{key:"startInteraction",value:function(){var e=this,t=new Ar({angle:this.angle});this.interactionState=t;var i=function(){return e.interactionState=null};return{state:t,done:i,cancel:function(){t.cancel(),i()}}}},{key:"createUndoRecord",value:function(){return Or(this.graphic)}},{key:"_updateMeshRotation",value:function(e){var t=this.geometry.anchor,i=this.viewingMode===dr.JY.Global,n=e.angle,a=e.previousAngle;this.geometry.rotate(0,0,(0,he.BV)(n-a),{origin:t,geographic:i}),e.previousAngle=n,(0,u.pC)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}},{key:"_updateMeshSize",value:function(e){var t=this.geometry.anchor,i=this.viewingMode===dr.JY.Global,n=e.scale,a=e.previousScale;this.geometry.scale(n/a,{origin:t,geographic:i}),e.previousScale=n,(0,u.pC)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}}]),i}($i.r);(0,l._)([(0,p.Cb)({constructOnly:!0})],kr.prototype,"graphic",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],kr.prototype,"geometry",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],kr.prototype,"viewingMode",void 0),(0,l._)([(0,p.Cb)()],kr.prototype,"angle",null),(0,l._)([(0,p.Cb)()],kr.prototype,"scale",null),(0,l._)([(0,p.Cb)()],kr.prototype,"interactionState",void 0),kr=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],kr);var Ar=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).angle=0,n.initialAngle=0,n.previousAngle=0,n.previousScale=1,n.scale=1,n.initialAngle=e.angle,n.previousAngle=e.angle,n}return(0,r.Z)(i,[{key:"state",get:function(){return{angle:this.angle,scale:this.scale}}},{key:"cancel",value:function(){this.angle=this.initialAngle,this.scale=1}}]),i}(C.Z);(0,l._)([(0,p.Cb)()],Ar.prototype,"angle",void 0),(0,l._)([(0,p.Cb)()],Ar.prototype,"initialAngle",void 0),(0,l._)([(0,p.Cb)()],Ar.prototype,"previousAngle",void 0),(0,l._)([(0,p.Cb)()],Ar.prototype,"previousScale",void 0),(0,l._)([(0,p.Cb)()],Ar.prototype,"scale",void 0),(0,l._)([(0,p.Cb)()],Ar.prototype,"state",null),Ar=(0,l._)([(0,v.j)("InteractionState")],Ar);var Pr=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).sizeAxis=null,n.interactionState=null,n}return(0,r.Z)(i,[{key:"initialize",value:function(){var e=this;this.own((0,h.gx)((function(){return(0,u.pC)(e.interactionState)?e.interactionState.state:null}),(function(t){e._updateSymbol(t)}),h.Z_))}},{key:"angle",get:function(){return(0,u.pC)(this.interactionState)?this.interactionState.angle:(0,u.pC)(this._orientationReferenceSymbolLayer)?function(e){return-(0,he.Vl)(e)}(this._orientationReferenceSymbolLayer.heading):0}},{key:"scale",get:function(){return(0,u.pC)(this.interactionState)?this.interactionState.scale:1}},{key:"relativeAngle",get:function(){return this.angle-this.initialAngle}},{key:"initialAngle",get:function(){return(0,u.pC)(this.interactionState)?this.interactionState.initialAngle:0}},{key:"size",get:function(){var e=this._sizeReferenceSymbolLayer;if((0,u.Wi)(e))return null;var t=this.findLayerView(),i=this._graphicSymbol;if((0,u.Wi)(t)||(0,u.Wi)(i)||"point-3d"!==i.type)return null;var n=t.getSymbolLayerSize(i,e);if("size"in n&&(0,u.pC)(n.size))return n.size;var a=this.sizeAxis;return"width"in n&&(0,u.pC)(n.width)&&((0,u.Wi)(a)||"width"===a||"all"===a||"width-and-depth"===a)?n.width:"depth"in n&&(0,u.pC)(e.depth)&&((0,u.Wi)(a)||"depth"===a||"all"===a||"width-and-depth"===a)?n.depth:"height"in n&&(0,u.pC)(e.height)&&((0,u.Wi)(a)||"height"===a||"all"===a)?n.height:null}},{key:"_sizeReferenceSymbolLayer",get:function(){var e=this._graphicSymbol;return(0,u.Wi)(e)||0===e.symbolLayers.length?null:e.symbolLayers.find((function(e){return"object"===e.type}))}},{key:"_orientationReferenceSymbolLayer",get:function(){var e=this._graphicSymbol;return(0,u.Wi)(e)||0===e.symbolLayers.length?null:e.symbolLayers.find((function(e){return"object"===e.type&&(0,u.pC)(e.heading)}))}},{key:"_graphicSymbol",get:function(){return(0,u.pC)(this.graphic)&&(0,u.pC)(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null},set:function(e){this.graphic.symbol=e}},{key:"startInteraction",value:function(){var e=this,t=this._graphicSymbol,i=this.findLayerView();if((0,u.pC)(this.interactionState)||(0,u.Wi)(t)||(0,u.Wi)(i))return Tr;var n=t.symbolLayers.map((function(e){return"object"===e.type?i.getSymbolLayerSize(t,e):null})).toArray(),a=t.clone(),r=this.angle,o=new Rr({originalSymbol:a,angle:r,initialSizes:n});this.interactionState=o;var s=function(){return e.interactionState=null};return{state:o,done:s,cancel:function(){e._graphicSymbol=a,s()}}}},{key:"createUndoRecord",value:function(){var e=this.graphic.symbol,t=null;return{undo:function(i){t=i.symbol,i.symbol=e},redo:function(i){e=i.symbol,i.symbol=t}}}},{key:"_updateSymbol",value:function(e){var t=this,i=e.scale,n=e.angle,a=e.originalSymbol,r=e.initialSizes,o=this._graphicSymbol;if(!(0,u.Wi)(o)&&"point-3d"===o.type){var s=o.clone(),l=-(0,he.BV)(n-this.initialAngle),c=!1;this._forEachObjectSymbolLayerPair(a,s,(function(e,n,a){var o=(0,u.Pt)(e.heading,0)+l;n.heading!==o&&(n.heading=o,c=!0);var s=r[a];if((0,u.pC)(s)&&"width"in s){s.width=t.sizeFilter(s.width),s.height=t.sizeFilter(s.height),s.depth=t.sizeFilter(s.depth);var h=s.width*i;n.width!==h&&(n.width=h,c=!0);var p=s.depth*i;n.depth!==p&&(n.depth=p,c=!0);var d=s.height*i;n.height!==d&&(n.height=d,c=!0)}})),c&&(this._graphicSymbol=s)}}},{key:"_forEachObjectSymbolLayerPair",value:function(e,t,i){e.symbolLayers.forEach((function(e,n){var a=t.symbolLayers.getItemAt(n);"object"===e.type&&"object"===a.type&&i(e,a,n)}))}}]),i}($i.r);(0,l._)([(0,p.Cb)()],Pr.prototype,"angle",null),(0,l._)([(0,p.Cb)()],Pr.prototype,"scale",null),(0,l._)([(0,p.Cb)()],Pr.prototype,"relativeAngle",null),(0,l._)([(0,p.Cb)()],Pr.prototype,"initialAngle",null),(0,l._)([(0,p.Cb)()],Pr.prototype,"size",null),(0,l._)([(0,p.Cb)()],Pr.prototype,"sizeAxis",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],Pr.prototype,"graphic",void 0),(0,l._)([(0,p.Cb)()],Pr.prototype,"interactionState",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],Pr.prototype,"findLayerView",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0})],Pr.prototype,"sizeFilter",void 0),(0,l._)([(0,p.Cb)()],Pr.prototype,"_sizeReferenceSymbolLayer",null),(0,l._)([(0,p.Cb)()],Pr.prototype,"_orientationReferenceSymbolLayer",null),(0,l._)([(0,p.Cb)()],Pr.prototype,"_graphicSymbol",null),Pr=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],Pr);var Tr={state:{angle:0,scale:0},done:function(){},cancel:function(){}},Rr=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).angle=0,n.initialAngle=0,n.scale=1,n.initialAngle=e.angle,n}return(0,r.Z)(i,[{key:"state",get:function(){return{originalSymbol:this.originalSymbol,angle:this.angle,initialAngle:this.initialAngle,scale:this.scale,initialSizes:this.initialSizes}}}]),i}(C.Z);(0,l._)([(0,p.Cb)()],Rr.prototype,"originalSymbol",void 0),(0,l._)([(0,p.Cb)()],Rr.prototype,"angle",void 0),(0,l._)([(0,p.Cb)()],Rr.prototype,"initialAngle",void 0),(0,l._)([(0,p.Cb)()],Rr.prototype,"initialSizes",void 0),(0,l._)([(0,p.Cb)()],Rr.prototype,"scale",void 0),(0,l._)([(0,p.Cb)()],Rr.prototype,"state",null),Rr=(0,l._)([(0,v.j)("InteractionState")],Rr);var Zr=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).enableZ=!0,n.enableRotation=!0,n.enableScaling=!0,n.tooltipOptions=new Qi.Z,n.type="transform-3d",n._scaleRotate=null,n._snappingPipeline=new Da.n,n._tooltip=null,n}return(0,r.Z)(i,[{key:"initialize",value:function(){var e=this,t=this.graphic,i=this.view;this.graphicState=new ji.F({graphic:t}),this.own((0,h.YP)((function(){return e.tooltipOptions.enabled}),(function(t){e._tooltip=t?new La.u({view:i}):(0,u.SC)(e._tooltip)}),h.tX)),this._moveManipulation=new Ea({tool:this,view:i,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&zn(t),radius:Ea.radiusForSymbol(t.symbol)}),this._moveManipulation.forEachManipulator((function(i,a){return e.handles.add([i.events.on("immediate-click",(function(i){e.emit("immediate-click",(0,n.Z)((0,n.Z)({},i),{},{graphic:t})),i.stopPropagation()})),i.events.on("focus-changed",(function(t){var i=t.action,n=e.tooltipOptions,r=e._tooltip;if(!(0,u.Wi)(r)&&(r.clear(),"focus"===i)){var o=a===Gn.TRANSLATE_Z?za:Va;r.info=new o({tooltipOptions:n})}}))])})),this._moveManipulation.elevationInfo=(0,g.RL)(t);var a=t.geometry;if(this._moveManipulation.createGraphicDragPipeline((function(n,r,o,s,l){return(0,u.pC)(a)&&n===ya.XY&&(o=o.next(e._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new Za.N({elevationInfo:(0,g.RL)(t),pointer:l,editGeometryOperations:Ra.c.fromGeometry(new pn.Z({spatialReference:a.spatialReference}),i.state.viewingMode),visualizer:new Nt,excludeFeature:t}),snappingManager:e.snappingManager,updatingHandles:e.updatingHandles,cancel:s}),e._snappingPipeline.next)),o.next((function(t){var i=e.tooltipOptions,a=e._tooltip;if((0,u.Wi)(a))return t;var r=t.mapStart,o=t.mapEnd;a.clear();var s=n===ya.Z?za:Va;if("end"===t.action)a.info=new s({tooltipOptions:i});else{var l=n===ya.Z?(0,Na._e)(r,o):(0,H.GQ)(r,o,e.graphicState.isDraped?"on-the-ground":"absolute-height");(0,u.pC)(l)&&(a.info=new s({tooltipOptions:i,distance:l}))}return t}))}),this.graphicState,(function(t){var i=t.action,n={graphic:t.graphic,dxScreen:t.dxScreen,dyScreen:t.dyScreen};switch(i){case"start":e.emit("graphic-translate-start",n),e.emit("record-undo",{record:e._createGeometryUndoRecord()});break;case"update":e.emit("graphic-translate",n);break;case"end":e.emit("graphic-translate-stop",n)}})),this._moveManipulation.angle=(0,u.pC)(this._scaleRotate)?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.handles.add((0,h.YP)((function(){return e._scaleRotateAdapter.angle}),(function(){return e._updateMoveAngle()}))),this.enableScaling||this.enableRotation){var r=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new Mr({tool:this,mode:r,adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.handles.add(this._scaleRotate.events.on("scale-changed",(function(){return e._onScaleChanged()})))}this.handles.add([Xn({view:this.view,graphic:this.graphic,forEachManipulator:function(t){return e._forEachManipulator(t)},onManipulatorsChanged:function(){return(0,c.kB)()}}),this.graphicState.on("changed",(function(){return e._onGeometryChanged()})),this._hideManipulatorsForGraphicState(),(0,h.YP)((function(){return i.scale}),(function(){return e._updateMoveAngle()}))]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator((function(t){t instanceof dn&&e.handles.add(t.events.on("grab-changed",(function(){return e._updateManipulatorsInteractive()})))})),this.finishToolCreation()}},{key:"destroy",value:function(){this._tooltip=(0,u.SC)(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=(0,u.SC)(this._scaleRotate),this._scaleRotateAdapter=(0,u.SC)(this._scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}},{key:"_updateManipulatorsInteractive",value:function(){(0,u.Wi)(this._scaleRotate)||(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}},{key:"_createScaleRotateAdapter",value:function(){var e=this;return(0,u.pC)(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new kr({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new Pr({graphic:this.graphic,sizeFilter:function(t){return e._enforceNonZeroSize(t)},findLayerView:function(){return e.view.allLayerViews.find((function(t){return t.layer===e.graphic.layer}))},sizeAxis:(0,u.pC)(this.tooltipOptions.visualVariables)&&(0,u.pC)(this.tooltipOptions.visualVariables.size)?this.tooltipOptions.visualVariables.size.axis:null})}},{key:"_forEachManipulator",value:function(e){this._moveManipulation.forEachManipulator(e),(0,u.pC)(this._scaleRotate)&&this._scaleRotate.forEachManipulator(e)}},{key:"_hideManipulatorsForGraphicState",value:function(){var e=this;return(0,h.YP)((function(){return e.graphicState.displaying}),(function(t){e._forEachManipulator((function(e){return e.available=t})),e._moveManipulation.zManipulation.available=t&&e.enableZ&&zn(e.graphic)}))}},{key:"_createGeometryUndoRecord",value:function(){return Or(this.graphic)}},{key:"snapToScene",set:function(e){this._moveManipulation&&(this._moveManipulation.snapToScene=e),this._set("snapToScene",e)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"location",set:function(e){this._moveManipulation.location=e,(0,u.pC)(this._scaleRotate)&&(this._scaleRotate.location=e)}},{key:"elevationAlignedLocation",set:function(e){this._moveManipulation.elevationAlignedLocation=e,(0,u.pC)(this._scaleRotate)&&(this._scaleRotate.elevationAlignedLocation=e)}},{key:"reset",value:function(){}},{key:"onHide",value:function(){(0,u.pC)(this._scaleRotate)&&this._scaleRotate.cancelActiveAnimation()}},{key:"_onScaleChanged",value:function(){if(!(0,u.Wi)(this._scaleRotate)){var e=this._scaleRotate.getScale();this._moveManipulation.displayScale=e}}},{key:"_updateMoveAngle",value:function(){this.view.state.viewingMode===dr.JY.Local||this.view.scale<1e6?this._moveManipulation.angle=this._scaleRotateAdapter.angle:this._moveManipulation.angle=0}},{key:"_onGeometryChanged",value:function(){Ln(this.view,this,this.graphic)}},{key:"_enforceNonZeroSize",value:function(e){return e||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}},{key:"test",get:function(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:(0,u.pC)(this._scaleRotate)?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}}]),i}((0,$i.p)(ci.Z.EventedMixin(Ta.m)));(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],Zr.prototype,"view",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],Zr.prototype,"graphic",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],Zr.prototype,"enableZ",void 0),(0,l._)([(0,p.Cb)()],Zr.prototype,"enableRotation",void 0),(0,l._)([(0,p.Cb)()],Zr.prototype,"enableScaling",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,type:Qi.Z})],Zr.prototype,"tooltipOptions",void 0),(0,l._)([(0,p.Cb)()],Zr.prototype,"graphicState",void 0),(0,l._)([(0,p.Cb)({value:!1})],Zr.prototype,"snapToScene",null),(0,l._)([(0,p.Cb)({constructOnly:!0})],Zr.prototype,"snappingManager",void 0),(0,l._)([(0,p.Cb)({readOnly:!0})],Zr.prototype,"type",void 0),(0,l._)([(0,p.Cb)({readOnly:!0})],Zr.prototype,"updating",null),Zr=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],Zr);var Dr=i(82218),Lr=i(11582),Gr=i(46784),Ir=i(89125),Vr=i(66576),zr=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).type="plane",n.position=null,n.heading=0,n.tilt=0,n.width=10,n.height=10,n}return(0,r.Z)(i,[{key:"equals",value:function(e){return this.heading===e.heading&&this.tilt===e.tilt&&(0,u._W)(this.position,e.position)&&this.width===e.width&&this.height===e.height}}]),i}((0,Lr.J)(Gr.wq));(0,l._)([(0,p.Cb)({readOnly:!0,json:{read:!1,write:!0}})],zr.prototype,"type",void 0),(0,l._)([(0,p.Cb)({type:pn.Z}),(0,Vr.B)()],zr.prototype,"position",void 0),(0,l._)([(0,p.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Vr.B)(),(0,Ir.p)((function(e){return fr.BV.normalize((0,f.q9)(e),0,!0)}))],zr.prototype,"heading",void 0),(0,l._)([(0,p.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Vr.B)(),(0,Ir.p)((function(e){return fr.BV.normalize((0,f.q9)(e),0,!0)}))],zr.prototype,"tilt",void 0),(0,l._)([(0,p.Cb)({type:Number,nonNullable:!0}),(0,Vr.B)()],zr.prototype,"width",void 0),(0,l._)([(0,p.Cb)({type:Number,nonNullable:!0}),(0,Vr.B)()],zr.prototype,"height",void 0),zr=(0,l._)([(0,v.j)("esri.analysis.SlicePlane")],zr);var Wr=i(48976),Nr=(i(14320),(0,d.Z)("mac"),Math.cos((0,he.Vl)(45)),Math.cos((0,he.Vl)(5)),(0,b.f)(1,.5,0)),Fr=((0,pe.b)([].concat((0,M.Z)(Nr),[.7])),(0,pe.b)([].concat((0,M.Z)(Nr),[.5])),(0,pe.b)([].concat((0,M.Z)(Nr),[1]))),Ur=(0,pe.f)(1,1,1,1),Hr=(0,pe.f)(1,.8,.6,1),jr=(0,pe.f)(1,.93,.86,1),Br=(0,pe.b)([].concat((0,M.Z)(Nr),[1])),Yr=(0,pe.b)([].concat((0,M.Z)(Nr),[1])),qr=40,Xr=(0,pe.b)([].concat((0,M.Z)(Nr),[1]));(0,$e.c)();var Qr=i(64226),Jr=i(11316),Kr=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments)).backgroundColor=(0,pe.f)(1,0,0,.5),e.gridColor=(0,pe.f)(0,1,0,.5),e.gridWidth=4,e}return(0,r.Z)(i)}(Ge.K),$r=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){return(0,a.Z)(this,i),t.apply(this,arguments)}return(0,r.Z)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get().build(this.configuration);return new be.$(e.rctx,t,Ie.i)}},{key:"initializePipeline",value:function(){return(0,we.sm)({blending:(0,we.wK)(Se.zi.ONE,Se.zi.ONE,Se.zi.ONE_MINUS_SRC_ALPHA,Se.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:Se.wb.LESS},colorWrite:we.BK})}}]),i}(me.A);$r.shader=new ye.J(Jr.S,(function(){return i.e(8492).then(i.bind(i,18492))}));rt.F5;var eo=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).ensureTechnique($r,null),n}return(0,r.Z)(i,[{key:"beginSlot",value:function(){return(0,u.Wg)(this.technique)}}]),i}(Ei.Z),to=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments)).renderOccluded=rt.yD.Occlude,e}return(0,r.Z)(i)}(Kr);i(78952);Math.pow(2,50);(0,b.c)();(0,b.c)(),i(72619);var io=i(17363),no=i(50411),ao=i(32500),ro=(Ge.K,function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){return(0,a.Z)(this,i),t.apply(this,arguments)}return(0,r.Z)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get().build(this.configuration);return new be.$(e.rctx,t,Ie.i)}},{key:"_setPipelineState",value:function(e,t){var i=this.configuration,n=e===et.Am.NONE,a=e===et.Am.FrontFace;return(0,we.sm)({blending:i.output!==xi.H.Color&&i.output!==xi.H.Alpha||!i.transparent?null:n?oo:(0,Pi.j7)(e),culling:(0,we.zp)(i.cullFace),depthTest:{func:(0,Pi.Bh)(e)},depthWrite:n?i.writeDepth&&we.LZ:(0,Pi.K5)(e),colorWrite:we.BK,stencilWrite:i.hasOccludees?no.s3:null,stencilTest:i.hasOccludees?t?no.eD:no.RY:null,polygonOffset:n||a?null:(0,Pi.je)(i.enableOffset)})}},{key:"initializePipeline",value:function(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}},{key:"getPipelineState",value:function(e,t){return t?this._occludeePipelineState:(0,te.Z)((0,ie.Z)(i.prototype),"getPipelineState",this).call(this,e,t)}}]),i}(me.A));ro.shader=new ye.J(ao.I,(function(){return i.e(8957).then(i.bind(i,18957))}));var oo=(0,we.if)(Se.zi.ONE,Se.zi.ONE_MINUS_SRC_ALPHA),so=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments)).output=xi.H.Color,e.cullFace=et.Vr.None,e.hasSlicePlane=!1,e.transparent=!1,e.enableOffset=!0,e.writeDepth=!0,e.hasOccludees=!1,e.transparencyPassType=et.Am.NONE,e.hasMultipassTerrain=!1,e.cullAboveGround=!1,e}return(0,r.Z)(i)}(Ti.W);(0,l._)([(0,De.o)({count:xi.H.COUNT})],so.prototype,"output",void 0),(0,l._)([(0,De.o)({count:et.Vr.COUNT})],so.prototype,"cullFace",void 0),(0,l._)([(0,De.o)()],so.prototype,"hasSlicePlane",void 0),(0,l._)([(0,De.o)()],so.prototype,"transparent",void 0),(0,l._)([(0,De.o)()],so.prototype,"enableOffset",void 0),(0,l._)([(0,De.o)()],so.prototype,"writeDepth",void 0),(0,l._)([(0,De.o)()],so.prototype,"hasOccludees",void 0),(0,l._)([(0,De.o)({count:et.Am.COUNT})],so.prototype,"transparencyPassType",void 0),(0,l._)([(0,De.o)()],so.prototype,"hasMultipassTerrain",void 0),(0,l._)([(0,De.o)()],so.prototype,"cullAboveGround",void 0);var lo,co=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e,new ho)).supportsEdges=!0,n.techniqueConfig=new so,n}return(0,r.Z)(i,[{key:"getConfiguration",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.enableOffset=t.camera.relativeElevation<Pi.ve,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig}},{key:"intersect",value:function(e,t,i,n,a,r,o){(0,Ze.Bw)(e,t,n,a,r,void 0,o)}},{key:"requiresSlot",value:function(e,t){return e===Re.r.DRAPED_MATERIAL||((0,Oi.S)(t)===xi.H.Highlight?e===Re.r.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?Re.r.TRANSPARENT_MATERIAL:Re.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Re.r.OPAQUE_MATERIAL))}},{key:"createGLMaterial",value:function(e){return e.output===xi.H.Color||e.output===xi.H.Alpha||e.output===xi.H.Highlight?new uo(e):void 0}},{key:"createBufferWriter",value:function(){return new Qr.G_(Qr.W1)}}]),i}(rt.F5),uo=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){return(0,a.Z)(this,i),t.call(this,(0,n.Z)((0,n.Z)({},e),e.material.parameters))}return(0,r.Z)(i,[{key:"_updateParameters",value:function(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(ro,e)}},{key:"_updateOccludeeState",value:function(e){e.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:e.hasOccludees}),this._updateParameters(e))}},{key:"beginSlot",value:function(e){return this._output!==xi.H.Color&&this._output!==xi.H.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}}]),i}(io.F),ho=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments)).transparent=!1,e.writeDepth=!0,e.hasSlicePlane=!1,e.cullFace=et.Vr.None,e.hasOccludees=!1,e.opacity=1,e.textureId=null,e.initTextureTransparent=!0,e}return(0,r.Z)(i)}(rt.Mt),po=i(24231);i(53866),m.Z.getLogger("esri.views.3d.interactive.analysisTools.slice.sliceToolUtils");function fo(e,t){switch(t){case lo.POSITIVE_X:return{basis:e.basis1,direction:1,position:(0,P.a)(wt.WM.get(),e.origin,e.basis1),edge:t};case lo.POSITIVE_Y:return{basis:e.basis2,direction:1,position:(0,P.a)(wt.WM.get(),e.origin,e.basis2),edge:t};case lo.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:(0,P.b)(wt.WM.get(),e.origin,e.basis1),edge:t};case lo.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:(0,P.b)(wt.WM.get(),e.origin,e.basis2),edge:t}}}function vo(e){var t=(0,P.l)(e.basis1),i=(0,P.l)(e.basis2);return.3*Math.min(t,i)}function go(e){return vo(e)}function _o(e){return 0!==e.direction[0]&&0!==e.direction[1]}function yo(e,t){var i=_o(t),n=i?[(0,b.f)(1,0,0),(0,b.f)(0,0,0),(0,b.f)(0,1,0)]:[(0,b.f)(1,0,0),(0,b.f)(-1,0,0)],a=at.Z.createPolylineGeometry(n),r=Xr,o=i?4:1,s=2*o,l=function(e){return e>1?function(e){return new ot.U({color:r,width:e,renderOccluded:rt.yD.OccludeAndTransparent})}(e):new po.Y({color:r,renderOccluded:rt.yD.OccludeAndTransparent})},c=[{geometry:a,material:l(o),stateMask:hn.Q9.Unfocused|Ao},{geometry:a,material:l(s),stateMask:hn.Q9.Focused|Ao},{geometry:a,material:l(1),stateMask:Po}],u=new dn({view:e,renderObjects:c,collisionType:{type:"line",paths:[n]},autoScaleRenderObjects:!1,worldSized:!0,radius:i?6:4});return u.state=Ao,u}function mo(e,t,i){var n=function(n){var a=(n?t:e).slice(0),r=(0,P.b)(wt.WM.get(),a[0],a[1]);(0,P.n)(r,r);var o=(0,P.b)(wt.WM.get(),a[a.length-1],a[a.length-2]);if((0,P.n)(o,o),i.padding>0){var s=(0,P.g)((0,b.c)(),o,-i.padding);if(a[a.length-1]=(0,P.a)(s,s,a[a.length-1]),i.bothEnds){var l=(0,P.g)((0,b.c)(),r,-i.padding);a[0]=(0,P.a)(l,l,a[0])}}var c=n?i.tipFocusMultiplier:1,h=i.tipLength*(i.focusTipLength?c:1),p=i.tipRadius*c,d=(0,Ke.i)(wt.MP.get());if(i.padding>0){var f=h/4,v=(0,P.s)(wt.WM.get(),0,f,0),g=1+i.padding/f;(0,Ke.j)(d,d,v),(0,Ke.h)(d,d,(0,P.s)(wt.WM.get(),g,g,g)),(0,Ke.j)(d,d,(0,P.g)(v,v,-1/g))}var _=(0,Ke.i)((0,$e.c)()),y=(0,b.f)(0,1,0),m=(0,Ke.k)((0,$e.c)(),(0,Wr.r)(wt.vD.get(),y,o));m[12]=a[a.length-1][0],m[13]=a[a.length-1][1],m[14]=a[a.length-1][2],(0,Ke.m)(m,m,d);var M,S,w=[{part:"tube",geometry:bo(i.tubeRadius*(n?i.tubeFocusMultiplier:1)+i.padding,i.flat,a),transform:_}];if((0,u.pC)(i.flat)?M=at.Z.createExtrudedTriangle(h,p,p,i.flat.thickness):(M=at.Z.createConeGeometry(h,p,24,!1,!1,!0),S=at.Z.createConeGeometry(h,p,24,!1,!0,!1)),w.push({part:"tip",geometry:M,transform:m}),S&&w.push({part:"cap",geometry:S,transform:m}),i.bothEnds){var C=(0,Ke.k)((0,$e.c)(),(0,Wr.r)(wt.vD.get(),y,r));C[12]=a[0][0],C[13]=a[0][1],C[14]=a[0][2],(0,Ke.m)(C,C,d),w.push({part:"tip",geometry:M,transform:C}),S&&w.push({part:"cap",geometry:S,transform:C})}return w};return{normal:n(!1),focused:n(!0)}}function bo(e,t,i){var n=[];if((0,u.pC)(t))n.push([e,t.thickness/2],[-e,t.thickness/2],[-e,-t.thickness/2],[e,-t.thickness/2]);else for(var a=0;a<12;a++){var r=a/12*2*Math.PI;n.push([Math.cos(r)*e,Math.sin(r)*e])}return at.Z.createPathExtrusionGeometry(n,i,[],[],!1)}function Mo(e,t){var i=(0,P.b)((0,b.c)(),e[e.length-1],e[e.length-2]);if((0,P.n)(i,i),(0,P.g)(i,i,12),(0,P.a)(i,i,e[e.length-1]),t){var n=(0,P.b)((0,b.c)(),e[0],e[1]);return(0,P.n)(n,n),(0,P.g)(n,n,12),(0,P.a)(n,n,e[0]),[n].concat((0,M.Z)(e),[i])}return[].concat((0,M.Z)(e),[i])}function So(e,t){return(0,aa.cp)(t,e.basis2,e.basis1)+ko}!function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"}(lo||(lo={}));var wo,Co,xo=hn.jg.Custom1;!function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"}(wo||(wo={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(Co||(Co={}));var Eo,Oo=hn.jg.Custom2,ko=((0,ce.Ue)(),Math.PI/2),Ao=hn.jg.Custom1,Po=hn.jg.Custom2;!function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(Eo||(Eo={}));var To="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC",Ro={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};var Zo=function(){function e(){(0,a.Z)(this,e),this.lastDragEvent=null,this.next=new ra.hM,this._enabled=!1}return(0,r.Z)(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(this._enabled!==e&&(0,u.pC)(this.lastDragEvent)){var t=(0,n.Z)((0,n.Z)({},this.lastDragEvent),{},{action:"update"});e&&this._adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}},{key:"createDragEventPipelineStep",value:function(){var e=this;return this.lastDragEvent=null,function(t){return e.lastDragEvent="end"!==t.action?(0,n.Z)({},t):null,e._enabled&&e._adjustScaleFactors(t),t}}},{key:"_adjustScaleFactors",value:function(e){var t=_o(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.handle.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}},{key:"test",get:function(){var e=this;return{_adjustScaleFactors:function(t){return e._adjustScaleFactors(t)}}}}]),e}(),Do=i(34778),Lo=i(254),Go=i(12225),Io=i(29014);function Vo(e,t){return Wo(e,t,!1)}function zo(e,t){return Wo(e,t,!0)}function Wo(e,t,i){if(e instanceof Do.y){if(e.operation instanceof Lo.z)return function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?-1:1,n=(0,b.f)(i*e.dx,i*e.dy,i*e.dz);(0,P.a)(t.origin,t.origin,n)}(e.operation,t,i),!0;if(e.operation instanceof Go.S)return function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?-e.angle:e.angle;(0,P.H)(t.basis1,t.basis1,b.Z,i),(0,P.H)(t.basis2,t.basis2,b.Z,i)}(e.operation,t,i),!0;if(e.operation instanceof Io.q)return function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=i?1/e.factor1:e.factor1,a=i?1/e.factor2:e.factor2;(0,P.g)(t.basis1,t.basis1,n),(0,P.g)(t.basis2,t.basis2,a),(0,k.q)(t.origin,t.origin,e.origin,e.axis1,n),(0,k.q)(t.origin,t.origin,e.origin,e.axis2,a)}(e.operation,t,i),!0}return!1}function No(e,t,i,n){var a=wt.WM.get();(0,P.b)(a,(0,P.b)(a,e.origin,e.basis1),e.basis2);var r=wt.WM.get();(0,P.C)(r,a,e.basis1,2);var o=wt.WM.get();(0,P.C)(o,r,e.basis2,2);var s=wt.WM.get();(0,P.C)(s,a,e.basis2,2),a[2]=r[2]=o[2]=s[2]=t;var l=n?"on-the-ground":"absolute-height",c=(0,Ga.Fp)((0,H.bZ)(a,r,i,l),(0,H.bZ)(s,o,i,l)),h=(0,Ga.Fp)((0,H.bZ)(r,o,i,l),(0,H.bZ)(a,s,i,l));return(0,u.Wi)(h)||(0,u.Wi)(c)?null:[c,h]}var Fo=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).type="extent-rotate",n.angle=0,n}return(0,r.Z)(i)}(Ia.h);(0,l._)([(0,p.Cb)()],Fo.prototype,"type",void 0),(0,l._)([(0,p.Cb)()],Fo.prototype,"angle",void 0),Fo=(0,l._)([(0,v.j)("esri.views.interactive.tooltip.ExtentRotateTooltipInfo")],Fo);var Uo=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).type="extent-scale",n.xScale=0,n.yScale=0,n.xSize=Ga.yP,n.ySize=Ga.yP,n}return(0,r.Z)(i)}(Ia.h);(0,l._)([(0,p.Cb)()],Uo.prototype,"type",void 0),(0,l._)([(0,p.Cb)()],Uo.prototype,"xScale",void 0),(0,l._)([(0,p.Cb)()],Uo.prototype,"yScale",void 0),(0,l._)([(0,p.Cb)()],Uo.prototype,"xSize",void 0),(0,l._)([(0,p.Cb)()],Uo.prototype,"ySize",void 0),Uo=(0,l._)([(0,v.j)("esri.views.interactive.tooltip.ExtentScaleTooltipInfo")],Uo);var Ho=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).enableZ=!0,n.enableRotation=!0,n.enableScaling=!0,n.tooltipOptions=new Qi.Z,n._preserveAspectRatio=new Zo,n.grabbing=!1,n.inputState=null,n.type="transform-3d",n.handles=new ne.Z,n.moveZManipulator=null,n.resizeManipulators=null,n.rotateManipulator=null,n.attachmentOrigin=null,n.outlineVisualElement=null,n.mapBounds=(0,Dr.c)(),n.mapBoundsStart=(0,Dr.c)(),n.zmax=0,n.sizeStart=null,n.displayBounds=(0,Dr.c)(),n.displayBoundsStart=(0,Dr.c)(),n.displayBoundsMarginStart=0,n.resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],n._moveXYTooltipInfo=null,n._moveZTooltipInfo=null,n._rotateTooltipInfo=null,n._scaleTooltipInfo=null,n._startAngle=0,n._endAngle=0,n._startScale=(0,A.a)(),n._endScale=(0,A.a)(),n}return(0,r.Z)(i,[{key:"initialize",value:function(){var e=this,t=this.view,i=this.graphic,a=this.manipulators,r=this.handles,o=this.graphicState=new ji.F({graphic:i}),s=i.geometry;this.editGeometryOperations=Ra.c.fromGeometry(s,t.state.viewingMode),this.graphicMoveManipulation=new Aa({tool:this,view:t,graphicState:o}),this.moveZManipulator=function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Eo.CENTER_ON_ARROW)===Eo.CENTER_ON_CALLOUT?qr:0,i=[(0,b.f)(t,0,-24),(0,b.f)(t,0,24)],n=Mo(i,!0),a=function(e,t){return mo(i,i,{tubeRadius:3,tipRadius:11,tipLength:22.5,tubeFocusMultiplier:1.15,tipFocusMultiplier:1.15,padding:e,bothEnds:!0,flat:null,focusTipLength:!0,addCap:t})},r=a(0,!1),o=a(2.25,!0),s=new Gt.E({color:Ur,cullFace:et.Vr.Back,renderOccluded:rt.yD.Opaque}),l=new Gt.E({color:Hr,cullFace:et.Vr.Back,renderOccluded:rt.yD.Opaque}),c=new Gt.E({color:jr,cullFace:et.Vr.Back,renderOccluded:rt.yD.Opaque}),u=new Gt.E({color:Yr,transparent:!0,writeDepth:!1,cullFace:et.Vr.Front,renderOccluded:rt.yD.Transparent}),h=at.Z.createPolylineGeometry([[t,0,0],[t-qr,0,0]]),p=at.Z.createPolylineGeometry([[t,0,0],[t-qr,0,0]]),d=new po.Y({color:Br,renderOccluded:rt.yD.OccludeAndTransparent});return new dn({view:e,renderObjects:[].concat((0,M.Z)(r.normal.map((function(e){var t=e.part,i=e.geometry,n=e.transform;return{geometry:i,material:"tip"===t?s:"cap"===t?l:c,transform:n,stateMask:hn.Q9.Unfocused|xo}}))),(0,M.Z)(o.normal.map((function(e){var t=e.geometry,i=e.transform;return{geometry:t,material:u,transform:i,stateMask:hn.Q9.Unfocused|xo}}))),[{geometry:h,material:d,stateMask:hn.Q9.Unfocused|xo|Oo}],(0,M.Z)(r.focused.map((function(e){var t=e.part,i=e.geometry,n=e.transform;return{geometry:i,material:"tip"===t?s:"cap"===t?l:c,transform:n,stateMask:hn.Q9.Focused|xo}}))),(0,M.Z)(o.focused.map((function(e){var t=e.geometry,i=e.transform;return{geometry:t,material:u,transform:i,stateMask:hn.Q9.Focused|xo}}))),[{geometry:p,material:d,stateMask:hn.Q9.Focused|xo|Oo}]),autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[n]},collisionPriority:1,radius:11,state:xo})}(t,Eo.CENTER_ON_CALLOUT),this.moveZManipulator.state|=Oo,r.add([this._createMoveXYGraphicDragPipeline(),(0,h.YP)((function(){return e.enableZ}),(function(){return e._updateManipulatorAvailability(e.moveZManipulator,Gn.TRANSLATE_Z)})),this._createMoveZDragPipeline()]),a.add(this.moveZManipulator),this.resizeManipulators=this.resizeHandles.map((function(i){var n=yo(t,i);return r.add([(0,h.YP)((function(){return e.enableScaling}),(function(){return e._updateManipulatorAvailability(n,Gn.SCALE)})),n.events.on("grab-changed",(function(t){return e._onResizeGrab(t)})),e._createResizeDragPipeline(n,i)]),n})),a.addMany(this.resizeManipulators),this.rotateManipulatorTexture=function(e){return e.fromData(To,(function(){return new xt.x(To,Ro)}))}(t.toolViewManager.textures),this.rotateManipulator=function(e,t){var i=new co({transparent:!0,writeDepth:!1,textureId:t.id,renderOccluded:rt.yD.Opaque}),n=40,a=27*1.1,r=function(e){var t=new Uint32Array([0,1,2,2,3,0]);return new Lt.Z([[_e.T.POSITION,{size:3,data:[n-e,-e,0,n+e,-e,0,n+e,e,0,n-e,e,0],exclusive:!0}],[_e.T.UV0,{size:2,data:[0,0,1,0,1,1,0,1]}]],[[_e.T.POSITION,t],[_e.T.UV0,t]])},o=at.Z.createPolylineGeometry([[0,0,0],[13,0,0]]),s=at.Z.createPolylineGeometry([[0,0,0],[n-a,0,0]]),l=new po.Y({color:Fr,renderOccluded:rt.yD.OccludeAndTransparent}),c=[{geometry:r(27),material:i,stateMask:hn.Q9.Unfocused|xo},{geometry:o,material:l,stateMask:hn.Q9.Unfocused|xo},{geometry:r(a),material:i,stateMask:hn.Q9.Focused|xo},{geometry:s,material:l,stateMask:hn.Q9.Focused|xo}];return new dn({view:e,renderObjects:c,autoScaleRenderObjects:!1,collisionType:{type:"disc",direction:[0,0,1],offset:[n,0,0]},collisionPriority:1,radius:13.5,state:xo})}(t,this.rotateManipulatorTexture.texture),r.add([(0,h.YP)((function(){return e.enableRotation}),(function(){return e._updateManipulatorAvailability(e.rotateManipulator,Gn.ROTATE)})),this.rotateManipulator.events.on("grab-changed",(function(t){e._onRotateGrab(t)})),this._createRotateDragPipeline(this.rotateManipulator)]),a.add(this.rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();var l=Xn({view:t,graphic:i,forEachManipulator:function(t){return e._forEachManipulator(t)},onManipulatorsChanged:function(){return(0,c.kB)()}});(0,u.pC)(l)&&(this.outlineVisualElement=l.visualElement instanceof mi?l.visualElement:null),(0,u.pC)(this.outlineVisualElement)&&r.add(this.outlineVisualElement.events.on("attachment-origin-changed",(function(){return e._updateDisplayBounds()}))),r.add(l),r.add([o.on("changed",(function(){return e._onGeometryChanged()})),(0,h.YP)((function(){return o.displaying}),(function(){return e._updateAllManipulatorAvailability()})),(0,h.YP)((function(){return o.isDraped}),(function(){return e._graphicDrapedChanged()}),h.nn),t.trackGraphicState(o)]);var p=t.pointsOfInterest;p&&r.add((0,h.YP)((function(){return p.centerOnSurfaceFrequent.location}),(function(){return e._updateDisplayBounds()})));this._forEachManipulator((function(t){r.add(t.events.on("grab-changed",(function(){e.grabbing=t.grabbing,e._updateAllManipulatorAvailability()})))}));this._forEachManipulator((function(t,a){r.add(t.events.on("immediate-click",(function(t){a===Gn.TRANSLATE_XY&&e.emit("immediate-click",(0,n.Z)((0,n.Z)({},t),{},{graphic:i})),t.stopPropagation()})))})),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this._initializeTooltip(),this.finishToolCreation()}},{key:"destroy",value:function(){this.mapBounds=null,this.displayBounds=null,this.rotateManipulatorTexture.release(),this.handles.destroy(),this.graphicMoveManipulation.destroy(),this.editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}},{key:"_initializeTooltip",value:function(){var e=this,t=this.handles,i=this.view,n=this._tooltip=new La.u({view:i}),a=function(){n.info=e._getUpdatedTooltipInfo()};t.add([this.on("graphic-translate-start",a),this.on("graphic-translate",a),this.on("graphic-translate-stop",(function(){e._moveXYTooltipInfo=null,e._moveZTooltipInfo=null,e._tooltip.clear()})),this.on("graphic-rotate-start",(function(t){e._startAngle=t.angle,a()})),this.on("graphic-rotate",(function(t){e._endAngle=t.angle,a()})),this.on("graphic-rotate-stop",(function(){e._startAngle=0,e._endAngle=0,a()})),this.on("graphic-scale-start",(function(t){(0,k.a)(e._startScale,t.xScale,t.yScale),(0,k.a)(e._endScale,t.xScale,t.yScale),a()})),this.on("graphic-scale",(function(t){(0,k.a)(e._endScale,t.xScale,t.yScale),a()})),this.on("graphic-scale-stop",(function(){(0,k.a)(e._startScale,0,0),(0,k.a)(e._endScale,0,0),a()}))]),this._forEachManipulator((function(i){t.add([i.events.on("focus-changed",a),i.events.on("grab-changed",a),i.events.on("drag",(function(t){"cancel"===t.action?e._tooltip.clear():a()}))])}))}},{key:"_getUpdatedTooltipInfo",value:function(){return this.tooltipOptions.enabled?this.graphicMoveManipulation.grabbing||this.graphicMoveManipulation.dragging?this._computeMoveXYTooltipInfo():this.moveZManipulator.focused?this._computeMoveZTooltipInfo():this.rotateManipulator.focused?this._computeRotateTooltipInfo():this.resizeManipulators.some((function(e){return e.focused}))?this._computeScaleTooltipInfo():null:null}},{key:"_computeMoveXYTooltipInfo",value:function(){var e=this;return this._moveXYTooltipInfo=(0,u.Pt)(this._moveXYTooltipInfo,(function(){return new Va({tooltipOptions:e.tooltipOptions})}))}},{key:"_computeMoveZTooltipInfo",value:function(){var e=this,t=this._moveZTooltipInfo=(0,u.Pt)(this._moveZTooltipInfo,(function(){return new za({tooltipOptions:e.tooltipOptions})})),i=this._moveUnit;if(this.moveZManipulator.dragging){var n=this.mapBoundsStart.origin,a=this.mapBounds.origin,r=(0,Na.Cr)(n,a,this.view.spatialReference);if((0,u.Wi)(r))return null;t.distance=r}else t.distance=(0,Ga.yG)(0,i);return t}},{key:"_computeRotateTooltipInfo",value:function(){var e=this,t=this._rotateTooltipInfo=(0,u.Pt)(this._rotateTooltipInfo,(function(){return new Fo({tooltipOptions:e.tooltipOptions})}));return t.angle=this._startAngle-this._endAngle,t}},{key:"_computeScaleTooltipInfo",value:function(){var e=this,t=this.graphic.geometry;if((0,u.Wi)(t))return null;var i=this._scaleTooltipInfo=(0,u.Pt)(this._scaleTooltipInfo,(function(){return new Uo({tooltipOptions:e.tooltipOptions})})),n=No(this.mapBounds,this.zmax,t.spatialReference,this.graphicState.isDraped);return(0,u.Wi)(n)?null:(i.xSize=n[0],i.ySize=n[1],(0,u.pC)(this.sizeStart)&&this.resizeManipulators.some((function(e){return e.dragging}))?(i.xScale=n[0].value/this.sizeStart[0].value,i.yScale=n[1].value/this.sizeStart[1].value):(i.xScale=1,i.yScale=1),i)}},{key:"_graphicDrapedChanged",value:function(){var e=this;this.handles.remove(jo),this._updateDisplayBounds(),this.graphicState.isDraped&&this.handles.add(this.view.elevationProvider.on("elevation-change",(function(t){(0,u.pC)(e.attachmentOrigin)&&(0,sn.jE)(t.extent,e.attachmentOrigin.x,e.attachmentOrigin.y)&&e._updateDisplayBounds()})),jo)}},{key:"_updateAllManipulatorAvailability",value:function(){var e=this;this._forEachManipulator((function(t,i){return e._updateManipulatorAvailability(t,i)}))}},{key:"_updateManipulatorAvailability",value:function(e,t){var i=this.grabbing&&!e.grabbing;if(e.interactive=!i,e instanceof dn){var n=this.graphicState.displaying,a=this.enableZ&&zn(this.graphic);switch(t){case Gn.ROTATE:e.available=n&&this.enableRotation;break;case Gn.SCALE:e.available=n&&(this.enableScaling||this.enableRotation||a),e.interactive=!i&&this.enableScaling,e.state=this.enableScaling?Ao:Po;break;case Gn.TRANSLATE_Z:e.available=n&&a;break;default:e.available=n}}}},{key:"_forEachManipulator",value:function(e){this.graphicMoveManipulation.forEachManipulator(e),this.resizeManipulators.forEach((function(t){return e(t,Gn.SCALE)})),e(this.rotateManipulator,Gn.ROTATE),e(this.moveZManipulator,Gn.TRANSLATE_Z)}},{key:"preserveAspectRatio",get:function(){return this._preserveAspectRatio.enabled},set:function(e){this._preserveAspectRatio.enabled=e,this._set("preserveAspectRatio",e)}},{key:"_moveUnit",get:function(){return(0,u.Pt)((0,O.j5)(this.view.spatialReference),"meters")}},{key:"reset",value:function(){}},{key:"_onGeometryChanged",value:function(){this._updateDisplayBounds()}},{key:"_calculateMapBounds",value:function(){var e=this.graphic.geometry,t=this.editGeometryOperations.data,i=t.components[0].edges[0],n=(0,k.g)(wt.qW.get(),i.leftVertex.pos,i.rightVertex.pos);(0,k.i)(n,n);var a=(0,u.Pt)(Dn(this.view,this.graphic),(function(){return e.extent.center})),r=Yo*this.view.pixelSizeAt(a),o=this.view.spatialReference,s=e.spatialReference;o.equals(s)||(r*=(0,O.c9)(o)/(0,O.c9)(s)),function(e,t,i,n){n||(n=(0,Dr.c)());var a=(0,k.a)(wt.qW.get(),e[1],-e[0]),r=(0,k.a)(wt.qW.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o=(0,k.a)(wt.qW.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),s=wt.qW.get();t.components.forEach((function(t){return t.vertices.forEach((function(t){var i=t.pos;(0,k.a)(s,(0,k.h)(e,i),(0,k.h)(a,i)),(0,k.x)(r,r,s),(0,k.y)(o,o,s)}))}));var l=1e-6,c=(0,k.a)(wt.qW.get(),o[0]-r[0]<l?i/2:0,o[1]-r[1]<l?i/2:0);(0,k.g)(r,r,c),(0,k.b)(o,o,c),(0,k.f)(n.basis1,e,(o[0]-r[0])/2),(0,k.f)(n.basis2,a,(o[1]-r[1])/2),(0,k.a)(n.origin,r[0]*e[0]+r[1]*a[0],r[0]*e[1]+r[1]*a[1]),(0,k.b)(n.origin,n.origin,n.basis1),(0,k.b)(n.origin,n.origin,n.basis2)}(n,t,r,this.mapBounds),this._calculateZMax()}},{key:"_calculateZMax",value:function(){var e=this.editGeometryOperations.data;if(e.geometry.hasZ){var t,i=e.coordinateHelper,n=Number.NEGATIVE_INFINITY,a=(0,Z.Z)(e.components);try{for(a.s();!(t=a.n()).done;){var r,o=t.value,s=(0,Z.Z)(o.vertices);try{for(s.s();!(r=s.n()).done;){var l=r.value,c=i.getZ(l.pos);n=Math.max(c,n)}}catch(u){s.e(u)}finally{s.f()}}}catch(u){a.e(u)}finally{a.f()}this.zmax=n}else this.zmax=0}},{key:"_updateDisplayBounds",value:function(){var e=this.graphic.geometry;if(!(0,u.Wi)(e)){var t=(0,u.pC)(this.outlineVisualElement)&&!this.graphicState.isDraped&&(0,u.pC)(this.outlineVisualElement.attachmentOrigin)?this.outlineVisualElement.attachmentOrigin:Dn(this.view,this.graphic);this.attachmentOrigin=(0,u.Pt)(t,e.extent.center);var i=(0,u.pC)(t)?t.z:(0,Ot.w7)(this.mapBounds.origin,this.view.elevationProvider,kt.o.fromElevationInfo((0,g.RL)(this.graphic)),this.view.renderCoordsHelper),n=(0,Dr.a)(this.mapBounds);n.origin[2]=i,function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4?arguments[4]:void 0;a||(a=(0,Dr.c)()),t.toRenderCoords(e.origin,i,a.origin);var r=wt.WM.get();(0,P.a)(r,e.origin,e.basis1),(0,P.a)(r,r,e.basis2),t.toRenderCoords(r,i,r);var o=wt.WM.get();(0,P.a)(o,e.origin,e.basis1),(0,P.b)(o,o,e.basis2),t.toRenderCoords(o,i,o);var s=wt.WM.get();(0,P.b)(s,e.origin,e.basis1),(0,P.b)(s,s,e.basis2),t.toRenderCoords(s,i,s);var l=wt.WM.get();(0,P.b)(l,e.origin,e.basis1),(0,P.a)(l,l,e.basis2),t.toRenderCoords(l,i,l);var c=(0,P.h)(wt.WM.get(),r,o,.5);(0,P.b)(c,c,a.origin);var u=(0,P.h)(wt.WM.get(),s,l,.5);(0,P.b)(u,a.origin,u),(0,P.h)(a.basis1,c,u,.5);var h=(0,P.h)(wt.WM.get(),l,r,.5);(0,P.b)(h,h,a.origin);var p=(0,P.h)(wt.WM.get(),o,s,.5);(0,P.b)(p,a.origin,p),(0,P.h)(a.basis2,h,p,.5);var d=(0,P.f)(wt.WM.get(),a.basis1,a.basis2),f=(0,P.f)(d,d,a.basis1);(0,P.n)(f,f),(0,P.g)(a.basis2,f,(0,P.e)(a.basis2,f)),(0,P.g)(a.basis1,a.basis1,1+n/(0,P.l)(a.basis1)),(0,P.g)(a.basis2,a.basis2,1+n/(0,P.l)(a.basis2)),(0,Dr.u)(a)}(n,this.view.renderCoordsHelper,e.spatialReference,this.displayBoundsMargin,this.displayBounds),this._updateManipulators()}}},{key:"displayBoundsMargin",get:function(){var e=this.view.pointsOfInterest,t=e?e.centerOnSurfaceFrequent.location:this.editGeometryOperations.data.geometry.extent.center;return Bo*this.view.pixelSizeAt(t)}},{key:"_createMoveXYGraphicDragPipeline",value:function(){var e=this;return this.graphicMoveManipulation.createDragPipeline((function(t,i,n){return e._applyGraphicMoveSteps(i,n,ya.XY)}))}},{key:"_createMoveZDragPipeline",value:function(){var e=this,t=this.view,i=this.editGeometryOperations.data.spatialReference;return(0,ra.Xd)(this.moveZManipulator,(function(n,a,r){var o=(0,b.a)(n.renderLocation),s=a.next(ha(t,o,i)).next((0,ra.zh)());e._applyGraphicMoveSteps(s,r,ya.Z)}))}},{key:"_applyGraphicMoveSteps",value:function(e,t,i){var n=this,a=e.next((function(e){return"start"===e.action&&(n.inputState={type:"move"},(0,Dr.a)(n.mapBounds,n.mapBoundsStart),n._calculateSizeStart(),n.emit("graphic-translate-start",{graphic:n.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY})),e})).next((0,ra.AN)()).next(this._moveDragUpdateGeometry()).next((function(e){var t={graphic:n.graphic,dxScreen:e.screenDeltaX,dyScreen:e.screenDeltaY};switch(e.action){case"start":case"update":(e.mapEnd.x-e.mapStart.x||e.mapEnd.y-e.mapStart.y||e.mapEnd.z-e.mapStart.z)&&n.emit("graphic-translate",t);break;case"end":n.inputState=null,n.emit("graphic-translate-stop",t)}return e})).next((function(e){return n._updateMoveTooltip(e,i)}));return t.next((function(){(0,u.pC)(n.inputState)&&n.emit("graphic-translate-stop",{graphic:n.graphic,dxScreen:0,dyScreen:0}),n._cancel()})),a}},{key:"_calculateSizeStart",value:function(){(0,u.Wi)(this.graphic.geometry)?this.sizeStart=null:this.sizeStart=No(this.mapBoundsStart,this.zmax,this.graphic.geometry.spatialReference,this.graphicState.isDraped)}},{key:"_moveDragUpdateGeometry",value:function(){var e=this;return function(t){if((0,u.Wi)(e.inputState)||"move"!==e.inputState.type)return t;var i,n=[],a=(0,Z.Z)(e.editGeometryOperations.data.components);try{for(a.s();!(i=a.n()).done;){var r=i.value;n.push.apply(n,(0,M.Z)(r.vertices))}}catch(s){a.e(s)}finally{a.f()}var o="start"===t.action?tr.O.NEW_STEP:tr.O.ACCUMULATE_STEPS;return Vo(e.editGeometryOperations.moveVertices(n,t.mapDeltaX,t.mapDeltaY,t.mapDeltaZ,o),e.mapBounds),e.graphic.geometry=e.editGeometryOperations.data.geometry,t}}},{key:"_updateMoveTooltip",value:function(e,t){if(t===ya.XY||t===ya.XY_AXIS){var i=(0,H.GQ)(e.mapStart,e.mapEnd,this.graphicState.isDraped?"on-the-ground":"absolute-height");(0,u.pC)(i)&&(0,u.pC)(this._moveXYTooltipInfo)&&(this._moveXYTooltipInfo.distance=i)}return e}},{key:"_onResizeGrab",value:function(e){if("start"===e.action){var t=this._calculatePickRay(e.screenPoint);(0,de.BR)(this.displayBounds.plane,t,wt.WM.get())&&((0,Dr.a)(this.displayBounds,this.displayBoundsStart),(0,Dr.a)(this.mapBounds,this.mapBoundsStart),this._calculateSizeStart(),this.displayBoundsMarginStart=this.displayBoundsMargin,this.inputState={type:"resize"})}}},{key:"_createResizeDragPipeline",value:function(e,t){var i=this;return(0,ra.Xd)(e,(function(e,a,r){(0,u.Wi)(i.inputState)||(a.next((function(e){return"start"===e.action&&i.emit("graphic-scale-start",{graphic:i.graphic,xScale:1,yScale:1}),e})).next(oa(i.view,i.displayBoundsStart.plane)).next((function(e){return(0,n.Z)((0,n.Z)({},e),{},{handle:t})})).next(i._resizeDragRenderPlaneToFactors()).next(i._preserveAspectRatio.createDragEventPipelineStep(),i._preserveAspectRatio.next).next(i._resizeDragUpdateGeometry()).next((function(e){var t={graphic:i.graphic,xScale:e.factor1,yScale:e.factor2};switch(e.action){case"start":case"update":i.emit("graphic-scale",t);break;case"end":i.inputState=null,i.emit("graphic-scale-stop",t)}return e})),r.next((function(){(0,u.pC)(i.inputState)&&i.emit("graphic-scale-stop",{graphic:i.graphic,xScale:1,yScale:1}),i._cancel()})))}))}},{key:"_resizeDragRenderPlaneToFactors",value:function(){var e=this;return function(t){var i=e.displayBoundsStart,a=t.handle.direction,r=e.displayBoundsMargin,o=e.displayBoundsMarginStart,s=(0,P.c)(wt.WM.get(),i.origin);(0,P.C)(s,s,i.basis1,-a[0]),(0,P.C)(s,s,i.basis2,-a[1]);var l=(0,P.b)(wt.WM.get(),t.renderEnd,s),c=(0,P.b)(wt.WM.get(),t.renderStart,s),u=_o(t.handle),h=go(i),p=go(e.displayBounds)/h,d=function(e,t){if(0===e)return 1;var i=(0,P.l)(t),n=.5*e*(0,P.e)(t,l)/i,a=n<0?-1:1;u&&(n+=(i-.5*e*(0,P.e)(t,c)/i)*a*p);var s=i<1.5*o?1:qo;return i=Math.max(i-o,qo),a>0&&(n-=r),a*Math.max(a*(n/i),s)};return(0,n.Z)((0,n.Z)({},t),{},{factor1:d(a[0],i.basis1),factor2:d(a[1],i.basis2)})}}},{key:"_resizeDragUpdateGeometry",value:function(){var e=this;return function(t){var i=(0,P.c)((0,b.c)(),e.mapBoundsStart.origin);(0,P.C)(i,i,e.mapBoundsStart.basis1,-t.handle.direction[0]),(0,P.C)(i,i,e.mapBoundsStart.basis2,-t.handle.direction[1]);var n=(0,k.a)((0,A.a)(),e.mapBoundsStart.basis1[0],e.mapBoundsStart.basis1[1]);(0,k.i)(n,n);var a,r=[],o=(0,Z.Z)(e.editGeometryOperations.data.components);try{for(o.s();!(a=o.n()).done;){var s=a.value;r.push.apply(r,(0,M.Z)(s.vertices))}}catch(u){o.e(u)}finally{o.f()}var l="start"===t.action?tr.O.NEW_STEP:tr.O.ACCUMULATE_STEPS,c=e.editGeometryOperations.scaleVertices(r,i,n,t.factor1,t.factor2,l,Do.w.REPLACE);return(0,Dr.a)(e.mapBoundsStart,e.mapBounds),Vo(c,e.mapBounds),e.graphic.geometry=e.editGeometryOperations.data.geometry,t}}},{key:"_onRotateGrab",value:function(e){if("start"===e.action){var t=function(e,t,i,n){var a=t.worldUpAtPosition(e.origin,wt.WM.get()),r=wt.WM.get();switch(i){case wo.HEADING:(0,P.c)(r,a);break;case wo.TILT:(0,P.c)(r,e.basis1)}return(0,de.Yq)(e.origin,r,n)}(this.displayBounds,this.view.renderCoordsHelper,wo.HEADING,(0,de.Ue)()),i=this._calculatePickRay(e.screenPoint);(0,de.BR)(t,i,wt.WM.get())&&((0,Dr.a)(this.displayBounds,this.displayBoundsStart),(0,Dr.a)(this.mapBounds,this.mapBoundsStart),this._calculateSizeStart(),this.inputState={type:"rotate",rotatePlane:t})}}},{key:"_createRotateDragPipeline",value:function(e){var t=this;return(0,ra.Xd)(e,(function(e,i,n){var a=t.inputState;(0,u.Wi)(a)||(i.next((function(e){return"start"===e.action&&t.emit("graphic-rotate-start",{graphic:t.graphic,angle:0}),e})).next(oa(t.view,a.rotatePlane)).next(t._rotateDragRenderPlaneToRotate(a)).next(t._rotateDragUpdateGeometry()).next((function(e){var i={graphic:t.graphic,angle:(0,he.BV)(e.rotateAngle)};switch(e.action){case"start":case"update":t.emit("graphic-rotate",i);break;case"end":t.inputState=null,t.emit("graphic-rotate-stop",i)}return e})),n.next((function(){(0,u.pC)(t.inputState)&&t.emit("graphic-rotate-stop",{graphic:t.graphic,angle:0}),t._cancel()})))}))}},{key:"_rotateDragRenderPlaneToRotate",value:function(e){var t=this;return function(i){var a=(0,de.mJ)(e.rotatePlane),r=Rn(i.renderStart,i.renderEnd,t.displayBounds.origin,a);return(0,n.Z)((0,n.Z)({},i),{},{rotateAxis:a,rotateAngle:r})}}},{key:"_rotateDragUpdateGeometry",value:function(){var e=this;return function(t){var i,n=(0,P.c)((0,b.c)(),e.mapBoundsStart.origin),a=[],r=(0,Z.Z)(e.editGeometryOperations.data.components);try{for(r.s();!(i=r.n()).done;){var o=i.value;a.push.apply(a,(0,M.Z)(o.vertices))}}catch(c){r.e(c)}finally{r.f()}var s="start"===t.action?tr.O.NEW_STEP:tr.O.ACCUMULATE_STEPS,l=e.editGeometryOperations.rotateVertices(a,n,t.rotateAngle,s,Do.w.REPLACE);return(0,Dr.a)(e.mapBoundsStart,e.mapBounds),Vo(l,e.mapBounds),e.graphic.geometry=e.editGeometryOperations.data.geometry,t}}},{key:"_calculatePickRay",value:function(e){var t=(0,ce.Ue)(),i=(0,y.md)(e);return cn(this.view.state.camera,i,t),(0,P.n)(t.direction,t.direction),t}},{key:"_updateManipulators",value:function(){var e=this;if(this.visible){var t=function(e,t){return Zn(e.basis1,e.basis2,e.origin,t)}(this.displayBounds,wt.MP.get());(function(e,t,i,n){var a=n.worldUpAtPosition(i.origin,wt.WM.get()),r=fo(i,lo.POSITIVE_X),o=(0,Ke.b)(wt.MP.get(),r.edge*Math.PI/2);(0,Ke.r)(o,o,-So(i,a)),(0,Ke.m)(o,t,o),o[12]=0,o[13]=0,o[14]=0,e.modelTransform=o,e.renderLocation=r.position})(this.rotateManipulator,t,this.displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this.moveZManipulator,t),this.resizeManipulators.forEach((function(i,n){!function(e,t,i,n){var a=(0,P.l)(n.basis1),r=(0,P.l)(n.basis2),o=vo(n),s=go(n),l=(0,P.s)(wt.WM.get(),0,0,0);(0,P.a)(l,(0,P.g)(wt.WM.get(),n.basis1,t.direction[0]),(0,P.g)(wt.WM.get(),n.basis2,t.direction[1])),(0,P.a)(l,n.origin,l);var c=0,u=1;if(_o(t))1===t.direction[0]&&-1===t.direction[1]?c=ko:1===t.direction[0]&&1===t.direction[1]?c=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(c=3*Math.PI/2),u=s;else{var h=0!==t.direction[0]?1:2;c=1===h?ko:0,u=(1===h?r:a)-o}var p=(0,Ke.b)(wt.MP.get(),c);(0,Ke.h)(p,p,(0,P.s)(wt.WM.get(),u,u,u)),(0,Ke.m)(p,i,p),p[12]=0,p[13]=0,p[14]=0,e.modelTransform=p,e.renderLocation=l}(i,e.resizeHandles[n],t,e.displayBounds)}))}}},{key:"_updateZMoveHandle",value:function(e,t){var i=this.displayBounds,n={basis:i.basis1,direction:-1,position:(0,P.b)(wt.WM.get(),i.origin,i.basis1),edge:2},a=wt.MP.get();(0,Ke.g)(a,t,n.edge*Math.PI/2),a[12]=0,a[13]=0,a[14]=0,e.modelTransform=a,e.renderLocation=n.position}},{key:"_cancel",value:function(){var e=this.editGeometryOperations.lastOperation;(0,u.Wi)(e)||(this.editGeometryOperations.undo(),this.graphic.geometry=this.editGeometryOperations.data.geometry,zo(e,this.mapBounds),this._updateDisplayBounds(),this.inputState=null)}},{key:"canUndo",get:function(){return this.editGeometryOperations.canUndo}},{key:"undo",value:function(){if((0,u.pC)(this.inputState))this.view.activeTool=null;else if(this.canUndo){var e=this.editGeometryOperations.undo();this.graphic.geometry=this.editGeometryOperations.data.geometry,zo((0,u.Wg)(e),this.mapBounds),this._updateDisplayBounds()}}},{key:"canRedo",get:function(){return this.editGeometryOperations.canRedo}},{key:"redo",value:function(){if(this.canRedo){var e=this.editGeometryOperations.redo();this.graphic.geometry=this.editGeometryOperations.data.geometry,Vo((0,u.Wg)(e),this.mapBounds),this._updateDisplayBounds()}}},{key:"test",get:function(){return{resizeManipulators:this.resizeManipulators,rotateManipulator:this.rotateManipulator,moveZManipulator:this.moveZManipulator,tooltip:this._tooltip}}}]),i}(ci.Z.EventedMixin(Ta.m));(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],Ho.prototype,"view",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],Ho.prototype,"graphic",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,nonNullable:!0})],Ho.prototype,"enableZ",void 0),(0,l._)([(0,p.Cb)()],Ho.prototype,"enableRotation",void 0),(0,l._)([(0,p.Cb)()],Ho.prototype,"enableScaling",void 0),(0,l._)([(0,p.Cb)({constructOnly:!0,type:Qi.Z})],Ho.prototype,"tooltipOptions",void 0),(0,l._)([(0,p.Cb)()],Ho.prototype,"preserveAspectRatio",null),(0,l._)([(0,p.Cb)()],Ho.prototype,"grabbing",void 0),(0,l._)([(0,p.Cb)()],Ho.prototype,"inputState",void 0),(0,l._)([(0,p.Cb)({readOnly:!0})],Ho.prototype,"type",void 0),(0,l._)([(0,p.Cb)()],Ho.prototype,"_moveUnit",null),Ho=(0,l._)([(0,v.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],Ho);var jo="draped-elevation-changes",Bo=10,Yo=80,qo=1e-6},8084:function(e,t,i){i.d(t,{j:function(){return m}});var n,a,r,o,s,l,c=i(30168),u=i(92026),h=i(21002),p=i(96415),d=i(82999),f=i(49450),v=i(58406),g=i(98634),_=i(19253),y=i(2104);function m(e,t){e.extensions.add("GL_OES_standard_derivatives");var i=e.fragment;i.include(h.S),e.include(p.G),i.uniforms.add([new v.p("globalAlpha",(function(e){return e.globalAlpha})),new f.J("glowColor",(function(e){return e.glowColor})),new v.p("glowWidth",(function(e,t){return e.glowWidth*t.camera.pixelRatio})),new v.p("glowFalloff",(function(e){return e.glowFalloff})),new f.J("innerColor",(function(e){return e.innerColor})),new v.p("innerWidth",(function(e,t){return e.innerWidth*t.camera.pixelRatio})),new _.A("depthMap",(function(e,t){return t.linearDepthTexture})),new d.A("nearFar",(function(e,t){return t.camera.nearFar})),new y.Q("frameColor")]),i.code.add((0,g.H)(n||(n=(0,c.Z)(["vec4 blendPremultiplied(vec4 source, vec4 dest) {\nfloat oneMinusSourceAlpha = 1.0 - source.a;\nreturn vec4(\nsource.rgb + dest.rgb * oneMinusSourceAlpha,\nsource.a + dest.a * oneMinusSourceAlpha\n);\n}"])))),i.code.add((0,g.H)(a||(a=(0,c.Z)(["vec4 premultipliedColor(vec3 rgb, float alpha) {\nreturn vec4(rgb * alpha, alpha);\n}"])))),i.code.add((0,g.H)(r||(r=(0,c.Z)(["vec4 laserlineProfile(float dist) {\nif (dist > glowWidth) {\nreturn vec4(0.0);\n}\nfloat innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));\nfloat glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);\nreturn blendPremultiplied(\npremultipliedColor(innerColor, innerAlpha),\npremultipliedColor(glowColor, glowAlpha)\n);\n}"])))),i.code.add((0,g.H)(o||(o=(0,c.Z)(["bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {\nfloat depth = linearDepthFromTexture(depthMap, uv, nearFar);\nif (-depth == nearFar[0]) {\nreturn false;\n}\npos = reconstructPosition(gl_FragCoord.xy, depth);\nnormal = normalize(cross(dFdx(pos), dFdy(pos)));\nfloat ddepth = fwidth(depth);\ndepthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\nreturn true;\n}"])))),t.contrastControlEnabled?(i.uniforms.add(new v.p("globalAlphaContrastBoost",(function(e){return(0,u.pC)(e.globalAlphaContrastBoost)?e.globalAlphaContrastBoost:1}))),i.code.add((0,g.H)(s||(s=(0,c.Z)(["float rgbToLuminance(vec3 color) {\nreturn dot(vec3(0.2126, 0.7152, 0.0722), color);\n}\nvec4 laserlineOutput(vec4 color) {\nfloat backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);\nfloat alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);\nreturn color * alpha;\n}"]))))):i.code.add((0,g.H)(l||(l=(0,c.Z)(["vec4 laserlineOutput(vec4 color) {\nreturn color * globalAlpha;\n}"]))))}},43505:function(e,t,i){i.d(t,{A:function(){return l}});var n,a=i(30168),r=i(82552),o=i(58406),s=i(98634);function l(e,t){if(t.screenSizeEnabled){var i=e.vertex;(0,r.h)(i,t),i.uniforms.add(new o.p("perScreenPixelRatio",(function(e,t){return t.camera.perScreenPixelRatio}))),i.uniforms.add(new o.p("screenSizeScale",(function(e){return e.screenSizeScale}))),i.code.add((0,s.H)(n||(n=(0,a.Z)(["float computeRenderPixelSizeAt( vec3 pWorld ){\nvec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);\nfloat viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));\nreturn viewDirectionDistance * perScreenPixelRatio;\n}\nvec3 screenSizeScaling(vec3 position, vec3 anchor){\nreturn position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;\n}"]))))}}},86360:function(e,t,i){i.d(t,{K:function(){return s}});var n=i(43144),a=i(15671),r=i(60136),o=i(54062),s=function(e){(0,r.Z)(i,e);var t=(0,o.Z)(i);function i(e){return(0,a.Z)(this,i),t.call(this,e,"vec3")}return(0,n.Z)(i)}(i(61809).x)},2346:function(e,t,i){i.d(t,{L:function(){return w}});var n=i(15671),a=i(43144),r=i(60136),o=i(54062),s=i(27366),l=i(85015),c=i(91505),u=i(92026),h=i(94172),p=i(17842),d=i(49861),f=(i(63780),i(93169),i(25243),i(69912)),v=i(88396),g=i(11186),_=i(71353),y=i(79803),m=i(74509),b=i(61574),M=i(64575),S=i(45008),w=function(e){(0,r.Z)(i,e);var t=(0,o.Z)(i);function i(e){var a;return(0,n.Z)(this,i),(a=t.call(this,e)).layer=null,a.interactive=!0,a.selectable=!1,a.grabbable=!0,a.dragging=!1,a.cursor=null,a.events=new c.Z.EventEmitter,a._circleCollisionCache=null,a._graphicSymbolChangedHandle=null,a._originalSymbol=null,a}return(0,a.Z)(i,[{key:"graphic",set:function(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}},{key:"elevationInfo",get:function(){var e="elevationInfo"in this.graphic.layer&&this.graphic.layer.elevationInfo,t=(0,m.vu)(this.graphic),i=e?e.offset:0;return new M.ZP({mode:t,offset:i})}},{key:"focusedSymbol",set:function(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}},{key:"grabbableForEvent",value:function(){return!0}},{key:"grabbing",set:function(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}},{key:"hovering",set:function(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}},{key:"selected",set:function(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}},{key:"_focused",get:function(){return this._get("hovering")||this._get("grabbing")}},{key:"destroy",value:function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}},{key:"intersectionDistance",value:function(e){var t=this.graphic;if(!1===t.visible)return null;var i=t.geometry;if((0,u.Wi)(i))return null;var n=this._get("focusedSymbol"),a=(0,u.pC)(n)?n:t.symbol;return"2d"===this.view.type?this._intersectDistance2D(this.view,e,i,a):this._intersectDistance3D(this.view,e,t)}},{key:"attach",value:function(){this.attachSymbolChanged(),(0,u.pC)(this.layer)&&this.layer.add(this.graphic)}},{key:"detach",value:function(){this.detachSymbolChanged(),this._resetGraphicSymbol(),(0,u.pC)(this.layer)&&this.layer.remove(this.graphic)}},{key:"attachSymbolChanged",value:function(){var e=this;this.detachSymbolChanged(),this._graphicSymbolChangedHandle=(0,h.YP)((function(){var t;return null===(t=e.graphic)||void 0===t?void 0:t.symbol}),(function(t){(0,u.pC)(t)&&t!==e.focusedSymbol&&t!==e._originalSymbol&&(e._originalSymbol=t,e._focused&&(0,u.pC)(e.focusedSymbol)&&(e.graphic.symbol=e.focusedSymbol))}),h.Z_)}},{key:"detachSymbolChanged",value:function(){(0,u.pC)(this._graphicSymbolChangedHandle)&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}},{key:"_updateGraphicSymbol",value:function(){this.graphic.symbol=this._focused&&(0,u.pC)(this.focusedSymbol)?this.focusedSymbol:this._originalSymbol}},{key:"_resetGraphicSymbol",value:function(){this.graphic.symbol=this._originalSymbol}},{key:"_intersectDistance2D",value:function(e,t,i,n){if(n=n||(0,b.js)(i),(0,u.Wi)(n))return null;var a=this._circleCollisionCache;if("point"!==i.type||"simple-marker"!==n.type)return(0,S.D)(t,i,e)?1:null;if((0,u.Wi)(a)||!a.originalPoint.equals(i)){var r=i,o=e.spatialReference;if((0,y.Up)(r.spatialReference,o)){var s=(0,y.iV)(r,o);a={originalPoint:r.clone(),mapPoint:s,radiusPx:(0,p.F2)(n.size)},this._circleCollisionCache=a}}if((0,u.pC)(a)){var l=(0,p.md)(t,x),c=e.toScreen(a.mapPoint),h=a.radiusPx,d=c.x+(0,p.F2)(n.xoffset),f=c.y-(0,p.F2)(n.yoffset);return(0,v.s)(l,[d,f])<h*h?1:null}return null}},{key:"_intersectDistance3D",value:function(e,t,i){var n=e.toMap(t,{include:[i]});return n&&(0,y.KC)(n,C,e.renderSpatialReference)?(0,g.i)(C,e.state.camera.eye):null}}]),i}(l.Z);(0,s._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],w.prototype,"graphic",null),(0,s._)([(0,d.Cb)()],w.prototype,"elevationInfo",null),(0,s._)([(0,d.Cb)({constructOnly:!0,nonNullable:!0})],w.prototype,"view",void 0),(0,s._)([(0,d.Cb)({value:null})],w.prototype,"focusedSymbol",null),(0,s._)([(0,d.Cb)({constructOnly:!0})],w.prototype,"layer",void 0),(0,s._)([(0,d.Cb)()],w.prototype,"interactive",void 0),(0,s._)([(0,d.Cb)()],w.prototype,"selectable",void 0),(0,s._)([(0,d.Cb)()],w.prototype,"grabbable",void 0),(0,s._)([(0,d.Cb)({value:!1})],w.prototype,"grabbing",null),(0,s._)([(0,d.Cb)()],w.prototype,"dragging",void 0),(0,s._)([(0,d.Cb)()],w.prototype,"hovering",null),(0,s._)([(0,d.Cb)({value:!1})],w.prototype,"selected",null),(0,s._)([(0,d.Cb)()],w.prototype,"cursor",void 0),w=(0,s._)([(0,f.j)("esri.views.interactive.GraphicManipulator")],w);var C=(0,_.c)(),x=(0,p.s1)()}}]);
//# sourceMappingURL=5227.328af6e0.chunk.js.map